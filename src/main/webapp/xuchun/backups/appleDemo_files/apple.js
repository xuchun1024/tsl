window.$P=function(){};var $=function(a){if("string"===typeof a||a instanceof String){return document.getElementById(a)}return a};Package=(function(){var a={};return function(c){if(c in a){return}a[c]=true;var f=window;var h=c.split(".");var b=h.length;var d;var g;for(d=0;d<b;++d){g=h[d];if(!f[g]){f[g]={}}f=f[g]}}})();coherent.strings["marker.image.placeholder"]="../img/block1px.gif";coherent.strings["error.required_value"]="This field is required.";Package("apple");if(typeof(AC)=="undefined"){AC={}}AC.addEvent=function(b,a,c){if(b.addEventListener){return b.addEventListener(a,c,false)}else{return b.attachEvent("on"+a,c)}};AC.removeEvent=function(b,a,c){if(b.removeEventListener){return b.removeEventListener(a,c,false)}else{return b.detachEvent("on"+a,c)}};AC.removeClassName=function(a,b){b=new RegExp(b,"g");a.className=a.className.replace(b,"").replace(/ +/g," ").replace(/ +$/gm,"").replace(/^ +/gm,"")};AC.getPreviousSibling=function(a){while(a=a.previousSibling){if(a.nodeType==1){return a}}};if(typeof(AC.Detector)=="undefined"){AC.Detector={_iOSVersion:null,iOSVersion:function(){if(this._iOSVersion===null){this._iOSVersion=(navigator.userAgent.match(/applewebkit/i)!==null&&(navigator.userAgent.match(/iphone/i)!==null||navigator.userAgent.match(/ipod/i)!==null||navigator.userAgent.match(/ipad/i)!==null))?parseFloat(navigator.userAgent.match(/os ([\d_]*)/i)[1].replace("_",".")):false}return this._iOSVersion},_style:null,_prefixes:null,_preFixes:null,_css:null,isCSSAvailable:function(m){if(!this._style){this._style=document.createElement("browserdetect").style}if(!this._prefixes){this._prefixes="-webkit- -moz- -o- -ms- -khtml- ".split(" ")}if(!this._preFixes){this._preFixes="Webkit Moz O ms Khtml ".split(" ")}if(!this._css){this._css={}}m=m.replace(/([A-Z]+)([A-Z][a-z])/g,"$1-$2").replace(/([a-z\d])([A-Z])/g,"$1-$2").replace(/^(\-*webkit|\-*moz|\-*o|\-*ms|\-*khtml)\-/,"").toLowerCase();switch(m){case"gradient":if(this._css.gradient!==undefined){return this._css.gradient}var m="background-image:",h="gradient(linear,left top,right bottom,from(#9f9),to(white));",g="linear-gradient(left top,#9f9, white);";this._style.cssText=(m+this._prefixes.join(h+m)+this._prefixes.join(g+m)).slice(0,-m.length);this._css.gradient=(this._style.backgroundImage.indexOf("gradient")!==-1);return this._css.gradient;case"inset-box-shadow":if(this._css["inset-box-shadow"]!==undefined){return this._css["inset-box-shadow"]}var m="box-shadow:",k="#fff 0 1px 1px inset;";this._style.cssText=this._prefixes.join(m+k);this._css["inset-box-shadow"]=(this._style.cssText.indexOf("inset")!==-1);return this._css["inset-box-shadow"];default:var f=m.split("-"),a=f.length,d,c,b;if(f.length>0){m=f[0];for(c=1;c<a;c++){m+=f[c].substr(0,1).toUpperCase()+f[c].substr(1)}}d=m.substr(0,1).toUpperCase()+m.substr(1);if(this._css[m]!==undefined){return this._css[m]}for(b=this._preFixes.length-1;b>=0;b--){if(this._style[this._preFixes[b]+m]!==undefined||this._style[this._preFixes[b]+d]!==undefined){this._css[m]=true;return true}}return false}return false}}}apple.GlobalNav=function(){var a=this;this.globalHeader=document.getElementById("apple-header");this.globalSearch=Element.query("#apple-header .search .wrapper input");if(this.globalHeader){if(navigator.userAgent.match(/applewebkit/i)){if(!navigator.geolocation){this.globalHeader.className+=" decelerate"}else{if(navigator.platform.match(/ipad/i)||navigator.platform.match(/iphone/i)||navigator.platform.match(/ipod/i)){this.globalHeader.className+=" ios"}}if(AC.Detector.iOSVersion()&&AC.Detector.iOSVersion()<=3.2){this.globalHeader.className+=" ios3"}if(!AC.Detector.isCSSAvailable("inset-box-shadow")||navigator.userAgent.match(/chrome/i)&&navigator.userAgent.match(/windows/i)){this.globalHeader.className+=" noinset"}}this.decorateSearchInput();this.vml();this.decorateTabStates();this.cancelRevealTimeout=window.setTimeout(function(){a.cancelReveal()},3000);if(AC.Detector.isCSSAvailable("transition-property")&&AC.Detector.isCSSAvailable("gradient")&&(AC.Detector.iOSVersion()===false||AC.Detector.iOSVersion()>=3.2)){this.globalHeader.className+=" enhanced";window.setTimeout(function(){a.reveal()},30)}else{this.show()}}};apple.GlobalNav.prototype.decorateSearchInput=function(){if(this.globalSearch){var b=this,a=true,c=Element.query(".search-reset"),d=Element.locateAncestor(this.globalSearch,function(f){return Element.hasClassName(f,"sitesearch-wrapper")});AC.addEvent(c,"mousedown",function(f){a=false;window.setTimeout(function(){a=true},75)});AC.addEvent(this.globalSearch,"focus",function(f){if(a){window.setTimeout(function(){b.globalHeader.className+=" searchmode"},10)}});AC.addEvent(this.globalSearch,"blur",function(f){if(a){window.setTimeout(function(){AC.removeClassName(b.globalHeader,"searchmode")},10)}else{a=true}})}};apple.GlobalNav.prototype.vml=function(){var f,a,c,b,d;if(!AC.Detector.isCSSAvailable("border-radius")&&document.namespaces&&this.globalHeader){document.namespaces.add("v","urn:schemas-microsoft-com:vml");f=document.createDocumentFragment();a=document.createElement("v:roundrect");a.setAttribute("id","globalheader-roundrect");a.setAttribute("stroked",true);a.setAttribute("strokeColor","#737373");a.setAttribute("arcSize",".1");f.appendChild(a);c=this.globalHeader.currentStyle.backgroundImage;this.globalHeader.style.backgroundImage="none";c=c.replace(/url\(["']*([^"']*)["']*\)/,"$1");b=document.createElement("v:fill");b.setAttribute("id","globalheader-fill");b.setAttribute("type","tile");b.setAttribute("src",c);a.appendChild(b);d=document.createElement("v:roundrect");d.setAttribute("id","globalheader-shadow");d.setAttribute("stroked",false);d.setAttribute("fillColor","#999");d.setAttribute("arcSize",".1");f.appendChild(d);this.globalHeader.appendChild(f)}};apple.GlobalNav.prototype.getPreviousNavItem=function(a){while(a.tagName.toLowerCase()!=="li"){a=a.parentNode}a=AC.getPreviousSibling(a);if(!a){return false}if(a.tagName.toLowerCase()!=="li"){return false}a=a.getElementsByTagName("a");if(!a[0]){return false}return a[0]};apple.GlobalNav.prototype.decorateTabStates=function(){this.globalNavItems=Element.queryAll(this.globalHeader,"ul.links a");var a=this,c=this.globalHeader.className.replace(/ .*/,""),b;for(b=this.globalNavItems.length-1;b>=0;b--){if(this.globalNavItems[b].href.match(c)){this.currentTab=this.globalNavItems[b]}AC.addEvent(this.globalNavItems[b],"mousedown",function(d){var f=(d.target)?d.target:d.srcElement;f=a.getPreviousNavItem(f);if(f&&f!==a.currentTab){f.className+=" before"}});AC.addEvent(this.globalNavItems[b],"mouseout",function(d){var f=(d.target)?d.target:d.srcElement;f=a.getPreviousNavItem(f);if(f&&f!==a.currentTab){AC.removeClassName(f,"before")}})}if(this.currentTab){this.currentTab=this.getPreviousNavItem(this.currentTab);this.currentTab.className+=" before"}};apple.GlobalNav.prototype.reveal=function(){if(!this.revealCanceled){var a=this;if(AC.Detector.isCSSAvailable("animation-name")&&!document.referrer.match(/^\w*:\/\/([^\.]*\.)+apple\.com/)){this.globalHeader.className+=" outside";this.globalHeader.addEventListener("transitionend",function(){a.revealed()},false)}else{window.setTimeout(function(){a.revealed()},300)}}};apple.GlobalNav.prototype.revealed=function(a){if(!this.revealCanceled&&(!a||typeof(a)=="number"||(a.target==this.globalHeader&&a.animationName.match(/reveal/i)))){this.show()}};apple.GlobalNav.prototype.show=function(){var a=this;window.clearTimeout(this.cancelRevealTimeout);this.globalHeader.style.visibility="visible";window.setTimeout(function(){a.loaded()},100)};apple.GlobalNav.prototype.loaded=function(){this.globalHeader.className+=" globalheader-loaded"};apple.GlobalNav.prototype.cancelReveal=function(){this.revealCanceled=true;this.show()};Package("apple.util");Math.clamp=function(c,b,a){return Math.min(Math.max(b,c),a)};apple.util.aliasMethodChain=function(b,d,c,a){b[d+"Without"+c.charAt(0).toUpperCase()+c.substring(1)]=b[d];b[d]=a};apple.util.elementSupportsAttribute=function(a,b){var c=document.createElement(a);if(b in c){return true}else{return false}};apple.util.makeSubclass=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a;a.superclass=c;if(c.prototype.constructor!=c){c.prototype.constructor=c}a.prototype.base=function(g){var d=this;var f=c.prototype[g];if("function"!=typeof(f)){return f}return function(){return f.apply(d,arguments)}}};apple.util.TEMPLATE_REGEX=/\$\{(\w+)\}/g;apple.util.expandTemplate=function(b,d,a){function c(h,f){var g=d[f];if(null===g||"undefined"===typeof(g)){return a}return g}return b.replace(this.TEMPLATE_REGEX,c)};apple.util.addOverflowEllipsis=function(g,d){var b=Element.getStyle(g,"display"),h=(g.textContent||g.innerText),a=0,c=0,f=h.length,k=h;g.style.display="inline";if(g.offsetWidth<=d){Element.setStyle(g,"display",b);return}while(g.offsetWidth!=d&&(a<f)){c=Math.floor(a+((f-a)/2));k=h.substr(0,c)+"&hellip;";g.innerHTML=k;if(g.offsetWidth<d){a=c+1}else{f=c}}g.innerHTML=k;Element.setStyle(g,"display",b)};apple.util.assignId=Element.assignId;apple.util.applyDefaults=Object.applyDefaults;apple.util.merge=Object.merge;Object.extend(Element,{hide:function(a){if(typeof a.cssDisplayCache=="undefined"){var b=a.style.display;if(b!="none"){a.cssDisplayCache=b}}a.style.display="none"},show:function(a){a.style.display=a.cssDisplayCache||"";a.cssDisplayCache=undefined},getDimensions:function(c){c=$(c);var h=Element.getStyle(c,"display");if(h&&h!="none"){return{left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight}}var b=c.style;var g=b.visibility;var d=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var f={width:c.offsetWidth,height:c.offsetHeight,left:c.offsetLeft,top:c.offsetTop};b.display=a;b.position=d;b.visibility=g;return f},getMarginBox:function(d){var c=Element.getStyles(d,["marginTop","marginBottom","marginRight","marginLeft"]);for(var b in c){c[b]=parseInt(c[b],10)||0}var a=c.marginLeft+c.marginRight;var f=c.marginTop+c.marginBottom;return{width:d.offsetWidth+a,height:d.offsetHeight+f}},setMarginBox:function(g,b){var f=Element.getStyles(g,["marginTop","marginBottom","marginRight","marginLeft","paddingTop","paddingBottom","paddingRight","paddingLeft","borderTopWidth","borderBottomWidth","borderRightWidth","borderLeftWidth"]);for(var d in f){f[d]=parseInt(f[d],10)||0}var c=f.marginLeft+f.marginRight+f.borderLeftWidth+f.borderRightWidth+f.paddingLeft+f.paddingRight;var a=f.marginTop+f.marginBottom+f.borderTopWidth+f.borderBottomWidth+f.paddingTop+f.paddingBottom;g.style.width=(b.width-c)+"px";g.style.height=(b.height-a)+"px"},makeClipping:function(a){a=$(a);if(!a){return a}a._originalOverflow=a.style.overflow||a.style.overflowY||a.style.overflowX;a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a||!("_originalOverflow" in a)){return a}a.style.overflow=a._originalOverflow||"";a._originalOverflow=null;return a},makePositioned:function(c,a){c=$(c);if(!c){return c}a=a||"relative";var b=Element.getStyle(c,"position");if("relative"==b||"absolute"==b||a==b){return c}c._originalPosition=b;c.style.position=a||"relative";if(window.opera){c.style.top=c.style.left="0"}return c},undoPositioned:function(a){a=$(a);if(!a||!("_originalPosition" in a)){return a}a.style.position=a._originalPosition||"";a._originalPosition=null;return a},getPositionedOffset:function(b){b=$(b);var a=0;var d=0;do{a+=b.offsetTop||0;d+=b.offsetLeft||0;b=b.offsetParent;if(b){if(b.tagName=="BODY"){break}var c=Element.getStyle(b,"position");if(c=="relative"||c=="absolute"){break}}}while(b);return{left:d,top:a}},makeAbsolute:function(b){b=$(b);if(b.style.position=="absolute"){return}var g=Element.getPositionedOffset(b);var f=g.top-parseFloat(Element.getStyle(b,"margin-top")||0);var d=g.left-parseFloat(Element.getStyle(b,"margin-left")||0);var c=b.clientWidth-parseFloat(Element.getStyle(b,"padding-left")||0)-parseFloat(Element.getStyle(b,"padding-right")||0);var a=b.clientHeight-parseFloat(Element.getStyle(b,"padding-top")||0)-parseFloat(Element.getStyle(b,"padding-bottom")||0);b._originalLeft=b.style.left;b._originalTop=b.style.top;b._originalWidth=b.style.width;b._originalHeight=b.style.height;b._originalPosition=b.style.position;b.style.position="absolute";b.style.top=f+"px";b.style.left=d+"px";b.style.width=c+"px";b.style.height=a+"px"},undoMakeAbsolute:function(a){a=$(a);if(a.style.position!="absolute"){return}a.style.position=a._originalPosition;a.style.left=a._originalLeft;a.style.top=a._originalTop;a.style.width=a._originalWidth;a.style.height=a._originalHeight},getElementsByClassName:function(b,a){return Element.queryAll(a,"."+b)},getOpacity:function(a){return Element.getStyles(a,"opacity")},setOpacity:function(a,b){a=$(a);if(b==1||b===""){a.style.opacity=""}else{if(b<0.00001){a.style.opacity=0}else{a.style.opacity=b}}return a},getPadding:function(c){var a=document.defaultView;var b=a.getComputedStyle(c,null);return{left:parseFloat(b.paddingLeft)||0,top:parseFloat(b.paddingTop)||0,right:parseFloat(b.paddingRight)||0,bottom:parseFloat(b.paddingBottom)||0}}});var useOpacity=(typeof document.createElement("div").style.opacity!="undefined");if(!useOpacity){Object.extend(Element,{setOpacity:function(a,d){a=$(a);var c=Element.getStyle(a,"filter");var b=a.style;if(d==1||d===""){b.filter=c.replace(/alpha\([^\)]*\)/gi,"");return a}if(d<0.00001){d=0}b.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(d*100)+")";return a}})}if(coherent.Browser.IE){Object.extend(Element,{getPadding:function(b){var a=b.currentStyle;return{left:parseFloat(a.paddingLeft)||0,top:parseFloat(a.paddingTop)||0,right:parseFloat(a.paddingRight)||0,bottom:parseFloat(a.paddingBottom)||0}}})}Object.extend(Event,{sendMouseEvent:(function(){if(document.createEvent){return function(f,c,a,b){var d=document.createEvent("MouseEvents");if(d.initMouseEvent){d.initMouseEvent(c,a,b,window,0,0,0,0,0,false,false,false,false,0,null)}else{d=document.createEvent("UIEvents");d.initEvent(c,a,b);d.view=window;d.detail=0;d.screenX=0;d.screenY=0;d.clientX=0;d.clientY=0;d.ctrlKey=false;d.altKey=false;d.metaKey=false;d.shiftKey=false;d.button=0;d.relatedTarget=null}return f.dispatchEvent(d)}}else{return function(f,c,a,b){var d=document.createEventObject("MouseEvents");d.bubbles=a;d.cancelable=b;d.view=window;d.detail=0;d.screenX=0;d.screenY=0;d.clientX=0;d.clientY=0;d.ctrlKey=false;d.altKey=false;d.metaKey=false;d.shiftKey=false;d.button=1;return f.fireEvent("on"+c,d)}}})(),isNumpadNumKey:function(a){return a>=96&&a<=111},isAlphaNumKey:function(a){if(!this._reverseKeys){this._reverseKeys=(function(){var d={};var c=Event.KEYS;for(var b in c){d[c[b]]=b}return d})()}return this.isNumpadNumKey(a)||!this._reverseKeys[a]},mousePosition:function(b){var c={x:0,y:0};if(b.pageX||b.pageY){c.x=b.pageX;c.y=b.pageY}else{var a=document.documentElement||document.body;c.x=b.clientX+a.scrollLeft-a.clientLeft;c.y=b.clientY+a.scrollTop-a.clientTop}return c},isMouseOverElement:function(f,d){var b=Event.mousePosition(f);var k=Element.getRect(d);var h=k.top;var a=h+d.offsetHeight;var g=k.left;var c=g+d.offsetWidth;return(b.x>=g&&b.x<=c&&b.y>=h&&b.y<=a)},onUnload:function(a){if(!arguments.callee.__fn){arguments.callee.__fn=function(){var b=arguments.callee.__handlers;while(b.length){(b.pop())()}delete arguments.callee.__handlers};Event.observe(window,"unload",arguments.callee.__fn);arguments.callee.__fn.__handlers=[]}arguments.callee.__fn.__handlers.push(a)},fixEvent:function(b){if(!b){if(window.event){b=window.event}}if(coherent.Browser.IE){if(!b.target){b.target=b.srcElement}if(!b.currentTarget){b.currentTarget=b.srcElement}if(!b.layerX){b.layerX=b.offsetX}if(!b.layerY){b.layerY=b.offsetY}var c=(b.srcElement&&b.srcElement.ownerDocument)?b.srcElement.ownerDocument:document;var a=(c.compatMode=="BackCompat")?c.body:c.documentElement;if(!b.pageX){b.pageX=b.clientX+(a.scrollLeft||0)}if(!b.pageY){b.pageY=b.clientY+(a.scrollTop||0)}if(b.type=="mouseover"){b.relatedTarget=b.fromElement}if(b.type=="mouseout"){b.relatedTarget=b.toElement}}return b},KEYS:{KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_HELP:47,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_NUMPAD_MULTIPLY:106,KEY_NUMPAD_PLUS:107,KEY_NUMPAD_ENTER:108,KEY_NUMPAD_MINUS:109,KEY_NUMPAD_PERIOD:110,KEY_NUMPAD_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145}});window.JSONP={get:function(b,m){if(!b){return{}}var d=((new Date()).getTime()+Math.floor(Math.random()*100000)).toString(32);var q=new coherent.Deferred();var f=m.callbackParamName||"callback";var h="apple_jsonp_callback_"+d,g=m.params||{},o;if(m.enableCache){o="apple_jsonp_callback";var n=g.find;window.queryParamsToFunctionNameMap=window.queryParamsToFunctionNameMap||{};window.queryParamsToFunctionNameMap[n]=h;if(!window[o]){window[o]=function(){var t=arguments[0];n=t.body.query;var r=window.queryParamsToFunctionNameMap[n];if(r&&window[r]){window[r](t)}}}}else{o=h}g[f]=o;var a=b+((-1==b.indexOf("?"))?"?":"&")+Object.toQueryString(g);var c;var k=document.createElement("script");k.type="text/javascript";k.src=a;window[h]=function(){var t=arguments[0];try{q.callback(t)}catch(u){}k.parentNode.removeChild(k);try{delete window[h]}catch(r){}};document.getElementsByTagName("HEAD")[0].appendChild(k);return q}};Package("apple");window.JSONRPC=(function(){function a(q,n){var t=document.createElement("form");t.action=q;t.method="post";var u;var m;var w={};var r=(function(){return function(x,v,y){var o=document.createElement("input");o.name=v;o.type="hidden";x.appendChild(o);o.value=y}})();for(u in n){m=n[u];if(n[u]===w[u]){continue}if(m instanceof Array){m.forEach(function(o){r(t,u,o)})}else{r(t,u,m)}}t.style.position="absolute";t.style.visibility="hidden";t.style.height="0px";t.style.width="0px";document.body.appendChild(t);t.submit()}function h(n,m){if(!n){return}m=Object.toQueryString(m);if(m){if(n.indexOf("?")){n+="&"}else{n+="?"}n+=m}window.location.href=n}function k(n){if(!n){return false}var u=false;var m=parseInt(n.head.status,10);switch(m){case 301:case 302:case 303:case 304:case 305:case 306:case 307:u=true;break;default:break}if(!u){return false}var r=n.head.data;var q=r.url;var t=r.method;var o=r.args;if("post"===t){a(q,o)}else{h(q,o)}return true}function f(n){if(!n){return true}var m=parseInt(n.head.status,10);if(m>=400&&m<600){return true}return false}function d(n,m){var q;if(m.head&&m.head.data&&m.head.data.microEvent){q=m.head.data.microEvent}else{if(m.body&&m.body.microEvent){q=m.body.microEvent;delete m.body.microEvent}}var o;if(m.head&&m.head.data&&m.head.data.metrics){o=m.head.data.metrics}else{if(m.body&&m.body.metrics){o=m.body.metrics;delete m.body.metrics}}if(!q&&!o&&!n){return}o=Object.extend(n||{},o);apple.metrics.fireEventCollection({microEvent:q,metrics:o})}var c={sync:false,responseContentType:"application/json"};var b=[];function g(u,o,r,n){function q(v){var w;d(n.metrics,v);if(k(v)){w=new Error("Response redirected");w.redirect=true}else{if(f(v)){w=new Error("Response returned errors")}}if(w){w.response=v;return w}return v.body}n=Object.applyDefaults(n,c);var t=n.protocol;var m=(t==="JSONP")?JSONP.get(o,n):XHR.request(u,o,r,n);m.addCallback(q);b.forEach(function(v){m.addCallback(v)},this);return m}g.get=function(n,o,m){return g("GET",n,o,m)};g.post=function(n,o,m){return g("POST",n,o,m)};g.__registerGlobalCallback=function(m){b.push(m)};return g})();window.DeferredJSON=Class.create(coherent.KVO,{constructor:function(a){Object.extend(this,a)},__keysToIgnore:Set("actionKey","_url","url","_version","version","loading","clearOldKeys"),__factory__:function(d){var b=Array.from(arguments);var a=this;function c(){}return function(){if(d){["extractContent","extractUpdates","setCallback"].forEach(function(g){if(g in d&&"string"===typeof(d[g])){d[g]=this[d[g]].bind(this)}},this)}c.prototype=a.prototype;var f=new c();a.prototype.constructor.apply(f,b);return f}},url:function(){return this._url},version:function(){return this._version},setUrl:function(a){this._url=a;return a},setVersion:function(a){this._version=a;return a},refresh:function(){this.setValueForKey(true,"loading");var a=this.url();if(!a){return null}var b=JSONRPC.get(a,this.extraArgs,{sync:this.sync});b.addMethods(this.set.bind(this),this.failure.bind(this));return b},performAction:function(c,b){var a=Object.extend({},this.extraArgs);a=Object.extend(a,b);if(!this.actionKey){throw new Error("actionKey value not set.")}a[this.actionKey]=c;return this.sendRequest(this.url(),a)},sendRequest:function(c,b,a){a=a||{method:"post"};this.setValueForKey(true,"loading");var f=JSONRPC[a.method](c,b);f.addMethods(this.set.bind(this),this.failure.bind(this));return f},failure:function(a){if(!a.redirect){this.setValueForKey(false,"loading")}return a},hasContent:function(){return Set.toArray(this.keys()).length},keys:function(){return this.__contentKeys||new Set()},setByUrl:function(b){var a={timeout:5000};req=XHR.get(b,null);req.addMethods(this.recommendationSuccess.bind(this),this.failure.bind(this))},recommendationSuccess:function(a){if(typeof a!=="object"){a=JSON.parse(a)}if(a&&typeof(a)==="object"&&"body" in a){this.set(a.body)}},set:function(c){this.__contentKeys=this.__contentKeys||new Set();if(c.url){this.setUrl(c.url)}this.setVersion(c.version?c.version:null);if(!c.content&&!c.update&&!c.replace){return this.refresh()}this.setValueForKey(false,"loading");var b=c.content||{};var d=c.update;var f=c.content?true:false;if(c.replace){for(var g in c.replace){b[g]=c.replace[g]}}if(!b.addObserverForKeyPath){b=coherent.KVO.adaptTree(b)}if(d&&this.extractUpdates){d=this.extractUpdates(d)}function a(r,n){var h=n.mutableKeys(),q,o;if(r){this.mutableKeys().forEach(function(t){if(h.indexOf(t)===-1&&this[t]){n.setValueForKey(null,t);h.push(t)}},this)}function k(t){if(!t){return}var u=(t in n&&n[t]!==null)?"add":"remove";Set[u](this.__contentKeys,t);this.willChangeValueForKey(t);this[t]=n[t]}function m(t){if(!t){return}this.didChangeValueForKey(t)}h.forEach(k,this);h.forEach(m,this);if(d&&d.data){for(q in d.data){o=d.data[q];if(typeof o=="object"&&o!==null){o=coherent.KVO.adaptTree(o)}this.setValueForKeyPath(o,q)}}if(this.setCallback){this.setCallback(n)}return n}if(this.extractContent){b=this.extractContent(b)}if(b===false){return false}else{if(b instanceof coherent.Deferred){b.addCallback(a.bind(this,f));return b}else{return a.call(this,f,b)}}}});$P(window.DeferredJSON.prototype,"set","Content");Package("apple.behavior.metrics");apple.behavior.metrics.ClickMap=function(a){this.anchorClickHandler=function(b){var d=b.target||b.srcElement,c;c=Element.locateAncestor(d,function(f){return f.tagName==="A"},a);if(c){apple.behavior.metrics.storePageEventData(c,b)}};this.formSubmitHandler=function(b){var c=b.target||b.srcElement;if(c&&c.nodeName&&c.nodeName.toLowerCase()==="form"){apple.behavior.metrics.storePageEventData(c)}}};apple.behavior.metrics.getClickMapId=function(d){var a,c,b=/s_objectID=['"](.*)['"]/i;if(d){a=d.getAttribute("data-s-object-id")||null;if(!a){c=d.getAttribute("onclick")||"";if(b.test(c)){a=b.exec(c)[1]}}}return a||null};apple.behavior.metrics.isExternalLink=function(b){var d=apple.Tracking.getSitecatalystInstance(),c=(d.linkInternalFilters||window.s.linkInternalFilters||""),a=false,g=b.nodeName.toLowerCase(),f;if(g==="a"&&"hostname" in b&&b.hostname.length&&c.length>0){f=c.split(",").filter(function(h){return(b.hostname.indexOf(h)!==-1)});a=(f.length===0)}return a};apple.behavior.metrics.storeDataForFuturePageEvent=function(b,d){var h,g={timestamp:(new Date()).getTime()},m=metricsStorage,c;c=document.createElement("a");c.setAttribute("href",b);if(c.hostname&&(c.hostname!==window.document.location.hostname)){return}for(var a in d){g[a.toLowerCase()]=d[a]}h=apple.metrics.getStorageKey(b);g=window.JSON.stringify(g);try{m.set(h,g);m.set(apple.metrics.Metrics.CONSTANTS.pageLoadDataKeyLatestKeyName,h)}catch(f){}};apple.behavior.metrics.parseMetricsDataFromElement=function(c){var g,d,a,h,k={},b={},n=[],f=[],m=["eVar1","eVar30","eVar31","prop37","prop42"];for(g=0;g<m.length;g++){a=m[g],h=a.toLowerCase(),d=c.getAttribute("data-"+h);if(d&&d.length){k[a]=d;n.push(a);b[h]=d;f.push(h)}}return{keys:f,vars:b,metrics:Object.extend({linkTrackVars:n.join(","),linkTrackEvents:""},k)}};apple.behavior.metrics.storePageEventData=function(d,a){var b=d.pathname||d.action,g;g=this.parseMetricsDataFromElement(d);if(g.keys.length===0){return}if(apple.behavior.metrics.isExternalLink(d)===true){var f,c;f=(d.target||"").toLowerCase();c=(["","_self","_parent","_top"].indexOf(f)===-1);if(c===true){apple.Tracking.track(d,"External Link (targeted window)",g.metrics)}else{a.preventDefault();apple.Tracking.track(d,"External Link",g.metrics,function(){window.location=d.href})}}else{this.storeDataForFuturePageEvent(b,g.vars)}};apple.behavior.metrics.captureProp42AndSubmitForm=function(a){};apple.behavior.metrics.cleanupStaleStorage=function(){var f=metricsStorage,b=24*60*60*1000,a=(new Date()).getTime(),h=apple.metrics.transformKey(apple.metrics.Metrics.CONSTANTS.pageLoadDataKeyPrefix),m=f.length(),k,c,g,d;for(d=m-1;d>=0;d--){k=f.getKey(d);if(k&&k.indexOf(h)!==-1){c=f.get(k);c=c?apple.data.json.parse(c):{};g=c.timestamp||a;if((a-g)>=b){f.remove(k)}}}};Event.onLoad(function(){if(!apple.metrics.evarDataNodesEnabled){return}var b=document.body,a=new apple.behavior.metrics.ClickMap(b);Event.observe(b,"click",a.anchorClickHandler.bind(a));Event.observe(b,"submit",a.formSubmitHandler.bind(a));apple.behavior.metrics.cleanupStaleStorage.delay(2000)});Package("apple.behavior");apple.behavior.Striper=function(){var b=null;var d=["odd","even"];var a=5;function c(k){var g=k.getElementsByTagName("tbody");for(var f=0;f<g.length;f++){var m=g[f].getElementsByTagName("tr");for(var h=0;h<m.length;h++){var n=m[h].className.split(" ");for(var o=0;o<d.length;o++){if(n.indexOf(d[o])!=-1){n.splice(n.indexOf(d[o]),1)}}n.push(d[h%d.length]);m[h].className=n.join(" ")}}}return function(k){var h;var g;if("undefined"===typeof k){var f=document.getElementsByTagName("table");if(null!==b&&"string"===typeof b){for(g=0;g<f.length;g++){if(f[g].className.indexOf(b)!=-1){h.push(f[g])}}}else{h=f}}else{if("string"===typeof k){h=[document.getElementById(k)]}else{h=[k]}}for(g=0;g<Math.min(a,h.length);g++){c(h[g])}for(var m=10;g<h.length;g++){window.setTimeout(function(){var n=h[g];return function(){c(n)}}(),m);m+=10}}}();Event.onDomReady(apple.behavior.Striper);Package("apple.behavior");apple.behavior.TextFieldPlaceholder=(function(){if(!(coherent&&coherent.TextField)){return null}var a="placeholder";var k="field-with-placeholder";var r=Element.regexForClassName(k);var q=coherent.TextField.prototype;var b=q.init;var n=q.onkeydown;var t=q.becomeFirstResponder;var u=q.setMarkerValue;var v=q.clearMarkerValue;var f=q.presentError;var z=q.endEditing;var h=q.onkeyup;coherent.TextField.prototype.init=x;coherent.TextField.prototype.presentError=c;coherent.TextField.prototype.onkeyup=w;coherent.TextField.prototype.endEditing=g;function y(C){var E=C.viewElement();var D=Element.query('label[for="'+E.id+'"].'+a);if(!D&&C.nullPlaceholder&&C.nullPlaceholder.toString()){D=document.createElement("label");D.setAttribute("for",E.id);D.htmlFor=E.id;D.innerHTML="<span>"+C.nullPlaceholder+"</span>";D.className=a}else{if(D){try{if(D.getElementsByTagName("span")[0]){C.nullPlaceholder=D.getElementsByTagName("span")[0].firstChild.nodeValue}else{C.nullPlaceholder=D.innerHTML}}catch(F){return false}}else{return false}}C.label=D;var G=E.parentNode;if(G.nodeName.toUpperCase()!="SPAN"){G=document.createElement("span");E.parentNode.replaceChild(G,E)}if(!r.test(G.className)){Element.addClassName(G,k)}if(E.parentNode!=G){G.appendChild(E)}G.insertBefore(D,E);return true}function o(C){if(y(C)){C.onkeydown=m;C.becomeFirstResponder=d;C.setMarkerValue=B;C.clearMarkerValue=A;Event.observe(C.viewElement(),"input",C.clearMarkerValue.bind(C));Event.observe(C.viewElement(),"paste",C.clearMarkerValue.bind(C));Event.onDomReady(function(){if(C.viewElement().value&&!C.validationError){C.clearMarkerValue()}})}}function x(){b.call(this);o(this);if(this.viewElement().value){this.clearMarkerValue()}}function m(C){n.call(this,C);var D=C.keyCode;if(Event.isAlphaNumKey(D)||D==32||D==8||D==46){this.clearMarkerValue()}}function d(){Element.addClassName(this.label,"focus");return t.call(this)}function B(C){if(C=="nullPlaceholder"){this.viewElement().value="";this.label.style.display="";Element.removeClassName(this.label,"hidden");Element.removeClassName(this.label,"focus")}}function c(C){var D=this.viewElement().parentNode;Element.addClassName(D,coherent.Style.kInvalidValueClass);return f.call(this,C)}function A(){var C=this.viewElement().parentNode;Element.removeClassName(C,coherent.Style.kInvalidValueClass);Element.addClassName(this.label,"hidden")}function g(){Element.removeClassName(this.viewElement().parentNode,coherent.Style.kEditingClass);z.call(this)}function w(C){h.call(this,C);if(this.updateTimer){Element.addClassName(this.viewElement().parentNode,coherent.Style.kEditingClass)}}return function(C){if(C instanceof coherent.TextField){if(C.markerValue){C.clearMarkerValue()}o(C)}}})();if("undefined"===typeof(window.LivePerson)){window.LivePerson={}}Object.extend(window.LivePerson,{chatButtonId:"lpChatButton",inviteId:"inviteBadge",chatInvitation:"Chat now!",animator:null,init:function(){var a=$("aos_header");if(!a){return}this.isPancakeMode=Element.hasClassName(a,"collapsed")||Element.hasClassName(a,"compact-header")},createInvitation:function(){var b=$(this.chatButtonId);if(!b){return null}var a=$(this.inviteId);if(a!==null){return null}a=document.createElement("button");a.id=this.inviteId;a.appendChild(document.createTextNode(this.chatInvitation));b.parentNode.insertBefore(a,b);if(this.isPancakeMode){var c=Element.getPositionedOffset(b);a.style.left=c.left+"px";a.style.top=c.top+"px"}else{this.originalWidth=Element.getDimensions(a).width;a.style.width="0"}a.onclick=this.inviteButtonClicked.bindAsEventListener(this);return a},showInviteButton:function(){this.animator.play(this.getInviteAnimation(),this.onShowInviteComplete.bind(this))},hideInviteButton:function(){this.animator.reverse(this.onHideInviteComplete.bind(this))},removeInviteButton:function(){var a=$(this.inviteId);a.parentNode.removeChild(a)},onShowInviteComplete:function(){window.setTimeout(this.hideInviteButton.bind(this),2500)},onHideInviteComplete:function(){if(this.inviteTimedOut===true){this.removeInviteButton()}else{window.setTimeout(this.showInviteButton.bind(this),2500)}},getInviteAnimation:function(){var b=apple.fx.easeOutSine;var a=this.originalWidth;var c=$(this.inviteId);return function(d){d=b(d);c.style.width=d*a+"px"}},oninvite:function(){var a=this.createInvitation();if(!a){return}if(this.isPancakeMode){return}this.animator=new apple.fx.Animator({duration:250});this.animator.play(this.getInviteAnimation(),this.onShowInviteComplete.bind(this))},ontimeout:function(){if(this.isPancakeMode){this.removeInviteButton();return}this.inviteTimedOut=true},inviteButtonClicked:function(a){this.invitationAccepted()}});Event.onDomReady(window.LivePerson.init.bind(window.LivePerson));(function(){if(!window.apple){window.apple={}}if(!window.apple.data){window.apple.data={}}if(!window.apple.data.xml){window.apple.data.xml={}}var d=function d(m){return !!(m.ownerDocument&&m.ownerDocument.evaluate)},b=function b(m){return !!(m.ownerDocument&&"selectNodes" in m.ownerDocument)},k="first",a="all",h=function h(o,n){var q,r=[],m;if(d(o)){q=o.ownerDocument.evaluate(n,o,null,XPathResult.ANY_TYPE,null);m=q.iterateNext();while(m){r.push(m);m=q.iterateNext()}}else{if(b(o)){r=o.selectNodes(n)}else{throw c("UserAgent does not support xPath evaluation on this node")}}return r},g=function g(o,n){var q,m;if(d(o)){q=o.ownerDocument.evaluate(n,o,null,XPathResult.ANY_TYPE,null);m=q.iterateNext()}else{if(b(o)){m=o.selectSingleNode(n)}else{throw c("UserAgent does not support xPath evaluation on this node")}}return m},f=function f(){var n=arguments[0],o=arguments[1]||n,q=arguments[2]||arguments[1],m;switch(n){case k:m=g(o,q);break;case a:m=h(o,q);break;default:m=h(o,q);break}return m},c=function c(n){n="An error occurred"||n;var m="AppleDataXmlError";return{name:m,message:n}};apple.data.xml.FIRST=k;apple.data.xml.ALL=a;apple.data.xml.find=f;apple.data.xml.error=c})();Package("apple.fx");apple.fx.Animator=function(a){this._direction=1;this.t=0;this.config=Object.applyDefaults(a,arguments.callee.DEFAULTS)};apple.fx.Animator.DEFAULTS={actions:[],duration:250,frameRate:60,callback:null};apple.fx.Animator.prototype.setDuration=function(a){this.config.duration=a};apple.fx.Animator.prototype.finishNow=function(){function a(b){b(1);if("finish" in b){b.finish(1)}}this.config.actions.forEach(a)};apple.fx.Animator.prototype.stop=function(){if(this._timer){window.clearTimeout(this._timer)}this._timer=0};apple.fx.Animator.prototype.play=function(a,b){this.stop();if("function"==typeof(a)){a=[a]}if(a&&this.config.actions!=a){if(0<this.t&&1>this.t){this.finishNow()}this.config.actions=a.filter(function(c){return null!==c&&"undefined"!=typeof(c)});this.t=0}if(1==this.t){this.t=0}this._direction=1;this._run(this.config.actions,this._direction,this.t,b||this.config.callback)};apple.fx.Animator.prototype.reverse=function(a){this.stop();this._direction=(this._direction>0)?-1:1;this._run(this.config.actions,this._direction,this.t,a||this.config.callback)};apple.fx.Animator.prototype._run=function(h,r,k,t){var u=this;var b;var f=this.config.duration;var n=h.length;var m;var g=Math.round(1000/this.config.frameRate);for(m=0;m<n;++m){if("setup" in h[m]){h[m].setup()}}function q(){u._timer=0;for(m=0;m<n;++m){if("finish" in h[m]){h[m].finish(u.t)}}if(t){t(u.t)}}function d(){var v=(new Date()).getTime()-b;if(v>f){v=f}u.t=Math.round(v/f*1000)/1000;for(m=0;m<n;++m){h[m](u.t)}if(v==f){q();return}u._timer=window.setTimeout(a,g)}function o(){var v=(new Date()).getTime()-b;if(v>f){v=f}u.t=1-v/f;for(m=0;m<n;++m){h[m](u.t)}if(v==f){q();return}u._timer=window.setTimeout(a,g)}var a=d;if(r<0){a=o;k=1-k}function c(){b=(new Date()).getTime()-f*k;a()}this._timer=window.setTimeout(c,0)};Package("apple.fx");apple.fx.ContentSwapper=function(a){a=Object.applyDefaults(a,arguments.callee.DEFAULTS);this.base("constructor")(a)};apple.util.makeSubclass(apple.fx.ContentSwapper,apple.fx.Animator);apple.fx.ContentSwapper.DEFAULTS={duration:1000,transition:"crossfade"};Class.extend(apple.fx.ContentSwapper,{fixElementDimensions:function(d){var c=$(this._measureDiv);if(!c){c=document.createElement("div");this._measureDiv=Element.assignId(c);c.style.position="relative";var b=$(this.config.id);b.appendChild(c)}d._originalWidth=d.style.width;d._originalHeight=d.style.height;if(d.style.width&&d.style.height){return}var m=d.style.display;d.style.display="block";var q=Element.getStyles(d,["width","height","paddingTop","paddingRight","paddingBottom","paddingLeft"]);function k(r){var h=r.lastChild;while(h&&h.nodeType!==1){h=h.previousSibling}return h}var o=0,f,a=k(d);while(a){f=parseFloat(Element.getStyles(a,"marginBottom")||0,10);if(f<0){o+=f}a=k(a)}var n=parseInt(q.width||0,10)-parseFloat(q.paddingLeft||0,10)-parseFloat(q.paddingRight||0,10);var g=parseInt(q.height||0,10)-parseFloat(q.paddingTop||0,10)-parseFloat(q.paddingBottom||0,10)+o;d.style.width=n+"px";d.style.height=g+"px";d.style.display=m},undoFixElementDimensions:function(a){a.style.width=a._originalWidth||"";a.style.height=a._originalHeight||""},swap:function(h,f,d,k,b){f=$(f);d=$(d);this.fixElementDimensions(f);this.fixElementDimensions(d);var g=[].concat(this._setup(h,f,d));if(b){g=g.concat(b)}var a=$(this.config.id);Element.makeClipping(a);Element.makePositioned(a);Element.makePositioned(f,"absolute");Element.makePositioned(d,"absolute");function c(){Element.undoPositioned(d);Element.undoPositioned(f);Element.undoClipping(a);Element.undoPositioned(a);this.undoFixElementDimensions(d);this.undoFixElementDimensions(f);a.style.height="";a.style.width="";if(k){k()}}this.play(g,c.bind(this))},_setup:function(h,f,b){var a=$(this.config.id);var d=a.offsetHeight-parseFloat(Element.getStyle(a,"padding-top")||0)-parseFloat(Element.getStyle(a,"padding-bottom")||0);var c=apple.fx;h=h||"crossfade";a.style.height=d+"px";var g=[];switch(h){case"fadein":g.push(new c.FadeIn(apple.fx.linearTween,b));g.push(new c.Hide(null,f));break;case"crossfade":case"swapfade":if(f&&b){g.push(new c.FadeOutIn(apple.fx.linearTween,f,b))}else{if(f){g.push(new c.FadeOut(apple.fx.linearTween,f))}else{if(b){g.push(new c.FadeIn(apple.fx.linearTween,b))}}}break;case"left":case"right":g.push(new c.Pan(apple.fx.easeInOutSine,f,b,h=="left"?-1:1));break;case"up":case"down":g.push(new c.Scroll(apple.fx.easeInOutSine,f,b,h=="up"?-1:1));break;default:if(f&&b){g.push(new c.CrossFade2(apple.fx.linearTween,f,b))}else{if(f){g.push(new c.FadeOut(apple.fx.linearTween,f))}else{if(b){g.push(new c.FadeIn(apple.fx.linearTween,b))}}}break}if(f&&b){f.style.zIndex=1;b.style.zIndex=2;g.push(new c.Resize(apple.fx.easeInOutSine,a,Element.getDimensions(b),Element.getDimensions(f)))}return new apple.fx.Chain(g)}});Package("apple.fx");apple.fx.CrossFade=function(a,b){if(!a||a<10){a=this.getDefaultSpeed()}if(!b){b=this.getDefaultIncrement()}this.fadeSpeed=a;this.fadeInc=b;this.fadeStep=0};apple.fx.CrossFade.DEFAULT_SPEED=8;apple.fx.CrossFade.DEFAULT_INCREMENT=0.05;apple.fx.CrossFade.prototype.getDefaultSpeed=function(){return apple.fx.CrossFade.DEFAULT_SPEED};apple.fx.CrossFade.prototype.getDefaultIncrement=function(){return apple.fx.CrossFade.DEFAULT_INCREMENT};apple.fx.CrossFade.prototype.fade=function(a,c,f){a=[].concat(a);c=[].concat(c);if(this.lastFromObjects){this.stopAnimation();this.lastFromObjects.forEach(Element.hide)}this.lastFromObject=a;this.fadeStep=0;function b(g){Element.setStyles(g,{top:"0px",left:"0px",opacity:1});Element.show(g)}function d(g){Element.setStyles(g,{top:"0px",left:"0px",opacity:0});Element.show(g)}a.forEach(b);c.forEach(d);this._fade(a,c,f)};apple.fx.CrossFade.prototype.swap=apple.fx.CrossFade.prototype.fade;function roundToPlaces(c,b){if(!b){return Math.round(c)}var a=Math.pow(10,b);return Math.round(c*a)/a}apple.fx.CrossFade.prototype._fade=function(b,d,h){this.stopAnimation();this.fadeStep=roundToPlaces(this.fadeStep+this.fadeInc,6);if(this.fadeStep<1){function g(k){return function(m){Element.setOpacity(m,k)}}var a=g(this.fadeStep);var f=g(roundToPlaces(1-this.fadeStep,6));(d||[]).forEach(a);(b||[]).forEach(f);var c=this;this.timer=window.setTimeout(function(){c._fade(b,d,h)},this.fadeSpeed)}else{this._finishFade(b,d,h)}};apple.fx.CrossFade.prototype._finishFade=function(a,b,d){function c(f){Element.setOpacity(f,1)}this.lastFromObject=null;this.stopAnimation();(a||[]).forEach(Element.hide);(b||[]).forEach(c);if(d){d()}};apple.fx.CrossFade.prototype.stopAnimation=function(){if(this.timer){window.clearTimeout(this.timer)}};Package("apple.fx");apple.fx.fadeShow=function(b,f,h,g){b=$(b);var a=Element.getStyle(b,"opacity");if(a<1){f=(1-a)*f}else{Element.setStyle(b,"opacity",0)}Element.show(b);var d=new apple.fx.Animator({duration:f});var c=new apple.fx.Fade(b,h,a,1);return{play:function(){d.play(c,g)}}};apple.fx.fadeHide=function(b,f,k,h){b=$(b);var a=Element.getStyle(b,"opacity");f=a*f;function g(){Element.hide(b);Element.setStyle(b,"opacity",1);if(h){h(b,d)}}var d=new apple.fx.Animator({duration:f});var c=new apple.fx.Fade(b,k,a,0);return{play:function(){d.play(c,g)}}};Package("apple.fx");apple.fx.Morph=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS)};apple.fx.Morph.prototype.DEFAULTS={duration:500,frameDelay:25,callback:function(){},style:{},easing:function(a){return 0.5+Math.sin((a+1.5)*Math.PI)/2}};apple.fx.Morph.prototype.start=function(a){if(this._timer){return}var b=$(this.config.element);if(!b){return}if(a){this.config=Object.applyDefaults(a,this.DEFAULTS)}this._animator=this.animate.bind(this);this._now=0;this._start=Object.applyDefaults(Element.getRect(b,true),Element.getDimensions(b));this._start.opacity=Element.getStyle(b,"opacity");var c=Element.getRect(b.parentNode,true);this._start.top-=c.top;this._start.left-=c.left;this._delta={};for(var d in this.config.style){this._delta[d]=this.config.style[d]-this._start[d];if(!this._delta[d]){delete this._delta[d]}}this._timer=window.setTimeout(this._animator,this.config.frameDelay)};apple.fx.Morph.prototype.stop=function(){if(!this._timer){return}window.clearTimeout(this._timer);this._timer=0;this._animator=null};apple.fx.Morph.prototype.animate=function(){var a;var b=$(this.config.element);if(!b){return}this._now+=this.config.frameDelay;for(var c in this._delta){a=this.config.easing(this._now/this.config.duration)*this._delta[c]+this._start[c];if("opacity"==c){Element.setStyle(b,"opacity",a)}else{b.style[c]=a+"px"}}if(this._now>=this.config.duration){if(this.config.callback){this.config.callback()}return}this._timer=window.setTimeout(this._animator,this.config.frameDelay)};Package("apple.fx");apple.fx.SwapFade=function(a){this.duration=a||200;this._timer=null};apple.fx.SwapFade.prototype._stopAnimation=function(){window.clearTimeout(this._timer);this._timer=null};apple.fx.SwapFade.prototype.swap=function(g,q,r){this._stopAnimation();var f=10;var c=0;var k=this.duration;var d=k/2;var b=false;function o(t){Element.setStyle(t,"top","0px");Element.setStyle(t,"left","0px");Element.setOpacity(t,1);Element.show(t)}function a(t){Element.setStyle(t,"top","0px");Element.setStyle(t,"left","0px");Element.setOpacity(t,0);Element.show(t)}function n(t){Element.hide(t);Element.setOpacity(t,1)}g.forEach(o);q.forEach(a);function m(){c+=f;function t(u){if(u<0){u=0}else{if(u>1){u=1}}u=Math.round(u*100)/100;return function(v){Element.setOpacity(v,u)}}if(c<d){g.forEach(t(1-c/d))}else{if(!b){b=true;g.forEach(n)}q.forEach(t((c-d)/d))}if(c>k){q.forEach(t(1));this._timer=null;if(r){r()}return}this._timer=window.setTimeout(h,f)}var h=m.bind(this);this._timer=window.setTimeout(h,f)};Package("apple.fx");apple.fx.Swoosh=function(c,b,a){this.viewerId=c;if(!b){b=apple.fx.Swoosh.DEFAULT_PAN_SPEED}if(!a){a=apple.fx.Swoosh.DEFAULT_PAN_INCREMENT}this.panSpeed=b;this.panIncrement=a};apple.fx.Swoosh.DEFAULT_PAN_SPEED=20;apple.fx.Swoosh.DEFAULT_PAN_INCREMENT=40;apple.fx.Swoosh.prototype.getDefaultSpeed=function(){return apple.fx.Swoosh.DEFAULT_PAN_SPEED};apple.fx.Swoosh.prototype.getDefaultIncrement=function(){return apple.fx.Swoosh.DEFAULT_PAN_INCREMENT};apple.fx.Swoosh.prototype.getViewer=function(){return $(this.viewerId)};apple.fx.Swoosh.prototype.pan=function(a,d,c,f){if(this.lastFromObject){this.stopAnimation();Element.hide(this.lastFromObject)}this.lastFromObject=d;var b=this.getViewWidth();Element.setStyles(d,{top:"0px",left:"0px"});Element.setStyles(c,{top:"0px",left:(a?b:-b)+"px"});Element.show(d);Element.show(c);this._pan(Math.PI,b,a,d,c,f)};apple.fx.Swoosh.prototype.getViewWidth=function(){return parseInt(Element.getStyle(this.getViewer(),"width"),10)};apple.fx.Swoosh.prototype._pan=function(h,d,c,g,f,k){this.stopAnimation();h+=Math.PI/this.panIncrement;if(h<=(2*Math.PI)){var a=Math.floor((d/2)*(1+Math.cos(h)));if(c){a=-a}Element.setStyle(g,"left",a+"px");Element.setStyle(f,"left",(a+(c?d:-d))+"px");var b=this;this.timer=window.setTimeout(function(){b._pan(h,d,c,g,f,k)},this.panSpeed)}else{this._finishPan(g,f,k)}};apple.fx.Swoosh.prototype._finishPan=function(b,a,c){this.lastFromObject=null;this.stopAnimation();Element.hide(b);if(c){c()}};apple.fx.Swoosh.prototype.stopAnimation=function(){if(this.timer){window.clearTimeout(this.timer);this.timer=null}};Package("apple.fx");var halfPI=Math.PI/2;var PI=Math.PI;apple.fx.linearTween=function(a){return a};apple.fx.easeInSine=function(a){return 1-Math.cos(a*halfPI)};apple.fx.easeOutSine=function(a){return Math.sin(a*halfPI)};apple.fx.easeInOutSine=function(a){return(1-Math.cos(a*PI))/2};apple.fx.easeInBack=function(a,b){if(b==undefined){b=1.70158}return a*a*((b+1)*a-b)};apple.fx.easeOutBack=function(a,b){if(b==undefined){b=1.70158}a=a-1;return(a*a*((b+1)*a+b)+1)};apple.fx.easeOutBackStrong=function(a,b){if(b==undefined){b=1.70158*1.5}a=a-1;return(a*a*((b+1)*a+b)+1)};apple.fx.Chain=function(){var c;if(1==arguments.length&&"function"==typeof(arguments[0])){return arguments[0]}if(1==arguments.length&&arguments[0] instanceof Array){c=arguments[0]}else{c=Array.from(arguments)}c=c.filter(function(n){return null!==n&&"undefined"!=typeof(n)});var g=c.length;var f=0;var b=0;var k=0;var m=[];var h=[];for(var d=0;d<g;++d){h[d]=b;if(!("duration" in c[d])){c[d].duration=1}b+=c[d].duration;m[d]=b}function a(o){if(f==g){return}var n=((o*b)-h[f])/c[f].duration;if(n>1){n=1}c[f](n);if(n<1){return}if("finish" in c[f]){c[f].finish(n)}f++;if(f==g){return}if("setup" in c[f]){c[f].setup()}a(o)}a.setup=function(){f=0;if("setup" in c[f]){c[f].setup()}};a.finish=function(n){};return a};apple.fx.Blend=function(){var d;if(1==arguments.length&&"function"==typeof(arguments[0])){return arguments[0]}if(1==arguments.length&&arguments[0] instanceof Array){d=arguments[0]}else{d=Array.from(arguments)}d=d.filter(function(f){return null!==f&&"undefined"!=typeof(f)});var a=d.length;var c;function b(f){for(c=0;c<a;++c){d[c](f)}}b.setup=function(){for(c=0;c<a;++c){if("setup" in d[c]){d[c].setup()}}};b.finish=function(f){for(c=0;c<a;++c){if("finish" in d[c]){d[c].finish(f)}}};return b};apple.fx.AdjustCurve=function(b,a,f){a=a||0;f=f||1;if(0===a&&1===f){return b}var c=f-a;var d=a/c;return function(g){return b(Math.min(1,g/c-d))}};apple.fx.Fade=function(c,b,h,g){var f=g-h;var d=(0===g)?["","none"]:["none",""];function a(k){Element.setOpacity(b,h+f*c(k))}a.setup=function(){Element.setOpacity(b,h);b.style.display=""};a.finish=function(k){k=k?1:0;b.style.display=d[k];Element.setOpacity(b,k?g:h)};return a};apple.fx.FadeIn=function(b,a){return apple.fx.Fade(b,a,0,1)};apple.fx.FadeOut=function(b,a){return apple.fx.Fade(b,a,1,0)};apple.fx.CrossFade2=function(g,d,c){var b;var f;function a(h){Element.setOpacity(d,g(1-h));Element.setOpacity(c,g(h))}a.setup=function(){b=Element.getStyle(d,"position");f=Element.getStyle(c,"position");d.style.display="";Element.setOpacity(d,1);d.style.position="absolute";Element.setOpacity(c,0);c.style.display="";c.style.position="absolute"};a.finish=function(h){c.style.display=(h?"":"none");Element.setOpacity(c,1);d.style.display=(h?"none":"");Element.setOpacity(d,1);c.style.position=f;d.style.position=b};return a};apple.fx.FadeOutIn=function(d,c,b){function a(f){f*=2;if(f<=1){Element.setOpacity(c,d(1-f));Element.setOpacity(b,0)}else{Element.setOpacity(c,0);Element.setOpacity(b,d(f-1))}}a.setup=function(){c.style.display="";Element.setOpacity(c,1);Element.setOpacity(b,0);b.style.display=""};a.finish=function(f){b.style.display=(f?"":"none");Element.setOpacity(b,1);c.style.display=(f?"none":"");Element.setOpacity(c,1)};return a};apple.fx.Pan=function(k,g,f,h){var d=g.offsetWidth;h=h||1;var c=((h>0)?-d:d);var b=h*d;function a(m){var n=Math.round(b*k(m));g.style.left=n+"px";f.style.left=c+n+"px"}a.setup=function(){g.style.display="";f.style.left=c+"px";f.style.display=""};a.finish=function(m){if(1==m){g.style.display="none";g.style.left="0"}};return a};apple.fx.Scroll=function(k,g,d,h){var a=g.offsetHeight;h=h||1;var c=((h>0)?-a:a);var f=h*a;function b(m){var n=Math.round(f*k(m));g.style.top=n+"px";d.style.top=c+n+"px"}b.setup=function(){g.style.display="";d.style.top=c+"px";d.style.display=""};b.finish=function(m){if(1==m){g.style.display="none";g.style.top="0"}};return b};apple.fx.MoveBy=function(g,d,k){var c=k.x||k.left||0;var a=k.y||k.top||0;var f;var h;function b(m){var n=g(m);d.style.left=f+Math.round(c*n)+"px";d.style.top=h+Math.round(a*n)+"px"}b.setup=function(){f=parseFloat(Element.getStyle(d,"left")||0);h=parseFloat(Element.getStyle(d,"top")||0)};return b};apple.fx.MoveTo=function(g,d,k){var c;var a;var f;var h;function b(m){var n=g(m);d.style.left=f+Math.round(c*n)+"px";d.style.top=h+Math.round(a*n)+"px"}b.setup=function(){f=parseFloat(Element.getStyle(d,"left")||0);h=parseFloat(Element.getStyle(d,"top")||0);if("x" in k||"left" in k){c=(k.x||k.left)-f}else{c=0}if("y" in k||"top" in k){a=(k.y||k.top)-h}else{a=0}};return b};apple.fx.Move=function(b,c,k,m){var g;var d;var h;var f;function a(n){var o=b(n);c.style.left=h+Math.round(g*o)+"px";c.style.top=f+Math.round(d*o)+"px"}a.setup=function(){if("x" in k||"left" in k){h=(k.x||k.left)}else{h=parseFloat(Element.getStyle(c,"left")||0)}if("y" in k||"top" in k){h=(k.y||k.top)}else{f=parseFloat(Element.getStyle(c,"top")||0)}if("x" in m||"left" in m){g=(m.x||m.left)-h}else{g=0}if("y" in m||"top" in m){d=(m.y||m.top)-f}else{d=0}};return a};apple.fx.FadeInBackgroundImage=function(g,b,f){var d=Element.assignId(b);var c=document.getElementById(d+"_fadingBackgroundImage");if("url("!=f.substr(0,4).toLowerCase()){f="url("+f+")"}if(!c){c=document.createElement("div");c.id=d+"_fadingBackgroundImage";c.style.display="none";c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.zIndex="0";b.insertBefore(c,b.firstChild)}c.style.backgroundImage=f;function a(h){Element.setOpacity(c,g(h))}a.setup=function(){Element.makePositioned(b);Element.makeClipping(b);c.style.backgroundPosition=Element.getStyle(b,"backgroundPosition");c.style.backgroundRepeat=Element.getStyle(b,"backgroundRepeat");c.style.width=b.offsetWidth+"px";c.style.height=b.offsetHeight+"px";Element.setOpacity(c,0);c.style.display=""};a.finish=function(k){function h(){c.style.display="none";Element.setOpacity(c,1);Element.undoPositioned(b);Element.undoClipping(b)}window.setTimeout(h,10)};return a};apple.fx.SetClassName=function(d,c,b){function a(f){c.className=b}a.duration=0;return a};apple.fx.SetInnerHTML=function(c,b,d){function a(f){b.innerHTML=d}a.duration=0;return a};apple.fx.SetInnerText=function(d,b,c){function a(f){var g=document.createTextNode(c);b.innerHTML="";b.appendChild(g)}a.duration=0;return a};apple.fx.Resize=function(d,c,b,g){var f=null;function a(h){var k=c.style;h=d(h);k.height=Math.round(h*f.height+g.height)+"px";k.width=Math.round(h*f.width+g.width)+"px"}a.setup=function(){Element.makeClipping(c);if(!g){g=Element.getDimensions(c)}f={width:b.width-g.width,height:b.height-g.height}};a.finish=function(k){var h=c.style;if(k){h.height=Math.round(b.height)+"px";h.width=Math.round(b.width)+"px"}else{h.height=Math.round(g.height)+"px";h.width=Math.round(g.width)+"px"}Element.undoClipping(c)};return a};apple.fx.Morph=function(g,f,d,k){var h=null;var a=true;var c=true;function b(m){var n=f.style;m=g(m);if(a){n.left=Math.round(m*h.left+k.left)+"px";n.top=Math.round(m*h.top+k.top)+"px"}if(c){n.height=Math.round(m*h.height+k.height)+"px";n.width=Math.round(m*h.width+k.width)+"px"}}b.setup=function(){if(!k){k=Element.getDimensions(f)}var m=Element.getPadding(f);a=("left" in d&&"left" in k&&"top" in d&&"top" in k);c=("width" in d&&"width" in k&&"height" in d&&"height" in k);h={left:d.left-k.left-m.left,top:d.top-k.top-m.top,width:d.width-k.width-m.left-m.right,height:d.height-k.height-m.top-m.bottom}};b.finish=function(n){var m=f.style;if(n){if(a){m.top=Math.round(d.top)+"px";m.left=Math.round(d.left)+"px"}if(c){m.height=Math.round(d.height)+"px";m.width=Math.round(d.width)+"px"}}else{if(a){m.top=Math.round(k.top)+"px";m.left=Math.round(k.left)+"px"}if(c){m.height=Math.round(k.height)+"px";m.width=Math.round(k.width)+"px"}}};return b};apple.fx.Hide=function(c,b){function a(d){}a.finish=function(d){b.style.display=d?"none":""};return a};apple.fx.ResizeImage=function(d,c,b,g){var f=null;function a(m){var o=c.style;var n;var k;m=d(m);o.height=(n=Math.round(m*f.height+g.height))+"px";o.width=(k=Math.round(m*f.width+g.width))+"px";c.width=k;c.height=n}a.setup=function(){if(!g){g=Element.getDimensions(c)}f={width:b.width-g.width-(parseFloat(Element.getStyle(c,"padding-left"))||0)-(parseFloat(Element.getStyle(c,"padding-right"))||0),height:b.height-g.height-(parseFloat(Element.getStyle(c,"padding-top"))||0)-(parseFloat(Element.getStyle(c,"padding-bottom"))||0)}};a.finish=function(q){var k;var n;var m=c.style;var o=q?b:g;m.height=(n=Math.round(o.height))+"px";m.width=(k=Math.round(o.width))+"px";c.height=n;c.width=k};return a};apple.fx.ColourRgbRegex=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i;apple.fx.ColourHexRegex=/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;apple.fx.ChangeColour=function(f,g,c,k,b){var m;function d(o){var q=o.match(apple.fx.ColourRgbRegex);if(q){return[Math.clamp(parseInt(q[1],10),0,255),Math.clamp(parseInt(q[2],10),0,255),Math.clamp(parseInt(q[3],10),0,255)]}q=o.match(apple.fx.ColourHexRegex);if(q){var v=q[1];var u;var t;var n;if(3==v.length){u=v.charAt(0)+v.charAt(0);t=v.charAt(1)+v.charAt(1);n=v.charAt(2)+v.charAt(2)}else{u=v.slice(0,2);t=v.slice(2,4);n=v.slice(4,6)}return[Math.clamp(parseInt(u,16),0,255),Math.clamp(parseInt(t,16),0,255),Math.clamp(parseInt(n,16),0,255)]}throw new Error("Invalid colour string: "+o)}function h(n){n=Math.round(Math.clamp(n,0,255));if(n<16){return"0"+n.toString(16)}else{return n.toString(16)}}function a(n){n=f(n);var o=["#",h(b[0]+m[0]*n),h(b[1]+m[1]*n),h(b[2]+m[2]*n)].join("");g.style[c]=o}a.setup=function(){b=d(b||Element.getStyle(g,c));k=d(k);m=[k[0]-b[0],k[1]-b[1],k[2]-b[2]]};return a};apple.fx.ChangeColor=apple.fx.ChangeColour;Package("apple.io.json");apple.io.json.invoke=function(c){var a=null;var f=c.preventCache||false;var g=c.sync||false;var b=c.method||"get";function h(n){var q;if(n.head&&n.head.data&&n.head.data.metrics){q=n.head.data.metrics}else{if(n.body&&n.body.metrics){q=n.body.metrics;delete n.body.metrics}}if(!q&&!c.metrics){return}var o=Object.extend(c.metrics||{},q);apple.metrics.fireEvent(o)}function m(n){if(apple.io.json.isRedirect(n)){if(c.redirect){c.redirect(n)}apple.io.json.redirect(n);return}if(apple.io.json.hasErrors(n)){if(c.error){c.error(n)}return}h(n);if(n.preScript){coherent.Scripts.install(n.preScript)}if(c.success){c.success(n)}if(n.postScript){coherent.Scripts.install(n.postScript)}apple.io.json.evaluateScriptKeys(n.body,c.scriptKeys)}function k(n){if(c.error){c.error(n)}}try{a=XHR.request(b,c.url,c.urlArgs,{sync:g,responseContentType:"application/json"});a.addMethods(m,k)}catch(d){if(c.error){c.error(d)}}return a};apple.io.json.redirect=function(b){var a=b.head.data;if(a&&a.url){if("post"==a.method){apple.io.json.issuePostRedirect(a.url,a.args)}else{apple.io.json.issueGetRedirect(a.url,a.args)}}};apple.io.json.issuePostRedirect=function(c,b){if(c){var f=document.createElement("form");f.action=c;f.method="post";var g;var a;var h={};function d(n,m,o){var k=document.createElement("input");n.appendChild(k);k.type="hidden";k.name=m;k.value=o}for(g in b){a=b[g];if(b[g]===h[g]){continue}if(a instanceof Array){a.forEach(function(k){d(f,g,k)})}else{d(f,g,a)}}f.style.position="absolute";f.style.visibility="hidden";f.style.height="0px";f.style.width="0px";document.body.appendChild(f);f.submit()}};apple.io.json.issueGetRedirect=function(b,a){if(b){var c=null;if(a){c=Object.toQueryString(a)}if(c){if(b.indexOf("?")<0){b+="?"+c}else{b+=c}}window.location.href=b}};apple.io.json.isRedirect=function(d){var a=false;try{if(d){var b=parseInt(d.head.status,10);switch(b){case 301:case 302:case 303:case 304:case 305:case 306:case 307:a=true;break;default:break}}}catch(c){}return a};apple.io.json.hasErrors=function(d){var a=false;try{if(d){var b=parseInt(d.head.status,10);if(b==200){a=false}else{if(b>=400&&b<600){a=true}}}else{a=true}}catch(c){}return a};apple.io.json.evaluateScriptKeys=function(d,c){if(d&&c){for(var b=0;b<c.length;b++){var f=d[c[b]];if(f){var a=coherent.Scripts.extract(f).scripts;coherent.Scripts.install(a)}}}};apple.io.json.createSimpleJsonMsg=function(a){var b={head:{status:"200"},body:{content:a}};return b};Package("apple.quicktime");apple.quicktime._initialised=false;apple.quicktime._version=undefined;apple.quicktime.DEFAULTS={activeXClassId:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",activeXCodebase:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0",mimeType:"video/quicktime",autoplay:true,cache:true,controller:false,enablejavascript:true,showlogo:false,saveembedtags:true,scale:"aspect"};apple.quicktime.mobileSafari=!!navigator.userAgent.match(/Mobile.*Safari/);apple.quicktime.isInstalled=function(){return(this.mobileSafari||this._version||this.getVersion())?true:false};apple.quicktime.getVersion=function(){if(this._version||this._initialised){return this._version}this._initialised=true;var c=window.navigator.plugins;var a=c?c.length:0;if(c&&a){var g;for(g=0;g<a;++g){var h=c[g];var d=h.name.match(/quicktime\D*([\.\d]*)/i);if(d&&d[1]){return(this._version=d[1])}}}else{try{var f=new window.ActiveXObject("QuickTimeCheckObject.QuickTimeCheck"),b=f.QuickTimeVersion.toString(16);this._version=[b.charAt(0),b.charAt(1),b.charAt(2)].join(".")}catch(k){}return this._version}return this._version};apple.quicktime.isVersionCompatible=function(b){function a(g,k){var f=parseInt(g[0],10);if(isNaN(f)){f=0}var h=parseInt(k[0],10);if(isNaN(h)){h=0}if(f===h){if(g.length>1){return a(g.slice(1),k.slice(1))}else{return true}}else{if(f<h){return true}else{return false}}}var c=String(b).split(/\./);var d=String(this.getVersion()).split(/\./);return a(c,d)};apple.quicktime.createMovie=function(b,a){var d=document.createElement("OBJECT");b=Object.applyDefaults(Object.clone(b),this.DEFAULTS);function c(g){if(!(g in b)){return}d.setAttribute(g,b[g])}function f(g){var h=document.createElement("PARAM");if(!(g in b)){return}h.setAttribute("name",g);h.setAttribute("value",b[g]);d.appendChild(h)}["width","height","name","id","class","title","bgcolor"].forEach(c);["src","autoplay","cache","controller","enablejavascript","showlogo","saveembedtags","loop"].forEach(f);if(window.ActiveXObject){d.setAttribute("classid",b.activeXClassId);d.setAttribute("codebase",b.activeXCodebase)}else{d.setAttribute("data",b.src);d.setAttribute("type",b.mimeType)}a.appendChild(d);return d};apple.quicktime.logProperties=function(a){function b(f){try{return[f,a["Get"+f]()].join(": ")}catch(d){return d.message}}var c;c=["PluginStatus","AutoPlay","ControllerVisible","Rate","Time","Volume","Mute","MovieName","MovieID","StartTime","EndTime","BgColor","IsLooping","LoopIsPalindrome","PlayEveryFrame","HREF","Target","QTNEXTUrl","URL","KioskMode","Duration","MaxTimeLoaded","TimeScale","MovieSize","MaxBytesLoaded","TrackCount","Matrix","Rectangle","Language"].map(b);console.log(c.join("\n"))};Package("apple.widget");apple.widget.AlternateProductsUpdater=function(a){this.config=a||{};Object.applyDefaults(this.config,apple.widget.AlternateProductsUpdater.DEFAULTS);Event.onDomReady(this.init.bind(this))};apple.widget.AlternateProductsUpdater.DEFAULTS={priceId:"price",shippingId:"shipping",priceClass:"price",shippingClass:"availability",labelSuffix:"-label"};apple.widget.AlternateProductsUpdater.prototype.init=function(){var b=document.getElementById(this.config.elementId);if(!b){return}var c=b.getElementsByTagName("label");if(!c){return}var d=this.selectProduct.bindAsEventListener(this);function a(h){var f=h.htmlFor;h.id=f+this.config.labelSuffix;var g=document.getElementById(f);Event.observe(g,"click",d)}Array.forEach(c,a,this)};apple.widget.AlternateProductsUpdater.prototype.selectProduct=function(a){var b=(a.srcElement||a.target);this.updateSelectedProduct(b)};apple.widget.AlternateProductsUpdater.prototype.updateSelectedProduct=function(g){var b=document.getElementById(g.id+this.config.labelSuffix);if(!b){return}var f=document.getElementById(this.config.priceId);var a=document.getElementById(this.config.shippingId);var c=Element.getElementsByClassName(this.config.priceClass,b);var d=Element.getElementsByClassName(this.config.shippingClass,b);if(f&&c&&c.length>0){f.innerHTML=c[0].innerHTML}if(a&&d&&d.length>0){a.innerHTML=d[0].innerHTML}};Package("apple.widget");apple.widget.AnimatedTextWidget=(function createAnimatedTextWidget(){var d=window.coherent,b=d.Markers,a=d.Animator,c=window.Element,h=c.getStyle,f=c.getStyles,g=c.setStyle,m=c.setStyles,k=c.undoClipping,n="px";return Class.create(d.View,{__viewClassName__:"apple.AnimatedText",animated:true,observeVisibleChange:function(y,A,r){var x=this.viewElement(),w=f(x,["display","paddingTop","paddingBottom"]),o={width:x.scrollWidth,height:x.scrollHeight},u=w.display,q=!!y.newValue,t=(parseFloat(w.paddingTop)||0)+(parseFloat(w.paddingBottom)||0),v,z;if(q===u){return}c.makeClipping(x);if(y.newValue){m(x,{height:0+n,display:""});a.setStyles(x,{height:Math.max(0,x.scrollHeight-t)},{duration:300,curve:d.easing.inOutSine,callback:function(){g(x,"height","");k(x)}})}else{g(x,"height",Math.max(x.offsetHeight-t,x.offsetHeight)+n);a.setStyles(x,{height:0},{duration:300,curve:d.easing.inOutSine,callback:function(){m(x,{display:"none",height:""});k(x)}})}},translateValue:function(t){var q=this.viewElement(),r=true,o=this.attributeOrProperty;if(this.formatter){t=this.formatter.stringFromValue(t)}switch(t){case"":case null:case undefined:if(typeof this.nullPlaceHolder==="string"||c.hasAttribute(q,"nullPlaceHolder")){t=o("nullPlaceholder")}break;case d.Markers.NoSelection:t=o("noSelectionPlaceholder");break;case d.Markers.MultipleValues:t=o("multipleValuesPlaceholder");break;default:t=String(t);r=false;break}if(r){c.addClassName(q,d.Style.kMarkerClass)}else{c.removeClassName(q,d.Style.kMarkerClass)}return t},observeTextChange:function(v,u,q){var o=this.viewElement(),r=this.translateValue(v.newValue),t;if(!this.animated||"none"===h(o,"display")){t=document.createTextNode(r);o.innerHTML="";o.appendChild(t);return}if(r===o.innerText){return}a.innerText(o,r,300)},observeHtmlChange:function(w,v,q){var o=this.viewElement(),t=w.newValue,r=this.translateValue(t),u;if(!this.animated||"none"===h(o,"display")){if(r!==t){u=document.createTextNode(r);o.innerHTML="";o.appendChild(u);return}o.innerHTML=r;return}if(typeof r==="string"){if(r!==t){this.observeTextChange(w,v,q);return}if(typeof r==="string"&&r.trim()===String(o.innerHTML).trim()){return}a.innerHTML(o,r,300)}}})})();Package("apple.widget");apple.widget.AutoCompleter=function(a,c,b){this.country=c;this.field=b;this.cur=-1;this.layer=null;this.textbox=a;this.init()};Object.extend(apple.widget.AutoCompleter.prototype,{init:function(){var a=this;this.textbox.onkeyup=function(b){if(!b){b=window.event}a.handleKeyUp(b)};this.textbox.onkeydown=function(b){if(!b){b=window.event}a.handleKeyDown(b)};this.textbox.onblur=function(){a.hideSuggestions()};this.createDropDown()},autosuggest:function(b,a){if(b.length>0){if(a){this.typeAhead(b[0])}this.showSuggestions(b)}else{this.hideSuggestions()}},createDropDown:function(){var c=this;this.layer=document.createElement("div");this.layer.className="AutoCompleterResults";if(coherent.Browser.Safari){var a=/AppleWebKit\/(\d+(?:\.\d+)?)/;var b=a.exec(navigator.userAgent);if(b&&parseInt(b[1],10)>=523){this.layer.className+=" capable"}}this.layer.style.visibility="hidden";this.layer.style.left="-5000px";this.layer.style.top="0px";this.layer.onmousedown=this.layer.onmouseup=this.layer.onmouseover=function(f){f=f||window.event;var d=f.target||f.srcElement;if(f.type=="mousedown"){var g=d.firstChild.nodeValue;if(g!==null){c.textbox.value=d.firstChild.nodeValue;c.hideSuggestions()}}else{if(f.type=="mouseover"){c.highlightSuggestion(d)}else{c.textbox.focus()}}};document.body.appendChild(this.layer)},handleKeyDown:function(a){switch(a.keyCode){case 38:this.previousSuggestion();return;case 40:this.nextSuggestion();return;case 13:this.cancelEvent(a);this.hideSuggestions();return;case 27:this.hideSuggestions();return;default:return}},cancelEvent:function(a){a.cancelBubble=true;a.returnValue=false;if(a.stopPropagation){a.stopPropagation();a.preventDefault()}},handleKeyUp:function(a){var c=a.keyCode;var b;if(c==8||c==46){this.autosuggest(this.search(this.textbox.value),false)}else{if(c<32||(c>=33&&c<46)||(c>=112&&c<=123)){return}else{this.autosuggest(this.search(this.textbox.value),true)}}},showSuggestions:function(h){var a=Element.getRect(this.textbox);this.layer.style.top=(a.top+this.textbox.offsetHeight)+"px";this.layer.style.left=(a.left+this.textbox.offsetWidth/2)+"px";this.layer.style.width="";var g=null;this.layer.innerHTML="";var k=document.createElement("div");k.className="top";k.innerHTML='<span class="left"></span><span class="right"></span>';var d=document.createElement("div");d.className="middle";var c=document.createElement("div");c.className="bottom";c.innerHTML='<span class="left"></span><span class="right"></span>';var b=document.createElement("ul");for(var f=0;f<h.length;f++){g=document.createElement("li");g.appendChild(document.createTextNode(h[f]));b.appendChild(g)}d.appendChild(b);this.layer.appendChild(k);this.layer.appendChild(d);this.layer.appendChild(c);this.layer.style.visibility="visible";this.layer.style.width=d.offsetWidth+"px";this.layer.style.marginLeft=-0.5*this.layer.offsetWidth+"px"},hideSuggestions:function(){this.layer.style.visibility="hidden"},highlightSuggestion:function(b){var a=this.layer.getElementsByTagName("li");for(var c=0;c<a.length;c++){a[c].className=a[c]==b?"selected":""}},nextSuggestion:function(){var b=this.layer.getElementsByTagName("li");if(b.length>0&&this.cur<b.length-1){var a=b[++this.cur];this.highlightSuggestion(a);this.textbox.value=a.firstChild.nodeValue}},previousSuggestion:function(){var b=this.layer.getElementsByTagName("li");if(b.length>0&&this.cur>0){var a=b[--this.cur];this.highlightSuggestion(a);this.textbox.value=a.firstChild.nodeValue}},selectRange:function(a,b){if(this.textbox.createTextRange){var c=this.textbox.createTextRange();c.moveStart("character",a);c.moveEnd("character",b-this.textbox.value.length);c.select()}else{if(this.textbox.setSelectionRange){this.textbox.setSelectionRange(a,b)}}},search:function(f){var d=[];var a=apple.widget.AutoCompleter.data[this.country][this.field];if(f.length>0){f=f.toUpperCase()+" ";while(f.length>1&&d.length===0){f=f.substring(0,f.length-1);var b=a[f.substring(0,1)];if(b){for(var c=0;c<b.length;c++){if(b[c].indexOf(f)===0){d.push(b[c])}}}}}return d},typeAhead:function(b){if(this.textbox.createTextRange||this.textbox.setSelectionRange){if(b&&this.textbox.value&&b.indexOf(this.textbox.value)===0){var a=this.textbox.value.length;this.textbox.value=b;this.selectRange(a,b.length)}}}});apple.widget.AutoCompleter.requestURL="";apple.widget.AutoCompleter.requestParams={};apple.widget.AutoCompleter.willRequest=false;apple.widget.AutoCompleter.requestTimer=null;apple.widget.AutoCompleter.requestCallback=null;apple.widget.AutoCompleter.data=null;apple.widget.AutoCompleter.registerInput=function(a,d,c){apple.widget.AutoCompleter.willRequest=true;var b=apple.widget.AutoCompleter.requestParams;if(!(d in b)){b[d]={}}if(!(c in b[d])){b[d][c]=[]}b[d][c].push(a)};apple.widget.AutoCompleter.requestData=function(){if(apple.widget.AutoCompleter.willRequest===false){return}var d={p:"apple.widget.AutoCompleter.processData"};for(var m in apple.widget.AutoCompleter.requestParams){if(!(m in d)){d[m]=[]}for(var h in apple.widget.AutoCompleter.requestParams[m]){d[m].push(h)}}var b=apple.widget.AutoCompleter.requestURL;var k=(b.indexOf("?")!=-1)?"&":"?";b+=k+Object.toQueryString(d);var a=document.createElement("script");a.src=b;function g(){apple.widget.AutoCompleter.requestCallback=function(){}}apple.widget.AutoCompleter.requestCallback=function(c){window.clearTimeout(apple.widget.AutoCompleter.requestTimer);apple.widget.AutoCompleter.requestTimer=null;apple.widget.AutoCompleter.processData(c)};apple.widget.AutoCompleter.requestTimer=window.setTimeout(g,10000);document.getElementsByTagName("HEAD")[0].appendChild(a)};apple.widget.AutoCompleter.processData=function(d){apple.widget.AutoCompleter.data=d;var g=apple.widget.AutoCompleter.requestParams;for(var h in g){for(var b in g[h]){for(var a=0;a<g[h][b].length;a++){apple.widget.AutoCompleter.create(g[h][b][a],h,b)}}}};apple.widget.AutoCompleter.create=function(f,d,c){var b=apple.widget.AutoCompleter.data;var a=document.getElementById(f);if(a){if(a.setAttribute){a.setAttribute("AUTOCOMPLETE","off")}new apple.widget.AutoCompleter(a,d,c)}};Event.onDomReady(apple.widget.AutoCompleter.requestData);Package("apple.widget");function _makePartFinder(g){var a=g.length,c;if(1==a){var f=g[0];function h(){return[document.getElementById(f)]}h.single=function(m){return document.getElementById(f)};h.isPart=function(m){return m.id==f};return h}function b(){c={};for(var m=0;m<a;++m){c[g[m]]=true}}function k(m){return m.id in c}function d(){var m=[];for(var n=0;n<a;++n){m.push(document.getElementById(g[n]))}return m}d.single=function(m){return document.getElementById(g[m])};d.isPart=function(m){b();this.isPart=k;return k(m)};return d}apple.widget.BaseWidget=function(b,a){if(1==arguments.length){a=b||{}}else{a=a||{};if("string"!=typeof(b)){a.id=Element.assignId(b)}else{a.id=b||a.id}}this._partCache={};this._widgetId=a.id;this.setConfig(a);Event.onDomReady(this.init.bind(this))};Class.extend(apple.widget.BaseWidget,{setConfig:function(b){for(var a=this.constructor;a&&Object!==a;a=a.superclass){Object.applyDefaults(b,a.DEFAULTS||{})}this.config=b},init:function(){},widget:function(){return document.getElementById(this._widgetId)},observeParts:function(b,f,d){var g=this.parts(b);var a=g.length;var c;for(c=0;c<a;++c){Event.observe(g[c],f,d)}},observePart:function(a,d,c){var b=this.part(a);Event.observe(b,d,c)},stopObservingParts:function(b,f,d){var g=this.parts(b);var a=g.length;var c;for(c=0;c<a;++c){Event.stopObserving(g[c],f,d)}},isPart:function(a,b){if(!(a in this._partCache)){this.parts(a)}return this._partCache[a].isPart(b)},part:function(a,b){b=b||0;if(a in this._partCache){return this._partCache[a].single(b)}return this.parts(a)[b]},parts:function(m){if(m in this._partCache){return this._partCache[m]()}var g=this.widget();var q=m.split(".");var b;var k;var a=[];var f;if(0===q.length||2<q.length){return[]}if(1==q.length){b=g.getElementsByTagName(q[0]);k=a.length=b.length;for(f=0;f<k;++f){a[f]=Element.assignId(b[f])}}else{var o=[];var h=0;var c=new RegExp("(?:^|\\s+)"+q[1]+"(?:\\s+|$)");b=g.getElementsByTagName(q[0]||"*");k=o.length=a.length=b.length;for(f=0;f<k;++f){var d=b[f];if(!c.test(d.className)){continue}a[h]=Element.assignId(d);o[h]=d;++h}a.length=h;o.length=h;b=o}this._partCache[m]=_makePartFinder(a);return Array.from(b)}});Package("apple.widget");apple.widget.ColumnEqualizer=function(a){this.elementList=typeof(a)==="string"?Element.queryAll(a):a;this.calculateHeights()};apple.widget.ColumnEqualizer.prototype.calculateHeights=function(){var a=0,b=0;this.elementList.forEach(function(c){b=c.style.height;c.style.height="";a=Math.max(a,parseInt(Element.getStyles(c,"height").replace("px",""),10));c.style.height=b});this.elementList.forEach(function(c){Element.setStyle(c,"height",a+"px")})};Package("apple.widget");apple.widget.ContentSwitcher=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS);this._activateTimer=null;Event.onDomReady(this.init.bind(this))};apple.widget.ContentSwitcher.STYLE={switchOnClick:0,switchOnHover:1};apple.widget.ContentSwitcher.prototype.nodesById=function(a){switch(typeof(a)){case"string":return[$(a)];case"undefined":return[];default:if(a instanceof Array){return a.map($)}if(!a){return[]}return[a]}};apple.widget.ContentSwitcher.prototype.DEFAULTS={hoverDelay:200,activeContentClass:"active",inactiveContentClass:"inactive",activeButtonClass:"active",inactiveButtonClass:"inactive",style:apple.widget.ContentSwitcher.STYLE.switchOnClick,transition:{swap:function(d,b,f){d=[].concat(d);b=[].concat(b);function c(g){g.style.display="none"}function a(g){g.style.display=""}d.forEach(c);b.forEach(a);if(f){f()}}}};apple.widget.ContentSwitcher.prototype.init=function(){var k=apple.widget.ContentSwitcher.STYLE;var g=k.switchOnHover==(this.config.style&k.switchOnHover);var c=this.mouseOverButton.bindAsEventListener(this);var m=this.mouseOutButton.bindAsEventListener(this);var h=this.buttonClicked.bindAsEventListener(this);for(var b in this.config.buttons){var d=$(b);var f=this.config.buttons[b];if("string"==typeof(f)){this.config.buttons[b]=f.split(/\s*,\s*/g)}if(!d){continue}if(g){Event.observe(d,"mouseover",c);Event.observe(d,"mouseover",c);Event.observe(d,"mouseout",m);Event.observe(d,"click",Event.stop)}else{Event.observe(d,"click",h)}}this._activeButtonId=this.findInitialActiveButton();this._activeContentIds=this.config.buttons[this._activeButtonId]||[this.overviewId];this._initialActiveButton=this._activeButtonId;this._initialActiveContentIds=this._activeContentIds;if(!this.config.containerId){return}var a=$(this.config.containerId);Event.observe(a,"mouseout",this.mouseOutContainer.bindAsEventListener(this));Event.observe(a,"mouseover",this.mouseOverContainer.bindAsEventListener(this))};apple.widget.ContentSwitcher.prototype.findInitialActiveButton=function(){if(this.config.overviewId){return undefined}for(var f in this.config.buttons){var b=$(f);var d=this.config.buttons[f];if(!b||!d){continue}var a=Element.regexForClassName(this.config.activeContentClass);if(a.test(b.className)){return f}function c(h){var g=$(h);return a.test(b.className)}if(this.nodesById(d).some(c,this)){return f}}return undefined};apple.widget.ContentSwitcher.prototype.reset=function(){if(this._activeButtonId==this._initialActiveButton){return}this.activateButton(this._initialActiveButton);this.activateContent(this._initialActiveContentIds)};apple.widget.ContentSwitcher.prototype.activateButton=function(b){var a;if(this._activeButtonId){a=$(this._activeButtonId);Element.addClassName(a,this.config.inactiveButtonClass);Element.removeClassName(a,this.config.activeButtonClass)}this._activeButtonId=b;if(!b){return}a=$(b);Element.removeClassName(a,this.config.inactiveButtonClass);Element.addClassName(a,this.config.activeButtonClass)};apple.widget.ContentSwitcher.prototype.activateContent=function(a){var c=this._activeContentIds||[];var g=a||[];var f=this.nodesById(c);var b=this.nodesById(g);function d(k){this.beforeHideContent(k.id);Element.removeClassName(k,this.config.activeContentClass);Element.addClassName(k,this.config.inactiveContentClass)}function h(k){this.beforeShowContent(k.id);Element.removeClassName(k,this.config.inactiveContentClass);Element.addClassName(k,this.config.activeContentClass)}f.forEach(d,this);b.forEach(h,this);this._activeContentIds=(a||[]);this.config.transition.swap(f,b);c.forEach(this.afterHideContent,this);g.forEach(this.afterShowContent,this)};apple.widget.ContentSwitcher.prototype.findTarget=function(a){if(!a){return a}while(!a.id&&"body"!=a.nodeName){a=a.parentNode}if(!a.id){return null}return a};apple.widget.ContentSwitcher.prototype.mouseOverButton=function(b){var d=this.findTarget(Event.fixEvent(b).target);if(!d){return}var f=this.config.buttons[d.id];var a;if(!f||f==this._activeContentId){return}function c(){this.activateButton(d.id);this.activateContent(f)}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this._activateTimer=window.setTimeout(c.bind(this),this.config.hoverDelay)};apple.widget.ContentSwitcher.prototype.mouseOutButton=function(b){b=Event.fixEvent(b);var c=this.findTarget(b.currentTarget);if(!c){return}var a=b.relatedTarget;while(a&&a!=c&&a.nodeName!="body"){a=a.parentNode}if(a==c){return}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this._activateTimer=null};apple.widget.ContentSwitcher.prototype.mouseOverContainer=function(a){var b=Event.fixEvent(a).target};apple.widget.ContentSwitcher.prototype.mouseOutContainer=function(b){b=Event.fixEvent(b);var c=b.currentTarget;if(!c){return}if(!this.config.overviewId){return}var a=b.relatedTarget;while(a&&a!=c&&a.nodeName!="body"){a=a.parentNode}if(a==c){return}this.activateContent([this.config.overviewId]);this.activateButton(null)};apple.widget.ContentSwitcher.prototype.buttonClicked=function(c){var d=this.findTarget(Event.fixEvent(c).target);if(!d){return}var a=this.config.buttons[d.id];var b;if(!a||d.id==this._activeButtonId){return}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this.activateButton(d.id);this.activateContent(a);Event.stop(c)};apple.widget.ContentSwitcher.prototype.beforeShowContent=function(a){};apple.widget.ContentSwitcher.prototype.beforeHideContent=function(a){};apple.widget.ContentSwitcher.prototype.afterShowContent=function(a){};apple.widget.ContentSwitcher.prototype.afterHideContent=function(a){};Package("apple.widget");apple.widget.CrossFader=Class.create(coherent.View,{exposedBindings:["locked"],paused:false,timer:null,selectedIndex:null,items:PartList("div.slide"),indicator:coherent.ListView("div.indicator",{contentBinding:"indicatorContent",selectedIndexBinding:"selectedIndex",enabledBinding:"locked(NOT)",innerHTML:"<span></span>"}),previousButton:coherent.Anchor("a.previous",{action:"showPreviousItem"}),nextButton:coherent.Anchor("a.next",{action:"showNextItem"}),init:function(){var c=this.items();var a=c.length;var b=this.viewElement();this.setValueForKey(false,"locked");this.setValueForKey(0,"selectedIndex");Element.addClassName(c[0],"faded_in");if(a<2){if(Element.query(b,"div.pagination")){Element.query(b,"div.pagination").style.display="none"}return}for(var d=1;d<a;d++){Element.addClassName(c[d],"faded_out")}if(this.indicator){var f=this.items().map(function(h,g){return{value:"Item "+(g+1)}});this.setValueForKey(coherent.KVO.adapt(f),"indicatorContent");this.addObserverForKeyPath(this,this.observeSelectedIndexChange,"selectedIndex")}Event.observe(b,"mouseover",this.pause.bindAsEventListener(this));Event.observe(b,"mouseout",this.resume.bindAsEventListener(this));this.resume()},observeSelectedIndexChange:function(a){if(this.locked){return}this.switchItems(a.oldValue,a.newValue,250)},showPreviousItem:function(d){if((typeof(d)==="undefined"&&this.paused)||this.locked){return}var c;if(typeof(d)!=="undefined"){c=250}var b=this.selectedIndex;var a;if(b===0){a=this.items().length-1}else{a=b-1}this.switchItems(b,a,c)},showNextItem:function(d){if((typeof(d)==="undefined"&&this.paused)||this.locked){return}var c;if(typeof(d)!=="undefined"){c=250}var b=this.selectedIndex;var a;if(b==this.items().length-1){a=0}else{a=b+1}this.switchItems(b,a,c)},switchItems:function(f,d,c){c=c||apple.widget.CrossFader.FADE_DURATION;if(this.timer){window.clearTimeout(this.timer);this.timer=null}var a=this;function b(){a.setValueForKey(d,"selectedIndex");a.setValueForKey(false,"locked");a.resume()}this.setValueForKey(true,"locked");Element.replaceClassName(this.items(f),"faded_in","fading_out");coherent.Animator.replaceClassName(this.items(f),"fading_out","faded_out",{duration:c,only:["opacity"],discreteTransitionPoint:1});Element.replaceClassName(this.items(d),"faded_out","fading_in");coherent.Animator.replaceClassName(this.items(d),"fading_in","faded_in",{duration:c,only:["opacity"],discreteTransitionPoint:1,callback:b})},pause:function(a){this.paused=true;if(this.timer){window.clearTimeout(this.timer)}this.timer=null},resume:function(a){if(a){this.paused=false}if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.showNextItem.bind(this),apple.widget.CrossFader.SLIDE_DELAY)}});apple.widget.CrossFader.SLIDE_DELAY=6000;apple.widget.CrossFader.FADE_DURATION=750;Package("apple");apple.Dialog=Class.create({constructor:function(a){this.createOverlay()},createOverlay:function(){var a=document.createElement("div");a.className="overlay";document.body.appendChild(a);this.overlay=new coherent.Overlay(a)}});Package("apple.widget");apple.widget.EmailSubscription=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.EmailSubscription,apple.widget.BaseWidget);var ServerStatus={good:"SUCCESS",bad:"ERROR",busy:"BUSY",off:"OFF",on:"ON",format:"FORMAT"};apple.widget.EmailSubscription.DEFAULTS={emailPlaceholder:"example: user@example.com",submitUrl:"email-server-reply.txt",urlArgs:{},argName:"emailAddress",emailFieldSpec:"input.notify_email",submitButtonSpec:".notify_submit",formSpec:"form",fadeDuration:350,showForm:{SUCCESS:false,ERROR:false,BUSY:false,ON:true,OFF:false,FORMAT:true},loadingClass:"loading",rpcTimeout:10000,emailRegex:/^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,4}$/i};apple.widget.EmailSubscription.prototype.init=function(){var g={duration:this.config.fadeDuration};this._animator=new apple.fx.Animator(g);this.setStatus("OFF");this.setStatus("ON");var b=this.part(this.config.formSpec);var f=this.part(this.config.emailFieldSpec);var a={placeholder:this.config.emailPlaceholder};this._field=new apple.widget.TextField(f.id,a);var d=this.part(this.config.submitButtonSpec);var c=this.submitHandler.bindAsEventListener(this);Event.observe(d,"click",c);Event.observe(b,"submit",c)};apple.widget.EmailSubscription.prototype.partSpecForStatus=function(a){return"div.notify_"+(a||"").toLowerCase()};apple.widget.EmailSubscription.prototype.setStatus=function(h,n,q){h=h||"ERROR";if(h==this._status){return}var g=this.widget();var a=this.part(this.config.formSpec);var b=this.config.showForm[this._status];var o=this.config.showForm[h];var k=this.part(this.partSpecForStatus(this._status));var m=this.part(this.partSpecForStatus(h));if(!this._status){a.style.display=o?"block":"none";m.style.display="block";this._status=h;return}if(q){a.style.display=o?"block":"none";m.style.display="block";k.style.display="none";this._status=h;return}var c=new apple.fx.Fade(apple.fx.linearTween,k,1,0);var f=new apple.fx.Fade(apple.fx.linearTween,m,0,1);var r;var d=[c,f];if(b!=o){if(o){r=new apple.fx.Fade(apple.fx.linearTween,a,0,1);d=[c,new apple.fx.Blend(f,r)]}else{r=new apple.fx.Fade(apple.fx.linearTween,a,1,0);d=[new apple.fx.Blend(c,r),f]}}this._status=h;this._animator.play(new apple.fx.Chain(d),n)};apple.widget.EmailSubscription.prototype.rpc=function(d,h,c){if(-1!=d.indexOf("?")){d=d+"&"}else{d=d+"?"}d+="bustCache="+(new Date()).getTime().toString(16)+":"+Math.random();var g;var b=document.createElement("script");b.src=d;function a(){window.clearTimeout(g);g=null;if(h){h.apply(window,arguments)}}function f(){window.signalStatus=function(){};if(c){c()}}window.signalStatus=a;g=window.setTimeout(f,this.config.rpcTimeout);document.getElementsByTagName("HEAD")[0].appendChild(b)};apple.widget.EmailSubscription.prototype.submitHandler=function(f){(f.target||f.srcElement).blur();Event.stop(f);var h=this.widget();var k=this.part(this.config.emailFieldSpec);if(!k||!this.config.submitUrl){return}var g=k.value||"";if(!g.match(this.config.emailRegex)){this.setStatus("FORMAT");k.focus();k.select();return}Element.addClassName(h,this.config.loadingClass);function d(){Element.removeClassName(h,this.config.loadingClass)}function a(n){n=n.replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();var m=ServerStatus[n];this.setStatus(m,d.bind(this))}var c=Object.applyDefaults({},this.config.urlArgs);c[this.config.argName]=g;var b=[this.config.submitUrl,Object.toQueryString(c)].join("?");this.rpc(b,a.bind(this),a.bind(this,"busy"))};Package("apple.widget");apple.widget.Engraver=function(a){this.config=a;this.timer=null};apple.widget.Engraver.DEFAULT_DELAY=1000;apple.widget.Engraver.prototype.validateConfig=function(){if(!this.config){return false}var a=this.getTextFields();if(!a){return false}for(var b=0;b<a.length;b++){if(!a[b]){return false}}if(!this.getEngraveImage()){return false}return true};apple.widget.Engraver.prototype.connectEvents=function(){if(!this.attachedEvents){if(!this.validateConfig()){return}function a(c){var b=this.getTextFields();for(var d=0;d<b.length;d++){var f=$(b[d]);f.setAttribute("autocomplete","off");Event.observe(f,"onkeyup",(function(g){this.valueChanged(g)}).bind(this));Event.observe(f,"onchange",(function(g){this.valueChanged(g)}).bind(this));Event.observe(f,"drop",(function(g){this.valueChanged(g)}).bind(this));Event.observe(f,"dragdrop",(function(g){this.valueChanged(g)}).bind(this));Event.observe(f,"onfocus",(function(g){this.valueChanged(g)}).bind(this))}}Event.onDomReady(a.bind(this));this.attachedEvents=true}};apple.widget.Engraver.prototype.valueChanged=function(a){if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.engrave.bind(this),this.getDelay())};apple.widget.Engraver.prototype.getTextFields=function(){return this.config.textFields};apple.widget.Engraver.prototype.getEngraveImage=function(){return this.config.engraveImageId};apple.widget.Engraver.prototype.getBaseUrl=function(){return this.config.baseUrl};apple.widget.Engraver.prototype.getDelay=function(){if(this.config.delay){return parseInt(this.config.delay,10)}return apple.widget.Engraver.DEFAULT_DELAY};apple.widget.Engraver.prototype.engrave=function(){var k=$(this.getEngraveImage()),f=this.getBaseUrl(),a=this.getTextFields(),h=f.indexOf("?"),d=h>=0,g=(f.length>h+1);if(!d){f+="?"}var b=true;for(var c=0;c<a.length;c++){if($(a[c]).value!==""){b=false;break}}for(c=0;c<a.length;c++){f+=g?"&":"";g=true;f+=this.getLineArgument($(a[c]).value,c)}if(k){k.setAttribute("src",f)}};apple.widget.Engraver.prototype.getLineArgument=function(c,b){c=this.encode(c);var a="th";if(b%2==1){a="tl"}return a+"="+c};apple.widget.Engraver.prototype.encode=function(b){try{return encodeURIComponent(b)}catch(a){return escape(b)}};Package("apple.widget");apple.widget.FormFormatter=function(a){var b=".user-form-block .field-with-placeholder > input";this.init(b)};Object.extend(apple.widget.FormFormatter.prototype,{inlineBlockCompensation:4,init:function(a){var b=this.gatherRows(a);this.parseRows(b)},gatherRows:function(a){var c=Element.queryAll(a),b=[];c.forEach(function(d){b.push(d.parentNode.parentNode)});return b.distinct()},parseRows:function(b){var a,c;b.forEach(function(d){a=Element.queryAll(d,"> *");a=this.parseChildren(a);a.adjustable=this.determineRelativeFlexFields(a.adjustable);this.formatRow(d,a)}.bind(this));return c},parseChildren:function(b){var d={adjustable:[],nonadjustable:[]},a,c;b.forEach(function(f){a=Element.getDimensions(f).width;if(a===0&&!this.isEmptyNode(f)){a=this.unhideAndCalculate(f)}if(this.isChildATextField(f)){Element.addClassName(f,"text-input")}c=(this.isChildATextField(f)&&!this.isFieldWidthDeclared(f))?d.adjustable:d.nonadjustable;c.push({node:f,width:a})}.bind(this));return d},determineRelativeFlexFields:function(g){var d=g.length,k=[],c=0,h,f=0,b=0;if(d===1){g[0].relativeWidth=1}else{g.forEach(function(m){h=Element.query(m.node,"input");c=h.maxLength;k.push(c);f=f+c});for(var a=0;a<d;a++){b=Math.round((k[a]/f)*100);b=b/100;g[a].relativeWidth=b}}return g},formatRow:function(k,d){var a=Element.getDimensions(k).width,g=0,b=0,f=0,h=0,c=0;if(a===0){a=this.unhideAndCalculate(k)}d.nonadjustable.forEach(function(m){b=b+m.width});f=a-b;d.adjustable.forEach(function(m){c=Math.round((m.relativeWidth*f)-this.inlineBlockCompensation);Element.setStyle(m.node,"width",c+"px")}.bind(this))},isChildATextField:function(c){var a=Element.query(c,"input[type=text]"),b=Element.query(c,"input[type=password]");return(a||b)?true:false},isFieldWidthDeclared:function(d){var a=Element.getDimensions(d).width,c=0,b=Element.getStyle(d,"minWidth");if(a===0){a=this.unhideAndCalculate(d)}d.style.width="auto";if(b!="0px"){d.style.minWidth=0}c=Element.getDimensions(d).width;if(c===0){c=this.unhideAndCalculate(d)}d.style.width=a+"px";if(b!="0px"){d.style.minWidth=b}return(a==c)?false:true},isEmptyNode:function(a){return(a.innerHTML==="")?true:false},unhideAndCalculate:function(c){var a=this.findHiddenParent(c),b=0;if(a){a.style.display="block";b=Element.getDimensions(c).width;a.style.display="none"}return b},findHiddenParent:function(b){var a=b.parentNode,c;if(a==document||!a){return false}if(a.style){c=a.style.display}return(c=="none")?a:this.findHiddenParent(a)}});Package("apple.widget");apple.widget.FormSubmitter=function(a){this.config=a;Event.onDomReady(this.init.bind(this))};apple.widget.FormSubmitter.prototype.init=function(){if(this._initialized){return}Event.observe(this.getForm(),"onsubmit",(function(a){this.formHandler(a)}).bind(this));Event.observe(this.getSubmit(),"onclick",(function(a){this.submitHandler(a)}).bind(this));this._initialized=true};apple.widget.FormSubmitter.prototype.getForm=function(){return $(this.config.formId)?$(this.config.formId):document.forms[this.config.formId]};apple.widget.FormSubmitter.prototype.getSubmit=function(){return $(this.config.submitId)};apple.widget.FormSubmitter.prototype.formHandler=function(a){return true};apple.widget.FormSubmitter.prototype.submitHandler=function(a){return true};apple.widget.SelectLinkFormSubmitter=apple.widget.FormSubmitter;apple.widget.SelectLinkFormSubmitter.prototype.getSelect=function(){return $(this.config.selectId)};apple.widget.SelectLinkFormSubmitter.prototype.formHandler=function(b){var c=this.getForm();var a=this.getSelect();if(c&&a&&a.options&&a.options[a.selectedIndex].value){c.action=a.options[a.selectedIndex].value}return true};Package("apple.widget");apple.widget.Gallery=function(a){this.config=a;this.index=0;if(!this.config.initial){this.config.initial=this.getTypeImage()}this.setMediaType(this.config.initial);this.setShowingAlt(false);this.setupImages();this.setupMovies();this.setupFX()};apple.widget.Gallery.FX_NONE=0;apple.widget.Gallery.FX_PAN=1;apple.widget.Gallery.FX_FADE=2;apple.widget.Gallery.TYPE_IMAGE=100;apple.widget.Gallery.TYPE_MOVIE=101;apple.widget.Gallery.prototype.getFxNone=function(){return apple.widget.Gallery.FX_NONE};apple.widget.Gallery.prototype.getFxPan=function(){return apple.widget.Gallery.FX_PAN};apple.widget.Gallery.prototype.getFxFade=function(){return apple.widget.Gallery.FX_FADE};apple.widget.Gallery.prototype.getTypeImage=function(){return apple.widget.Gallery.TYPE_IMAGE};apple.widget.Gallery.prototype.getTypeMovie=function(){return apple.widget.Gallery.TYPE_MOVIE};apple.widget.Gallery.prototype.setupImages=function(){if(!this.hasImages()){return}function d(g){c[g]++;window.setTimeout(f.bind(null,g),10)}function f(m){function k(){b[h][m+"Image"]=n;if(!q){return}window.clearTimeout(q);d(m)}function g(){q=0;window.clearTimeout(q);d(m)}var q=0;var h=c[m];if(h>=a){return}var o=b[h][m];if(!o){d(m);return}var n=new Image();n.onload=k;n.src=o;q=window.setTimeout(g,2000)}var c={thumb:0,full:0};var b=this.config.images;var a=b.length;f("thumb");f("full")};apple.widget.Gallery.prototype.setupMovies=function(){if(this.hasMovies()){if(!this.config.movie.full){this.config.movie.full={}}if(!this.config.movie.full.elementId){this.config.movie.full.elementId=Element.uniqueId()}for(var c=0;c<this.config.movies.length;c++){if(this.config.movies[c].thumb){var d=new Image();d.src=this.config.movies[c].thumb;this.config.movies[c].thumbImage=d}if(this.config.movies[c].full){var a=this.config.movies[c];var b=this.findIdName(a.full);if(!b){b=this.config.movie.full.elementId+c;a.full.push("id");a.full.push(b)}a.elementId=b;a.full.push("enablejavascript");a.full.push("true");var f=new apple.quicktime.QuickTime(a.full);a.xml=f.generateOBJECTTextXHTML()}}}};apple.widget.Gallery.prototype.setupFX=function(){if(this.config.fade){this.fader=new apple.fx.CrossFade(this.config.fade.speed,this.config.fade.increment)}if(this.config.swoosh){this.swoosher=new apple.fx.Swoosh(this.config.viewer.elementId,this.config.swoosh.speed,this.config.swoosh.increment)}};apple.widget.Gallery.prototype.next=function(){if(this.isShowingImage()){this._showImage(this.index+1,this.getFxPan())}else{this._showMovie(this.index+1,this.getFxNone())}};apple.widget.Gallery.prototype.previous=function(){if(this.isShowingImage()){this._showImage(this.index-1,this.getFxPan())}else{this._showMovie(this.index-1,this.getFxNone())}};apple.widget.Gallery.prototype.image=function(a){if(!this.isShowingImage()){this.swapMedia()}this._showImage(a,this.getFxFade())};apple.widget.Gallery.prototype.movie=function(a){if(!this.isShowingMovie()){this.swapMedia()}this._showMovie(a,this.getFxNone())};apple.widget.Gallery.prototype.hasImages=function(){return this.config.images&&this.config.images.length};apple.widget.Gallery.prototype.hasMovies=function(){return this.config.movies&&this.config.movies.length};apple.widget.Gallery.prototype.isShowingImage=function(){return(this.mediaType==this.getTypeImage())};apple.widget.Gallery.prototype.isShowingMovie=function(){return(this.mediaType==this.getTypeMovie())};apple.widget.Gallery.prototype.setMediaType=function(a){this.mediaType=a};apple.widget.Gallery.prototype.swapMedia=function(){this.stopAnimations();var a=this.getMovieElement();var b=this.getActiveImage();if(this.isShowingImage()){Element.hide(b);a.innerHTML="";Element.show(a);this.changeThumbImageState(this.getTypeImage(),this.index,-1);this.setMediaType(this.getTypeMovie())}else{Element.show(b);a.innerHTML="";Element.hide(a);this.changeThumbImageState(this.getTypeMovie(),this.index,-1);this.setMediaType(this.getTypeImage())}this.index=-1};apple.widget.Gallery.prototype._showMovie=function(a,d){if(a==this.index){return}if(!this.hasMovies()){return}var g=this.index;if(a>=this.config.movies.length){a=0}else{if(a<0){a=this.config.movies.length-1}}this.changeThumbImageState(this.getTypeMovie(),g,a);this.stopAnimations();var b=this.getMovieElement();Element.hide(b);try{var f=null;if(g>=0){f=$(this.config.movies[g].elementId)}if(f){f.Stop();Element.hide(f);while(b.hasChildNodes()){b.removeChild(b.firstChild)}b.innerHTML=""}}catch(c){b.innerHTML=""}b.innerHTML=this.config.movies[a].xml;Element.show(b);this.index=a};apple.widget.Gallery.prototype._showImage=function(a,c){if(a==this.index){return}if(!this.hasImages()){return}var d=this.index;var b=(a>=d);if(a>=this.config.images.length){a=0}else{if(a<0){a=this.config.images.length-1}}this.changeThumbImageState(this.getTypeImage(),this.index,a);this.stopAnimations();if(c==this.getFxFade()){if(this.fader){this.fadeImage(this.config.images[a])}else{this.getActiveImage().src=this.config.images[a].fullImage.src;this.getActiveImage().alt=this.config.images[a].alt}}else{if(c==this.getFxPan()){if(this.swoosher){this.panImage(b,this.config.images[a])}else{this.getActiveImage().src=this.config.images[a].fullImage.src;this.getActiveImage().src=this.config.images[a].alt}}}this.index=a};apple.widget.Gallery.prototype.getActiveImage=function(){if(this.isShowingAlt()){return this.getAltFullImage()}else{return this.getFullImage()}};apple.widget.Gallery.prototype.stopAnimations=function(){if(this.fader){this.fader.stopAnimation()}if(this.swoosher){this.swoosher.stopAnimation()}};apple.widget.Gallery.prototype.isShowingAlt=function(){return this.showingAlt};apple.widget.Gallery.prototype.setShowingAlt=function(a){return this.showingAlt=a};apple.widget.Gallery.prototype._resetImages=function(b,a){Element.setOpacity(b,1);Element.setOpacity(a,1)};apple.widget.Gallery.prototype.fadeImage=function(c){var b=!this.isShowingAlt();this.setShowingAlt(b);var d=null;var a=null;if(b){d=this.getFullImage();a=this.getAltFullImage()}else{d=this.getAltFullImage();a=this.getFullImage()}a.src=c.fullImage.src;a.alt=c.alt;this._resetImages(d,a);this.fader.fade(d,a)};apple.widget.Gallery.prototype.panImage=function(b,d){var c=!this.isShowingAlt();this.setShowingAlt(c);var f=null;var a=null;if(c){f=this.getFullImage();a=this.getAltFullImage()}else{f=this.getAltFullImage();a=this.getFullImage()}a.src=d.fullImage.src;a.alt=d.alt;this._resetImages(f,a);this.swoosher.pan(b,f,a)};apple.widget.Gallery.prototype.changeThumbImageState=function(d,c,a){var b=this.getThumbAnchor(d,c);var f=this.getThumbAnchor(d,a);if(b){b.className=this.config.image.thumb.cssClass}if(f){f.className=this.config.image.thumb.cssActiveClass}};apple.widget.Gallery.prototype.getFullImage=function(){return $(this.config.image.full.elementId)};apple.widget.Gallery.prototype.getAltFullImage=function(){var a=this.config.image.full.elementId+"Alt";var b=$(a);if(!b){var c=this.getFullImage();b=c.cloneNode(false);b.id=a;var d=this.getViewer();d.appendChild(b)}return b};apple.widget.Gallery.prototype.getMovieElement=function(){var a=this.config.movie.full.elementId;var b=$(a);if(!b){b=document.createElement("div");b.id=a;Element.setStyle(b,"position","absolute");Element.setStyle(b,"display","block");Element.setStyle(b,"left","0px");Element.setStyle(b,"top","0px");var c=this.getViewer();c.appendChild(b)}return b};apple.widget.Gallery.prototype.getViewer=function(){return $(this.config.viewer.elementId)};apple.widget.Gallery.prototype.getThumbAnchorId=function(b,a){var c=null;if(b==this.getTypeImage()){c=this.config.image.thumb.elementId+a}else{c=this.config.movie.thumb.elementId+a}return c};apple.widget.Gallery.prototype.getThumbAnchor=function(b,a){return $(this.getThumbAnchorId(b,a))};apple.widget.Gallery.prototype.getThumbImage=function(b,a){var c=null;if(b==this.getTypeImage()){c=this.config.images[a].thumbImage}else{c=this.config.movies[a].thumbImage}return c};apple.widget.Gallery.prototype.outputImageThumbs=function(){if(this.hasImages()){var b=null;b=$(this.config.image.thumb.elementId);for(var a=0;a<this.config.images.length;a++){var c=new apple.widget.Gallery.ClickWrapper(this,a,this.getTypeImage());this.createThumb(b,this.getThumbAnchorId(this.getTypeImage(),a),this.config.images[a].thumbImage.src,false,this.config.image.thumb,c)}if(this.isShowingImage()){this.index=-1;this._showImage(0,this.getFxNone())}}};apple.widget.Gallery.prototype.outputMovieThumbs=function(){if(this.hasMovies()){var b=null;b=$(this.config.movie.thumb.elementId);for(var a=0;a<this.config.movies.length;a++){var c=new apple.widget.Gallery.ClickWrapper(this,a,this.getTypeMovie());this.createThumb(b,this.getThumbAnchorId(this.getTypeMovie(),a),this.config.movies[a].thumbImage.src,false,this.config.movie.thumb,c)}if(this.isShowingMovie()){this.index=-1;this._showMovie(0,this.getFxNone())}}};apple.widget.Gallery.prototype.createThumb=function(d,k,h,c,b,f){var a=this.createAnchorNode(k,c,b.cssActiveClass,b.cssClass);a.onclick=function(){f.onClick()};var g=this.createImageNode(h,b.width,b.height);a.appendChild(g);d.appendChild(a)};apple.widget.Gallery.prototype.createImageNode=function(d,b,a){var c=document.createElement("img");Element.setStyle(c,"height",a+"px");Element.setStyle(c,"width",b+"px");c.src=d;return c};apple.widget.Gallery.prototype.createAnchorNode=function(f,c,b,d){var a=document.createElement("a");a.id=f;if(c){if(b){a.className=b}}else{if(d){a.className=d}}return a};apple.widget.Gallery.prototype.findIdName=function(b){for(var a=0;a<b.length;a+=2){var c=b[a].toLowerCase();var d=b[a+1];if("name"==c||"id"==c){return d}}return null};apple.widget.Gallery.ClickWrapper=function(a,b,c){this.gallery=a;this.index=b;this.type=c};apple.widget.Gallery.ClickWrapper.prototype.onClick=function(){if(this.type==this.gallery.getTypeImage()){this.gallery.image(this.index)}else{this.gallery.movie(this.index)}};Package("apple.widget");apple.widget.Gallery2=function(a){this.base("constructor")(a);this._groupThumbs={};this._activeGroup=0;this._imageId=[];this._activeImageIndex=0;this._quicktimeInstalled=false;this._loadedImages={};this._mediaClass=null;this._mediaType=null};apple.util.makeSubclass(apple.widget.Gallery2,apple.widget.BaseWidget);apple.widget.Gallery2.DEFAULTS={activeClass:"active",disabledClass:"disabled",imageClass:"image",mediaClass:"media",movieClass:"movie",thumbGroupClass:"thumbnails",thumbMouseOver:false,allowWrapping:true,movieFirstFrame:{pattern:/\.m[o|4]v$/,replace:"-first.jpg"},moviePosterFrame:{pattern:/\.m[o|4]v$/,replace:".jpg"}};apple.widget.Gallery2.prototype.cssClassRegex=/css-class\((.*?)\)/;apple.widget.Gallery2.prototype.movieRegex=/\.m[o|4]v$/;apple.widget.Gallery2.prototype.jsvrRegex=/jsvr$/;apple.widget.Gallery2.RIGHT="right";apple.widget.Gallery2.LEFT="left";apple.widget.Gallery2.FADE="";apple.widget.Gallery2.prototype.init=function(){var m=$(this.config.galleryId);if(!m){return}this._quicktimeInstalled=apple.quicktime.isInstalled();this._mediaClass=this.config.imageClass;Element.addClassName(m,this.config.imageClass);Element.removeClassName(m,this.config.movieClass);var b=Element.queryAll(m,"."+this.config.mediaClass)[0];if(!b){return}this._mediaId=Element.assignId(b);var h={id:this._mediaId,duration:400};this._swapper=new apple.fx.ContentSwapper(h);function a(){var n=document.createElement("div");var o=document.createElement("img");n.appendChild(o);o.style.position="absolute";o.style.left="50%";o.style.top="50%";n.style.position="absolute";n.style.left="0";n.style.top="0";n.style.width="100%";n.style.height="100%";n.style.display="none";n.style.zIndex="2";b.appendChild(n);return n}var f=b.getElementsByTagName("img")[0];var k=f.src;f.parentNode.removeChild(f);f=a();this._imageId[0]=Element.assignId(f);this._setImage(0,k,this.config.imageClass);f.style.display="";f=a();this._imageId[1]=Element.assignId(f);if(this.config.jsvrOptions){this._createVrContainer(this.config.jsvrOptions);this._sampleVrImage(this.config.jsvrOptions)}this._createNavigation(m);var g=this.thumbClicked.bindAsEventListener(this);function d(r,q){var o=r.getElementsByTagName("a");function n(u){var v=Element.assignId(u);var t=u.href;if(t==k){this._activeThumbId=v;this._activeGroup=q;Element.addClassName(u,this.config.activeClass)}else{Element.removeClassName(u,this.config.activeClass)}u._groupIndex=q;this._groupThumbs[q].push(v);if(!t.match(this.movieRegex)){return}if(!this._quicktimeInstalled){t=t.replace(this.config.moviePosterFrame.pattern,this.config.moviePosterFrame.replace);u.href=this._movieFrameSrc(u,this.config.moviePosterFrame)}}Event.observe(r,"click",g);this._groupThumbs[q]=[];Array.forEach(o,n,this)}var c=Element.queryAll(m,"."+this.config.thumbGroupClass);Array.forEach(c,d,this);Event.observe(m,"mousedown",this.mouseDown.bindAsEventListener(this));this._updateNavigation()};apple.widget.Gallery2.prototype._setImage=function(a,h,d,k){function c(){this._mediaSize={width:g.width,height:g.height};if(!("devicePixelRatio" in window&&window.devicePixelRatio>1)){f.width=g.width;f.height=g.height}f.src=h;f.style.marginTop=-(g.height/2)+"px";f.style.marginLeft=-(g.width/2)+"px";if(k){k.call(this)}}var b=$(this._imageId[a]);var f=b.firstChild;var g=new Image();b.className=d||"";g.onload=c.bind(this);g.src=h};apple.widget.Gallery2.prototype._updateMediaClass=function(b){if(b==this._mediaClass){return}var a=$(this.config.galleryId);Element.addClassName(a,b);Element.removeClassName(a,this._mediaClass);this._mediaClass=b};apple.widget.Gallery2.prototype._createNavigation=function(c){var b;b=document.createElement("a");b.className="prev";b.href="#";b.onclick=this.prevButtonClicked.bindAsEventListener(this);this._prevButtonId=Element.assignId(b);c.appendChild(b);b=document.createElement("a");b.className="next";b.href="#";b.onclick=this.nextButtonClicked.bindAsEventListener(this);this._nextButtonId=Element.assignId(b);c.appendChild(b)};apple.widget.Gallery2.prototype._getMovie=function(){return $(this._movieId)};apple.widget.Gallery2.prototype._hideMovie=function(){var a=this._getMovie();if(a&&!this._playingMovie&&apple.quicktime.mobileSafari){a.parentNode.removeChild(a);return}if(!this._movieController){return}a.parentNode.style.backgroundImage="";this._movieController.hideMovie();var b=a.parentNode};apple.widget.Gallery2.prototype._movieLoaded=function(b){var a=$(this.config.galleryId);this._updateMediaClass(this._mediaType);var c=$(this._imageId[this._activeImageIndex]);var d=b.parentNode;d.className=this._mediaType;b.parentNode.style.backgroundImage="url("+c.firstChild.src+")";this._movieController.showMovie(this._mediaSize.width,this._mediaSize.height);c.style.display="none";this._movieController.play()};apple.widget.Gallery2.prototype._movieFrameSrc=function(c,d){d=d||this.config.movieFirstFrame;var b=$(c);if(!b){return""}var f=this._stripFolder(b.href);var h=b.getElementsByTagName("img")[0];if(!h){return""}var g=h.src;var a=g.lastIndexOf("/");if(-1==a){return""}g=[g.substr(0,a),f].join("/");return g.replace(d.pattern,d.replace)};apple.widget.Gallery2.prototype._stripFolder=function(b){var a=b.lastIndexOf("/");if(-1==a){return b}return b.substr(a+1)};apple.widget.Gallery2.prototype._playMovie=function(c,f){var b=apple.quicktime.mobileSafari?this.config.moviePosterFrame:this.config.movieFirstFrame;var a=this._movieFrameSrc(this._activeThumbId,b);function d(){var g=this._getMovie();if(coherent.Browser.Safari||apple.quicktime.mobileSafari||!g){this._createMovie(c);return}this._movieController.hideMovie();this._movieController.loadMovie(c)}this._swapImages(a,f,d.bind(this))};apple.widget.Gallery2.prototype._showVr=function(a){if(!this.vr){this._positionVrContainer(a);this.vr=new apple.VR(a)}this.vrContainer.style.display="block";this._updateMediaClass(this._mediaType);var b=$(this._imageId[this._activeImageIndex]);b.style.display="none"};apple.widget.Gallery2.prototype._hideVr=function(a){if(this.vrContainer){this.vrContainer.style.display="none"}};apple.widget.Gallery2.prototype._createVrContainer=function(a){this.vrContainer=document.createElement("div");this.vrContainer.id=a.container;var b=$(this._mediaId);b.appendChild(this.vrContainer)};apple.widget.Gallery2.prototype._positionVrContainer=function(b){var a=(this.vrContainer.parentNode.offsetWidth-this.sampleVrImage.width)/2;var c=(this.vrContainer.parentNode.offsetHeight-this.sampleVrImage.height)/2;this.vrContainer.style.position="absolute";this.vrContainer.style.left=a+"px";this.vrContainer.style.top=c+"px";this.vrContainer.style.width=this.sampleVrImage.width+"px";this.vrContainer.style.height=this.sampleVrImage.height+"px"};apple.widget.Gallery2.prototype._sampleVrImage=function(a){var d=a.imagePath.match(/^([^#]*)(#+)([^#]*)$/);var c=d[2].length;var b="1";while(b.length<c){b="0"+b}var f=d[1]+b+d[3];this.sampleVrImage=new Image();this.sampleVrImage.src=f};apple.widget.Gallery2.prototype._createMovie=function(d){var g=$(this._mediaId);var f=document.createElement("div");var b;if(this._movieId){b=$(this._movieId);b.parentNode.removeChild(b)}g.appendChild(f);f.style.position="absolute";f.style.left="0";f.style.top="0";f.style.width="100%";f.style.height="100%";f.style.backgroundPosition="center center";f.style.backgroundRepeat="no-repeat";this._movieId=Element.uniqueId();var c={src:d,id:this._movieId,width:this.config.movieWidth,height:this.config.movieHeight,autoplay:false,bgcolor:this.config.movieBackground};b=apple.quicktime.createMovie(c,f);b.style.position="absolute";b.style.left="50%";b.style.top="50%";b.style.marginLeft=(-this._mediaSize.width/2)+"px";b.style.marginTop=(-this._mediaSize.height/2)+"px";if(apple.quicktime.mobileSafari){return $(this._movieId)}var a={movieId:this._movieId,onload:this._movieLoaded.bind(this)};this._movieController=new apple.widget.MovieController(this.config.controllerId,a);this._movieController.hideMovie();return $(this._movieId)};apple.widget.Gallery2.prototype._swapImages=function(c,g,k){var a=$(this.config.galleryId);var f=this._activeImageIndex?0:1;var d=$(this._imageId[this._activeImageIndex]);var h=$(this._imageId[f]);if(!d||!h){return}function b(){d.style.display="";this._activeImageIndex=f;this._hideVr();this._hideMovie();if(!this._playingMovie){this._updateMediaClass(this._mediaType)}this._swapper.swap(g,d,h,k)}if(this._movieController){this._movieController.stop()}h.style.display="none";this._setImage(f,c,this._mediaType,b)};apple.widget.Gallery2.prototype.showAsset=function(a,b){if(a.match(this.movieRegex)){this._playingMovie=true;this._playMovie(a,b)}else{if(a.match(this.jsvrRegex)){this._showVr(this.config.jsvrOptions)}else{this._playingMovie=false;this._swapImages(a,b)}}};apple.widget.Gallery2.prototype._updateNavigation=function(){var a=this._groupThumbs[this._activeGroup];var c=a.indexOf(this._activeThumbId);var b=$(this._prevButtonId);var d=$(this._nextButtonId);if(1==a.length){b.style.display="none";d.style.display="none";return}b.style.display="";d.style.display="";if(this.config.allowWrapping){return}if(!c){Element.addClassName(b,this.config.disabledClass)}else{Element.removeClassName(b,this.config.disabledClass)}if(a.length==c+1){Element.addClassName(d,this.config.disabledClass)}else{Element.removeClassName(d,this.config.disabledClass)}};apple.widget.Gallery2.prototype._activateThumb=function(d){var b;if(this._activeThumbId){b=$(this._activeThumbId);Element.removeClassName(b,this.config.activeClass)}this._activeThumbId=d;b=$(this._activeThumbId);Element.addClassName(b,this.config.activeClass);var c;var a=(b.rel||"");c=a.match(this.cssClassRegex);if(c&&c[1]){this._mediaType=c[1]}else{if(b.href.match(this.movieRegex)){this._mediaType=this.config.movieClass}else{this._mediaType=this.config.imageClass}}this._updateNavigation()};apple.widget.Gallery2.prototype.thumbClicked=function(c){var d=c.target||c.srcElement;var a=$(this.config.galleryId);Event.stop(c);while(d&&d!=a&&d.nodeName.toLowerCase()!="a"){d=d.parentNode}if(d==a){return}var b=d.href;if(!b){return}d.blur();if(this._activeThumbId==d.id){return}this._activeGroup=d._groupIndex;this._activateThumb(d.id);this.showAsset(b)};apple.widget.Gallery2.prototype.nextButtonClicked=function(f){var b=this._groupThumbs[this._activeGroup];var d=b.indexOf(this._activeThumbId);Event.stop(f);d++;if(!this.config.allowWrapping&&d==b.length){return}if(d==b.length){d=0}var a=b[d];var c=$(a).href;this._activateThumb(a);this.showAsset(c,apple.widget.Gallery2.LEFT)};apple.widget.Gallery2.prototype.prevButtonClicked=function(f){var b=this._groupThumbs[this._activeGroup];var d=b.indexOf(this._activeThumbId);Event.stop(f);d--;if(!this.config.allowWrapping&&d<0){return}if(d<0){d=b.length-1}var a=b[d];var c=$(a).href;this._activateThumb(a);this.showAsset(c,apple.widget.Gallery2.RIGHT)};apple.widget.Gallery2.prototype.mouseDown=function(b){var c=b.srcElement||b.target;var a=this._getMovie();if(c==a){return}Event.stop(b)};Package("apple.widget");apple.widget.HelpMessage=Class.create(coherent.Overlay,{__structure__:{},container:Part(".container"),content:Part(".content"),target:Part(".target"),innerHTML:'<div class="container"><table><tr class="t"><td class="l"><span></span></td><td class="m"><span></span></td><td class="r"><span></span></td></tr><tr class="m"><td class="l"></td><td class="msg"><div class="content"></div></td><td class="r"></td></tr><tr class="b"><td class="l"></td><td class="m"></td><td class="r"></td></tr></table><span class="target"></span></div>',containerAlign:"help-left",displaying:false,inTimeout:null,inTimeoutFor:250,shouldShow:true,helpClassName:"help-message",constructor:function(a,b,c){this.base(this.constructWrapper(a),b,c);this.__unposition()},constructWrapper:function(c){var b=("string"===typeof(c))?document.getElementById(c):c;this.srcElementId=Element.assignId(b);this.srcElement=b;var a=document.createElement("DIV");Element.assignId(a);Element.addClassName(a,this.helpClassName);document.body.appendChild(a);return a},init:function(){var b=this.getSrcElement(),c=this.viewElement(),d=this.content(),a=this.container();var f=Event.observe;f(b,"mouseover",this.__mouse.bindAsEventListener(this));f(b,"mouseout",this.__mouse.bindAsEventListener(this));f(b,"click",this.__mouse.bindAsEventListener(this));f(c,"mouseout",this.__mouse.bindAsEventListener(this));f(document.body,"touchstart",this.__touchstart.bindAsEventListener(this));f(window,"blur",this.__mouse.bindAsEventListener(this));this.transitionEndListener=this.__transitionEnd.bind(this)},getSrcElement:function(){return this.srcElement||document.getElementById(this.srcElementId)},__mouse:function(a){this.__clearDelay();this.inTimeout=this.toggle.bindAndDelay(this,this.inTimeoutFor,a.type,(a.relatedTarget||a.toTarget))},__touchstart:function(a){if(a.target.id!==this.srcElementId){this.__clearDelay();this.inTimeout=this.toggle.bindAndDelay(this,this.inTimeoutFor,a.type,a.target)}},__clearDelay:function(){window.clearTimeout(this.inTimeout);this.inTimeout=null},__loadContent:function(){var g=this.content(),b=this.container(),f=this.target(),h=document.getElementById(this.srcElementId),a,m,c,d,k;if(!this.loadedContent){m=document.getElementById(h.getAttribute("rel"));this.loadedContent="<p>This is the default help message. Maybe you need to setup the help message element?</p>";if(m){a=m.className;d=m.innerHTML;this.setContentWidth();this.shouldShow=true}else{this.shouldShow=false}g.innerHTML=d;c=h.cloneNode(true);c.id=null;c.onclick=null;c.removeAttribute("id");c.removeAttribute("onclick");f.innerHTML="";f.onclick='return apple.widget.HelpMessage.click("'+this.srcElementId+'");';f.appendChild(c);this.loadedContent=g.innerHTML}Element.addClassName(g,a);g.innerHTML=this.loadedContent;b.className="container";if(Element.hasClassName(h,"top")){Element.addClassName(b,"text-top")}else{Element.addClassName(b,"text-bottom")}if(Element.hasClassName(h,"left")){Element.addClassName(b,"text-left")}else{Element.addClassName(b,"text-right")}},setContentWidth:function(){var a=document.getElementById(this.srcElementId),b=document.getElementById(a.getAttribute("rel")),c=b.style.width;if(!c){c="200px"}Element.setStyle(this.content(),"width",c)},__position:function(){var c=this.viewElement(),f=this.container(),b=Element.getRect(f),a=document.getElementById(this.srcElementId),d=Element.getRect(a);Element.setStyles(c,{top:(Element.hasClassName(a,"top")?d.bottom:d.top)+"px",left:(Element.hasClassName(a,"left")?d.right:d.left)+"px"})},__unposition:function(){var a=this.viewElement();Element.setStyles(a,{top:"-9000em",left:"",width:"",height:""})},__transitionEnd:function(){this.container().removeEventListener("webkitTransitionEnd",this.transitionEndListener,false);this.__unposition()},toggle:function(c,a){var b=this.viewElement(),d=a;switch(c){case"click":case"mouseover":if(this.displaying===true){return}this.display();break;case"touchstart":case"mouseout":case"blur":if(this.displaying!==true){return}do{if(d===b){return}}while((d=d&&d.parentNode));this.hide();return;default:break}},display:function(){var a=this.container();this.__loadContent();if(!this.shouldShow){return}this.__position();if((coherent.Browser.Safari||coherent.Browser.MobileSafari)&&typeof(WebKitTransitionEvent)!="undefined"){Element.addClassName(a,"show")}else{coherent.Animator.addClassName(a,"show",{duration:150})}apple.metrics.fireMicroEvent({feature:"help overlay",part:$(this.srcElementId).getAttribute("rel"),action:"show",eVar:"eVar21"});this.displaying=true;this.__clearDelay()},hide:function(){var b=this.viewElement(),a=this.container();if((coherent.Browser.Safari||coherent.Browser.MobileSafari)&&typeof WebKitTransitionEvent!="undefined"){a.addEventListener("webkitTransitionEnd",this.transitionEndListener,false);Element.removeClassName(a,"show")}else{coherent.Animator.removeClassName(a,"show",{duration:150,callback:this.__unposition.bind(this)})}this.displaying=false;this.__clearDelay()}});apple.widget.HelpMessage.loadAll=function(a,c){if(arguments.length<2){c=a;a=null}function b(){var g=a?Element.queryAll(a,c):Element.queryAll(a),f=g.length,d,h;for(h=0;h<f;h++){d=coherent.View.fromNode(g[h]);if(d){d.teardown()}new apple.widget.HelpMessage(g[h])}}Event.onLoad(b)};apple.widget.HelpMessage.click=function(a){return($(a)||document.body).onclick()};Package("apple.widget");apple.widget.HoverManager=function(b,a){if(apple.widget.HoverManager.sharedManager){return apple.widget.HoverManager.sharedManager}apple.widget.HoverManager.sharedManager=this;a=Object.applyDefaults(a,arguments.callee.DEFAULTS);this.configs=b||[];this.hovers=[];this.activeHover=null;this._sourceClickedHandler=this.sourceClicked.bindAsEventListener(this);this._mouseOverHandler=this.mouseOver.bindAsEventListener(this);this._mouseOutHandler=this.mouseOut.bindAsEventListener(this);this._contentClicked=this.contentClicked.bindAsEventListener(this);this._behaviour=a.behaviour;this._showDelay=a.showDelay;this._hideDelay=a.hideDelay;Event.onDomReady(this.init.bind(this));return this};apple.widget.HoverManager.sharedManager=null;apple.widget.HoverManager.BEHAVIOUR={CLICK_OUTSIDE_TO_CLOSE:1,CLICK_INSIDE_TO_CLOSE:2,MOUSE_OVER_TO_OPEN:4,MOUSE_OUT_TO_CLOSE:8,CLICK_SOURCE_TO_OPEN:16};apple.widget.HoverManager.DEFAULTS={showDelay:1000,hideDelay:1000,behaviour:(apple.widget.HoverManager.BEHAVIOUR.CLICK_OUTSIDE_TO_CLOSE|apple.widget.HoverManager.BEHAVIOUR.CLICK_SOURCE_TO_OPEN|apple.widget.HoverManager.BEHAVIOUR.MOUSE_OVER_TO_OPEN|apple.widget.HoverManager.BEHAVIOUR.MOUSE_OUT_TO_CLOSE)};apple.widget.HoverManager.prototype.init=function(){function a(b,d){var c=new apple.widget.Hover(b,this)}this.configs.forEach(a,this);if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_OUTSIDE_TO_CLOSE){this._bodyClickedHandler=this.bodyClicked.bindAsEventListener(this);Event.observe(document.body,"onclick",this._bodyClickedHandler)}Event.onUnload(this.cleanup.bind(this))};apple.widget.HoverManager.prototype.manageHover=function(c){if(!c){return}var d=$(c.config.sourceId);var b=$(c.config.contentId);if(!d||!b){return}var a=this.hovers.length;this.hovers.push(c);d.hoverIndex=a;b.hoverIndex=a;if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_SOURCE_TO_OPEN){Event.observe(d,"click",this._sourceClickedHandler)}if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.MOUSE_OVER_TO_OPEN){Event.observe(d,"mouseover",this._mouseOverHandler);Event.observe(b,"mouseover",this._mouseOverHandler);Event.observe(d,"mouseout",this._mouseOutHandler);Event.observe(b,"mouseout",this._mouseOutHandler)}if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_INSIDE_TO_CLOSE){Event.observe(b,"click",this._contentClickedHandler)}};apple.widget.HoverManager.prototype.cleanup=function(){function a(b){var c=$(b.config.sourceId);b.cleanup()}this.hovers.forEach(a);this.hovers.length=0;if(this._bodyClickedHandler){Event.stopObserving(document.body,"onclick",this._bodyClickedHandler);this._bodyClickedHandler=null}this.cancelShowing();this.cancelHiding()};apple.widget.HoverManager.prototype.findHoverNode=function(a){while(a&&a.nodeName!="BODY"){if("hoverIndex" in a){return a}a=a.parentNode}return null};apple.widget.HoverManager.prototype.sourceClicked=function(a){var b=this.findHoverNode(a.target||a.srcElement);if(!b){return}this.showHover(b,true);Event.stop(a)};apple.widget.HoverManager.prototype.bodyClicked=function(a){if(!this.activeHover){return}if(Event.isMouseOverElement(a,$(this.activeHover.config.contentId))){return}this.hideHover(null,true);Event.stop(a)};apple.widget.HoverManager.prototype.mouseOver=function(a){var c=this.findHoverNode(a.srcElement||a.target);if(!c){return}var b=this.findHoverNode(a.relatedTarget||a.fromElement);if(b&&c==b){return}c.hasMouse=true;var d=c.sourceId||c.id;this.showHover(d)};apple.widget.HoverManager.prototype.mouseOut=function(b){var c=this.findHoverNode(b.srcElement||b.target);if(!c){return}var a=this.findHoverNode(b.relatedTarget||b.toElement);if(a&&c==a){return}c.hasMouse=false;var d=c.sourceId||c.id;if(this._showingSourceId==d||this._behaviour&apple.widget.HoverManager.BEHAVIOUR.MOUSE_OUT_TO_CLOSE){this.hideHover(d)}};apple.widget.HoverManager.prototype.contentClicked=function(a){var b=this.findHoverNode(a.srcElement||a.target);if(!b){return}this.hideHover(b.sourceId,true);Event.stop(a)};apple.widget.HoverManager.prototype.showHover=function(c,d){c=$(c);if(!c){return}if(c.id==this._hidingSourceId){this.cancelHiding()}if(d&&c.id==this._showingSourceId){this.cancelShowing();this.activeHover.show(true);return}var b=this.hovers[c.hoverIndex];if(b==this.activeHover){return}if(this._showing){this.cancelShowing()}if(this.activeHover){this.activeHover.hide();this.activeHover=b;b.show();this.cancelHiding();return}if(d){this.activeHover=b;b.show(true);return}function a(){this.cancelShowing();b.show(true)}this.activeHover=b;this._showingSourceId=c.id;this._showing=window.setTimeout(a.bind(this),this._showDelay)};apple.widget.HoverManager.prototype.cancelShowing=function(){window.clearTimeout(this._showing);this._showing=this._showingSourceId=0};apple.widget.HoverManager.prototype.cancelHiding=function(){window.clearTimeout(this._hiding);this._hiding=this._hidingSourceId=0};apple.widget.HoverManager.prototype.hideHover=function(c,d){c=c||(this.activeHover?this.activeHover.config.sourceId:null);c=$(c);if(!c){return}var b=this.hovers[c.hoverIndex];if(c.id==this._showingSourceId){this.cancelShowing();this.activeHover=null;return}if(this.activeHover&&b!=this.activeHover){b.hide();return}if(d){b.hide(true);this.activeHover=null;return}function a(){this.cancelHiding();b.hide(true);this.activeHover=null}this._hidingSourceId=c.id;this._hiding=window.setTimeout(a.bind(this),this._hideDelay)};apple.widget.HoverManager.prototype.beforeShowHover=function(a){};apple.widget.HoverManager.prototype.beforeHideHover=function(a){};Package("apple.widget");var STATES={hidden:0,showing:1,shown:2,hiding:3};apple.widget.Hover=function(a,b){function d(h,g){var f=[];while(f.length<g){f=f.concat(h)}f.length=g;return f}function c(g){var f=[].concat(g);function h(k){if(!(typeof k==="string"||k instanceof String)){return k}return apple.widget.Hover.LAYOUT_NAMES[k]}return f.map(h)}this.config=Object.applyDefaults(a,apple.widget.Hover.DEFAULTS);this.config.sourcePadding=d(this.config.sourcePadding,4);this.config.contentOffset=d(this.config.contentOffset,4);this.config.pointerOffset=d(this.config.pointerOffset,4);this.config.allowedLayouts=c(this.config.allowedLayout||this.config.allowedLayouts);this.manager=b||new apple.widget.HoverManager();Event.observe(window,"load",this.init.bind(this))};apple.widget.Hover.prototype.init=function(){var a=this.close.bindAsEventListener(this);this.currentLayout=apple.widget.Hover.NO_LAYOUT;var g=this._wrapContent();if(!g){return}var f=Element.getElementsByClassName("wdgt-mdl",g)[0];if(this.config.width){g.style.width=this.config.width}if(f&&this.config.height>=parseInt(Element.getStyles(f,"height"),10)){f.style.height=this.config.height}function d(n){Event.observe(n,"onclick",a)}var b=Element.getElementsByClassName("close-link",g);Array.forEach(b,d);var h=Element.queryAll(document,"#indicator_hover_content a");Array.forEach(h,d);var m=Element.getRect(g,true);function c(o){var n=Element.getDimensions(o);var q=Element.getRect(o,true);n.left=q.left-m.left;n.top=q.top-m.top;return n}var k=Element.getElementsByClassName("triangle",g);this.pointerInfo=Array.map(k,c);if(g&&(Element.getStyle(g,"display")!="none")){this._state=STATES.visible}else{this._state=STATES.hidden}this.manager.manageHover(this)};apple.widget.Hover.prototype.cleanup=function(){};apple.widget.Hover.DEFAULT_SHOW_Z_INDEX=1000;apple.widget.Hover.DEFAULT_HIDE_Z_INDEX=999;apple.widget.Hover.NO_LAYOUT=null;apple.widget.Hover.TOP_LAYOUT=0;apple.widget.Hover.RIGHT_LAYOUT=1;apple.widget.Hover.BOTTOM_LAYOUT=2;apple.widget.Hover.LEFT_LAYOUT=3;apple.widget.Hover.DEFAULTS={sourcePadding:[0,0,-2,-10],contentOffset:[20,40],pointerOffset:[8,10],fadeInDuration:300,fadeOutDuration:500,closeLink:"Close",allowedLayouts:[apple.widget.Hover.TOP_LAYOUT,apple.widget.Hover.RIGHT_LAYOUT,apple.widget.Hover.BOTTOM_LAYOUT,apple.widget.Hover.LEFT_LAYOUT]};apple.widget.Hover.POINTER_INDEX=[3,2,0,1];apple.widget.Hover.LAYOUT_NAMES={top:apple.widget.Hover.TOP_LAYOUT,bottom:apple.widget.Hover.BOTTOM_LAYOUT,left:apple.widget.Hover.LEFT_LAYOUT,right:apple.widget.Hover.RIGHT_LAYOUT};apple.widget.Hover.prototype._wrapContent=function(){var a=$(this.config.contentId);if(!a){return null}var f=a.parentNode;a.parentNode.removeChild(a);a.id="";a.className="";var c=Element.uniqueId();var g=document.createElement("div");g.id=this.config.contentId;g.sourceId=this.config.sourceId;g.className=[a.className,"popup-wdgt"].join(" ");g.innerHTML=['<div class="wdgt-top"><div></div>','<span class="triangle"></span>',"</div>",'<div class="wdgt-mdl">','<div class="wdgt-right">','<span class="triangle"></span>',"</div>",'<div class="wdgt-left">','<a class="close-link" href="#">',this.config.closeLink,"</a>",'<div id="',c,'"></div>','<span class="triangle"></span>',"</div>","</div>",'<div class="wdgt-btm">',"<div></div>",'<span class="triangle"></span>',"</div>"].join("");document.body.appendChild(g);var b=$(c);b.parentNode.replaceChild(a,b);return g};apple.widget.Hover.prototype.show=function(c){var a=$(this.config.contentId);if(!a){return}switch(this._state){case STATES.shown:return;case STATES.showing:coherent.Animator.setStyles(a,{opacity:1},{duration:0,cleanup:true});this._state=STATES.shown;return;default:break}a.style.visibility="hidden";a.style.display="block";this.position();this.manager.beforeShowHover(this);this.setContentZIndex(apple.widget.Hover.DEFAULT_SHOW_Z_INDEX);function b(){this._state=STATES.shown}if(!c){a.style.display="block";b.call(this);return}this._state=STATES.showing;Element.setOpacity(a,0);a.style.visibility="visible";coherent.Animator.setStyles(a,{opacity:1},{duration:this.config.fadeInDuration,callback:b.bind(this),cleanup:true})};apple.widget.Hover.prototype.hide=function(c){var b=$(this.config.contentId);if(!b){return}switch(this._state){case STATES.hidden:return;case STATES.hiding:coherent.Animator.setStyles(b,{opacity:0},{duration:0,callback:a.bind(this),cleanup:true});this._state=STATES.hidden;return;default:break}this.manager.beforeHideHover(this);this.setContentZIndex(apple.widget.Hover.DEFAULT_HIDE_Z_INDEX);function a(){b.style.display="none";this._state=STATES.hidden}if(!c){a.call(this);return}this._state=STATES.hiding;coherent.Animator.setStyles(b,{opacity:0},{duration:this.config.fadeOutDuration,callback:a.bind(this),cleanup:true})};apple.widget.Hover.prototype.toggle=function(){switch(this._state){case STATES.hidden:case STATES.hiding:this.show();return;case STATES.shown:case STATES.showing:this.hide();return;default:return}};apple.widget.Hover.prototype.close=function(a){this.manager.hideHover(this.config.sourceId,true);Event.stop(a)};apple.widget.Hover.prototype._getCurrentPointer=function(){var a=$(this.config.contentId);if(!a){return null}var b=Element.getElementsByClassName("triangle",a);if(!b){return null}return b[apple.widget.Hover.POINTER_INDEX[this.currentLayout]]};apple.widget.Hover.prototype._showPointer=function(){var a=this._getCurrentPointer();if(!a){return}a.style.display="block"};apple.widget.Hover.prototype._hidePointer=function(){var a=this._getCurrentPointer();if(!a){return}a.style.display="none"};apple.widget.Hover.prototype.setContentZIndex=function(b){var a=$(this.config.contentId);if(!a){return}a.style.zIndex=b};apple.widget.Hover.prototype._createPositionContext=function(){var a={contentElem:$(this.config.contentId),sourceElem:$(this.config.sourceId),sourcePosition:{left:0,top:0},sourceBox:{height:0,width:0},contentBox:{height:0,width:0}};if(!a.contentElem||!a.sourceElem){return null}a.contentElem.style.left="0";a.contentElem.style.top="0";a.pageOffset=Element.getRect(a.contentElem);a.sourcePosition=Element.getRect(a.sourceElem);a.sourceBox=Element.getDimensions(a.sourceElem);a.contentBox=Element.getDimensions(a.contentElem);return a};apple.widget.Hover.prototype._computeContentPosition=function(d,c){var a={left:0,top:0,pointerStyle:"",pointerOffset:0};c=c||this._createPositionContext();if(!c){return a}var b=this.pointerInfo[apple.widget.Hover.POINTER_INDEX[d]];switch(d){case apple.widget.Hover.TOP_LAYOUT:a.top=c.sourcePosition.top-c.contentBox.height-this.config.sourcePadding[d];a.left=c.sourcePosition.left-this.config.contentOffset[d];break;case apple.widget.Hover.BOTTOM_LAYOUT:a.top=c.sourcePosition.top+c.sourceBox.height+this.config.sourcePadding[d];a.left=c.sourcePosition.left-this.config.contentOffset[d];break;case apple.widget.Hover.LEFT_LAYOUT:a.left=c.sourcePosition.left-c.contentBox.width-this.config.sourcePadding[d]-b.width;a.top=c.sourcePosition.top-this.config.contentOffset[d];break;case apple.widget.Hover.RIGHT_LAYOUT:a.left=c.sourcePosition.left+c.sourceBox.width+this.config.sourcePadding[d]-b.left;a.top=c.sourcePosition.top-this.config.contentOffset[d];break;default:break}return a};apple.widget.Hover.prototype._findBestLayout=function(d){d=d||this._createPositionContext();if(!d){return null}var a=d.contentBox.width*d.contentBox.height;var b=Element.getViewport();b.bottom=b.top+b.height;b.right=b.left+b.width;var c=null;function h(q){var k=this._computeContentPosition(q,d);var u=Math.max(b.top,k.top);var n=Math.min(b.bottom,k.top+d.contentBox.height);var t=Math.max(b.left,k.left);var o=Math.min(b.right,k.left+d.contentBox.width);var m=(n-u)*(o-t);var r={layout:q,position:k,overlap:m,fits:(m>=a)};if(!c&&r.fits){c=r}return r}var f=this.config.allowedLayouts.map(h,this);if(1==f.length){return f[0]}if(c){return c}function g(k){if(!c||k.overlap>c.overlap){c=k}}f.forEach(g);return c};apple.widget.Hover.prototype.position=function(){var c=this._createPositionContext();if(!c){return}var a=Element.getElementsByClassName("triangle",c.contentElem);Array.forEach(a,function(g){g.style.display="none"});var d=this._findBestLayout(c);if(!d){return}this.currentLayout=d.layout;c.contentElem.style.position="absolute";c.contentElem.style.top=(d.position.top)+"px";c.contentElem.style.left=(d.position.left)+"px";var f=this._getCurrentPointer();if(!f){return}var b=this.pointerInfo[apple.widget.Hover.POINTER_INDEX[d.layout]];switch(d.layout){case apple.widget.Hover.TOP_LAYOUT:case apple.widget.Hover.BOTTOM_LAYOUT:f.style.left=(this.config.pointerOffset[d.layout]+this.config.contentOffset[d.layout]-b.width/2)+"px";break;case apple.widget.Hover.LEFT_LAYOUT:case apple.widget.Hover.RIGHT_LAYOUT:f.style.top=(this.config.pointerOffset[d.layout]+this.config.contentOffset[d.layout]-b.top-b.height/2)+"px";break;default:break}f.style.display="block"};Package("apple.widget");apple.widget.ImageButton=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.ImageButton,apple.widget.BaseWidget);apple.widget.ImageButton.DEFAULTS={disabledClass:"disabled",activeClass:"active"};apple.widget.ImageButton.prototype.init=function(){var a=this.widget();a._disabledClass=this.config.disabledClass;this._mousedownHandler=this.mousedown.bindAsEventListener(this);this._mouseupHandler=this.mouseup.bindAsEventListener(this);this._mouseoutHandler=this.mouseout.bindAsEventListener(this);this._mouseoverHandler=this.mouseover.bindAsEventListener(this);a.innerHTML="";Event.observe(a,"mousedown",this._mousedownHandler);apple.widget.ImageButton._checkIds.push(a.id);apple.widget.ImageButton.installDisabledChecker()};apple.widget.ImageButton.prototype.disable=function(){var a=this.widget();a.disabled=true;if(a.disabled){Element.addClassName(a,this.config.disabledClass)}else{Element.removeClassName(a,this.config.disabledClass)}};apple.widget.ImageButton.prototype.enable=function(){var a=this.widget();a.disabled=false};apple.widget.ImageButton._checkIds=[];apple.widget.ImageButton.removeDisabledChecker=function(){if(!apple.widget.ImageButton._disabledCheckerTimer){return}window.clearInterval(apple.widget.ImageButton._disabledCheckerTimer);apple.widget.ImageButton._disabledCheckerTimer=0};apple.widget.ImageButton.installDisabledChecker=function(){if(apple.widget.ImageButton._disabledCheckerTimer){return}Event.onUnload(apple.widget.ImageButton.removeDisabledChecker);apple.widget.ImageButton._disabledCheckerTimer=window.setInterval(apple.widget.ImageButton.disabledChecker,500)};apple.widget.ImageButton.disabledChecker=function(){function a(c){var b=$(c);if(!b){return}if(b.disabled){Element.addClassName(b,b._disabledClass)}else{Element.removeClassName(b,b._disabledClass)}}apple.widget.ImageButton._checkIds.forEach(a)};apple.widget.ImageButton.prototype.mousedown=function(a){var b=this.widget();Element.addClassName(b,this.config.activeClass);Event.observe(b,"mouseout",this._mouseoutHandler);Event.observe(b,"mouseover",this._mouseoverHandler);Event.observe(document,"mouseup",this._mouseupHandler);this._active=true};apple.widget.ImageButton.prototype.mouseup=function(a){var b=this.widget();Element.removeClassName(b,this.config.activeClass);Event.stopObserving(b,"mouseout",this._mouseoutHandler);Event.stopObserving(b,"mouseover",this._mouseoverHandler);Event.stopObserving(document,"mouseup",this._mouseupHandler);this._active=false};apple.widget.ImageButton.prototype.mouseover=function(a){if(!this._active){Element.addClassName(this.widget(),this.config.activeClass)}this._active=true};apple.widget.ImageButton.prototype.mouseout=function(a){if(this._active){Element.removeClassName(this.widget(),this.config.activeClass)}this._active=false};Package("apple.widget");apple.widget.ImageButtonLinks=function(a){this.config=a;Event.onDomReady(this.init.bind(this))};apple.widget.ImageButtonLinks.prototype.init=function(){if(this._initialized){return}this._initialized=true;if(this.config.buttonIds&&this.config.imageIds&&this.config.buttonIds.length==this.config.imageIds.length){for(var c=0;c<this.config.buttonIds.length&&c<this.config.imageIds.length;c++){var b=$(this.config.buttonIds[c]);var f=$(this.config.imageIds[c]);if(b&&f){var a=(function(){this.style.backgroundPosition="bottom left"}).bind(b);var d=(function(){this.style.backgroundPosition="top left"}).bind(b);Event.observe(b,"onmouseover",a);Event.observe(b,"onmouseout",d);Event.observe(f,"onmouseover",a);Event.observe(f,"onmouseout",d)}}}};Package("apple.widget");apple.widget.LinkManager=function(a){this.setConfig(a);if(coherent.Browser.IE){Event.observe(window,"load",this.init.bind(this))}Event.onDomReady(this.init.bind(this))};apple.widget.LinkManager.prototype.constructor=apple.widget.LinkManager;apple.widget.LinkManager.DEFAULTS={markerClass:"superlink",hoverClass:"superlink-hover",activeClass:"superlink-active",ignoreClass:"superlink-ignore",disclosureClass:"more",disclosureOpenClass:"open",disclosureRegex:/(?:^|\s)disclosure\(([^)]*)\)(?:$|\s)/,popupWidthRegex:(/w(\d+)(-|$)/i),popupHeightRegex:(/h(\d+)(-|$)/i),popupPrefix:"popup-",engravingGalleryRel:"engravingGallery",socialSharingRel:"social-sharing",learnMore3GUSRel:"dataPlan3G",learnMore3GRel:"dataPlan",relatedLinkDataAttribute:"data-relatedlink",relatedClassName:"relatedlink"};apple.widget.LinkManager.prototype.init=function(){window.setTimeout(this.rescanDocument.bind(this),10);Event.observe(document.body,"DOMNodeInserted",this.documentChanged.bindAsEventListener(this));if(coherent.Browser.IE){Event.observe(window,"resize",this.documentChanged.bindAsEventListener(this))}};apple.widget.LinkManager.prototype.setConfig=function(b){b=b||{};for(var a=this.constructor;a&&Object!==a;a=a.superclass){Object.applyDefaults(b,a.DEFAULTS||{})}this.config=b};apple.widget.LinkManager.prototype.rescanDocument=function(){this.manageLinks(document)};apple.widget.LinkManager.prototype.documentChanged=function(a){if(this._rescanTimer){window.clearTimeout(this._rescanTimer)}this._rescanTimer=window.setTimeout(this.rescanDocument.bind(this),250)};apple.widget.LinkManager.prototype.getPopupAttributes=function(g){var f={location:(g.indexOf("l")!=-1?"yes":"no"),menubar:(g.indexOf("m")!=-1?"yes":"no"),toolbar:(g.indexOf("t")!=-1?"yes":"no"),status:(g.indexOf("s")!=-1?"yes":"no"),scrollbars:(g.indexOf("!b")!=-1?"no":"yes"),resizable:(g.indexOf("!r")!=-1?"no":"yes")};var c=this.config.popupWidthRegex.exec(g);var h=this.config.popupHeightRegex.exec(g);if(c&&c[1]){f.width=c[1]}if(h&&h[1]){f.height=h[1]}var d=[];for(var b in f){d.push(b+"="+f[b])}return d.join(",")};apple.widget.LinkManager.prototype.relatedLinkRequest=function(d,g){var c=d.getAttribute(this.config.relatedLinkDataAttribute),f=Element.query("a["+this.config.relatedLinkDataAttribute+'="'+c+'"]');if(!f){return}try{this._sendingClick=true;var a=Event.sendMouseEvent(f,"click",true,true);if(!a){return}if(!coherent.Browser.Safari){var b=window.open(f.href,f.target||"_self",g||"");b.focus()}Event.stop(event)}finally{this._sendingClick=false}};apple.widget.LinkManager.prototype.observeRelatedLinks=function(c,f,b){var d=Element.queryAll("["+this.config.relatedLinkDataAttribute+'="'+f+'"]'),a=this;Array.forEach(d,function(g){if(g.nodeName.toUpperCase()==="A"){return}Event.observe(g,"click",function(){a.relatedLinkRequest.call(a,c,b)});Element.addClassName(g,this.config.relatedClassName)},this)};apple.widget.LinkManager.prototype.manageLinks=function(t){var a=document.getElementsByTagName("a");if(!a.length){return}var b=this.config.disclosureClass;var r=this.config.disclosureRegex;var c=this.config.disclosureOpenClass;var k=this.config.markerClass;var m=this.config.popupPrefix;var o=this.config.engravingGalleryRel;var h=this.config.socialSharingRel;var y=this.config.learnMore3GUSRel;var n=this.config.learnMore3GRel;var f=document.body;var v=this.mouseOverLink.bindAsEventListener(this);var d=this.mouseOutLink.bindAsEventListener(this);var w=this.mouseDownLink.bindAsEventListener(this);var g=this.parentClicked.bindAsEventListener(this);this.mouseUp=this.mouseUp.bindAsEventListener(this);var u=this.dragStarted.bindAsEventListener(this);function x(A){var z=A.parentNode;if(z==f){return null}while(z&&f!=z){if(Element.hasClassName(z,k)){return z}z=z.parentNode}return A.parentNode}function q(G){var C;var I;var A;if(G._managed){return}G._managed=true;if(G.target&&m==G.target.slice(0,m.length)){C=this.getPopupAttributes(G.target);G.target=G.target.replace(/[^\w]/g,"");I=this.popupLinkClicked.bindAsEventListener(this,C);Event.observe(G,"click",I)}if(Element.hasClassName(G,b)&&!!(A=r.exec(G.rel))){var E=$(A[1]);var F=document.createElement("div");var z=Element.assignId(F);var B=Element.hasClassName(G,c);E.parentNode.replaceChild(F,E);F.appendChild(E);I=this.disclosureLinkClicked.bindAsEventListener(this,z,E);Event.observe(G,"click",I);if(!B){Element.makeClipping(F);F.style.height="0";E.style.height="auto"}}if(G.rel==o){Event.observe(G,"click",this.engravingGalleryLinkClicked)}if(G.rel==h){Event.observe(G,"click",this.socialSharingLinkClicked)}if(G.rel==y||G.rel==n){Event.observe(G,"click",this.learnMore3GLinkClicked)}var D=G.getAttribute(this.config.relatedLinkDataAttribute);if(D){this.observeRelatedLinks(G,D,C)}if(!Element.hasClassName(G,k)){return}var H=x(G);if(!H){return}Element.assignId(H);Element.addClassName(H,k);H._linkId=Element.assignId(G);Event.observe(H,"mouseover",v);Event.observe(H,"mouseout",d);Event.observe(H,"mousedown",w);if(C){I=this.parentClicked.bindAsEventListener(this,C);Event.observe(H,"click",I)}else{Event.observe(H,"click",g)}if(coherent.Browser.IE){Event.observe(H,"dragstart",u);Event.observe(H,"selectstart",u)}}Array.forEach(a,q,this)};apple.widget.LinkManager.prototype.findAnchor=function(b){var a=document.body;while(b&&a!=b){if("_linkId" in b){return null}if("a"==b.tagName.toLowerCase()){return b}b=b.parentNode}return null};apple.widget.LinkManager.prototype.findLink=function(b){var a=document.body;while(b&&a!=b){if(b.className.indexOf(this.config.ignoreClass)>-1){return null}if("_linkId" in b){return b}b=b.parentNode}return null};apple.widget.LinkManager.prototype.mouseOverLink=function(a){var b=this.findLink(a.target||a.srcElement);if(!b){return}if(this._activeLinkId&&this._activeLinkId!=b.id){return}if(this._activeLinkId==b.id){Element.addClassName(b,this.config.activeClass)}else{Element.addClassName(b,this.config.hoverClass)}};apple.widget.LinkManager.prototype.mouseOutLink=function(a){var b=this.findLink(a.target||a.srcElement);if(!b){return}if(this._activeLinkId&&this._activeLinkId!=b.id){return}if(this._activeLinkId==b.id){Element.removeClassName(b,this.config.activeClass);Element.addClassName(b,this.config.hoverClass)}else{Element.removeClassName(b,this.config.hoverClass)}};apple.widget.LinkManager.prototype.mouseDownLink=function(a){if(a.which==Event.LEFT_MOUSE&&!Event.isModifiedKey(a)){var b=this.findLink(a.target||a.srcElement);if(!b){return}Event.observe(document,"mouseup",this.mouseUp);this._activeLinkId=b.id;Element.addClassName(b,this.config.activeClass);Element.removeClassName(b,this.config.hoverClass);Event.stop(a)}};apple.widget.LinkManager.prototype.mouseUp=function(a){Event.stopObserving(document,"mouseup",this.mouseUp);var c=$(this._activeLinkId);var b=this.findLink(a.target||a.srcElement);this._activeLinkId=undefined;if(c){Element.removeClassName(c,this.config.activeClass);Element.removeClassName(c,this.config.hoverClass)}this.mouseOverLink(a)};apple.widget.LinkManager.prototype.popupLinkClicked=function(d,c){if(this._sendingClick){return}var b=this.findAnchor(d.target||d.srcElement);var a=window.open(b.href,b.target||"_blank",c||"");a.focus();Event.preventDefault(d)};apple.widget.LinkManager.prototype.parentClicked=function(g,f){if(!Event.isModifiedKey(g)){if(this._sendingClick){return}var h=g.target||g.srcElement;var d=this.findLink(h);if(!d){return}var c=this.findAnchor(h);if(c&&c.id!=d._linkId){return}c=c||$(d._linkId);if(!c){return}Event.stop(g);try{this._sendingClick=true;var a=Event.sendMouseEvent(c,"click",true,true);if(!a){return}if(!coherent.Browser.Safari){var b=window.open(c.href,c.target||"_self",f||"");b.focus()}Event.stop(g)}finally{this._sendingClick=false}}};apple.widget.LinkManager.prototype.dragStarted=function(a){Event.stop(a);return false};apple.widget.LinkManager.prototype.disclosureLinkClicked=function(b,m,h){function o(q){q=parseInt(q||0,10);if(isNaN(q)){return 0}return q}var f=o(Element.getStyle(h,"border-left-width"))+o(Element.getStyle(h,"border-right-width"));var n=o(Element.getStyle(h,"border-top-width"))+o(Element.getStyle(h,"border-bottom-width"));var a={width:h.scrollWidth+f,height:h.scrollHeight+n};var k=this.findAnchor(b.target||b.srcElement);var d=Element.hasClassName(k,this.config.disclosureOpenClass);var g=$(m);var c;if(this.disclosureAnimator){this.disclosureAnimator.stop()}this.disclosureAnimator=new apple.fx.Animator();if(d){c=new apple.fx.Resize(apple.fx.easeInOutSine,g,{width:a.width,height:0},a);Element.removeClassName(k,this.config.disclosureOpenClass)}else{this.trackDisclosureClick(g);c=new apple.fx.Resize(apple.fx.easeInOutSine,g,a,{width:a.width,height:0});Element.addClassName(k,this.config.disclosureOpenClass)}this.disclosureAnimator.play(c);Event.stop(b)};apple.widget.LinkManager.prototype.trackDisclosureClick=function(f){var a=f.getElementsByTagName("div");if(!a){return}if(a.count===0){return}var d=a[0].id;var h=window.state;var g=window.s||null;if(!g){return}var c=apple.metrics.Metrics.getProductSubstring(g.products);var b={slot:"",feature:"Learn More",action:"Selected: "+d};if(typeof(h)!="undefined"){b.part=h.summary.part}else{b.part=c}apple.metrics.fireMicroEventNoDuplicates(b)};apple.widget.LinkManager.prototype.engravingGalleryLinkClicked=function(a){var d=window.s||null;if(!d){return}var b=apple.metrics.Metrics.getProductSubstring(d.products);var c={slot:"",feature:"Engraving-Gallery",part:b,action:"Selected"};apple.metrics.fireMicroEventNoDuplicates(c)};apple.widget.LinkManager.prototype.socialSharingLinkClicked=function(b){var a=b.target.className;var f=window.s||null;if(!f){return}var c=apple.metrics.Metrics.getProductSubstring(f.products);var d={slot:"",feature:a,part:c,action:""};apple.metrics.fireMicroEventNoDuplicates(d);apple.metrics.fireEvent({events:"event7"})};apple.widget.LinkManager.prototype.learnMore3GLinkClicked=function(a){var d=window.s||null;if(!d){return}var b=apple.metrics.Metrics.getProductSubstring(d.products);var c={slot:"",feature:"Learn More 3G",part:b,action:"Selected"};apple.metrics.fireMicroEventNoDuplicates(c)};window.gLinkManager=new apple.widget.LinkManager();Package("apple.widget");apple.widget.Movie=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.Movie,apple.widget.BaseWidget);apple.widget.Movie.DEFAULTS={autoplay:true,loop:false,wrapperClass:"movieWrapper"};apple.widget.Movie.prototype.init=function(){if(!apple.quicktime.isInstalled()){return}var a;var g=this.widget();var d;if(!g){return}switch(g.tagName.toLowerCase()){case"a":this.config.src=g.href;a=g.parentNode;d=g.getElementsByTagName("img")[0];d=g.removeChild(d);a.replaceChild(d,g);break;case"img":d=g;a=d.parentNode;break;default:console.log("Movie cannot initialise from "+g.tagName+"#"+this.config.id);return}this._posterId=this.config.id+"_poster";this._movieId=this.config.id+"_movie";this.config=Object.applyDefaults(this.config,{width:d.width,height:d.height});var c=document.createElement("div");c.style.visibility="hidden";c.style.position="relative";c.className=this.config.wrapperClass;c.id=g.id;d=a.replaceChild(c,d);d.id=this._posterId;c.appendChild(d);var f={autoplay:false,id:this._movieId};f=Object.applyDefaults(f,this.config);apple.quicktime.createMovie(f,c);var b={movieId:this._movieId,onload:this.movieLoaded.bind(this)};this.controller=new apple.widget.MovieController(this.config.controllerId,b);this.controller.hideMovie();c.style.visibility="visible"};apple.widget.Movie.prototype.movieLoaded=function(d){var g=document.getElementById(this._posterId);var h=this.config.width;var a=this.config.height;var k=this.config.autoplay;var c=this.controller;c.hideMovie();var f=this;function b(){g.style.display="none";c.showMovie(h,a);if(k){d.Play()}}coherent.Animator.setStyles(g,{opacity:0},{duration:500,callback:b,cleanup:true})};Package("apple.widget");apple.widget.MovieController=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.MovieController,apple.widget.BaseWidget);apple.widget.MovieController.DEFAULTS={create:false,disabledClass:"disabled",activeClass:"active",loadingClass:"loading",errorClass:"error",playingClass:"playing",pausedClass:"paused",onload:function(){},monitorInterval:500,playButtonSpec:"button"};apple.widget.MovieController.prototype.init=function(){this._duration=0;this._loading=true;this.monitorProgress();var a=this.widget();if(!a){return}a.style.display="none";Element.addClassName(a,this.config.pausedClass);Element.removeClassName(a,this.config.playingClass);var d=this.part(this.config.playButtonSpec);new apple.widget.ImageButton(d);Event.observe(d,"click",this.playButtonClicked.bind(this));var c=a.getElementsByTagName("div")[0];this._meterId=Element.assignId(c);this._meterWidth=c.offsetWidth;Event.observe(c,"mousedown",this.meterMouseDown.bind(this));var b=c.getElementsByTagName("span")[0];this._barId=Element.assignId(b)};apple.widget.MovieController.prototype._getMovie=function(){return $(this.config.movieId)};apple.widget.MovieController.prototype._updateMeter=function(b){var a=this.widget();if(!a||this._vr){return}b=b||this._getMovie();if(!b){return}try{var c=b.GetRate()}catch(h){return}if(c&&!this._playing){this._playing=true;Element.addClassName(a,this.config.playingClass);Element.removeClassName(a,this.config.pausedClass)}else{if(!c&&this._playing){this._playing=false;Element.addClassName(a,this.config.pausedClass);Element.removeClassName(a,this.config.playingClass)}}if(!this._duration){this._duration=b.GetDuration()}if(!this._duration){return}var f=$(this._meterId);this._meterWidth=f.offsetWidth-4;var d=$(this._barId);if(!d||this._meterWidth<0){return}var g=(b.GetTime()*this._meterWidth/this._duration);if(this._lastLeft==g){return}this._lastLeft=g;d.style.left=g+"px";d.style.width=(this._meterWidth-g+2)+"px"};apple.widget.MovieController.prototype.monitorProgress=function(){if(apple.quicktime.mobileSafari){return}var b=this.widget();function c(){var d=this._getMovie();if(!d){return}this._duration=d.GetDuration();this.config.onload(d);this._vr=d.GetIsVRMovie();if(!b){return}if(this._vr){coherent.Animator.setStyles(b,{opacity:0},{duration:250,callback:function(){b.style.display="none"},cleanup:true})}else{Element.setOpacity(b,0);b.style.display="";coherent.Animator.setStyles(b,{opacity:1},{duration:250,cleanup:true})}}function a(){var f=this._getMovie();if(!f){return}try{var d=(f.GetPluginStatus()||"").split(":")[0].toLowerCase();this._updateMeter(f);switch(d){case"playable":case"complete":if(!this._loading){break}this._loading=false;if(b){Element.removeClassName(b,this.config.loadingClass)}window.setTimeout(c.bind(this),10);break;case"error":if(b){Element.removeClassName(b,this.config.loadingClass);Element.addClassName(b,this.config.errorClass)}break;default:break}}catch(g){}}this._monitor=window.setInterval(a.bind(this),this.config.monitorInterval)};apple.widget.MovieController.prototype.playButtonClicked=function(b){this.part(this.config.playButtonSpec).blur();var a=this._getMovie();if(!a){return}if(a.GetRate()){a.Stop()}else{a.Play()}};apple.widget.MovieController.prototype._updateTimeoutExpired=function(a){this._updateTimeFromPosition(this._lastPos)};apple.widget.MovieController.prototype._updateTimeFromPosition=function(d){var a=this._getMovie();if(!a){return}d-=this._baseX;if(d<0){d=0}else{if(d>this._meterWidth){d=this._meterWidth}}var c=$(this._barId);if(c){c.style.left=d+"px";c.style.width=(this._meterWidth-d+2)+"px"}var b=a.GetDuration()*d/this._meterWidth;a.SetTime(b);this._moveTimeout=0};apple.widget.MovieController.prototype.meterMouseUp=function(b){Event.stopObserving(document,"mouseup",this._mouseUpHandler);Event.stopObserving(document,"mousemove",this._mouseMoveHandler);this._updateTimeFromPosition((b||window.event).clientX);var a=this._getMovie();if(!a){return}if(this._previousRate){a.Play()}};apple.widget.MovieController.prototype.meterMouseMoved=function(a){this._lastPos=(a||window.event).clientX;this._moveTimeout=this._moveTimeout||window.setTimeout(this._updateHandler,10)};apple.widget.MovieController.prototype.meterMouseDown=function(b){b=b||window.event;var a=this._getMovie();var c=$(this._meterId);if(!a){return}this._previousRate=a.GetRate();a.Stop();this._baseX=Element.getRect(c,true).left-document.body.scrollLeft-document.documentElement.scrollLeft;this._updateHandler=this._updateTimeoutExpired.bind(this);this._mouseMoveHandler=this.meterMouseMoved.bind(this);this._mouseUpHandler=this.meterMouseUp.bind(this);Event.observe(document,"mousemove",this._mouseMoveHandler);Event.observe(document,"mouseup",this._mouseUpHandler);Event.stop(b);this._updateTimeFromPosition(b.clientX)};apple.widget.MovieController.prototype.hideMovie=function(){var b=this._getMovie();if(!b){return}b.width=1;b.height=1;b.style.width="1px";b.style.height="1px";var a=this.widget();if(!a){return}a.style.display="none"};apple.widget.MovieController.prototype.showMovie=function(c,d){var b=this._getMovie();if(!b){return}b.width=c;b.height=d;b.style.width=c+"px";b.style.height=d+"px";var a=this.widget();if(!a){return}a.style.display=""};apple.widget.MovieController.prototype.stop=function(){var a=this._getMovie();if(!a){return}a.Stop()};apple.widget.MovieController.prototype.play=function(){var a=this._getMovie();if(!a){return}a.Play()};apple.widget.MovieController.prototype.loadMovie=function(d){var b=this._getMovie();if(!b){return}var a=this.widget();if(a){Element.addClassName(a,this.config.loadingClass)}this._loading=true;try{b.Stop();b.SetURL(d);b.SetAutoPlay(false);b.SetControllerVisible(false)}catch(c){console.log("SetURL: "+c.message)}};Package("apple.widget");apple.widget.ProductCluster=function(a){this.config=a;this.resetPages();function b(){window.clearInterval(this._firefoxTimer)}function c(){Event.onUnload(b.bind(this));this._firefoxTimer=window.setInterval(this.checkScroll.bind(this),2000)}if(coherent.Browser.Mozilla){Event.onDomReady(c.bind(this))}Event.observe(window,"scroll",this.checkScroll.bind(this));Event.observe(window,"load",this.checkScroll.bind(this))};apple.widget.ProductCluster.prototype.encodeURL=function(d,a){if(!a){a=this.config.baseURL}for(var b in d){var c=d[b];if(c&&c.length){if(a.indexOf("?")>0){a+="&"+b+"="+c}else{a+="?"+b+"="+c}}}return a};apple.widget.ProductCluster.prototype.gotoPage=function(g,f,d,c){var b=this.encodeURL({p:g,f:f,s:d,n:c});var a=this;apple.io.json.invoke({url:b,success:function(h){a.switchContent(a.config.contentId,h)}});return false};apple.widget.ProductCluster.prototype.sort=function(f,d,c){var b=this.encodeURL({f:f,s:d,n:c});var g=$("product-loading-sort");if(g){g.style.display="inline"}var a=this;apple.io.json.invoke({url:b,success:function(h){a.config.sort=d;a.switchContent(a.config.contentId,h);if(g){g.style.display="none"}}});return false};apple.widget.ProductCluster.prototype.gotoNode=function(d,c){var b=this.encodeURL({n:d,s:c});var f=$("product-loading-filter");if(f){f.style.display="inline"}var a=this;apple.io.json.invoke({url:b,success:function(g){a.config.childNode=d;a.config.sort=c;a.switchContent(a.config.contentId,g);if(f){f.style.display="none"}}});return false};apple.widget.ProductCluster.prototype.gotoFilter=function(f,d,c){var b=this.encodeURL({f:f,s:c,n:d});var a=this;apple.io.json.invoke({url:b,success:function(g){a.config.filter=f;a.config.sort=c;a.config.childNode=d;a.switchContent(a.config.contentId,g)}});return false};apple.widget.ProductCluster.prototype.resetPages=function(){this.checkingScroll=false;this.pagePositions=new Array();this.loadedPages=new Array()};apple.widget.ProductCluster.prototype.loadPage=function(c){if(this.loadedPages[c]){return}this.loadedPages[c]=1;var b=this.encodeURL({p:""+c,f:this.config.filter,s:this.config.sort,n:this.config.childNode},this.config.pageURL);var a=this;apple.io.json.invoke({url:b,success:function(g){var d=a.config.pageIdPrefix+c+a.config.pageIdSuffix;var f=a.config.pageIdPrefix+c;a.switchContent(d,g);c=$(f);var k=$(d);var h=function(){if(Element.getMarginBox(c).height<Element.getMarginBox(k).height){var m=Element.getMarginBox(k);m.height++;Element.setMarginBox(c,m)}};Element.setOpacity(k,0);k.style.display="";coherent.Animator.setStyles(k,{opacity:1},{duration:600,cleanup:true,callback:h})}})};apple.widget.ProductCluster.prototype.checkScroll=function(){if(this.checkingScroll){return}this.checkingScroll=true;var b=Element.getViewport().top;var f=b+Element.getViewport().height;var d=f+this.config.scrollBuffer;var c=b-this.config.scrollBuffer;for(var g=this.config.pages-1;g>=1;g--){var a=this.config.pageIdPrefix+g;if(!this.pagePositions[g]){var k=$(a);if(k){this.pagePositions[g]=Element.getRect(k).top}}var h=Element.getMarginBox($(a));if(c<=this.pagePositions[g]+h.height&&d>=this.pagePositions[g]){this.loadPage(g)}}this.checkingScroll=false};apple.widget.ProductCluster.prototype.setupEmptyPages=function(w,f,g,d,k,n){this.config.pages=f;this.resetPages();var m="";if(this.config.loadingIconUrl){m='<img class="product-loading-tile" src="'+this.config.loadingIconUrl+'">'}var t="";for(var b=1;b<this.config.pages;b++){t+='<div class="product-page" id="'+this.config.pageIdPrefix+b+'">\n';t+='<div class="product-page-grid hidden" id="'+this.config.pageIdPrefix+b+this.config.pageIdSuffix+'"></div>\n';var o=d;if(b==this.config.pages-1){o=k}var q;for(var a=0;a<o;a++){q=(((b-1)*d+a) in n);if(a==o-1&&b==this.config.pages-1){t+='<ul class="product-row last-row'}else{t+='<ul class="product-row'}t+=q?' has-specials">':'">';t+='<li class="product first-tile">'+m+"</li>";for(var u=1;u<g-1;u++){t+='<li class="product">'+m+"</li>"}t+='<li class="product last-tile">'+m+"</li>";t+="</ul>\n"}t+="</div>\n"}var v=$(w);v.innerHTML=t;if(coherent.Browser.MobileSafari){for(var h=1;h<f;h++){this.loadPage(h)}}};apple.widget.ProductCluster.prototype.switchContent=function(a,c){if(c.body.content){var b=$(a);b.innerHTML=c.body.content}};Package("apple.widget");apple.widget.ProductDetailsContentMenu=Class.create(coherent.View,{init:function(){var a=Element.queryAll("#contents ul li a");Array.forEach(a,function(b){var c=b.getAttribute("href");if(Element.query(c)===null){b.parentNode.style.display="none"}})}});Package("apple.widget");apple.widget.ProductFilter=function(b,a){this.base("constructor")(b,a);this._expanded=false;this._filters=[];this._selectionIndex=-1};apple.util.makeSubclass(apple.widget.ProductFilter,apple.widget.BaseWidget);apple.widget.ProductFilter.DEFAULTS={expandedClass:"expanded",controlSpec:"ul.filter-controls",expandLinkSpec:".expand-link",secondaryFilterClass:"secondary",contractLinkSpec:".contract-link",selectedClass:"selected",filterListSpec:"ul.filter-items",animateDuration:50};apple.widget.ProductFilter.prototype.init=function(){var g=this.widget();var f=this.part(this.config.filterListSpec);var b=this.part(this.config.controlSpec);if(!g||!f||!b){return}b.style.display="block";this._expanded=Element.hasClassName(g,this.config.expandedClass);this._animator=new apple.fx.Animator();var a=this.part(this.config.expandLinkSpec);var c=this.part(this.config.contractLinkSpec);if(!a||!c){return}Event.observe(a,"click",this.expandLinkClicked.bindAsEventListener(this));Event.observe(c,"click",this.contractLinkClicked.bindAsEventListener(this));var d=this.filterClicked.bindAsEventListener(this);Event.observe(f,"click",d);function h(m,k){this._filters.push(Element.assignId(m));if(Element.hasClassName(m,this.config.selectedClass)){this._selectionIndex=k}m.filterIndex=k;if(this._expanded||Element.hasClassName(m,this.config.selectedClass)||!Element.hasClassName(m,this.config.secondaryFilterClass)){return}m.style.display="none"}Array.forEach(f.getElementsByTagName("li"),h,this);g.style.display="none";g.style.display="block"};apple.widget.ProductFilter.prototype.expandFilters=function(m){var d=[];var f=this.widget();var h=this.part(this.config.filterListSpec);var b=h.getElementsByTagName("li")[0].offsetWidth;function k(n,q){var t=$(n);if(q==this._selectionIndex||Element.hasClassName(t,this.config.selectedClass)||!Element.hasClassName(t,this.config.secondaryFilterClass)){return}t.style.width=b+"px";t.style.height="auto";var r=Element.getDimensions(t);t.style.width="";var o=new apple.fx.Resize(apple.fx.easeInOutSine,t,r,{width:b,height:0});var u=new apple.fx.Fade(apple.fx.linearTween,t,0,1);d.push(new apple.fx.Blend(o,u))}var a=this.part(this.config.expandLinkSpec);var g=this.part(this.config.contractLinkSpec);a.style.visibility="hidden";g.style.visibility="hidden";this._filters.forEach(k,this);if(!d.length){return}function c(){a.style.visibility="";g.style.visibility="";Element.addClassName(f,this.config.expandedClass);this._expanded=true;if(m){m()}}this._animator.setDuration(d.length*this.config.animateDuration);this._animator.play(new apple.fx.Chain(d),c.bind(this))};apple.widget.ProductFilter.prototype.contractFilters=function(m){var d=[];var f=this.widget();var h=this.part(this.config.filterListSpec);var b=h.getElementsByTagName("li")[0].clientWidth;function k(n,q){var t=$(n);if(q==this._selectionIndex||Element.hasClassName(t,this.config.selectedClass)||!Element.hasClassName(t,this.config.secondaryFilterClass)){return}t.style.width=b+"px";var r=Element.getDimensions(t);t.style.width="";var o=new apple.fx.Resize(apple.fx.easeInOutSine,t,{width:b,height:0},r);var u=new apple.fx.Fade(apple.fx.linearTween,t,1,0);d.push(new apple.fx.Blend(o,u))}var a=this.part(this.config.expandLinkSpec);var g=this.part(this.config.contractLinkSpec);a.style.visibility="hidden";g.style.visibility="hidden";this._filters.forEach(k,this);if(!d.length){return}function c(){a.style.visibility="";g.style.visibility="";Element.removeClassName(f,this.config.expandedClass);this._expanded=false;if(m){m()}}this._animator.setDuration(d.length*this.config.animateDuration);this._animator.play(new apple.fx.Chain(d),c.bind(this))};apple.widget.ProductFilter.prototype.selectFilter=function(a){if(a==this._selectionIndex){return}var b=this._filters[this._selectionIndex];var c=this._filters[a];this._selectionIndex=a;if(b){Element.removeClassName($(b),this.config.selectedClass)}if(c){Element.addClassName($(c),this.config.selectedClass)}};apple.widget.ProductFilter.prototype.expandLinkClicked=function(a){var b=a.target||a.srcElement;b.blur();Event.stop(a);this.expandFilters()};apple.widget.ProductFilter.prototype.contractLinkClicked=function(a){var b=a.target||a.srcElement;b.blur();Event.stop(a);this.contractFilters()};apple.widget.ProductFilter.prototype.findFilterNode=function(a){var b=this.widget();while(a!=b&&!("filterIndex" in a)){a=a.parentNode}if(!("filterIndex" in a)){return null}return a};apple.widget.ProductFilter.prototype.filterClicked=function(a){var c=a.target||a.srcElement;c.blur();Event.stop(a);var b=this.findFilterNode(c);if(!b){return}this.selectFilter(b.filterIndex);if(this._expanded){this.contractFilters(this.filterContent.bind(this))}else{this.filterContent()}};apple.widget.ProductFilter.prototype.filterContent=function(){var b=$(this._filters[this._selectionIndex]);if(!b){return}var a=b.getElementsByTagName("a")[0];if(!a){return}window.open(a.href,"_self")};Package("apple.widget");apple.widget.ProductTrailer=Class.create(coherent.View,{__structure__:{"a.video-trailer":coherent.Anchor({action:"createOverlay"})},trailerInnerHTML:'<div class="trailer-overlay"><div class="video"><a href="">Placeholder</a></div></div>',init:function(){},createOverlay:function(){var a=document.getElementById("trailerOverlay"),b=Element.query("a.video-trailer").href;if(!this.trailerOverlay){this.trailerOverlay=new coherent.Overlay(a)}this.trailerOverlay.display({classname:"overlay",html:this.trailerInnerHTML});this.videoSource=Element.query(".video a");this.videoSource.setAttribute("href",b);this.videoController()},videoController:function(){if(this.videoPlayer){return}console.log(this);var a=Element.query(".trailer-overlay .video");var c=this.videoSource.href;var b={autoplay:"true",width:320,height:240};delete coherent.View.viewLookup["volume-track"];delete coherent.View.viewLookup["control-track"];this.videoPlayer=Media.create(a,c,b);if(this.videoPlayer){if(!coherent.Browser.MobileSafari){this.videoControls=new Media.ControlsWidget(a);this.videoPlayer.setControlPanel(this.videoControls)}var f=function(){d.parentNode.removeChild(d);a.appendChild(this.videoPlayer.video().object());a.appendChild(this.videoControls.element);this.videoControls.play()}.bind(this);var d=document.createElement("div");Element.addClassName(d,"endstate");Event.observe(d,"click",f);this.videoPlayer.setDelegate({didEnd:function(){this.videoControls.pause();this.videoPlayer.setTime(0);this.videoPlayer.reset();a.appendChild(d);a.removeChild(this.videoControls.element);a.removeChild(this.videoPlayer.video().object())}.bind(this)})}},overlayVisibleChange:function(c,a,b){if(!c.newValue){this.videoControls.pause()}}});Package("apple.widget");apple.widget.SchoolFinder=Class.create(coherent.View,{__structure__:{"#loading":coherent.View({visibleBinding:"loading"}),"div#instructions":coherent.View({visibleBinding:"lastQuery(not)"}),"div#no-results":coherent.View({visibleBinding:"noResults"}),"table#schools-table":coherent.ListView({contentBinding:"results.schools",visibleBinding:"schoolCount",selectedObjectBinding:"school"}),"table#schools-table td.name":coherent.View({htmlBinding:"*.name"}),"table#schools-table td.location":coherent.View({htmlBinding:"*.location"}),"table#schools-table td.level":coherent.View({htmlBinding:"*.type"}),"#filter-HiEd":coherent.ToggleButton({selectionBinding:"filterSelection"}),"#filter-K12":coherent.ToggleButton({selectionBinding:"filterSelection"}),"#schoolQuery":coherent.TextField({valueBinding:"query",action:"submitQuery",sendsActionOnEndEditing:false}),"#schoolSearch":coherent.Button({action:"submitQuery",visibleBinding:"loading(not)"}),"#resultCount ":coherent.View({visibleBinding:"schoolCount"}),"#resultCount span":coherent.View({htmlBinding:"schoolCount"}),"div.more-information":coherent.View({visibleBinding:"lastQuery",animated:true}),"#school-submit":coherent.Button({animated:true,visibleBinding:"school",action:"goToSchool"})},keyDependencies:{schoolCount:["results"],noResults:["results","loading","lastQuery"]},init:function(){this.lastType=this.valueForKey("filterSelection");this.addObserverForKeyPath(this,this.resultsChanged,"results");this.addObserverForKeyPath(this,this.submitQuery,"filterSelection");Event.observe($("schoolQuery"),"click",this.textFieldClicked.bind(this));Event.observe(window,"load",function(){$("schoolQuery").focus()});if(coherent.Browser.MobileSafari){var a=Element.query("div.search-results");Element.addClassName(a,"flexible")}},textFieldClicked:function(){if($("schoolQuery").value===""){this.setValueForKey(null,"query");this.setValueForKey(null,"lastQuery");this.setValueForKey(coherent.KVO.adaptTree({schools:[]}),"results")}},schoolCount:function(){if(this._results&&"schools" in this._results){return this._results.schools.length}else{return 0}},noResults:function(){return(this.schoolCount()===0&&this.lastQuery&&!this.loading)},resultsChanged:function(c,a,b){this.setValueForKey(null,"school");apple.behavior.Striper.delay(0,$("schools-table"))},getResults:function(){return this._results},setResults:function(b){if(b.schools){b.schools.forEach(function(c){c.setValueForKey(c.city+", "+c.state+" "+c.zipcode,"location")})}this._results=b;var a=Element.query(this.viewElement(),"div.search-results td");if(a){a.scrollIntoView()}},submitQuery:function(){var c=this.query;var b=this.valueForKey("filterSelection");if(c===this.lastQuery&&b===this.lastType){return}if(c){var f={query:c,type:b},d=this.queryReturned.bind(this),a=this.queryFailed.bind(this);this.setValueForKey(true,"loading");JSONRPC.get(this.queryURL,f).addMethods(d,a);this.lastType=b;this.setValueForKey(c,"lastQuery")}},queryReturned:function(a){var b={query:this.lastQuery+" - "+this.valueForKey("filterSelection"),pageName:window.s?window.s.pageName:null,results:(a&&a.schools)?a.schools.length:0};this.setValueForKey(false,"loading");this.setValueForKey(coherent.KVO.adaptTree(a),"results")},queryFailed:function(){this.setValueForKey(false,"loading");this.setValueForKey(coherent.KVO.adaptTree({schools:[]}),"results")},goToSchool:function(){var a={school:this.school.name,pageName:window.s?window.s.pageName:null,query:this.lastQuery};window.location=this.school.url}});Package("apple");apple.SiteSearch=Class.create(coherent.Form,{defaultOptions:{suggestionsEnabled:false,suggestionsUrl:null,dropDownMenuClassName:"search-auto-complete",selectedClassName:coherent.Browser.MobileSafari?"iosHighlight":"selected",initialKeypressDelay:50,keypressDelay:250,showDelay:200,closeDelay:500,requestTimeOut:5000,text:{searchHeading:"Bsquedas",productHeading:"Productos",categoryHeading:"Categoras"}},dataBinding:[],markupTemplate:"<ul><li></li></ul>",searchFieldset:coherent.View(".autocomplete",{}),searchField:coherent.TextField('input[type="text"]',{valueBinding:"searchValue"}),__structure__:{".search-reset":coherent.View({visibleBinding:"showReset"}),".search-spinner":coherent.View({visibleBinding:"showSpinner"})},dropDownItemMaxWidth:undefined,formSubmissionStarted:false,onsubmit:function(a){Event.stop(a);if(!this.options.suggestionsEnabled){this.fireMetricsAndSubmit()}},init:function(){var a=this,b=Element.queryAll(".search-reset");this.base();this.options=Object.applyDefaults(this.options,this.defaultOptions);this.setupSearchField();if(this.options.suggestionsEnabled){this.enableKeyboardObservers();this.buildDropDownMenu()}this.toggleResetButton();this.requestCounter=0;this.searchFocusFlag=false;this._hiddenParams=this._hiddenParamQueryString();if(b&&b.length>0){b.forEach(function(c){Event.observe(c,"click",a.resetSearchField.bind(a))})}},setupSearchField:function(){this.searchField.viewElement().removeAttribute("placeholder");this.searchField.viewElement().setAttribute("aria-autocomplete","list");this.searchField.viewElement().setAttribute("aria-expanded","false");Event.observe(this.searchField.viewElement(),"focus",this.focus.bind(this));Event.observe(this.searchField.viewElement(),"blur",this.blur.bind(this));var b=Element.query(this.viewElement(),"button[type=submit]");if(b&&this.options.suggestionsEnabled){Event.observe(b,"keypress",this.killReturn.bind(this));var a=this;Event.observe(b,"click",function(c){a.select()});Event.observe(b,"keypress",function(c){if(c.keyCode===Event.KEY_RETURN){a.select()}})}},killReturn:function(a){if(a.keyCode===Event.KEY_RETURN){Event.preventDefault(a)}},enableKeyboardObservers:function(){Event.observe(this.searchField.viewElement(),"keydown",this.keydown.bind(this));if(this.searchFieldset){Event.observe(this.searchFieldset.viewElement(),"keypress",this.keypress.bind(this));Event.observe(this.searchFieldset.viewElement(),"keypress",this.killReturn.bind(this))}Event.observe(this.searchField.viewElement(),"keyup",this.keyup.bind(this));Event.observe(this.searchField.viewElement(),"paste",this.paste.bind(this));Event.observe(this.searchField.viewElement(),"text",this.keyup.bind(this))},buildDropDownMenu:function(){var b=document.createElement("div");this.dropDownMenuId=Element.assignId(b);b.className=this.options.dropDownMenuClassName;Element.setStyle(b,"display","none");b.setAttribute("aria-hidden","true");b.innerHTML=this.markupTemplate;if(this.searchFieldset){this.searchFieldset.viewElement().appendChild(b);this.searchField.viewElement().setAttribute("aria-owns",this.dropDownMenuId)}var a=b.getElementsByTagName("ul")[0];this.resultsListId=Element.assignId(a);a.setAttribute("role","listbox");Event.observe(a,"mousedown",this.selectOnClick.bindAsEventListener(this));Event.observe(a,"mouseover",this.selectMenuItem.bindAsEventListener(this))},focus:function(a){if(this.searchField.viewElement().id!=="find"){Element.addClassName(this.searchFieldset.viewElement(),"focused")}},blur:function(a){this.hide();if(this.searchField.viewElement().id!=="find"){Element.removeClassName(this.searchFieldset.viewElement(),"focused")}},keydown:function(a){switch(a.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:if(this.resultsVisible){switch(a.keyCode){case Event.KEY_UP:this.activatePrev();break;case Event.KEY_DOWN:this.activateNext();break;default:break}Event.stop(a)}break;default:break}},keyup:function(a){switch(a.keyCode){case Event.KEY_ESC:this.hide();Event.stop(a);break;case Event.KEY_RETURN:if(!this.formSubmissionStarted){this.preprocessRequest()}Event.stop(a);break;default:if(!Event.isMetaKey(a)){this.preprocessRequest()}break}this.toggleResetButton()},keypress:function(b){var a=Element.query(this.viewElement(),".search-reset"),c=b.target||b.srcElement;if(b.keyCode===Event.KEY_RETURN){if(c===a){Event.stop(b);this.resetSearchField(b)}else{this.select()}}},paste:function(d){var c=this;function b(){c.preprocessRequest()}b.delay(10)},toggleResetButton:function(){if(this.searchField.viewElement().value.length>0){this.setValueForKey(true,"showReset")}else{this.setValueForKey(false,"showReset")}},resetSearchField:function(c){var b=this.viewElement(),a=c.target||c.srcElement;if(b.contains(a)){this.setValueForKey("","searchValue");this.toggleResetButton();this.searchField.viewElement().focus();this.hide()}},preprocessRequest:function(){var a;(this.requestCounter<3)?a=this.options.initialKeypressDelay:a=this.options.keypressDelay;this.setValueForKey(this.searchField.viewElement().value.replace(/^\s+$/,""),"searchValue");if(this.searchValue.length<1){this.processNoResults()}else{if(this.keyupTimeout){window.clearTimeout(this.keyupTimeout);this.keyupTimeout=null}this.keyupTimeout=this.requestSuggestionsFor.bindAndDelay(this,a,this.searchValue)}},requestSuggestionsFor:function(g){var f,d,a,c;this.cancelOutstanding();if(!window.navigator.onLine){return}this.requestCounter=this.requestCounter+1;this.setValueForKey(true,"showSpinner");c={find:g};var b={params:c,enableCache:true,callbackParamName:"method",protocol:"JSONP"};this.jsonpresponse=JSONRPC.get(this.options.suggestionsUrl,c,b);this.jsonpresponse.addCallback(this.processJSONPResponse.bind(this));this.__waitingTimer=this.cancelOutstanding.bindAndDelay(this,this.options.requestTimeOut)},processJSONPResponse:function(){this.resetSelection();if(this.__waitingTimer){window.clearTimeout(this.__waitingTimer)}if(this.searchValue.length>0&&this.jsonpresponse&&this.jsonpresponse._result){var a=this.jsonpresponse._result;this.query=a.query.toLowerCase();if(a&&a.results&&((a.results.category&&a.results.category.length)||(a.results.product&&a.results.product.length)||(a.results.search&&a.results.search.length))){this.changeData(a.results)}else{this.processNoResults()}}else{this.processNoResults()}},cancelOutstanding:function(){try{if(this.jsonpresponse){this.jsonpresponse.cancel()}}catch(a){}if(this.__waitingTimer){window.clearTimeout(this.__waitingTimer)}this.processNoResults()},addSectionList:function(k,h){var c={},a=-1,m=this.dropDownMenuId+"_"+k,g='<li class="section" id="'+m+'"><p>'+this.options.text[k+"Heading"]+"</p></li>";this.dataBinding.push({});for(var f=0,b=h.length;f<b;f++){var d=Object.applyDefaults(h[f],{section:k,rank:f+1,resultCount:b});this.dataBinding.push(d);c.display=c.original=this.sanitizeHtml(h[f].term);c.title=c.original.replace(/\"/g,"&quot;");if(k==="search"){g+='<li role="option"><span title="'+c.title+'">'+c.display+"</span></li>"}else{g+='<li role="option"><span title="'+c.title+'"><a>'+c.display+"</a></span></li>"}}return g},changeData:function(c){var b=$(this.resultsListId);var d=b.innerHTML="";this.LastSuggestions=c;this.dataBinding=[];if(c.search&&c.search.length>0){d+=this.addSectionList("search",c.search)}if(c.product&&c.product.length>0){d+=this.addSectionList("product",c.product)}if(c.category&&c.category.length>0){d+=this.addSectionList("category",c.category)}if(d){b.innerHTML=d;this.changeSelectedIndex(null);var a=$(this.dropDownMenuId);Element.setStyle(a,"display","");a.setAttribute("aria-hidden","false");this.searchField.viewElement().setAttribute("aria-expanded","true");this.resultsVisible=true;this.truncateAndHighlight(b);this.setValueForKey(false,"showSpinner")}},sanitizeHtml:function(b){var a=document.createElement("textarea");a.innerHTML=b;return a.value},truncateAndHighlight:function(d){var m,v,a,y,k=this.dropDownItemMaxWidth,g,h,w,b,f,c;var u=document.documentElement.style,t=("textOverflow" in u||"OTextOverflow" in u);for(var r=0,o=d.childNodes.length;r<o;r++){if(d.childNodes[r].className!=="section"){m=d.childNodes[r];m.setAttribute("menuIndex",r);m.setAttribute("aria-selected","false");this.resultslistElementId=Element.assignId(m);v=m.getElementsByTagName("span");if(v&&v.length>0){y=v[0];if(k===undefined){k=parseInt(Element.getStyle(y,"width"),10);this.dropDownItemMaxWidth=k=isNaN(k)?0:k}a=y.getElementsByTagName("a");if(a&&a.length>0){y=a[0]}}if(!t){apple.util.addOverflowEllipsis(y,k)}h=(y.textContent||y.innerText);b=this.dataBinding[r].highlights;var q="",x;for(x=b.length-1;x>=0;x--){f=b[x][0];c=b[x][1];if(f<h.length){q="<strong>"+h.substring(f,c)+"</strong>"+h.substring(c)+q;h=h.substring(0,f)}}y.innerHTML=h+q}}},selectMenuItem:function(b){var c=b.target||b.srcElement,a=Element.locateAncestor(c,function(d){return d.tagName==="LI"});if(a){this.changeSelectedIndex(a.getAttribute("menuIndex"),true);Event.stop(b)}},changeSelectedIndex:function(g,m){var n;var f=$(this.resultsListId),a=f.childNodes,k=(g!==null&&!isNaN(g)&&g<0)?a.length-1:g,h=this.selectedIndex,c=this.options.selectedClassName,m=m?m:false;if(h!==null&&!isNaN(h)&&h>=0){Element.removeClassName(a[h],c);a[h].setAttribute("aria-selected","false");forceRedraw(a[h])}if(k!==null&&!isNaN(k)){n=a[k%a.length];if(this.listItemHasHeading(n)){this.skipSectionHeading(h,k)}else{Element.addClassName(a[k%a.length],c);f.offset=f.offset+a[k%a.length].offset;a[k%a.length].setAttribute("aria-selected","true");this.searchField.viewElement().setAttribute("aria-activedescendant",n.getAttribute("id"));forceRedraw(a[k%a.length]);this.selectedIndex=(k%a.length);var o=a[k%a.length],d=f.offsetHeight,b=(Math.floor(o.offsetTop/d))*d;if(!m&&b!==f.scrollTop){f.scrollTop=b}}}else{this.selectedIndex=k}},skipSectionHeading:function(b,a){if(b===null||a>b){this.changeSelectedIndex(a+1)}else{this.changeSelectedIndex(a-1)}},listItemHasHeading:function(a){return(a.getElementsByTagName("p").length===1)},updateSearchFieldValue:function(a){this.searchField.viewElement().value=a},activatePrev:function(){if(this.selectedIndex===null||isNaN(this.selectedIndex)){this.selectedIndex=1}this.changeSelectedIndex(this.selectedIndex-1)},activateNext:function(){if(this.selectedIndex===null||isNaN(this.selectedIndex)){this.selectedIndex=-1}this.changeSelectedIndex(this.selectedIndex+1)},hide:function(){if(this.searchFocusFlag===true){this.searchFocusFlag=false;this.searchField.viewElement().focus();return}this.hideImpl();this.resetSelection()},hideImpl:function(){if(this.options.suggestionsEnabled){var a=$(this.dropDownMenuId);Element.setStyle(a,"display","none");this.resultsVisible=false;a.setAttribute("aria-hidden","true");this.searchField.viewElement().setAttribute("aria-expanded","false")}},processNoResults:function(){this.hide();this.setValueForKey(false,"showSpinner")},selectOnClick:function(a){var b=a.target||a.srcElement;if(b.nodeName.toUpperCase()==="UL"){this.searchFocusFlag=true;return}this.select()},reset:function(){this.setValueForKey(false,"showSpinner");this.setValueForKey(false,"showReset");this.hide()},resetSelection:function(){delete this.selectedIndex},select:function(){this.hideImpl.bindAndDelay(this,100);this.searchField.viewElement().focus();this.fireMetricsAndSubmit();this.formSubmissionStarted=true},_hiddenParamQueryString:function(){var c=this.viewElement(),f=Element.queryAll(c,"input[type=hidden]"),b={};if(f){for(var a=0,d=f.length;a<d;a++){b[f[a].name]=f[a].value}}return Object.toQueryString(b)},fireMetricsAndSubmit:function(){var c=this.selectedIndex?this.dataBinding[this.selectedIndex]:null,b=function(d){return encodeURIComponent(d.replace(/[\s\'\"]+/g,"-"))},a=function(){var f,d,g=window.location;if(c&&c.path){c.path+=(c.path.indexOf("?")===-1)?"?":"&";c.path+=this._hiddenParams;g.href=c.path}else{if(c){this.updateSearchFieldValue(c.term)}f=this.searchField.viewElement().form.action;f=f.replace("&amp;","&");f=f.replace(g.search,"");d=this.searchField.viewElement().value;g.href=f+"/"+b(d)+g.search}}.bind(this);this.getSearchConfig();this.fireMetricsEvent(c,function(){this.action=null;if(this.LastSuggestions&&this.LastSuggestions.search){var d=[];for(var g=0,f=this.LastSuggestions.search.length;g<f;g++){d.push(this.LastSuggestions.search[g].term)}apple.ai.set("LastSuggestions",d)}apple.behavior.metrics.storePageEventData(this.viewElement());a()}.bind(this))},getSearchConfig:function(){var a=new apple.metrics.Metrics({});var b=a.getObjectCookie()||{};if(b.searchConfig){this.addSearchConfigValueToForm(b.searchConfig)}},addSearchConfigValueToForm:function(b){var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","searchConfig");a.setAttribute("value",b);this.viewElement().appendChild(a)},fireMetricsEvent:function(a,d){var b={linkTrackVars:"events,eVar2",linkTrackEvents:"event8",events:"event8"},c=this.searchField.viewElement().value;if(!a){b.eVar2=c}else{b.eVar2=a.term;b.linkTrackVars+=",eVar23";b.eVar23=[c,a.section,a.resultCount,a.term,a.rank].join(" | ")}apple.Tracking.track(this.viewElement(),"search",b,d)}});var forceRedraw=(function(){var a;if(coherent.Browser.IE===8){a=function(c){var b=c.paddingLeft;c.paddingLeft="1px";window.setTimeout(function(){c.paddingLeft=b},1)}}else{a=function(b){}}return a})();Package("apple.widget");apple.widget.SlidingTrackStack=function(b,a,c){c=c||{};this.narrow=false;this.trackStack=[];this.settings=Object.applyDefaults(c,{animated:true,trackFloatSelector:null,stackFloatSelector:null,minHeight:655,hasStack:true,floatingClassName:"floating",offscreenClassName:"offscreen",lastClassName:"last",narrowClassName:"narrow"});this.buildTrackStack(b,a)};apple.widget.SlidingTrackStack.prototype.buildTrackStack=function(c,b){var g=a(c)?Element.query(c):c,f,d;this.trackStack.push({track:g,trackId:g.id,floater:this.getFloater(g)});if(this.settings.hasStack){f=a(b)?Element.queryAll(b):b;f.forEach(function(h){d=this.getFloater(h);this.trackStack.push({track:h,trackId:h.id,floater:this.getFloater(h)})},this)}function a(h){return typeof h==="string"}this.setScrollInfo();Event.observe(window,"scroll",this.viewportScrolled.bind(this));Event.observe(window,"resize",this.viewportResized.bind(this));Event.observe(g,"click",this.scrollToCoords.bind(this))};apple.widget.SlidingTrackStack.prototype.getFloater=function(b,a){return a?Element.query(a):b.children[0]};apple.widget.SlidingTrackStack.prototype.setScrollInfo=function(){var d=0,b=0,a=this.trackStack.length,c;for(b;b<a;b++){c=this.trackStack[b];if(c.floating){this.unsetFloating(c)}c.offset=d;c.trackRect=Element.getRect(c.track);c.floatRect=Element.getRect(c.floater);if(c.floating){this.setFloating(c)}d=d+c.floatRect.height}this.viewportResized()};apple.widget.SlidingTrackStack.prototype.scrollToCoords=function(a){if(this.narrow||!a){return}var k=Element.getViewport(),h=a.target||a.srcElement,c=Element.locateAncestor(h,function(n){return n.tagName.toLowerCase()=="div"}),g=c.className.replace(/\s.*/,""),m=0,b=this.trackStack.length,d,f;for(m;m<b;m++){if(c.className==this.trackStack[m].track.className){d=this.trackStack[m];break}}if(!d){return}f=d.floatRect.top-d.offset;if(f==Element.getViewport().top){d=this.trackStack[m+1];if(!d){return}f=d.floatRect.top-d.offset}if(this.settings.animated){coherent.Animator.scrollTo([0,f])}else{window.scrollTo(0,f)}};apple.widget.SlidingTrackStack.prototype.setFloating=function(a){Element.addClassName(a.track,this.settings.floatingClassName);Element.removeClassName(a.track,this.settings.lastClassName);Element.setStyle(a.floater,"position","fixed");Element.setStyle(a.floater,"top",a.offset+"px")};apple.widget.SlidingTrackStack.prototype.unsetFloating=function(a){Element.removeClassName(a.track,this.settings.floatingClassName);Element.removeClassName(a.track,this.settings.lastClassName);Element.removeClassName(a.track,this.settings.offscreenClassName);Element.setStyle(a.floater,"position","");Element.setStyle(a.floater,"top","")};apple.widget.SlidingTrackStack.prototype.viewportScrolled=function(){var a=Element.getViewport(),g=0,d=0,c=0,b=this.trackStack.length,f;if(this.narrow){return}for(c;c<b;c++){f=this.trackStack[c];if(f.trackRect.top<=a.top+f.offset){this.setFloating(f);f.floating=true;g=c}else{this.unsetFloating(f);f.floating=false}d=a.top+f.offset+f.floatRect.height;if(d>=f.trackRect.bottom){Element.addClassName(f.track,this.settings.offscreenClassName)}else{Element.removeClassName(f.track,this.settings.offscreenClassName)}}Element.addClassName(this.trackStack[g].track,this.settings.lastClassName)};apple.widget.SlidingTrackStack.prototype.viewportResized=function(){var f=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=coherent.Browser.IE?document.body.scrollWidth:document.documentElement.scrollWidth,a=this.trackStack.length,d=0;if(coherent.Browser.MobileSafari||f<c||b<this.settings.minHeight){this.narrow=true}else{this.narrow=false}if(this.narrow){for(d;d<a;d++){this.unsetFloating(this.trackStack[d])}Element.addClassName(this.trackStack[0].track,this.settings.narrowClassName)}else{this.viewportScrolled();Element.removeClassName(this.trackStack[0].track,this.settings.narrowClassName)}};Package("apple.widget");apple.widget.SlidingTrackView=Class.create((function(){var n={PINNED_TOP:"pinned_top",FLOATING:"floating",PINNED_BOTTOM:"pinned_bottom"};var c="load";var h="touchstart";var f="touchmove";var a="touchend";var g="touchcancel";var m="scroll";var o="resize";var k=[c,h,f,a,g,m,o];var d=coherent.Browser.MobileSafari?-121:0;var b={pinned_top:function(){if(!coherent.Browser.MobileSafari){if(!this.isFloatingDisabled&&this._trackFrame.top<d&&this._viewport.height>=this._itemFrame.height){if(this._trackFrame.bottom<this._itemFrame.height){return this.setState(n.PINNED_BOTTOM)}if(this._viewport.height>this._itemFrame.height){return this.setState(n.FLOATING)}}}},floating:function(){if(!coherent.Browser.MobileSafari){if(this.isFloatingDisabled||this._trackFrame.top>d||this._viewport.height===this._itemFrame.height||this._trackFrame.bottom==this._itemFrame.bottom){return this.setState(n.PINNED_TOP)}if(this._trackFrame.bottom<=this._itemFrame.bottom){return this.setState(n.PINNED_BOTTOM)}}},pinned_bottom:function(){if(!coherent.Browser.MobileSafari){if(this._itemFrame.top>=d){if(this._itemFrame.bottom===this._trackFrame.bottom&&this._trackFrame.top>=d){return this.setState(n.PINNED_TOP)}else{return this.setState(n.FLOATING)}}}}};return{constructor:function(y,A){var z=coherent.Browser.IE!==6&&Element.isFixedPositionSupported();var r=/AppleWebKit\/(\d+(?:\.\d+)?)/;var x=r.exec(navigator.userAgent);var v=(x&&parseInt(x[1],10)>=536);if(z||v){var w=k.length;var q=Array.from(y.childNodes);var t;var u;this.view=y;while((u=q.shift())){if(u.nodeType==1&&!t){t=u;continue}if(A==undefined){A=""}if(!!A.cleanup){y.removeChild(u)}}this.isFloatingDisabled=false;this.shouldHideFloating=coherent.Browser.MobileSafari;this._item=coherent.View.fromNode(t);if(this._item===null){this._item=new coherent.View(t)}this._viewport=Element.getViewport();this._trackFrame=Element.getRect(y,true);this._itemFrame=Element.getRect(t,true);this.setState(n.PINNED_TOP);this.updateItemPosition();this._item.addObserverForKeyPath(this,this.itemFrameChanged,"frame");Event.observe(window,"pageshow",this.pageShowHandler.bindAsEventListener(this));if(window.addEventListener){while(w--){window.addEventListener(k[w],this,false)}}else{this.boundHandleEvent=this.handleEvent.bindAsEventListener(this);while(w--){Event.observe(window,k[w],this.boundHandleEvent)}}}},pageShowHandler:function(r){var q=k.length;if(r.persisted){if(window.addEventListener){while(q--){window.removeEventListener(k[q],this,false)}}else{this.boundHandleEvent=this.handleEvent.bindAsEventListener(this);while(q--){Event.observe(window,k[q],this.boundHandleEvent)}}}},iOSRail:function(){var r=document.getElementById("secondary"),w=195,q=(window.pageYOffset+this._itemFrame.height),t=(this._trackFrame.height+w),v=(window.pageYOffset>w)?((window.pageYOffset-w)+"px"):0,u=document.documentElement.clientHeight;if(this._itemFrame.height>this._viewport.height){r.style.top="0px"}else{if(this._trackFrame.top<=0){if(q<=t){r.style.top=v;r.style.bottom=""}else{r.style.bottom="0px";r.style.top=""}}else{r.style.bottom="";r.style.top="0px"}}},handleEvent:function(q){switch(q.type){case c:case o:this.viewportResized();break;default:if(this.shouldHideFloating){switch(q.type){case g:case m:this.iOSRail();break;default:break}}this.viewportScrolled();break}},viewportResized:function(r){var q=this._viewport?this._viewport.width:0;this._viewport=Element.getViewport();if(coherent.Browser.Safari){this.setState(n.PINNED_TOP)}if(coherent.Browser.IE){this.isFloatingDisabled=document.documentElement.clientWidth<document.body.scrollWidth}else{this.isFloatingDisabled=document.documentElement.clientWidth<document.documentElement.scrollWidth}this.viewportScrolled()},viewportScrolled:function(){this._trackFrame=Element.getRect(this.view,true);this._itemFrame=Element.getRect(this._item.viewElement(),true);this.updateItemPosition()},updateItemPosition:function(){if("willResizeFrame" in this._item){var q=Object.applyDefaults({},this._itemFrame);q.top=Math.max(0,this._trackFrame.top);q.bottom=Math.min(this._trackFrame.bottom,this._viewport.height);q.height=q.bottom-q.top;if(this._viewport.height>this._itemFrame.height&&this._item.willResizeFrame(q)){this._itemFrame=this._item.resizeFrame(q)}}this._stateSwitcher()},itemFrameChanged:function(t,q,r){this._itemFrame=t.newValue;this.updateItemPosition()},setState:function(r){if(this._currentState==r){return}var q=this.view;Element.removeClassName(q,this._currentState);Element.addClassName(q,r);this._currentState=r;this._stateSwitcher=b[r]}}})());Package("apple.widget");apple.widget.SmartTextField=function(a){this.textAreaNodeId=a.textAreaElementId;this.errNodeId=a.errDivElementId;this.checkServerURL=a.checkServerURL;this.sid=a.sid;this.partNumber=a.partNumber;this.inFlight=false;this.resubmit=false;this.serverError="";this.wrappedText="";this.previewDivId="";this.timer=-1;this.cancelledRequest=false;$(this.textAreaNodeId).stf=this;Event.onDomReady(this.init.bind(this))};apple.widget.SmartTextField.prototype.init=function(){var a=$(this.textAreaNodeId);var c=null;var b=(function(d){if(c){window.clearTimeout(c)}c=this.afterKeypress.bindAndDelay(this,1000,d)}).bind(this);Event.observe(a,"keyup",b)};apple.widget.SmartTextField.prototype.checkServer=function(){this.timer=-1;this.inFlight=true;this.resubmit=false;var f=this;if(this.checkServerURL){var d=function(g){if(!f.cancelledRequest){if(g!="BAD REQUEST"&&g.substring(0,6)!="<html>"){f.inFlight=false;f.serverError="";if(f.resubmit){f.resubmit=false;f.checkServerSoon()}if(g.substr(0,2)!="OK"){f.serverError=g}if(g.substr(0,3)=="OK:"){f.wrappedText=g.substring(3);if(f.previewDivId){$(f.previewDivId).innerHTML=f.wrappedText}}f.showError()}}};var a=function(g){return};var c={mt:$(f.textAreaNodeId).value,pn:this.partNumber,wosid:this.sid};var b=XHR.post(this.checkServerURL,c);b.addMethods(d,a)}};apple.widget.SmartTextField.prototype.checkServerSoon=function(){this.cancelledRequest=false;if(!this.inFlight){if(this.timer!=-1){window.clearTimeout(this.timer)}var a=this;this.timer=window.setTimeout(function(){a.checkServer()},500)}else{this.resubmit=true}};apple.widget.SmartTextField.prototype.afterKeypress=function(a){this.checkServerSoon();return};apple.widget.SmartTextField.prototype.showError=function(){var a=$(this.errNodeId);a.innerHTML=this.serverError.replace(/</,"&lt;")};apple.widget.SmartTextField.prototype.setPreviewDivId=function(a){this.previewDivId=a};apple.widget.SmartTextField.prototype.cancelRequest=function(){this.cancelledRequest=true;this.inFlight=false;this.resubmit=false};Package("apple.widget");apple.widget.SuggestViewController=Class.create(coherent.ViewController,{__structure__:{},init:function(){}});Package("apple.widget");apple.widget.SyncContent=function(a){this.config=a;this.change()};apple.widget.SyncContent.prototype.getContent=function(){var a=null;var b=(function(c){if(c.body&&c.body.content){a=c.body.content}}).bind(this);apple.io.json.invoke({url:this.getUrl(),sync:true,success:b,scriptKeys:["content"]});return a};apple.widget.SyncContent.prototype.change=function(){var a=this.getContent();if(a){document.write(a)}};apple.widget.SyncContent.prototype.getUrl=function(){return this.config.url};Package("apple.widget");apple.widget.TabController=function(a){this.base("constructor")(a)};apple.util.makeSubclass(apple.widget.TabController,apple.widget.BaseWidget);apple.widget.TabController.DEFAULTS={activeClass:coherent.Style.kActiveClass,inactiveClass:"inactive",transition:"crossfade",animate:false,autoRotate:false,advanceInterval:8000,transitionDuration:1000};apple.widget.TabController.prototype.init=function(){var c=$(this.config.contentId),n=this.config.selectedTabId,m=this.tabContentIdFromTabId(n),b,h,k,f=window.location.hash.match(/^#tab(\d+)$/),d,a,g=Element;if(!$(m)){b=document.createElement("div");b.id=this.config.contentId;b.className=c.className;c.id=m;c.className="";c=c.parentNode.replaceChild(b,c);b.appendChild(c)}h={id:this.config.contentId,duration:this.config.transitionDuration,transition:this.config.transition};this._swapper=new apple.fx.ContentSwapper(h);this.getTabIds();this.setupWrapperEvents();if(n){a=$(n).parentElement;if(a&&!g.hasClassName(a,this.config.activeClass)){g.addClassName(a,this.config.activeClass)}}if(c){g.addClassName(c,"tab-container")}if(f&&f[1]){f=parseInt(f[1],10)-1;for(d in this.config.tabs){if(this.config.tabs.hasOwnProperty(d)){k=d.match(/(\d+)$/);if(!k||k[1]!==f){continue}this.selectTab(d);break}}}this.resume()};apple.widget.TabController.prototype.calculateTabHeights=function(h){var b=$(h),a=document.createElement("li"),d,m,f,c,g,k;a.innerHTML='<a href="#"><strong>one line</strong></a>';b.appendChild(a);d=parseInt(Element.getStyles(a.getElementsByTagName("strong")[0],"height"),10);b.removeChild(a);m=b.getElementsByTagName("strong");f=m.length;for(c=0;c<f;c+=1){g=m[c];k=parseInt(Element.getStyles(g,"height"),10);if(k>d){Element.addClassName(g.parentNode.parentNode,"two-line")}}};apple.widget.TabController.prototype.getTabIds=function(){var a;this.config.tabIds=[];for(a in this.config.tabs){if(this.config.tabs.hasOwnProperty(a)){this.config.tabIds.push(a)}}return this.config.tabIds};apple.widget.TabController.prototype.setupWrapperEvents=function(){var a;if(!this.config.wrapperId){return}a=$(this.config.wrapperId);if(a){Event.observe(a,"mouseover",this.pause.bindAsEventListener(this));Event.observe(a,"mouseout",this.resume.bindAsEventListener(this))}};apple.widget.TabController.prototype.pause=function(){if(!this.config.autoRotate){return}this.paused=true;if(this.timer){window.clearTimeout(this.timer)}this.timer=null};apple.widget.TabController.prototype.resume=function(a){if(!this.config.autoRotate){return}if(a){this.paused=false}if(this.timer){window.clearTimeout(this.timer)}this.timer=this.showNextTab.bindAndDelay(this,this.config.advanceInterval)};apple.widget.TabController.prototype.showNextTab=function(){var a,c,b;if(this.paused||this.locked){return}a=this.config.selectedTabId;c=this.config.tabIds||this.getTabIds();b=c.indexOf(a);if(b===c.length-1){b=0}else{b+=1}this.selectTab(c[b],"advance")};apple.widget.TabController.prototype.preloadNextTab=function(){var a=this.config.selectedTabId,h=this.config.tabIds||this.getTabIds(),d=h.indexOf(a),c,b,g;if(d===h.length-1){d=0}else{d+=1}c=h[d];if($(this.tabContentIdFromTabId(c))){return}function f(m){var k;if(!m||!m.body){return}k=coherent.Scripts.extract(m.body.content);this.insertTabContent(c,k)}b=this.config.tabContentUrl||this.config.tabs[c];b=b.url||b;b=apple.util.expandTemplate(b,{tabId:c});g={url:b,success:f.bind(this),scriptKeys:["content"]};apple.io.json.invoke(g)};apple.widget.TabController.prototype.tabContentIdFromTabId=function(a){return[this.config.contentId,a].join("_")};apple.widget.TabController.prototype.insertTabContent=function(b,c){var a,d;if($(this.tabContentIdFromTabId(b))){return null}a=$(this.config.contentId);d=document.createElement("div");d.id=this.tabContentIdFromTabId(b);Element.setInnerHTML(d,c);d.style.display="none";a.appendChild(d);return d};apple.widget.TabController.prototype.activateTab=function(b){var f,d,a,g=this;if(this.config.selectedTabId){f=$(this.config.selectedTabId);if(!this.config.animate){Element.removeClassName(f,this.config.activeClass);Element.removeClassName(f.parentNode,this.config.activeClass);Element.addClassName(f,this.config.inactiveClass);Element.addClassName(f.parentNode,this.config.inactiveClass)}d=this.tabContentIdFromTabId(this.config.selectedTabId)}this.config.selectedTabId=b;if(b){f=$(b);if(this.config.animate){coherent.Animator.replaceClassName(f,this.config.inactiveClass,this.config.activeClass,{duration:250,curve:coherent.easing.outSine});coherent.Animator.replaceClassName(f.parentNode,this.config.inactiveClass,this.config.activeClass,{duration:250,curve:coherent.easing.outSine})}else{Element.removeClassName(f,this.config.inactiveClass);Element.removeClassName(f.parentNode,this.config.inactiveClass);Element.addClassName(f,this.config.activeClass);Element.addClassName(f.parentNode,this.config.activeClass)}a=this.tabContentIdFromTabId(b)}function c(){g.locked=false;g.resume();$(a).style.zoom=1;if(g.config.autoRotate){g.preloadNextTab()}}this._swapper.swap(this.config.transition,d,a,c)};apple.widget.TabController.prototype.selectTab=function(d,h){var n,c,k,a,f,b,m;if(h===undefined){h="click"}if(this.locked){return}if(this.config.selectedTabId===d){return}if(h==="click"){this.config.autoRotate=false}n=this.tabContentIdFromTabId(d);if(this.timer){window.clearTimeout(this.timer);this.timer=null}this.locked=true;c=this.config.baseMetrics;if(c!=="undefined"&&c&&h==="click"){k=this.config.tabs[d].displayName;a=apple.util.expandTemplate(c,{index:k});apple.metrics.Metrics.reportCustomLink(null,a)}if(this.config.selectedTabId){f=$(this.config.selectedTabId);if(this.config.animate){coherent.Animator.replaceClassName(f,this.config.activeClass,this.config.inactiveClass,{duration:250,curve:coherent.easing.inSine});coherent.Animator.replaceClassName(f.parentNode,this.config.activeClass,this.config.inactiveClass,{duration:250,curve:coherent.easing.inSine})}}if($(n)){this.activateTab(d);return}function g(q){var o;if(this.config.selectedTabId===d){return}if(!q||!q.body){return}o=coherent.Scripts.extract(q.body.content);this.insertTabContent(d,o);this.activateTab(d)}b=this.config.tabContentUrl||this.config.tabs[d];b=b.url||b;b=apple.util.expandTemplate(b,{tabId:d});m={url:b,success:g.bind(this),scriptKeys:["content"]};apple.io.json.invoke(m)};Package("apple.widget");apple.widget.TextField=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.TextField,apple.widget.BaseWidget);apple.widget.TextField.DEFAULTS={placeholder:"No Value",placeholderClass:"placeholder"};apple.widget.TextField.prototype.init=function(){var b=this.widget();Event.observe(b,"focus",this.fieldReceivedFocus.bindAsEventListener(this));Event.observe(b,"blur",this.fieldLostFocus.bindAsEventListener(this));this._maxLength=b.maxLength||-1;var a=(b.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(""!==a&&this.config.placeholder!==a){return}b.maxLength=this.config.placeholder.length;b.value=this.config.placeholder;Element.addClassName(b,this.config.placeholderClass)};apple.widget.TextField.prototype.fieldReceivedFocus=function(a){var c=this.widget();var b=(c.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(this.config.placeholder===b){c.value=""}if(-1!=this._maxLength){c.maxLength=this._maxLength}else{c.removeAttribute("maxLength")}Element.removeClassName(c,this.config.placeholderClass)};apple.widget.TextField.prototype.fieldLostFocus=function(a){var c=this.widget();var b=(c.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(""!==b){return}Element.addClassName(c,this.config.placeholderClass);this._maxLength=c.maxLength||-1;c.maxLength=this.config.placeholder.length;c.value=this.config.placeholder};Package("apple.widget");apple.widget.VoteController=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS);Event.onDomReady(this.init.bind(this))};apple.widget.VoteController.prototype.DEFAULTS={voteYesValue:1,voteNoValue:0,voteClass:"vote",voteYesClass:"yes",voteNoClass:"no",messageClass:"useful",voteIdRegex:/-(\w+)$/,fadeDuration:200};apple.widget.VoteController.prototype.init=function(){var a=document.getElementById(this.config.elementId);if(!a){return}this.attachVoteEvents(Element.getElementsByClassName(this.config.voteYesClass,a),this.voteYes.bindAsEventListener(this));this.attachVoteEvents(Element.getElementsByClassName(this.config.voteNoClass,a),this.voteNo.bindAsEventListener(this))};apple.widget.VoteController.prototype.attachVoteEvents=function(b,c){function a(d){Event.observe(d,"click",c)}Array.forEach(b,a)};apple.widget.VoteController.prototype.voteYes=function(a){var b=(a.srcElement||a.target);Event.stop(a);this.sendVote(b,this.config.voteYesValue)};apple.widget.VoteController.prototype.voteNo=function(a){var b=(a.srcElement||a.target);Event.stop(a);this.sendVote(b,this.config.voteNoValue)};apple.widget.VoteController.prototype.sendVote=function(f,b){var d=this.getVoteElem(f);var g=this.getVoteId(d);if(g){apple.io.json.invoke({url:this.config.requestUrl,urlArgs:{voteId:g,vote:b}})}if(this.config.type=="answer"){var a=Element.query(d,"input[name='featureType']");var c=a?a.value:null;this.reportEvent(b,c)}this.displayFeedbackMessage(f)};apple.widget.VoteController.prototype.displayFeedbackMessage=function(h){var f=this.getMessageElem(h);var g=this.getVoteElem(h);var k=this.config.feedbackMessage;var c=this.config.fadeDuration;var b=document.createElement("p");b.className="vote-msg";b.setAttribute("role","alert");b.setAttribute("tabindex","-1");var d=function(){b.innerHTML=k;f.parentNode.removeChild(f);g.innerHTML="";g.appendChild(b);Element.setOpacity(g,0);coherent.Animator.setStyles(g,{opacity:1},{duration:c,cleanup:true});g.firstChild.focus()};var a=parseInt(Element.getStyles(g,"height"),10);if(!isNaN(a)){g.style.height=Math.max(a,0)+"px"}coherent.Animator.setStyles(g,{opacity:0},{duration:c,callback:d})};apple.widget.VoteController.prototype.getVoteElem=function(b){var c=this.config.voteClass;var a=b.parentNode;while(a&&a!=document.body){if(a.className==c){return a}a=a.parentNode}return null};apple.widget.VoteController.prototype.getMessageElem=function(c){var a=null;var b=this.getVoteElem(c);var d=Element.getElementsByClassName(this.config.messageClass,b);if(d&&d.length>0){a=d[0]}return a};apple.widget.VoteController.prototype.getVoteId=function(b){if(!b||!b.id){return null}var c=null;var a=this.config.voteIdRegex.exec(b.id);if(a&&a.length>1){c=a[1]}return c};apple.widget.VoteController.prototype.reportEvent=function(a,b){var c=(a==1)?"Useful":"Not Useful";apple.metrics.fireMicroEvent({page:window.s.pageName,feature:(b||"Product")+" vote",part:window.s.prop25,action:c})};Package("apple.widget");apple.widget.WhyBuyEmailSubscription=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.WhyBuyEmailSubscription,apple.widget.BaseWidget);var ServerStatus={good:"SUCCESS",bad:"ERROR",busy:"BUSY",off:"OFF",on:"ON",format:"FORMAT"};apple.widget.WhyBuyEmailSubscription.DEFAULTS={emailPlaceholder:"example: user@example.com",submitUrl:"email-server-reply.txt",urlArgs:{},argName:"emailAddress",emailFieldSpec:"input.notify_email",submitButtonSpec:".notify_submit",formSpec:"form",fadeDuration:350,showForm:{SUCCESS:false,ERROR:false,BUSY:false,ON:true,OFF:false,FORMAT:true},loadingClass:"loading",rpcTimeout:10000,emailRegex:/^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,4}$/i};apple.widget.WhyBuyEmailSubscription.prototype.init=function(){var g={duration:this.config.fadeDuration};this._animator=new apple.fx.Animator(g);this.setStatus("OFF");this.setStatus("ON");var b=this.part(this.config.formSpec);var f=this.part(this.config.emailFieldSpec);var a={placeholder:this.config.emailPlaceholder};this._field=new apple.widget.TextField(f.id,a);this._actions=[];var d=this.part(this.config.submitButtonSpec);var c=this.submitHandler.bindAsEventListener(this);Event.observe(d,"click",c);Event.observe(b,"submit",c)};apple.widget.WhyBuyEmailSubscription.prototype.showHideForm=function(a){var b=this.config.showForm[this._status];var d=this.config.showForm[a];var c=this.part(this.config.formSpec);if(b!=d){if(d){this._actions.push(new apple.fx.Fade(apple.fx.linearTween,c,0,1))}else{this._actions.push(apple.fx.Fade(apple.fx.linearTween,c,1,0))}}};apple.widget.WhyBuyEmailSubscription.prototype.displayStatusUpdate=function(a){var b=Element.query("#email_notification .notify_on p");b.style.opacity="0";a="notify_"+a.toLowerCase();b.innerHTML=this.config.msgText[a];this._actions.push(new apple.fx.Fade(apple.fx.linearTween,b,0,1))};apple.widget.WhyBuyEmailSubscription.prototype.partSpecForStatus=function(a){return"div.notify_"+(a||"").toLowerCase()};apple.widget.WhyBuyEmailSubscription.prototype.setStatus=function(h,n,q){h=h||"ERROR";if(h==this._status){return}var g=this.widget();var a=this.part(this.config.formSpec);var b=this.config.showForm[this._status];var o=this.config.showForm[h];var k=this.part(this.partSpecForStatus(this._status));var m=this.part(this.partSpecForStatus(h));if(!this._status){a.style.display=o?"block":"none";m.style.display="block";this._status=h;return}if(q){a.style.display=o?"block":"none";m.style.display="block";k.style.display="none";this._status=h;return}var c=new apple.fx.Fade(apple.fx.linearTween,k,1,0);var f=new apple.fx.Fade(apple.fx.linearTween,m,0,1);var r;var d=[c,f];if(h!="ON"&&h!="OFF"){this.displayStatusUpdate(h);this.showHideForm(h);this._status=h;this._animator.play(new apple.fx.Chain(this._actions),n)}else{if(b!=o){if(o){r=new apple.fx.Fade(apple.fx.linearTween,a,0,1);d=[c,new apple.fx.Blend(f,r)]}else{r=new apple.fx.Fade(apple.fx.linearTween,a,1,0);d=[new apple.fx.Blend(c,r),f]}}this._status=h;this._animator.play(new apple.fx.Chain(d),n)}};apple.widget.WhyBuyEmailSubscription.prototype.rpc=function(d,h,c){if(-1!=d.indexOf("?")){d=d+"&"}else{d=d+"?"}d+="bustCache="+(new Date()).getTime().toString(16)+":"+Math.random();var g;var b=document.createElement("script");b.src=d;function a(){window.clearTimeout(g);g=null;if(h){h.apply(window,arguments)}}function f(){window.signalStatus=function(){};if(c){c()}}window.signalStatus=a;g=window.setTimeout(f,this.config.rpcTimeout);document.getElementsByTagName("HEAD")[0].appendChild(b)};apple.widget.WhyBuyEmailSubscription.prototype.submitHandler=function(f){(f.target||f.srcElement).blur();Event.stop(f);var h=this.widget();var k=this.part(this.config.emailFieldSpec);if(!k||!this.config.submitUrl){return}var g=k.value||"";if(!g.match(this.config.emailRegex)){this.setStatus("FORMAT");k.focus();k.select();return}Element.addClassName(h,this.config.loadingClass);function d(){Element.removeClassName(h,this.config.loadingClass)}function a(n){n=n.replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();var m=ServerStatus[n];this.setStatus(m,d.bind(this))}var c=Object.applyDefaults({},this.config.urlArgs);c[this.config.argName]=g;var b=[this.config.submitUrl,Object.toQueryString(c)].join("?");this.rpc(b,a.bind(this),a.bind(this,"busy"))};Package("apple.widget");apple.widget.EngravedPod=Class.create(coherent.View,{exposedBindings:["engravingText","productId","picassoUrl","backgroundImage"],innerHTML:'<img class="engraving" src="">',__structure__:{"img.background":coherent.ImageView({srcBinding:"backgroundImage"}),"img.engraving":coherent.ImageView({srcBinding:"engravedImage",visibleBinding:"pending(not)"})},keyDependencies:{prepareEngravedImage:["picassoUrl","productId","backgroundImage","engravingText"]},productId:"",backgroundImage:"",picassoUrl:"",init:function(){},prepareEngravedImage:function(){if(!this.picassoUrl||!this.productId||!this.backgroundImage||!this.engravingText){return}if(this.__imageTimer){window.clearTimeout(this.__imageTimer);this.__imageTimer=null}var a=(this.engravingText||"").split("\n"),c={th:a[0]||"",tl:a[1]||"",i:this.backgroundImage},b=this.picassoUrl,d=[b,Object.toQueryString(c)].join((b.indexOf("?")>=0)?"&":"?");this.setValueForKey(true,"pending");this.__imageTimer=window.setTimeout(function(){this.setValueForKey(d,"engravedImage");this.setValueForKey(false,"pending")}.bind(this),50)}});Package("apple");apple.EngravingGalleryController=Class.create(coherent.ViewController,{__structure__:{"div.tabs ul":coherent.ListView({selectedIndexBinding:"selectedTabIndex",enabledBinding:"waiting(not)",animated:"true",action:"noop"}),"div.preview":apple.widget.EngravedPod({picassoUrlBinding:"selectedVariation.picassoUrl",classBinding:"viewClass",productIdBinding:"selectedProduct.productId",backgroundImageBinding:"selectedVariation.backer",engravingTextBinding:"engravingText"}),"ul.ipod-list":coherent.ListView({contentBinding:"products",selectedObjectBinding:"selectedProduct",visibleBinding:"showProducts",action:"noop"}),"ul.ipod-list a":coherent.Anchor({titleBinding:"*.title"}),"ul.ipod-list img":coherent.ImageView({altBinding:"*.productId",srcBinding:"*.productImage"}),"ul.variations":coherent.ListView({contentBinding:"productVariations",selectedObjectBinding:"selectedVariation",visibleBinding:"showVariations",action:"noop"}),"ul.variations a":coherent.Anchor({titleBinding:"*.label",classBinding:"selectedProduct.productId"}),"ul.variations span":coherent.Anchor({textBinding:"*.label",classBinding:"*.swatch"}),"div.engravings":coherent.ListView({contentBinding:"engravings",selectedIndexBinding:"selectedTabIndex",animated:"true",action:"noop"}),"div.engravings ul":coherent.ListView({contentBinding:"*.content",selectedObjectBinding:"*.selectedEngraving",action:"noop"}),"div.engravings ul a":coherent.View({htmlBinding:"*.text"})},keyDependencies:{viewClass:["selectedVariation","selectedProduct","engravings"],showVariations:["productVariations"],engravingText:["selectedTabIndex"]},init:function(){this.view.superview().addObserverForKeyPath(this,this.overlayVisibleChange,"visible");Array.forEach(Element.queryAll("div.engravings ul"),function(b){Array.forEach(b.getElementsByTagName("li"),function(c,d){Element.addClassName(c,"item"+(d+1))})});this.shuffleTab=Element.query(this.viewElement(),"ul.shuffle");if(this.shuffleTab){var a=Element.query(this.viewElement(),"ul.ipod-list li");if(a){a.style.display="none"}}this.addObserverForKeyPath(this,"observeSelectedEngravingChange","engravings.selectedEngraving")},videoController:function(){if(this.videoPlayer){return}var a=document.getElementById("video-container");var c=document.getElementById("video-href").getAttribute("href");var b={autoplay:"true",width:640,height:360};delete coherent.View.viewLookup["volume-track"];delete coherent.View.viewLookup["control-track"];this.videoPlayer=Media.create(a,c,b);if(this.videoPlayer){if(!coherent.Browser.MobileSafari){this.videoControls=new Media.ControlsWidget(a);this.videoPlayer.setControlPanel(this.videoControls)}var f=function(){d.parentNode.removeChild(d);a.appendChild(this.videoPlayer.video().object());a.appendChild(this.videoControls.element);this.videoControls.play()}.bind(this);var d=document.createElement("div");Element.addClassName(d,"endstate");Event.observe(d,"click",f);this.videoPlayer.setDelegate({didEnd:function(){this.videoControls.pause();this.videoPlayer.setTime(0);this.videoPlayer.reset();a.appendChild(d);a.removeChild(this.videoControls.element);a.removeChild(this.videoPlayer.video().object())}.bind(this)})}},selectedTabIndex:function(){return this.__selectedTabIndex},setSelectedTabIndex:function(d){if(!this.engravings){return(this.__selectedTabIndex=d)}this.setValueForKey(true,"waiting");var h=this.engravings;var g=d==h.length-2;var b=this.__selectedTabIndex==h.length-2;var k=d==h.length-1;var a=this.__selectedTabIndex==h.length-1;var c=Element.query(this.viewElement(),"#video-container");this.__selectedTabIndex=d;if(k&&c){if(c.firstChild){if(this.videoControls){this.videoControls.show()}this.setSelectedProduct(this.products[4])}else{this.videoController.bindAndDelay(this,500)}this.setSelectedProduct(this.products[4])}else{if(a&&c){if(c.firstChild){if(this.videoControls){this.videoControls.pause()}this.setSelectedProduct(this.products[1])}else{this.setSelectedProduct(this.products[1])}}}if(g&&this.shuffleTab){this.setSelectedProduct(this.products[0])}else{if((b&&this.shuffleTab)&&!k){this.setSelectedProduct(this.products[1])}}var f=h[this.__selectedTabIndex];if(!f.selectedEngraving){f.setValueForKey(f.content[0],"selectedEngraving")}else{this.updateEngravingText(f.selectedEngraving)}(function(){this.setValueForKey(false,"waiting")}).bindAndDelay(this,500);return d},selectedProduct:function(){return this.__selectedProduct},setSelectedProduct:function(b){this.willChangeValueForKey("productVariations");this.__selectedProduct=b;this.didChangeValueForKey("productVariations");var a;this.shuffleTab?a=!(b==this.products[0]||b==this.prod):a=!(b==this.prod);this.setValueForKey(a,"showProducts");var c=this.productVariations();this.setValueForKey(c[0],"selectedVariation");return b},updateEngravingText:function(c){var a=c.text||"";var b=a.split(/<\s*br\s*\/?>/i).map(function(d){return d.trim()}).join("\n");this.setValueForKey(b,"engravingText")},observeSelectedEngravingChange:function(a){if(1!==a.indexes.length){return}this.updateEngravingText(a.newValue[0])},viewClass:function(){if(!this.__selectedProduct){return"preview"}if(!this.selectedVariation){return"preview "+this.__selectedProduct.productId}var a=this.__selectedProduct.productId+"_"+this.selectedVariation.swatch;return["preview",this.__selectedProduct.productId,a].join(" ")},showVariations:function(){var a=this.productVariations();return a.length>1},productVariations:function(){if(!this.__selectedProduct||!this.productData){return[]}var a=this.__selectedProduct.productId;return this.productData[a]||[]},noop:function(a,b){Event.stop(b)},overlayVisibleChange:function(c,a,b){if(!c.newValue&&this.videoPlayer){this.videoControls.pause()}},setInitialSelections:function(b){this.setValueForKey(true,"waiting");var a=this.products[b.selectedProduct||0];this.setSelectedProduct(a);var c=this.productVariations();this.setValueForKey(c[b.selectedVariationIndex||0],"selectedVariation");this.setSelectedTabIndex.bindAndDelay(this,10,b.selectedTab)}});Package("apple");apple.EngravingViewController=Class.create(coherent.ViewController,{__structure__:{".one-click":coherent.View({visibleBinding:"showOneClickButtons"}),'input[type="checkbox"]':coherent.ToggleButton({checkedBinding:"thisIsGift"}),".outline_box .close":coherent.Anchor({action:"hide"}),"p.toggle":coherent.View({visibleBinding:"overlayHidden",animated:true}),"p.toggle a":coherent.Anchor({action:"show"})},engravingOverlay:coherent.View(".outline_box"),skipEngravingLink:coherent.Anchor(".outline_box .alert_bubble a"),engravingForm:Part("form#engraving_form"),addEngravingButton:Part('.add-engraving button[type="submit"]'),skipEngravingButton:Part('.skip-engraving button[type="submit"]'),saveEngravingButton:Part('#engraving-options button[type="submit"][name="save"]'),cancelEngravingButton:Part('#engraving-options button[type="submit"][name="cancel"]'),microEventData:{addEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Add engraving"},skipEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Skip engraving"},editEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Edit Engraving"},closeEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Close engraving box"},continueWithoutEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Continue"}},init:function(){Event.observe(window,"unload",function(){});this.checkOneClickSettings();this.addObserverForKeyPath(this,this.observeThisIsGiftCheckbox,"thisIsGift");this.observeThisIsGiftCheckbox();var c="";if(this.skipEngravingLink){c=this.skipEngravingLink}if(c&&!apple.buyFlowVersionId){Event.observe(this.skipEngravingLink.viewElement(),"click",this.handleClick.bind(this))}this.productImage=Element.query(this.viewElement(),"#EngraveDynamicImage");var b=Element.queryAll(this.viewElement(),"#engraving_form button[type=submit]");if(b&&-1!==b.length){for(var a=b.length;a>0;a--){b[a-1].clicked=false;Event.observe(b[a-1],"click",this.handleClick.bind(this));Event.stopObserving(b[a-1],"click",this.handleClick.bind(this))}}if(document.getElementById("gift-checkbox")){Event.observe(document.getElementById("gift-checkbox"),"focus",this.showGiftPopup);Event.observe(document.getElementById("gift-checkbox"),"blur",this.hideGiftPopup);Event.observe(document.getElementById("gift-checkbox"),"keyup",this.handleGiftCheckboxKeyUp);Event.observe(document.getElementById("gift-checkbox"),"keypress",this.handleGiftCheckboxKeypress)}},showGiftPopup:function(a){var b=new apple.widget.HoverManager(),c=b.findHoverNode(a.target||a.srcElement);if(!c){return}b.showHover(c,true)},hideGiftPopup:function(a){var b=new apple.widget.HoverManager(),c=b.findHoverNode(a.target||a.srcElement);if(!c){return}b.hideHover(c,true)},handleGiftCheckboxKeypress:function(a){if(a.keyCode===Event.KEY_RETURN){Event.stop(a)}},handleGiftCheckboxKeyUp:function(b){if(b.keyCode===Event.KEY_ESC){Event.stop(b);var c=new apple.widget.HoverManager(),a=b.target||b.srcElement,d=c.findHoverNode(a);if(!d){return}c.hideHover(d,true)}},checkOneClickSettings:function(){var a=apple.cookie("appleconfig3");if(a===null){a=apple.cookie("AppleConfig3")}this.oneClickEnabled=(a!==null)?true:false},observeThisIsGiftCheckbox:function(a){if(this.oneClickEnabled){this.hideOneClickButtonsIfThisIsGift()}},hideOneClickButtonsIfThisIsGift:function(){if(this.valueForKey("thisIsGift")){this.setValueForKey(false,"showOneClickButtons")}else{this.setValueForKey(true,"showOneClickButtons")}},show:function(b){var a=this.engravingOverlay.viewElement();a.style.display="block";coherent.Animator.setStyles(a,{opacity:1},{duration:200});this.setValueForKey(false,"overlayHidden");this.disableShowObserver();var c=this.microEventData.editEngraving;c.node=b;apple.metrics.fireMicroEventNoDuplicates(c)},hide:function(b){var a=this.engravingOverlay.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:200,callback:function(){a.style.display="none"}});this.setValueForKey(true,"overlayHidden");Element.query("p.toggle").style.display="block";this.enableShowObserver();var c=this.microEventData.closeEngraving;c.node=b;apple.metrics.fireMicroEventNoDuplicates(c)},enableShowObserver:function(){Event.observe(this.productImage,"click",this.observeClick.bind(this))},disableShowObserver:function(){Event.stopObserving(this.productImage,"click",this.observeClick.bind(this))},observeClick:function(a){if(this.overlayHidden){this.show()}},handleClick:function(f){try{if((f.currentTarget&&f.currentTarget.name&&f.currentTarget.name.match(/buyNow/i))||(f.srcElement&&f.srcElement.name&&f.srcElement.name.match(/buyNow/i))){if(apple.cookie("aosqbe")){apple.fcs.setFcsDataForQbe()}}}catch(g){}var a=f.target||f.srcElement,c=Element.locateAncestor(a,function(h){return h.tagName.toLowerCase()=="button"});var d=Element.queryAll(this.viewElement(),"#engraving_form button[type=submit]");for(var b=d.length;b>0;b--){if(d[b-1].clicked){d[b-1].disabled=true;Event.stop(f)}Element.addClassName(d[b-1],"disabled");d[b-1].clicked=true}this.fireMicroEventAndSubmitOrRedirect(f)},fireMicroEventAndSubmitOrRedirect:function(f){var a=f.target||f.srcElement,d=Element.locateAncestor(a,function(h){return h.tagName.toLowerCase()=="button"}),c=function(h,n,o){var m=n.form,k;k=document.createElement("input");k.type="hidden";k.value=n.value;k.name=n.name;m.appendChild(k);Event.preventDefault(h);apple.metrics.fireMicroEvent(o,function(){m.submit()})};var b="";if(this.skipEngravingLink){b=this.skipEngravingLink.viewElement().id}if(d===this.addEngravingButton()){var g=this.microEventData.addEngraving;g.node=d;c(f,d,g)}else{if(d===this.skipEngravingButton()){var g=this.microEventData.continueWithoutEngraving;g.node=d;c(f,d,g)}else{if(d===this.saveEngravingButton()||d===this.cancelEngravingButton()){return true}else{if(a.id===b){Event.preventDefault(f);var g=this.microEventData.skipEngraving;g.node=this.skipEngravingLink.viewElement();apple.metrics.fireMicroEvent(g,function(){window.location=a.href})}}}}}});Package("apple");apple.EngravingStepController=Class.create(apple.EngravingViewController,{skipEngravingLink:coherent.Anchor(".outline_box .alert_bubble a",{hrefBinding:"skipEngravingUrl"}),compoundButtonAddEngravingButton:Part('.add-engraving .dynamic-menu li.BuyNow button[type="submit"]'),compoundButtonSkipEngravingButton:Part('.skip-engraving .dynamic-menu li.BuyNow button[type="submit"]'),init:function(){this.submitClicked=false;this.isBuyFlow=apple.buyFlowVersionId;if(this.isBuyFlow){this.storageDelegate=new apple.buyFlowStorageDelegate({session:true,hash:true,expires:apple.buyFlowExpiry||3600000,expiryInMs:true});this.storageDelegate.checkBuyFlowComplete();if(this.storageDelegate.hasEntriesForStep()){this.populateEngravingMessage();this.populateGiftSelection()}else{var b=Element.queryAll(this.engravingForm(),'input[type="text"]');b.forEach(function(f){f.value=""})}if(this.skipEngravingLink){this.setSkipEngravingLink();Event.observe(this.skipEngravingLink.viewElement(),"click",this.skipEngravingSubmit.bind(this))}var d=$("gift-checkbox");if(d){Event.observe(d,"change",this.onCheckboxChange.bindAsEventListener(this))}var a=Element.queryAll(this.viewElement(),".compound-button .dynamic-menu ul li a");if(a){var c=this;a.forEach(function(f){Event.observe(f,"click",c.bindEngravingActionsToLink.bind(c))})}}this.base();Element.replaceClassName(this.viewElement(),"loading","init");Event.observe(window,"pageshow",function(f){if(f.persisted){if(this.storageDelegate){this.storageDelegate.storage.init();this.storageDelegate.checkBuyFlowComplete();if(this.storageDelegate.hasEntriesForStep()){this.populateEngravingMessage()}}}}.bind(this))},bindEngravingActionsToLink:function(a){var b=a.target||a.srcElement,c=Element.locateAncestor(b,function(d){return d.tagName.toLowerCase()=="fieldset"});if(Element.hasClassName(c,"add-engraving")){this.addEngravingSubmit(a)}else{if(Element.hasClassName(c,"skip-engraving")){this.skipEngravingSubmit(a)}}},handleClick:function(d){var k=d.target||d.srcElement,b=Element.locateAncestor(k,function(m){return m.tagName.toLowerCase()=="button"});if(this.submitClicked===true){Event.stop(d);return}this.submitClicked=true;var f,c=Element.queryAll('.add-engraving button[type="submit"]'),h=c.length,a=0;for(a;b&&a<h;a++){if(c[a].value==b.value){f=c[a]}}var g="";if(this.skipEngravingLink){g=this.skipEngravingLink.viewElement().id}this.submitClicked=true;if(b===f||b===this.compoundButtonAddEngravingButton()){this.addEngravingSubmit(d)}else{if(b===this.skipEngravingButton()||b===this.compoundButtonSkipEngravingButton()){this.skipEngravingSubmit(d)}else{if(k.id===g){this.skipEngravingSubmit(d)}else{this.skipEngravingSubmit(d)}}}},addEngravingSubmit:function(d){if(this.isBuyFlow){var c=this.storageDelegate.entriesForSelector("not-engraved")||this.storageDelegate.entriesForSelector("acc-not-engraved"),b=Element.query(this.viewElement(),'input[name="productEngrave"]');if(c){var a=$("skip-engraving");if(a&&a.checked){a.checked=false}this.storageDelegate.removeSelected("not-engraved");if(b){this.storageDelegate.setPartNumber(b.value)}if(this.storageDelegate.entriesForSelector("acc-not-engraved")){this.storageDelegate.removeSelected("acc-not-engraved")}}}this.submitForm(d,"add")},skipEngravingSubmit:function(c){var a=$("skip-engraving"),b=Element.query(this.viewElement(),'input[name="product"]');if(a){a.checked=true}if(this.isBuyFlow&&b){this.storageDelegate.setPartNumber(b.value)}this.submitForm(c,"skip")},submitForm:function(b,f){if(this.isBuyFlow){this.storageDelegate.save(this);var h=Element.query('input[name="product"]'),g=h&&Element.query('input[name="secondary_product"]');if(g&&g.value==h.value){g.value=""}if(f==="skip"){this.removeEngravingMessageFromStorage()}var c=b.target||b.srcElement,d=c&&Element.locateAncestor(c,function(n){return n.tagName.toLowerCase()==="button"}),m=d&&d.name;if(m){if(m!=="proceed"){this.storageDelegate.setBuyFlowComplete()}}else{if(c.id===this.skipEngravingLink.viewElement().id){var a=this.addEngravingButton();var k=this.compoundButtonAddEngravingButton();if(a&&a.name!=="proceed"||k&&k.name!=="proceed"){this.storageDelegate.setBuyFlowComplete()}}}}this.fireMicroEventAndSubmitOrRedirect(b)},onCheckboxChange:function(a){var b=a.target||a.srcElement;if(this.isBuyFlow&&b){if(b.checked){this.storageDelegate.setSelected(b.name,b.checked)}else{this.storageDelegate.removeSelected(b.name)}if(this.skipEngravingLink){this.setSkipEngravingLink()}}},setSkipEngravingLink:function(d){var b,h=this.skipEngravingLink.viewElement().href,c=h.split("?"),g,a,f;if(!this.originalUrlParams){this.originalUrlParams=c&&Object.fromQueryString(c[1]||"")}if(this.isBuyFlow){f=this.storageDelegate.storage.inFallback&&this.storageDelegate.storage.wantHash;b=f?Object.fromQueryString(window.location.search):this.storageDelegate.entriesForSession(true)||{}}g=Object.merge(this.originalUrlParams,b);a=c[0]+"?"+Object.toQueryString(g);this.setValueForKey(a,"skipEngravingUrl")},populateEngravingMessage:function(){var b=this.storageDelegate.entriesForStep(true),a=Element.queryAll(this.engravingForm(),'input[type="text"]'),c=false;a.forEach(function(f){var d=f.name;if(b[d]){if(coherent.Browser.Mozilla){f.value=b[d]}else{f.setAttribute("value",b[d])}}(function(){if(!c){f.focus();c=true}}).bindAndDelay(this,0)})},populateGiftSelection:function(){var a=this.storageDelegate.entriesForStep(true),b=$("gift-checkbox");if(b){if(a[b.name]){b.checked=true}else{b.checked=false}}},removeEngravingMessageFromStorage:function(){var a=this.storageDelegate.entriesForStep(true),b=Element.queryAll(this.engravingForm(),'input[type="text"]'),c=this;b.forEach(function(f){var d=f.name;if(a[d]){c.storageDelegate.removeSelected(d)}})}});Package("apple");apple.stylesheet=function(b){if(b){this.__stylesheet=document.getElementById(b)}else{b=this.__ID_PREFIX+(new Date()).getTime()}if(!this.__stylesheet){var a=document.createElement("style");a.setAttribute("id",b);document.getElementsByTagName("head")[0].appendChild(a);if(a.sheet){this.__stylesheet=a.sheet}else{this.__stylesheet=document.styleSheets[document.styleSheets.length-1]}}};if(!CSSStyleSheet.prototype.addRule){CSSStyleSheet.prototype.addRule=function(a,d,b){var c=a+"{"+d+"}";return CSSStyleSheet.prototype.insertRule.call(this,c,b)}}apple.stylesheet.prototype.__ID_PREFIX="stylesheet-";apple.stylesheet.prototype.insertRule=function(a,f,b){var d=[];if(b!==undefined){b=(this.__stylesheet.cssRules!==undefined)?this.__stylesheet.cssRules.length:this.__stylesheet.rules.length}for(var c in f){d.push(c+":"+f[c])}this.__stylesheet.addRule(a,d.join(";"),b);return b};(function(b){var d={MobileSafari:{shouldAddClassName:coherent.Browser.MobileSafari,className:"ios"}};for(var a in d){var c=d[a];if(c.shouldAddClassName){Element.addClassName(b,c.className)}}if(!coherent.Browser.MobileSafari){Element.addClassName(b,"no-touch")}})(document.documentElement);Package("apple.masthead");apple.masthead.MastHeadViewController=(function(){return Class.create(coherent.ViewController,{getTooltipTrigger:Part("#call-apple"),init:function(){var c=$("u_tele"),b=this.getTooltipTrigger();this.drawer=$("contact-drawer");if(!c||!this.drawer){return}if(this.drawer&&coherent.Browser.IE!==8){Element.addClassName(this.drawer,"opacity")}var a={owner:this,onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave};this.drawer.setAttribute("aria-hidden","true");this.addTrackingInfo("call-apple",a);this.addTrackingInfo("contact-drawer",a);Event.observe(b,"mouseout",this.closeMenu.bindAsEventListener(this));Event.observe(b,"click",this.showHoursOfOperation.bindAsEventListener(this));Event.observe(b,"blur",this.closeMenu.bindAsEventListener(this));Event.observe(b,"keydown",this.tooltipKeydown.bindAsEventListener(this));Event.observe(this.drawer,"mouseout",this.closeMenu.bindAsEventListener(this));Event.observe(document.body,"click",this.ontouchend.bindAsEventListener(this));Event.observe(document.body,"touchstart",this.ontouchstart.bindAsEventListener(this))},tooltipKeydown:function(a){if(a.keyCode===Event.KEY_ESC){this.closeMenu(a)}},showHoursOfOperation:function(b){if(!this.__setleftValue){var a=174;var c=a/2-Element.getRect(Element.query(".contact")).width/2;c=Element.query(".contact").offsetLeft-Math.floor(c);this.drawer.style.left=c+"px";this.__setleftValue=true}this.drawer.setAttribute("aria-hidden","false");Element.addClassName($("call-apple"),"open");Element.addClassName(this.drawer,"open-drawer");apple.metrics.fireMicroEvent({eVar:"prop41",feature:"Chat",action:"Call 800-MY-APPLE link"})},closeMenu:function(b){var a=$("call-apple-content");var c=b.toElement||b.relatedTarget;if(this.drawer&&Element.hasClassName(this.drawer,"open-drawer")&&c!==this.drawer&&c!==a&&c!==a.parentNode){this.drawer.setAttribute("aria-hidden","true");Element.removeClassName(this.drawer,"open-drawer");Element.removeClassName($("call-apple"),"open")}},onmouseenter:function(a){this.hoverNodeId=a.id;if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}},onmouseleave:function(b){if(b.id!==this.hoverNodeId){return}if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}function a(){this.__timer=null;if(this.drawer&&Element.hasClassName(this.drawer,"open-drawer")){Element.removeClassName(this.drawer,"open-drawer");Element.removeClassName($("call-apple"),"open")}}this.__timer=a.bindAndDelay(this,3000);this.hoverNodeId=""},ontouchstart:function(a){var b=a.target||a.srcElement;do{if(b&&b.id==="contact-drawer"||b.id==="call-apple"){return}b=b.parentNode}while(b&&b!==document.body);if(b===document.body){this.closeMenu(a)}},teardown:function(){var a=this.getTooltipTrigger();Event.stopObserving(a,"mouseover",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"mouseout",this.closeMenu.bindAsEventListener(this));Event.stopObserving(a,"click",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"focus",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"blur",this.closeMenu.bindAsEventListener(this));Event.stopObserving(a,"keydown",this.tooltipKeydown.bindAsEventListener(this));Event.stopObserving(this.drawer,"mouseout",this.closeMenu.bindAsEventListener(this));Event.stopObserving(document.body,"click",this.ontouchend.bindAsEventListener(this));Event.stopObserving(document.body,"touchstart",this.ontouchstart.bindAsEventListener(this))}})})();Event.onLoad(function(){var a=Element.query(".masthead");if(a){new apple.masthead.MastHeadViewController(a)}});Package("apple");coherent.Base64=Class.create({buffer:[],constructor:function(a){},decode:function(b){var f=new coherent.Base64DecodeEnumerator(b);while(f.moveNext()){var a=f.current;if(a<128){this.buffer.push(String.fromCharCode(a))}else{if((a>191)&&(a<224)){f.moveNext();var d=f.current;this.buffer.push(String.fromCharCode(((a&31)<<6)|(d&63)))}else{f.moveNext();var d=f.current;f.moveNext();var c=f.current;this.buffer.push(String.fromCharCode(((a&15)<<12)|((d&63)<<6)|(c&63)))}}}return this.buffer.join("")}});coherent.Base64DecodeEnumerator=Class.create({codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",constructor:function(a){this._input=a;this._index=-1;this._buffer=[];this.current=64},moveNext:function(){if(this._buffer.length>0){this.current=this._buffer.shift();return true}else{if(this._index>=(this._input.length-1)){this.current=64;return false}else{var h=this.codex.indexOf(this._input.charAt(++this._index));var g=this.codex.indexOf(this._input.charAt(++this._index));var f=this.codex.indexOf(this._input.charAt(++this._index));var d=this.codex.indexOf(this._input.charAt(++this._index));var c=(h<<2)|(g>>4);var b=((g&15)<<4)|(f>>2);var a=((f&3)<<6)|d;this.current=c;if(f!=64){this._buffer.push(b)}if(d!=64){this._buffer.push(a)}return true}}}});Package("apple.utilitynav");(function(){var b=Class.create(coherent.ViewController,{__structure__:{"#unav_sign-in a":coherent.Anchor({hrefBinding:"account.signInUrl",visibleBinding:"userNamePresent(not)"}),"#unav_sign-out a":coherent.Anchor({hrefBinding:"account.signOutUrl",visibleBinding:"userNamePresent"}),"#unav_create-account a":coherent.Anchor({hrefBinding:"account.createAppleIdUrl",visibleBinding:"userNamePresent(not)"}),"#honorificText":coherent.View({visibleBinding:"honorSymbolPresent"}),"#unav-account":coherent.View({}),"#unav-cart":coherent.View({}),"#unav-cart p.view-link a":coherent.Anchor({hrefBinding:"data.cart.viewAllUrl"}),".checkout a":coherent.Anchor({visibleBinding:"data.cart.items.@count",hrefBinding:"data.cart.checkOutUrl"}),"#unav-your-cart .account-signin":coherent.View({visibleBinding:"userNamePresent(not)"}),"#unav-your-cart .empty-cart-message":coherent.View({visibleBinding:"data.cart.items.@count(not)"}),"#unav-your-cart .unav-your-cart-title":coherent.View({visibleBinding:"data.cart.items.@count",}),"#unav-cart .checkout":coherent.View({visibleBinding:"data.cart.items.@count",}),"#u_account":coherent.View({visibleBinding:"accountText",}),"#unav-your-cart ul":coherent.ListView({contentBinding:"data.cart.items",visibleBinding:"data.cart.items.@count",template:coherent.View({__structure__:{a:coherent.Anchor({hrefBinding:"*.productDetailsUrl"}),img:coherent.ImageView({srcBinding:"*.imageUrl"}),span:coherent.View({htmlBinding:"*.description"})}})})},accountLink:coherent.Anchor("#u_account a"),accountSpan:coherent.View("#accountName",{htmlBinding:"userName"}),cartLink:coherent.Anchor("#u_cart a"),popupMenuEvents:false,OMNITURE_FEATURE_NAME:"Utility Nav",OMNITURE_PROPERTY_NAME:"eVar6",keyDependencies:{accountVisible:["visibleSection","dataLoaded"],cartVisible:["visibleSection","dataLoaded"]},stylesheet:new apple.stylesheet(),init:function(){this.addObserverForKeyPath(this,this.callbackFunction,"account.displayAccountName");this.userNamePresent=false;this.honorSymbolPresent=false;this.setValueForKey(true,"accountText");this.setValueForKey(null,"visibleSection");this.setValueForKey(false,"dataLoaded");var f=320;var o=30;var q={owner:this,onclick:this.onclicked,onmouseleave:this.onmouseleave};var n={owner:this,onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave};this.addTrackingInfo("u_account",q);this.addTrackingInfo("u_cart",q);this.addTrackingInfo("unav-account",n);this.addTrackingInfo("utility-nav-loading",n);this.addTrackingInfo("unav-cart",n);var g=Element.query("#unav-cart .checkout a");Event.observe(g,"click",apple.fcs.flushFcsData.bind(this));if(this.surveyData){var k=window.apple.survey;k.surveyButton(this)}this.unavAccount=coherent.View.viewLookup["unav-account"];this.unavCart=coherent.View.viewLookup["unav-cart"];this.cartList=Element.query("#unav-cart ul");this.cartList.innerHTML="<li></li>";if(this.accountLink){var d=Element.getRect(this.accountLink.viewElement()).left-(Element.getRect(Element.query(".utility-nav")).left-f)+o;this.stylesheet.insertRule(".unav-account:before",{left:d+"px"})}if(coherent.Browser.MobileSafari){var m=Element.query(".user-navigation li#u_account a");var h=Element.query(".user-navigation li#u_cart a");if(m){m.href="#"}if(h){h.href="#"}}if(this.cartLink){Event.observe(this.cartLink.viewElement(),"click",this.hoverHandler.bindAsEventListener(this));Event.observe(this.cartLink.viewElement(),"keydown",this.keydown.bindAsEventListener(this))}if(this.accountLink){Event.observe(this.accountLink.viewElement(),"click",this.hoverHandler.bindAsEventListener(this));Event.observe(this.accountLink.viewElement(),"keydown",this.keydown.bindAsEventListener(this))}Event.observe(document.body,"click",this.mouseoutHandler.bindAsEventListener(this));Event.observe(document.body,"touchstart",this.mouseoutHandler.bindAsEventListener(this));this.ariaInit()},callbackFunction:function(f,d){if(f.object.account.displayAccountName.trim()==="true"){this.updateAccountName()}},updateAccountName:function(){var n="aoscn",d=Element.query("#accountName"),m,h;if(d){m=d.text||d.innerText||d.textContent}if(apple.cookie){h=(apple.cookie("aoscn")!==null&&apple.cookie("aoscn")!==undefined)?apple.cookie("aoscn").split("~")[0]:undefined}var f=apple.cookie("sfa");if(h){this.userName=h}if(this.userName!==null&&m&&this.userName!==m.trim()&&this.userName!==undefined){var k=new coherent.Base64(),g=k.decode(this.userName);g=g.replace(/[<>\&\'\"/]/gim,function(o){return"&#"+o.charCodeAt(0)+";"});this.setValueForKey(true,"userNamePresent");this.setValueForKey(g,"userName");if(f&&f.toLowerCase().indexOf("jp")!==-1){this.setValueForKey(true,"honorSymbolPresent")}}},ariaInit:function(){function d(g,f,h){if(f){g.setAttribute("aria-haspopup","true")}if(h){g.setAttribute("aria-owns",h)}return g}if(this.accountLink){d(this.accountLink.viewElement(),true,"unav-account")}if(this.cartLink){d(this.cartLink.viewElement(),true,"unav-cart")}Element.query("#unav-account ul").setAttribute("role","menu");$("unav-cart").setAttribute("role","menu");$("unav-account").setAttribute("aria-hidden","true");$("unav-cart").setAttribute("aria-hidden","true");this.addObserverForKeyPath(this,this.ariaObserveVisible,"accountVisible");this.addObserverForKeyPath(this,this.ariaObserveVisible,"cartVisible");document.getElementById("utility-nav-content").setAttribute("aria-live","polite")},removeAriaAlert:function(){var f=document.getElementById("ariaLoadingAlert");if(f){var d=f.parentElement||f.parentNode;d.removeChild(f)}},createAriaAlert:function(h,d){this.removeAriaAlert();var f=document.createElement("p");var g=document.createTextNode(h);f.appendChild(g);f.setAttribute("role","alert");f.setAttribute("aria-live",(d||"polite"));f.setAttribute("id","ariaLoadingAlert");f.setAttribute("style","border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px;");document.body.appendChild(f)},ariaObserveVisible:function(h,k){var g=this;var f=(function d(m){switch(m){case ("accountVisible"):return g.unavAccount.viewElement();case ("cartVisible"):return g.unavCart.viewElement();default:return undefined}})(k);if(f){f.setAttribute("aria-hidden",!h.newValue)}},hoverHandler:function(d){var h=this,k=d.target||d.srcElement;if(d.target.id==="accountName"){k=k.parentNode}var m=k.parentNode.parentNode.id==="breadcrumb",g=~k.parentNode.id.indexOf("u_")||~k.parentNode.id.indexOf("unav-"),f=this.lockedToNav;if(coherent.Browser.IE===8&&d){d.returnValue=false}else{d.preventDefault()}if(coherent.Browser.MobileSafari){this.touchHandler(d,true)}else{window.setTimeout(function(){if(document.activeElement===k&&!f){if(!h.menuLink){var n=k.parentNode.id||false;if(n&&~n.indexOf("u_")){h.menuLink=n}}h.triggerKeyOpen()}else{if(!h.__visibleSection&&g){h.onclicked(k.parentNode)}else{h.closeMenu(d)}}})}},clickHandler:function(d){if(coherent.Browser.IE===8&&d){d.returnValue=false}else{d.preventDefault()}if(d.target.parentNode.id===this.hoverNodeId){this.closeMenu(d)}},touchHandler:function(d,f){var g=d.target||d.srcElement,h=g.parentNode.id||false;if(g.id==="accountName"){h=g.parentNode.id}if(h&&!~h.indexOf("u_")){h=d.srcElement.parentNode.parentNode&&d.srcElement.parentNode.parentNode.id}if(h&&~h.indexOf("u_")){Event.preventDefault(d);if(f){if($(h)&&Element.hasClassName($(h),"open")){this.setValueForKey(null,"visibleSection")}else{this.setValueForKey(h,"visibleSection")}}}},keyboardShow:function(d){var f=(d.target||d.srcElement).parentNode.id||false;if(f&&~f.indexOf("u_")){this.menuLink=f;Event.preventDefault(d)}else{this.lockedToNav=false;this.menuLink=undefined}},closeMenu:function(d){var g=d.target||d.srcElement,f=this;do{if(g&&g.id==="utility-nav"||g.id==="u_account"||g.id==="u_cart"){if(coherent.Browser.MobileSafari&&g.id==="utility-nav"){(function(){this.lockedToNav=false;this.menuLink=undefined;this.setValueForKey(null,"visibleSection")}).bindAndDelay(this,500)}break}g=g.parentNode}while(g&&g!==document.body);if(this.__visibleSection){this.lockedToNav=false;this.menuLink=undefined;this.setValueForKey(null,"visibleSection")}},keyboardNavDataLoadCallback:function(){var d=Element.query("#unav-cart .checkout a");if(d&&typeof(d.search)!="undefined"&&d.search!=null){d.search=apple.fcs.appendFcsData(d.search)}if(this.lockedToNav){this.currentNavEls=this.getVisibleNavContents();this.focusCurrentNavEls.bindAndDelay(this,100)}else{this.lockedToNav=true}},getNodeFromNav:function(d){switch(d){case"u_account":return this.unavAccount.viewElement();case"u_cart":return this.unavCart.viewElement();default:return""}},getVisibleNavContents:function(){var h=Element.queryAll(this.getNodeFromNav(this.menuLink),"a"),g=[];for(var f=0,d=h.length;f<d;f++){if(h[f]&&h[f].style.display!=="none"){g.push(h[f])}}return g},keydown:function(d){var k=d.keyCode,h=d.target||d.srcElement,m=(h.parentNode.parentNode.id==="breadcrumb");var f=Element.locateAncestor(d.target||d.srcElement,function(o){return o.id==="u_tele"||o.id==="u_chat"},this.viewElement());if(k===Event.KEY_ESC&&this.lockedToNav){Event.preventDefault(d);Element.query("#"+this.valueForKey("visibleSection")+" a").focus();var g=this;this.popupMenuEvents=false;this.currentNavEls.forEach(function(o){Event.stopObserving(o,"keydown",g.focusNavEls.bindAsEventListener(g,g.currentNavEls))});this.setValueForKey(null,"visibleSection");this.lockedToNav=false;this.menuLink=undefined}if((k===Event.KEY_RETURN||k===32||k===Event.KEY_UP||k===Event.KEY_DOWN)&&(!m&!f)){Event.preventDefault(d);if(!this.menuLink){var n=h.parentNode.id||false;if(n&&~n.indexOf("u_")){this.menuLink=n}}this.triggerKeyOpen()}},triggerKeyOpen:function(){if(this.menuLink!==this.__visibleSection){this.lockedToNav=false}if(this.menuLink==="u_account"){this.fireEvent({action:"Account"})}else{if(this.menuLink==="u_cart"){this.fireEvent({action:"Cart"})}}if(this.menuLink&&!this.lockedToNav){this.hoverNodeId=this.menuLink;this.setValueForKey(this.menuLink,"visibleSection");this.lockedToNav=true;this.currentNavEls=this.getVisibleNavContents();this.focusCurrentNavEls.bindAndDelay(this,100)}else{if(this.menuLink&&this.lockedToNav){var d=this;this.popupMenuEvents=false;this.currentNavEls.forEach(function(f){Event.stopObserving(f,"keydown",d.focusNavEls.bindAsEventListener(d))});this.lockedToNav=false;this.menuLink=undefined;this.setValueForKey(null,"visibleSection")}}},focusCurrentNavEls:function(){var d=this;if(!this.popupMenuEvents){this.popupMenuEvents=true;if(this.currentNavEls){this.currentNavEls.forEach(function(f){Event.observe(f,"keydown",d.focusNavEls.bindAsEventListener(d));Event.observe(f,"blur",d.focusBody.bindAsEventListener(d));f.setAttribute("role","menuitem")})}}this.currentNavEls[0].focus()},focusNavEls:function(d){var h=this.currentNavEls,g=d.target||d.srcElement,f=h.indexOf(g);if(this.lockedToNav&&d.keyCode===Event.KEY_TAB){if(!d.shiftKey&&g===this.currentNavEls[this.currentNavEls.length-1]){Event.stop(d);this.currentNavEls[0].focus()}if(d.shiftKey&&g===this.currentNavEls[0]){Event.stop(d);this.currentNavEls[this.currentNavEls.length-1].focus()}}if(d.keyCode===Event.KEY_DOWN){Event.preventDefault(d);if(f+1===h.length){h[0].focus()}else{h[f+1].focus()}}if(d.keyCode===Event.KEY_UP){Event.preventDefault(d);if(f==0){h[h.length-1].focus()}else{h[f-1].focus()}}if(d.keyCode===Event.KEY_ESC){this.keydown(d)}if(d.keyCode===32||d.keyCode===Event.KEY_RETURN){Event.preventDefault(d);Event.sendMouseEvent(g,"click",true,true)}},focusBody:function(d){var f=this;window.setTimeout(function(){var h=document.activeElement,g=h.parentNode;if(f.currentNavEls.indexOf(h)===-1&&f.currentNavEls.indexOf(g)===-1){f.triggerKeyOpen()}})},getSurveyData:function(){return this.surveyData},surveyFeature:function(){return"Survey"},surveyEVar:function(){return"eVar5"},surveyElement:function(){var d=this.surveyData;var k=unescape(d.surveyURL);var h=window.s;function m(o){o+="=";var n=document.cookie.split(";");for(var q=0;q<n.length;q++){var r=n[q];while(r.charAt(0)===" "){r=r.substring(1,r.length)}if(r.indexOf(o)===0){return r.substring(o.length,r.length)}}return null}var f=new Date();k+=(k.indexOf("?")===-1?"?":"&")+"Pagename="+escape(h.pageName)+"&visitorID="+escape(m("s_vi"))+"&hit_time_gmt="+escape(f.toGMTString())+"&OS="+escape(h.n.oscpu);var g=document.createElement("li");Element.setInnerHTML(g,'<a target="_blank" href="'+k+'"><span>'+d.surveyButtonText+"</span></a>");Element.setStyle(g,"opacity",0);this.surveyElementId=Element.assignId(g);return g},surveyCallback:function(h){if(h){var d=$(this.surveyElementId);var g=Element.query(document.body,"#user_nav ul, #guide_wrap ul");if(g){if(!(this.surveyElementId&&d)){var f=g.getElementsByTagName("li")[0];f.parentNode.insertBefore(h,f);d=$(this.surveyElementId)}Element.setStyle(d,"display","inline");coherent.Animator.setStyles(d,{opacity:1});apple.metrics.fireMicroEvent({feature:"Survey",action:"displayed"})}}},surveyCallbackHide:function(f){f.alreadyShown=false;var d=$(this.surveyElementId);if(d){coherent.Animator.setStyles(d,{opacity:0},{callback:function(){Element.setStyle(d,"display","none")}})}},discardCartData:function(){this.dataLoaded=false},visibleSection:function(){return this.__visibleSection},dataFinishedLoading:function(g){var f=this,d=this.cartList.innerHTML;if(d===""){this.cartList.innerHTML="<li></li>"}else{var h=this.cartList.children[0];if(h.innerHTML===""){this.cartList.removeChild(h)}}Element.removeClassName($("utility-nav-loading"),"open");this.removeAriaAlert();this.setValueForKey(true,"dataLoaded");Element.addClassName($("unav-cart"),"open");window.setTimeout(function(){if(f.currentNavEls&&f.popupMenuEvents){f.currentNavEls.forEach(function(k){Event.observe(k,"keydown",f.focusNavEls.bindAsEventListener(f));Event.observe(k,"blur",f.focusBody.bindAsEventListener(f));k.setAttribute("role","menuitem")})}})},setVisibleSection:function(g){var h;var m;var f=this.__visibleSection;if(f&&!!(h=$(f))&&h){Element.removeClassName(h,"open");m=h.id;if(m==="u_account"){Element.removeClassName($("unav-account"),"open")}else{if(m==="u_cart"){Element.removeClassName($("utility-nav-loading"),"open");Element.removeClassName($("unav-cart"),"open")}}}if(g&&!!(h=$(g))&&h){Element.addClassName(h,"open");Element.addClassName($("utility-nav"),"open");m=h.id;if(m==="u_account"){Element.addClassName($("unav-account"),"open")}else{if(m==="u_cart"&&this.dataLoaded){Element.addClassName($("unav-cart"),"open")}}}if(g&&!this.dataLoaded&&g==="u_cart"){Element.addClassName($("utility-nav-loading"),"open");this.createAriaAlert(document.createTextNode(Element.query("#utility-nav-loading .replaced").innerHTML||"Loading ..."));var k=this.data.refresh();k.addCallback(this.dataFinishedLoading.bind(this));k.addCallback(this.keyboardNavDataLoadCallback.bind(this))}if(!g){Element.removeClassName($("utility-nav"),"open")}this.__visibleSection=g},mouseoutHandler:function(d){var g=d.toElement||d.relatedTarget||d.target,h=this.__visibleSection,f;if(h==="u_cart"){f=Element.query("#unav-cart")}else{if(h==="u_account"){f=Element.query("#unav-account")}}while(this.currentNavEls&&g&&g!==document.body){if(g&&(g===f||this.currentNavEls.indexOf(g)!==-1||this.currentNavEls.indexOf(g.parentNode)!==-1)){break}g=g.parentNode}if(!this.currentNavEls&&!coherent.Browser.MobileSafari&&!coherent.Browser.Chrome){while(g&&g!==document.body){if(g&&g.id===h){break}g=g.parentNode}}else{if(coherent.Browser.MobileSafari||coherent.Browser.Chrome){while(g&&g!==f){if(g&&g.id===h){break}g=g.parentNode;if(g===document.body){break}}}}if(g===document.body){this.popupMenuEvents=false;this.closeMenu(d)}},accountVisible:function(){return"u_account"===this.__visibleSection},cartVisible:function(){return this.dataLoaded&&"u_cart"===this.__visibleSection},fireEvent:function(d){d=d||{action:"unknown"};d.eVar=this.OMNITURE_PROPERTY_NAME;d.page=s.pageName;d.feature=this.OMNITURE_FEATURE_NAME;apple.metrics.fireMicroEvent(d)},data:DeferredJSON(),account:DeferredJSON(),unsupportedCheckoutCheck:function(f){var d=this.valueForKeyPath("data.cart.unsupportedMessage");if(d){Event.stop(f);alert(d)}},onclicked:function(k){if(k.id!==this.visibleSection()){var d=Element.queryAll(".search-auto-complete");if(d&&d[0]){Element.setStyle(d[0],"display","none")}if(coherent.Browser.MobileSafari){return}var m="";if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}function g(){this.__timer=null;this.setValueForKey(m,"visibleSection")}function f(){this.__timer=null;this.lockedToNav=false;this.menuLink=undefined;this.setValueForKey(null,"visibleSection")}switch(k.id){case"u_account":this.fireEvent({action:"Account"});case"unav-account":m="u_account";break;case"u_cart":this.fireEvent({action:"Cart"});case"utility-nav-loading":case"unav-cart":m="u_cart";break;default:}if(m===this.visibleSection()){this.__timer=f.bindAndDelay(this,150)}else{if(m){this.__timer=g.bindAndDelay(this,150)}}var h=this;this.popupMenuEvents=true;if(this.currentNavEls){this.currentNavEls.forEach(function(n){Event.observe(n,"keydown",h.focusNavEls.bindAsEventListener(h));Event.observe(n,"blur",h.focusBody.bindAsEventListener(h));n.setAttribute("role","menuitem")})}this.hoverNodeId=k.id}},onmouseenter:function(d){this.hoverNodeId=d.id;if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}},onmouseleave:function(f){if(f.id!==this.hoverNodeId){return}if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}function d(){this.__timer=null;this.lockedToNav=false;this.menuLink=undefined;this.setValueForKey(null,"visibleSection")}this.__timer=d.bindAndDelay(this,3000);this.hoverNodeId=""},}),a;function c(){if(!a){if(arguments.length>0){a=(b.apply(a,arguments))()}}return a}apple.utilitynav.UtilityNavViewController=b;apple.utilitynav.UtilityNavViewController.singleton=c})();Package("apple.widget");apple.widget.CountrySelector=Class.create(coherent.View,{mouseoverDelay:150,showDuration:250,mouseoutDelay:50,hideDuration:250,contentLoaded:false,trigger:coherent.Anchor("a.trigger",{action:"show"}),triggeredByKeyboard:false,potentialTriggeredByKeyboard:false,init:function(){this.getPreviousAndNextSiblings();var a=Element.query(".country-selector");if(a){var b=Element.assignId(a);this.viewElement().appendChild(a);this.countrySelector=new coherent.View(b)}this.positionCountrySelector();Event.observe(this.previousFocussableElement,"focus",this.hide.bind(this));Event.observe(this.nextFocussableElement,"focus",this.hide.bind(this));Event.observe(this.viewElement(),"mouseover",this.mouseover.bind(this));Event.observe(this.viewElement(),"mouseout",this.mouseout.bind(this));Event.observe(this.countrySelector.viewElement(),"click",this.selectCountry.bind(this));Event.observe(this.trigger.viewElement(),"focus",this.focusTriggeredByKeyboard.bind(this));Event.observe(this.trigger.viewElement(),"blur",this.blurTriggeredByKeyboard.bind(this));this.preloadCountrySelectorSprite.bindAndDelay(this,3000);this._touchstart=this.touchstart.bind(this);this.keyDownObserver=this.observeKeyDown.bind(this);if(this.countrySelector.viewElement().innerHTML.trim().length>0){this.contentLoaded=true}this.trigger.viewElement().setAttribute("aria-haspopup","true");this.trigger.viewElement().setAttribute("aria-owns","change-country-list");this.countrySelector.viewElement().setAttribute("aria-hidden","true");this.listOfCountries=Element.queryAll(".country-selector a");this.listOfCountriesLength=this.listOfCountries.length;this.lastCountryLink=this.listOfCountries[this.listOfCountriesLength-1];this.firstCountryLink=this.listOfCountries[0]},getPreviousAndNextSiblings:function(){var c=this.trigger.viewElement();var d=Element.queryAll(".apple-footer a");for(var b=0,a=d.length;b<a;b++){if(d[b]==c){this.previousFocussableElement=d[b-1];this.nextFocussableElement=d[b+1];return}}},positionCountrySelector:function(){var f=119;var d=this.trigger.viewElement().offsetWidth;var b=this.viewElement().previousSibling;while(b.nodeType!=1){b=b.previousSibling}var a=b.getElementsByTagName("a")[0].offsetWidth;var c=Math.round(d/2)+a-f;this.countrySelector.viewElement().style.left=c+"px"},preloadCountrySelectorSprite:function(){var a=this.trigger.viewElement();Element.addClassName(a,"preload-country-selector-sprite")},mouseover:function(){if(coherent.Browser.MobileSafari){return}this.showTimer=this.show.bindAndDelay(this,this.mouseoverDelay);if(this.hideTimer){window.clearTimeout(this.hideTimer);this.hideTimer=null}},mouseout:function(){if(coherent.Browser.MobileSafari){return}this.hideTimer=this.hide.bindAndDelay(this,this.mouseoutDelay);if(this.showTimer){window.clearTimeout(this.showTimer);this.showTimer=null}},touchstart:function(c){var a=Element.query(".apple-footer .country-selector");if(a.style.display=="block"){var b=c.target;do{if(b&&b===Element.query(".country-selector")){return}b=b.parentNode}while(b&&b!==document.body);this.hide()}},show:function(){this.countrySelector.viewElement().style.display="block";coherent.Animator.setStyles(this.countrySelector.viewElement(),{opacity:1},{duration:this.showDuration});this.enableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","false");if(this.potentialTriggeredByKeyboard===true){this.triggeredByKeyboard=true;this.firstCountryLink.focus()}},hide:function(){var a=this.countrySelector.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:this.hideDuration,callback:function(){a.style.display="none"}});if(this.triggeredByKeyboard){this.triggeredByKeyboard=false}this.disableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","true")},focusTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=true},blurTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=false},enableCloseObservers:function(){Event.observe(document.body,"keydown",this.keyDownObserver);Event.observe(document.body,"touchstart",this._touchstart)},disableCloseObservers:function(){Event.stopObserving(document.body,"keydown",this.keyDownObserver);Event.stopObserving(document.body,"touchstart",this._touchstart)},observeKeyDown:function(b){var f=b.keyCode||b.which,a=b.shiftKey,c=Element.query("a.trigger"),d=b.target||b.srcElement;if(f==Event.KEY_ESC){this.hide();c.focus();if(d===c){this.triggeredByKeyboard=true}}if(f==Event.KEY_TAB&&d===this.firstCountryLink&&a===true){Event.stop(b);this.lastCountryLink.focus()}if(f==Event.KEY_TAB&&d===this.lastCountryLink&&a===false){Event.stop(b);this.firstCountryLink.focus()}},selectCountry:function(a){Event.stop(a);var b=a.target||a.srcElement;if(b.nodeName==="A"){this.country=b;this.reportEvent();this.redirect.bindAndDelay(this,500)}},reportEvent:function(){apple.metrics.fireMicroEvent({feature:"Country",action:"Selected: "+this.country.title})},redirect:function(){window.location=this.country.href}});Package("apple.widget");apple.widget.FooterView=Class.create(coherent.View,{mouseoverDelay:150,showDuration:250,mouseoutDelay:50,hideDuration:250,triggeredByKeyboard:false,potentialTriggeredByKeyboard:false,countrySelector:coherent.View(".country-selector"),countryListItem:coherent.View("#change-country"),formatCookie:"platformPref=",__structure__:{"#mobile":coherent.Anchor({action:"handleFormatSwitch"}),"#format-switcher":coherent.View({visibleBinding:"showSwitcher"})},trigger:coherent.Anchor("a.trigger",{action:"show"}),init:function(){if(this.countrySelector!==null){this.initCountrySelector()}this.displayFormatSwitcher()},getPreviousAndNextSiblings:function(){var c=this.trigger.viewElement();var d=Element.queryAll(".apple-footer a");for(var b=0,a=d.length;b<a;b++){if(d[b]==c){this.previousFocussableElement=d[b-1];this.nextFocussableElement=d[b+1];return}}},initCountrySelector:function(){this.getPreviousAndNextSiblings();var a=Element.query(".country-selector");this.countryListItem.viewElement().appendChild(a);this.positionCountrySelector();Event.observe(this.previousFocussableElement,"focus",this.hide.bind(this));Event.observe(this.nextFocussableElement,"focus",this.hide.bind(this));Event.observe(this.countryListItem.viewElement(),"mouseover",this.mouseover.bind(this));Event.observe(this.countryListItem.viewElement(),"mouseout",this.mouseout.bind(this));Event.observe(document.body,"click",this.hide.bindAsEventListener(this));Event.observe(this.countrySelector.viewElement(),"click",this.selectCountry.bind(this));Event.observe(this.trigger.viewElement(),"focus",this.focusTriggeredByKeyboard.bind(this));Event.observe(this.trigger.viewElement(),"blur",this.blurTriggeredByKeyboard.bind(this));this.preloadCountrySelectorSprite.bindAndDelay(this,3000);this._touchstart=this.touchstart.bind(this);this.trigger.viewElement().setAttribute("aria-haspopup","true");this.trigger.viewElement().setAttribute("aria-owns","change-country-list");this.countrySelector.viewElement().setAttribute("aria-hidden","true");this.listOfCountries=Element.queryAll(".country-selector a");this.listOfCountriesLength=this.listOfCountries.length;this.lastCountryLink=this.listOfCountries[this.listOfCountriesLength-1];this.firstCountryLink=this.listOfCountries[0]},positionCountrySelector:function(){var f=119;var d=this.trigger.viewElement().offsetWidth;var b=this.countryListItem.viewElement().previousSibling;while(b.nodeType!=1){b=b.previousSibling}var a=b.getElementsByTagName("a")[0].offsetWidth;var c=Math.round(d/2)+a-f;this.countrySelector.viewElement().style.left=c+"px"},preloadCountrySelectorSprite:function(){var a=this.trigger.viewElement();Element.addClassName(a,"preload-country-selector-sprite")},mouseover:function(){if(coherent.Browser.MobileSafari){return}this.showTimer=this.show.bindAndDelay(this,this.mouseoverDelay);if(this.hideTimer){window.clearTimeout(this.hideTimer);this.hideTimer=null}},mouseout:function(){if(coherent.Browser.MobileSafari){return}this.hideTimer=this.hide.bindAndDelay(this,this.mouseoutDelay);if(this.showTimer){window.clearTimeout(this.showTimer);this.showTimer=null}},touchstart:function(c){var a=Element.query(".apple-footer .country-selector");if(a.style.display=="block"){var b=c.target;do{if(b&&b===Element.query(".country-selector")){return}b=b.parentNode}while(b&&b!==document.body);this.hide()}},show:function(){this.countrySelector.viewElement().style.display="block";coherent.Animator.setStyles(this.countrySelector.viewElement(),{opacity:1},{duration:this.showDuration});this.enableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","false");if(this.potentialTriggeredByKeyboard===true){this.triggeredByKeyboard=true;this.firstCountryLink.focus()}},hide:function(b){var c=b?(b.target||b.srcElement):undefined;if(c&&c===this.countrySelector.viewElement()||c===this.trigger.viewElement()){return}var a=this.countrySelector.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:this.hideDuration,callback:function(){a.style.display="none"}});if(this.triggeredByKeyboard){this.triggeredByKeyboard=false}this.disableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","true")},focusTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=true},blurTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=false},enableCloseObservers:function(){Event.observe(document.body,"keydown",this.observeKeyDown.bindAsEventListener(this));Event.observe(document.body,"touchstart",this._touchstart)},disableCloseObservers:function(){Event.stopObserving(document.body,"keydown",this.observeKeyDown.bindAsEventListener(this));Event.stopObserving(document.body,"touchstart",this._touchstart)},observeKeyDown:function(b){var f=b.keyCode,a=b.shiftKey,c=Element.query("a.trigger"),d=b.target||b.srcElement;if(f==Event.KEY_ESC){this.hide();c.focus();if(d===c){this.triggeredByKeyboard=true}}if(f==Event.KEY_TAB&&d===this.firstCountryLink&&a===true){Event.stop(b);this.lastCountryLink.focus()}if(f==Event.KEY_TAB&&d===this.lastCountryLink&&a===false){Event.stop(b);this.firstCountryLink.focus()}},selectCountry:function(a){Event.stop(a);var b=a.target||a.srcElement;if(b.nodeName==="A"){this.country=b;this.reportEvent();this.redirect.bindAndDelay(this,500)}},reportEvent:function(){apple.metrics.fireMicroEvent({feature:"Country",action:"Selected: "+this.country.title})},redirect:function(){window.location=this.country.href},handleFormatSwitch:function(a){this.fireFormatChangeEvent(a);(function(){this.deleteFormatCookie(a)}).bindAndDelay(this,500)},fireFormatChangeEvent:function(c){var a=c&&c.viewElement();if(a&&a.hasAttribute("data-sprop36")){var d=a.getAttribute("data-sprop36");var b=apple.metrics._stringToEvent(d);b.eVar="prop36";b.excludeAosNamespace=true;apple.metrics.fireMicroEvent(b)}},deleteFormatCookie:function(a){var b=new Date();b.setDate(b.getDate()-1);document.cookie=this.formatCookie+"''; expires="+b.toUTCString()+"; path=/; domain=.apple.com";window.location.reload()},displayFormatSwitcher:function(){if(document.cookie.match(this.formatCookie)||Element.query(this.viewElement(),".format-switcher-show")){this.setValueForKey(true,"showSwitcher")}else{this.setValueForKey(false,"showSwitcher")}}});window.apple.survey={alreadyShown:false,defaults:{trafficPercentage:15,surveyDelay:0},surveyButton:function(c){var a=c.getSurveyData();if(!a){return false}if(!a.cartValue||(!$("sidebar-summary-total")&&!$("cart-summary-order-total"))){this.surveyButtonBuild(c)}else{var b=Element.hasClassName(document.getElementsByTagName("body")[0],"checkout");var f=Element.hasClassName(document.getElementsByTagName("body")[0],"thankyou");function d(){if((b&&!f)||($("sidebar-summary-total")&&coherent.View.fromNode($("sidebar-summary-total"))&&$("sidebar-summary-total").innerHTML!=="")||($("cart-summary-order-total")&&coherent.View.fromNode($("cart-summary-order-total"))&&$("cart-summary-order-total").innerHTML!=="")){if(window.controller){window.controller.addObserverForKeyPath(window.apple.survey,null,"content.cart.summary.total",c)}window.apple.survey.surveyButtonBuild(c)}else{window.setTimeout(d,50)}}d()}return true},observeChangeForKeyPath:function(b,c,a){this.surveyButtonBuild(a)},surveyButtonBuild:function(c){var o=c.getSurveyData();var C=new Storage();var b=new Date();var B=C.get("csat_last_surveyed_date");if(B){B=new Date(B);var a=180*1000*60*60*24;if(Math.ceil((b.getTime()-B.getTime())/a)>=1){c.surveyCallbackHide(this);return false}}var r=new Date(o.startDate);var g=new Date(o.endDate);if(b<r||b>g){c.surveyCallbackHide(this);return false}var u=o.surveyStart.split(":");var D=o.surveyEnd.split(":");var f=b.getHours();var H=b.getMinutes();if(f<u[0]||f>D[0]){c.surveyCallbackHide(this);return false}if((f==u[0])&&(H<u[1]||H>D[1])){c.surveyCallbackHide(this);return false}var q=["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"];var E=q[b.getDay()];var h={};for(var z=0,x=o.activeDays.length;z<x;z++){h[o.activeDays[z]]=""}if(!E in h){c.surveyCallbackHide(this);return false}if(o.operatingSystem.length){var m="windows";if(navigator.appVersion.indexOf("Mac")!=-1){m="macosx"}if(navigator.appVersion.indexOf("X11")!=-1){m="linux"}if(navigator.appVersion.indexOf("Linux")!=-1){m="linux"}if(navigator.appVersion.indexOf("SunOS")!=-1){m="sunos"}var G={};for(z=0,x=o.operatingSystem.length;z<x;z++){G[o.operatingSystem[z]]=""}if(!m in G){c.surveyCallbackHide(this);return false}}var t;if(o.trafficPercentage){t=parseInt(o.trafficPercentage,10)}else{t=window.apple.survey.defaults.trafficPercentage}var k=Math.ceil(Math.random()*100);if(k>t&&!this.alreadyShown){c.surveyCallbackHide(this);return false}if(o.referrer){if(document.referrer.indexOf(o.referrer)===-1){c.surveyCallbackHide(this);return false}}var n;var v=Element.hasClassName(document.getElementsByTagName("body")[0],"checkout");var w=Element.hasClassName(document.getElementsByTagName("body")[0],"thankyou");var A=Element.hasClassName(document.getElementsByTagName("body")[0],"cart");if(o.cartValue&&o.cartActualValue){n=parseFloat(o.cartActualValue.replace(/[^\d.]/g,""));if(parseFloat(o.cartValue)>n){c.surveyCallbackHide(this);return false}}else{if(o.cartValue&&(v||w||A)){n=parseFloat(window.controller.valueForKeyPath("content.cart.summary.total").replace(/[^\d.]/g,""));if(parseFloat(o.cartValue)>n){c.surveyCallbackHide(this);return false}}}function F(){var I=window.s;var J;if(c.surveyElementId&&$(c.surveyElementId)){J=$(c.surveyElementId)}else{J=c.surveyElement();Event.observe(J.getElementsByTagName("a")[0],"click",function(){y(c)})}return J}function y(I){apple.metrics.fireMicroEvent({eVar:I.surveyEVar(),feature:I.surveyFeature(),action:"selected"});C.set("csat_last_surveyed_date",b);I.surveyCallbackHide(this)}var d;if(o.timeSpentOnPage){d=1000*o.timeSpentOnPage}else{d=window.apple.survey.defaults.surveyDelay}window.setTimeout(function(){c.surveyCallback(F(c))},d);this.alreadyShown=true;return true}};coherent.DynamicMenu=Class.create(coherent.View,{exposedBindings:["model"],init:function(){this.addObserverForKeyPath(this,this.updateState,"model.open")},updateState:function(b){var a=this.valueForKeyPath("model.open");if(a){this.openMenu()}else{this.closeMenu()}this.setValueForKeyPath(a,"model.contentUpdated");this.setValueForKeyPath(a,"model.isOpen")},closeMenu:function(a){Element.removeClassName(this.viewElement(),"visible");if(this.model.manager){this.model.manager.clear()}},openMenu:function(c){Element.addClassName(this.viewElement(),"visible");if(this.model.contentURL&&!this.model.response){this.addObserverForKeyPath(this,this.model.contentResponse,"model.response");var b=XHR.get(this.model.contentURL);b.addMethods(this.getResponseDelegate(),this.getResponseDelegate());this.viewElement().innerHTML="<div class='spinner'></div>"}if(this.model.manager){var a=this.model.manager.getLastView();if(a){a.setValueForKeyPath(false,"model.open")}this.model.manager.setNextView(this)}},getResponseDelegate:function(){var a=this;return function(b){a.setValueForKeyPath(b,"model.response");a.setValueForKeyPath(b,"model.contentUpdated")}}});coherent.DynamicMenuManager=Class.create({lastId:null,setNextView:function(a){this.lastId=a.viewElement().id},clear:function(){this.lastId=null},getLastId:function(){return this.lastId},getLastElem:function(){return $(this.getLastId())},getLastView:function(){if(this.getLastElem()){return coherent.View.fromNode(this.getLastElem())}}});coherent.CompoundLink=Class.create(coherent.View,{exposedBindings:["menuModel"],__structure__:{".dynamic-menu":coherent.DynamicMenu({modelBinding:"*.menuModel"}),"a[target!=_blank]":coherent.Anchor({action:"resetMenu"}),".handle a":coherent.Anchor({action:"click"})},init:function(){Event.observe(this.viewElement(),"mouseover",this.viewOver.bindAsEventListener(this));Event.observe(this.viewElement(),"mouseout",this.viewOut.bindAsEventListener(this))},getMenu:function(){return Element.query(this.viewElement(),".dynamic-menu")},viewOver:function(){window.clearTimeout(this.valueForKey("viewOverTimeout"))},viewOut:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open")},250);this.setValueForKey(b,"viewOverTimeout")},click:function(b,a){Event.stop(a);if(this.valueForKeyPath("menuModel.open")){this.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}else{this.setValueForKeyPath(true,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":2000})}},resetMenu:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(a.viewElement(),{"z-index":"auto"})},350);this.setValueForKey(b,"viewOverTimeout");this.setValueForKeyPath(false,"handleDown")}});coherent.CompoundButton=Class.create(coherent.View,{exposedBindings:["menuModel","name","value","menuEnabled"],__structure__:{".dynamic-menu":coherent.DynamicMenu({modelBinding:"*.menuModel"})},getPrimaryButton:Part(".button"),getPrimaryButtonLabel:Part(".button .label"),getHandle:Part(".handle"),getAccount:Part(".button.active.init.account"),getPreSignBtn:Part(".button.active.init.alt"),getMenu:Part(".dynamic-menu"),init:function(){if(this.getHandle()){coherent.page.addTrackingInfo(this.viewElement().id,{owner:this,onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave});this.addObserverForKeyPath(this,this.updateHandle,"menuModel.open");this.addObserverForKeyPath(this,this.reposition,"menuModel.contentUpdated");this.addObserverForKeyPath(this,this.updateHandle,"handleDown");Element.addClassName(this.viewElement(),"init");Element.addClassName(this.getPrimaryButton(),"init");Element.addClassName(this.getHandle(),"init");var a=this.getHandle(),b=this.getMenu();if(a){a.setAttribute("aria-haspopup","true");a.setAttribute("aria-owns",b.id)}if(b){b.setAttribute("role","menu");b.setAttribute("aria-hidden","true")}window.setTimeout(this.initButtonHandlers.bind(this),0);Event.observe(document.body,"keyup",this.onblurMenu.bindAsEventListener(this));Event.observe(document.body,"click",this.closeMenu.bindAsEventListener(this));Event.observe(document.body,"ontouchstart",this.documentTouch.bindAsEventListener(this));if(a){Event.observe(a,"keydown",this.keydownHandle.bindAsEventListener(this,false));Event.observe(a,"click",this.clickHandle.bindAsEventListener(this));Event.observe(a,"mousedown",this.mousedownHandle.bindAsEventListener(this));Event.observe(a,"beforeactivate",this.beforeactivateHandle.bindAsEventListener(this));Event.observe(a,"ontouchstart",this.clickHandle.bindAsEventListener(this))}if(this.getAccount()!=null){Event.observe(this.getAccount(),"click",this.clickHandle.bindAsEventListener(this))}if(this.getPreSignBtn()!=null){Event.observe(this.getPreSignBtn(),"click",this.clickHandle.bindAsEventListener(this))}}},canToggleMenu:true,currentlySelectedMenuItem:0,existingMenuListener:false,preventIE8Focus:false,initButtonHandlers:function(){var b=this.getHandle(),c=this.getMenu(),d=Element.queryAll(c,"li"),a=this.viewElement();this.menuItems=Element.findFocusables(c,false);this.menuItems=this.menuItems.filter(function(f){var g=Element.locateAncestor(f,function(h){return h.nodeName.toLowerCase()==="li"},a);return g?g.style.display!=="none":true});this.menuItems.forEach(function(f){f.setAttribute("role","menuitem");if(f.nodeName=="A"){Event.observe(f,"keydown",this.followLink.bindAsEventListener(this))}},this);d.forEach(function(f){f.setAttribute("role","presentation")})},observeHtmlChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButtonLabel().innerHTML=c.newValue}},observeValueChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButton().attributes.value.nodeValue=c.newValue}},observeNameChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButton().name=c.newValue}},observeMenuEnabledChange:function(d,c,b){if(d.newValue!==null){var a=(this.canToggleMenu=d.newValue)?Element.addClassName:Element.removeClassName;a(this.viewElement(),coherent.CompoundButton.compoundBtnClassName);this.viewElement().parentNode.className+=""}},resetMenu:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(a.viewElement(),{"z-index":"auto"})},350)},updateHandle:function(a){if(this.getHandle()){if(this.valueForKeyPath("menuModel.open")||this.valueForKeyPath("handleDown")){Element.addClassName(this.getHandle(),"hover")}else{Element.removeClassName(this.getHandle(),"hover");Element.removeClassName(this.getHandle(),"clicked")}}},clickHandle:function(a){var b=this;this.preventIE8Focus=false;Event.stop(a);window.setTimeout(function(){if(document.activeElement===b.getHandle()){b.keydownHandle(a,true)}else{b.toggleMenuState()}},0)},mousedownHandle:function(a){Event.stop(a);this.preventIE8Focus=true},beforeactivateHandle:function(a){if(this.preventIE8Focus){Event.stop(a)}},toggleMenuState:function(){var a=this.__relativeSource;if(a.valueForKeyPath("menuModel.open")){this.getMenu().setAttribute("aria-hidden","true");a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}else{this.getMenu().setAttribute("aria-hidden","false");a.setValueForKeyPath(true,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":20000});Element.addClassName(this.getHandle(),"clicked")}},closeMenu:function(a){if(this.__relativeSource.valueForKeyPath("menuModel.open")){this.getMenu().setAttribute("aria-hidden","true");this.__relativeSource.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}},documentTouch:function(a){if(this.menuItems.indexOf(a.target)==-1){this.closeMenu(a)}},keydownHandle:function(b,a){if(a||b.keyCode===Event.KEY_DOWN||b.keyCode===32||b.keyCode===Event.KEY_UP){if(!a){Event.stop(b)}this.toggleMenuState();if(!this.existingMenuListener){Event.observe(this.getMenu(),"keydown",this.keydownMenu.bindAsEventListener(this,this.menuItems));this.existingMenuListener=true}this.menuItems[0].focus()}},keydownMenu:function(a){if(a.keyCode===Event.KEY_ESC){Event.preventDefault(a);this.closeMenu(a);this.currentlySelectedMenuItem=0;this.getHandle().focus()}if(a.keyCode===Event.KEY_DOWN){Event.preventDefault(a);if(this.currentlySelectedMenuItem<this.menuItems.length-1){this.currentlySelectedMenuItem+=1}else{this.currentlySelectedMenuItem=0}this.menuItems[this.currentlySelectedMenuItem].focus()}if(a.keyCode===Event.KEY_UP){Event.preventDefault(a);if(this.currentlySelectedMenuItem>0){this.currentlySelectedMenuItem-=1}else{this.currentlySelectedMenuItem=this.menuItems.length-1}this.menuItems[this.currentlySelectedMenuItem].focus()}},onblurMenu:function(a){var b=this;if(a.keyCode===Event.KEY_TAB){if(b.menuItems.indexOf(document.activeElement)==-1){b.closeMenu(a)}}},followLink:function(a){if(a.keyCode===32){Event.preventDefault(a);Event.sendMouseEvent(a.target||a.srcElement,"click",true,true)}},reposition:function(h){if(h.newValue){Element.setStyles(this.getMenu(),{width:"auto",right:0,left:"auto"});var b=Element.getRect(this.getPrimaryButton());var a=Element.getRect(this.getHandle());var g=Element.getRect(this.getMenu());var f=b.width;var c=a.height;if(!Element.hasClassName(document.body,"ns")){c+=1}var d=g.left;Element.setStyles(this.getMenu(),{width:(g.width>f?g.width:f)+"px",top:c+"px",right:(d<0?"auto":0),left:(d<0?0:"auto")})}},findFormFromElement:function(b){var a=b.parentElement||b.parentNode;if(a.tagName=="FORM"){return a}else{return this.findFormFromElement(a)}},teardown:function(){var b=this.getHandle();if(b){Event.stopObserving(b,"keydown",this.keydownHandle.bindAsEventListener(this,false));Event.stopObserving(b,"click",this.clickHandle.bindAsEventListener(this));Event.stopObserving(b,"mousedown",this.mousedownHandle.bindAsEventListener(this));Event.stopObserving(b,"beforeactivate",this.beforeactivateHandle.bindAsEventListener(this));Event.stopObserving(b,"ontouchstart",this.clickHandle.bindAsEventListener(this))}Event.stopObserving(document.body,"keydown",this.onblurMenu.bindAsEventListener(this));Event.stopObserving(document.body,"click",this.closeMenu.bindAsEventListener(this));Event.stopObserving(document.body,"ontouchstart",this.documentTouch.bindAsEventListener(this));if(this.getAccount()!=null){Event.stopObserving(this.getAccount(),"click",this.clickHandle.bindAsEventListener(this))}if(this.getPreSignBtn()!=null){Event.stopObserving(this.getPreSignBtn(),"click",this.clickHandle.bindAsEventListener(this))}if(this.menuItems&&this.existingMenuListener){this.existingMenuListener=false;this.menuItems.forEach(function(d){if(d.nodeName=="A"){Event.stopObserving(d,"keydown",this.followLink(this))}},this)}var c=b&&coherent.View.fromNode(this.getHandle());c&&c.teardown();var a=this.getMenu()&&coherent.View.fromNode(this.getMenu());a&&a.teardown();this.base()}});coherent.CompoundButton.compoundBtnClassName="compound-button";apple.ImageSetView=Class.create(coherent.ImageSetView,{PIXEL_RATIO_COOKIE_NAME:"pxro",init:function(){var a=parseInt(apple.cookie(this.PIXEL_RATIO_COOKIE_NAME),10);if(a){this.setValueForKey(a,"pxRatio")}}});Package("apple.widget");apple.widget.EqualizeCopy=function(){var b=Element.queryAll(".equalize .copy");if(b){var a=0,c=0;b.forEach(function(d){Element.setStyle(d,"height","");c=parseInt(Element.getStyles(d,"height").replace("px",""),10);a=Math.max(a,c)});b.forEach(function(d){Element.setStyle(d,"height",a+"px")})}};apple.SocialSharingCompoundLink=Class.create(coherent.CompoundLink,{__structure__:{"a[target]":coherent.Anchor({action:"linkClicked"})},linkClicked:function(f,a){var d="";var b=new coherent.URL(document.location.href);if(b){var c=b.path.match(/(\w{5,7}\/\w)$/);if(c.length>1){d=c[1]}}apple.metrics.fireMicroEvent({eVar:"eVar6",part:d,feature:"Sharing",action:f.viewElement().className+" post"});this.resetMenu()}});apple.initSocialSharingCompoundLinks=function(){var d=new coherent.DynamicMenuManager();var a=Element.queryAll(".socialsharing");for(var c=0;c<a.length;c++){Element.queryAll(a[c],"a[target]").forEach(function(g){if(g){var h=g.href;var f=h.match(/\?vid2\=|&vid2\=/i);if(f===null){if(h.indexOf("?")>-1){h=/&$/.test(h)?h+"vid2=web":h+"&vid2=web"}else{h=h+"?vid2=web"}g.href=h}}}.bind(this));var b={menuModel:{manager:d}};new apple.SocialSharingCompoundLink(a[c],b,{menuModelBinding:"*.menuModel"})}};Event.onLoad(apple.initSocialSharingCompoundLinks);coherent.FormField=Class.create(coherent.View,{exposedBindings:["value","name"],observeValueChange:function(b){var a=this.viewElement();a.value=b.newValue},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue}});apple.AddToCartCompoundButton=Class.create(coherent.CompoundButton,{exposedBindings:["model","modes"],__structure__:{"a[target]":coherent.Anchor({action:"linkClicked"}),"button.button":coherent.FormField({nameBinding:"$modes.$model.primaryButtonMode$.name",titleBinding:"$modes.$model.primaryButtonMode$.title",classBinding:"$modes.$model.primaryButtonMode$.buttonClass"}),".handle":coherent.View({classBinding:"$modes.$model.primaryButtonMode$.handleClass",action:"click"}),"button.button .label":coherent.View({textBinding:"$modes.$model.primaryButtonMode$.html"}),".BuyNow":coherent.View({visibleBinding:"model.buyNowEnabled",enabledBinding:"model.buyNowAvailable"}),".BuyNow button":coherent.FormField({nameBinding:"$modes.$model.buyNowButtonMode$.name",titleBinding:"$modes.$model.buyNowButtonMode$.title",textBinding:"$modes.$model.buyNowButtonMode$.html",enabledBinding:"model.buyNowAvailable"}),".BuyNow-SignUp":coherent.View({visibleBinding:"model.buyNowEnabled(not)",enabledBinding:"model.buyNowAvailable"})},init:function(){this.base();var a=$("gift-checkbox");if(a){Event.observe(a,"click",this.giftStateChanged.bind(this))}},giftStateChanged:function(a){var b=a.target?a.target.checked:a.srcElement.checked;this.setValueForKeyPath(!b,"model.buyNowAvailable");if(this.model.buyNowEnabled){if(!this.model.buyNowAvailable){this.setValueForKeyPath("default","model.primaryButtonMode");this.setValueForKeyPath("buynow","model.buyNowButtonMode")}else{this.setValueForKeyPath("buynow","model.primaryButtonMode");this.setValueForKeyPath("default","model.buyNowButtonMode")}}},linkClicked:function(d,a){var b=this.findFormFromElement(d.viewElement())["product"];var c=b?b.value:"";apple.metrics.fireMicroEvent({eVar:"eVar6",part:c,feature:"Sharing",action:d.viewElement().className+" post"});this.resetMenu();if(coherent.Browser.IE&&coherent.Browser.IE==7){this.base()}}});apple.buyNowEnabled=apple.cookie("aosqbe");apple.initAddToCartCompoundButtons=function(){var q=new coherent.DynamicMenuManager();var n=Element.queryAll(".compound-button.add-to-cart");for(var g=0,d=n.length;g<d;g++){var f=coherent.View.fromNode(n[g]);if(f){f.teardown()}var b=Element.query(n[g],"button.button");var a=Element.query(n[g],"button.handle");var m=Element.query(b,".label");var r=$("gift-checkbox");var k={menuModel:{manager:q},buttonModel:{buyNowAvailable:r?!r.checked:true,buyNowEnabled:apple.buyNowEnabled?true:false,primaryButtonMode:"default"},buttonModes:{"default":{name:b.name,title:b.title,value:b.value,html:m.textContent||m.innerText,buttonClass:b?b.className:"",handleClass:a?a.className:""}}};if(apple.buyNowEnabled){var o=Element.query(n[g],".BuyNow button");if(o){k.buttonModel.buyNowButtonMode="buynow";k.buttonModes.buynow={name:o.name,title:o.title,value:o.value,html:o.textContent||o.innerText,buttonClass:"button transactional",handleClass:"handle transactional"}}if(o&&k.buttonModel.buyNowAvailable){k.buttonModel.primaryButtonMode="buynow";k.buttonModel.buyNowButtonMode="default"}}new apple.AddToCartCompoundButton(n[g],k,{modelBinding:"*.buttonModel",modesBinding:"*.buttonModes",menuModelBinding:"*.menuModel"})}var h=Element.query("#fcspro");if(h){var c=Element.query(".compound-button.add-to-cart button.button.transactional");if(c&&c.name&&c.name.match(/buy-now/i)){Event.observe(c,"click",apple.fcs.setFcsDataForQbe)}}};Event.onLoad(apple.initAddToCartCompoundButtons);typeof window.apple==="undefined"&&(window.apple={});(function(o){try{o.sessionStorage.setItem("pbCheck","1");o.sessionStorage.removeItem("pbCheck")}catch(n){return}var f=document.getElementsByTagName("script");var b=f[f.length-1];var t=b&&b.innerHTML;var c=t?JSON.parse(t):{};c.scaleFactor=1;c.offsetY=(c.offsetY||80)*c.scaleFactor;if(c.skip||o.isAppleStoreAppDisabled){return}var r="AppleStoreAppBannerViews";var g="AppleStoreAppBannerSessionViews";c.sessionViewLimit=c.sessionViewLimit||1;var m=function(x,w){this.storage=x;this.MAX_EXPIRY=w&&w.DEFAULT_EXPIRY||365};m.prototype.setItem=function(y,z,x){var w=this.storage.getItem(y);var A={value:z,timestamp:(Date.now()+(typeof x==="number"?x:this.MAX_EXPIRY)*86400000)};this.storage.setItem(y,JSON.stringify(A))};m.prototype.getItem=function(x){var w=this.storage.getItem(x);if(w){w=JSON.parse(w);if(w.timestamp>Date.now()){return w.value}else{this.storage.removeItem(x)}}return null};var u=new m(o.localStorage,{DEFAULT_EXPIRY:c.expiry});var q=new m(o.sessionStorage,{DEFAULT_EXPIRY:c.expiry});function k(y,B,x,C){this.xhr=new o.XMLHttpRequest();function A(D){if(D.target&&D.target.status===200){B(D.target)}else{x(D.target)}}function w(D){x(D.target)}this.xhr.onload=A;this.xhr.onerror=w;try{this.xhr.open(C||"GET",y,true);this.xhr.send()}catch(z){x(z)}}function h(x){var y=RegExp("(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)","img");var w=[];var z=new String(x.replace(y,function(){w.push(arguments[1]);return""}));z.scripts=w;return z}function a(F){o["mobile-banner-loaded"]=true;var B=document.getElementById("page");B&&B.setAttribute("aria-hidden","true");B.setAttribute("tabindex","-1");var w=document.createDocumentFragment();var D="ontouchstart" in o;var L=document.createElement("DIV");L.innerHTML=[,'    <div aria-label="Download the Apple Store app" id="applestoreapp" role="dialog"  ',(c.scaleFactor!==1?'style="-webkit-transform: scale(0.32)"':""),">","        <section>",F,"        </section>","    </div>",'    <div id="applestoreapp-mask">',"    </div>"].join("");w.appendChild(L);var O=L.querySelector("#applestoreapp");var P=O.querySelector("section");document.body.insertBefore(w,document.body.firstChild);var Q=O.querySelector(".app-download-modal-inside"),C="app overlay displayed",x=Q.getAttribute("data-prop36"),I=(x)?z(x):z(C);setTimeout(function(){if(Q){B.style.display="none"}},1000);function N(){L.parentNode.removeChild(L);b.parentNode.removeChild(b)}function E(R,aa,U){R.preventDefault();R.stopPropagation();var Z=document.getElementById("page");Z.style.display="";if(aa||false){var X=O.querySelector(".close"),T="app overlay close button clicked",Y=U.getAttribute("data-prop36"),V=(Y)?z(Y):z(T)}var ab=parseInt(u.getItem(r),10)||0;var S=parseInt(q.getItem(g),10)||0;u.setItem(r,ab+1);q.setItem(g,S+1);P.removeEventListener("touchstart");var W=document.body;W.removeEventListener("gesturechange");W.removeEventListener("gestureend");Z&&Z.setAttribute("aria-hidden","false");Z.removeAttribute("tabindex");O.setAttribute("aria-hidden","true");O.setAttribute("tabindex","-1");L.style.display="none"}function A(T,S){T.preventDefault();T.stopPropagation();var R=O.querySelector(".download-button"),W="app overlay download link clicked",V=S.getAttribute("data-prop36"),U=(V)?z(V):z(W);u.setItem(r,c.viewLimit);q.setItem(g,c.sessionViewLimit);E(T,false);o.setTimeout(function(){o.location.href=T.target.href},500)}function M(T){var S=T.target;var R=null;var U=null;while(S&&S!==P&&S!==document.documentElement){if(S.className){if(!!S.className.match(/close/)){U=S;break}if(!!S.className.match(/download-button/)){R=S;break}}S=S.parentNode}if(U){E(T,true,S)}if(R){A(T,S)}}function y(R){var S;if(o.pageYOffset===0){S=0}else{S=(Math.max(c.offsetY,o.pageYOffset))/c.scaleFactor}}function z(R){if(o.s){o.s.tl(true,"o","Mobile Overlay",{linkTrackVars:"prop36",prop36:R})}}if(D){P.addEventListener("touchstart",M,false);var K=document.getElementById("applestoreapp-mask");K.addEventListener("touchmove",function(R){R.preventDefault()},true)}else{P.addEventListener("mousedown",M,false);P.addEventListener("mousemove",function(R){R.preventDefault()},true)}O.className="revealed";var G=P.querySelectorAll("#apstoreurl,#apstoreurl2");if(G&&G.length){for(var J=0,H=G.length;J<H;J++){G[J].setAttribute("href",c.storeUrl)}}}function d(){new k(c.bannerNodeUrl,function(w){a(h(w.responseText))},function(w){console.log("error",w)})}function v(){c.bannerNodeUrl=c.bannerNodeUrl||o.appleStoreAppBannerNode;c.storeUrl=c.storeUrl||o.appleStoreAppUrl;if(o.appleStoreAppBannerExpiry!=undefined){c.expiry=o.appleStoreAppBannerExpiry}else{c.expiry=30}if(o.appleStoreAppBannerViewLimit!=undefined){c.viewLimit=o.appleStoreAppBannerViewLimit}else{c.viewLimit=2}if(q.getItem(g)<c.sessionViewLimit&&u.getItem(r)<c.viewLimit){if(o.isAnotherDialogOpen){o.__defineSetter__("dialog-dismissed",function(w){w&&d()})}else{d()}}}o.scrollTo(0,0);if(typeof o.apple==="undefined"){v()}else{o.apple.MobileBanner=v}})(window);Event.onDomReady(function(h){if(/#(.*)Replacement/.test(window.location.href)){if(!coherent.Browser.IE||coherent.Browser.IE>=9){window.location.hash=""}var g,d,f=Element.query("#productReplacedMessageOverlayContent"),a=Element.query("#productReplacedMessageOverlayCloseButton"),c="productReplacedMessageOverlay";if(!f){return}d=document.createElement("DIV");d.id=c;d.className="overlay";document.body.appendChild(d);g=new coherent.Overlay(c);g.setDelegate({willShowOverlay:function(){if(a){Event.observe(a,"click",g.hide.bind(g))}}});g.display({sourceId:"productReplacedMessageOverlayContent"});if(Element.query(".product-details")){function b(){var o=Element.query("#productReplacedMessageOverlay.overlay"),t=Element.query("#productReplacedMessageOverlay.overlay a"),k=Element.query("#productReplacedMessageOverlayCloseButton"),q=Element.query("#productReplacedMessageOverlayContent h2"),n=Element.query(".productReplacedMessageOverlayContentBody"),r=Element.query(".product-details #page");if(o&&t&&n&&q&&r){o.setAttribute("role","dialog");o.setAttribute("aria-hidden","false");o.appendChild(t);n.setAttribute("id","PRMOverlayContentBody");q.setAttribute("id","PRMOverlayContentHeader");o.setAttribute("aria-labelledby","PRMOverlayContentHeader");o.setAttribute("aria-describedby","PRMOverlayContentBody");r.setAttribute("aria-hidden","true");k.setAttribute("aria-describedby","productReplacedMessageOverlayContent");Event.observe(k,"click",m);Event.observe(t,"click",m);Event.observe(k,"keydown",m);Event.observe(t,"keydown",m);Event.observe(o,"keydown",function(v){u()});Event.observe(Element.query(".overlayScreen"),"click",function(v){m(v)})}function u(){Element.preventFocus(r,true);Element.queryAll(":[tabindex=0]").forEach(function(v){v.setAttribute("data-tabindex",v.getAttribute("tabindex"));v.setAttribute("tabindex","-1")})}function m(v){if(v.type=="click"||(v.type=="keydown"&&(v.keyCode=="13"||v.keyCode=="32"||v.keyCode=="27"))){r.removeAttribute("aria-hidden");Element.restoreFocus(r,true)}}}b()}}});Package("apple.fcs");function supportsLocalStorage(){try{return window.localStorage}catch(a){return false}}function getDataFromCookie(b){var d=document.cookie.split(";");for(var c=0;d.length>c;c++){var a=d[c].substr(0,d[c].indexOf("="));var f=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a===b){return decodeURIComponent(f)}}}function getReferrerDomain(){var c=document.referrer;if(!(typeof c==="undefined")){var b=c.split("/");if(b!=null&&b.length>=3){var a=b[2]}return a}return" "}function updateFcsData(a,b){if(typeof a==="string"&&a==="AC"){return true}return b}apple.fcs.setFcsDataForQbe=function(){try{var b=document.getElementsByName("fcs1")[0];if(b&&b.value===""){b.value=localStorage.getItem("fcs1")}else{b.value=decodeURIComponent(b.value)}localStorage.removeItem("fcs1")}catch(c){}try{var a=document.getElementsByName("fcs2")[0];if(a&&a.value===""){a.value=localStorage.getItem("fcs2")}else{a.value=decodeURIComponent(a.value)}localStorage.removeItem("fcs2")}catch(c){}};apple.fcs.storeFcsData=function(){this.localStorageKey="fcs1";this.localStorageCounterKey="fcs2";if(supportsLocalStorage()){var a=localStorage.getItem(this.localStorageKey);if(a==null){data={RD:getReferrerDomain(),LPU:document.URL,AC:false,SST:Math.round(new Date().getTime()/1000)};localStorage.setItem(this.localStorageKey,JSON.stringify(data));localStorage.setItem(this.localStorageCounterKey,1)}else{var b=localStorage.getItem(this.localStorageCounterKey);localStorage.setItem(this.localStorageCounterKey,++b)}}};apple.fcs.appendFcsData=function(a){var f=a;var b=/\?/ig;var d=a.match(b);try{if(typeof(localStorage.getItem("fcs1"))!=="undefined"&&localStorage.getItem("fcs1")!==null){if(d){f=f+"&f1="+encodeURIComponent(localStorage.getItem("fcs1"))}else{f=f+"?f1="+encodeURIComponent(localStorage.getItem("fcs1"))}}if(typeof(localStorage.getItem("fcs2"))!=="undefined"&&localStorage.getItem("fcs2")!==null){if(f.match(b)){f=f+"&f2="+encodeURIComponent(localStorage.getItem("fcs2"))}else{f=f+"?f2="+encodeURIComponent(localStorage.getItem("fcs2"))}}return f}catch(c){return a}};apple.fcs.flushFcsData=function(){localStorage.removeItem("fcs1");localStorage.removeItem("fcs2")};apple.fcs.setAcceptCookie=function(){try{var a=localStorage.getItem("fcs1");if(typeof(a)!="undefined"&&a!=null){localStorage.setItem("fcs1",JSON.stringify(JSON.parse(a,updateFcsData)))}}catch(b){}};Package("apple");apple.PagelevelFeedbackViewController=Class.create(coherent.ViewController,{loadingClassName:"plf-loading",closingClassName:"plf-closing",showingMessageClassName:"plf-showing-message",showingDataClassName:"plf-showing-data",questionWidgets:[],isDataLoaded:false,AJAXResponse:"",isKeyboardUser:false,isFormButtonInAction:false,defaultDesktopDrawerHeight:199,defaultHandheldDrawerHeight:500,transition:(function(){var a=(function(){var d=document.createElement("trans"),c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"};for(var b in c){if(d.style[b]!==undefined){return c[b]}}}());return a&&{end:a}})(),animate:function(h,f,d){if(!this.transition){coherent.Animator.setStyles.apply(h,arguments);return}var d=Object.applyDefaults(d,{duration:500,curve:"ease-in"}),b=["Webkit","O","Moz","ms"],a=function(o,m){if(m in o){return m}var q=m.charAt(0).toUpperCase()+m.slice(1),k=m,n=b.length;while(n--){m=b[n]+q;if(m in o){return m}}return k},g=function(o,n){for(var m in n){var k=a(o.style,m);o.style[k]=n[m]}},c=function(k){h.removeEventListener(this.transition.end,c,true);d.callback()}.bind(this);g(h,f);if(coherent.typeOf(d.callback)==="function"){h.addEventListener(this.transition.end,c,true)}},init:function(){var a=this.viewElement();this.plfMsg=Element.query(a,".plf-msg");this.plfForm=Element.query(a,".plf-form");this.plfIntro=Element.query(a,".plf-intro");this.plfDrawer=Element.query(a,".plf-drawer");this.plfOpenBtn=Element.query(a,".plf-open-btn");this.plfCancelBtn=Element.query(a,".button.cancel");this.plfSubmitBtn=Element.query(a,".button[type=submit]");this.disableFormElements(true);this.plfDrawer.setAttribute("tabindex",-1);this.plfOpenBtn.setAttribute("aria-owns",Element.assignId(this.plfDrawer));Event.observe(this.plfIntro,"keydown",this.formKeydownHandler.bindAsEventListener(this));Event.observe(this.plfOpenBtn,"click",this.openButtonClickHandler.bindAsEventListener(this));Event.observe(this.plfCancelBtn,"click",this.cancelButtonClickHandler.bindAsEventListener(this));Event.observe(this.plfSubmitBtn,"click",this.submitButtonClickHandler.bindAsEventListener(this))},openButtonClickHandler:function(a){Event.stop(a);this.fireMetricsEvent({action:"Open"});if(this.isFormButtonInAction){return false}this.isFormButtonInAction=true;this.openDrawer();this.isFormButtonInAction=false},cancelButtonClickHandler:function(a){Event.stop(a);this.fireMetricsEvent({action:"Cancel"});if(this.isFormButtonInAction){return false}this.isFormButtonInAction=true;this.closeDrawer();this.isFormButtonInAction=false},submitButtonClickHandler:function(a){Event.stop(a);this.fireMetricsEvent({action:"Submit"});if(this.isFormButtonInAction){return false}this.isFormButtonInAction=true;this.submitDrawer();this.isFormButtonInAction=false},formKeydownHandler:function(a){this.isKeyboardUser=true},openDrawer:function(){if(this.isOpened){return}this.isOpened=false;var a=(Element.hasClassName(document.documentElement,"handheld"))?this.defaultHandheldDrawerHeight:this.defaultDesktopDrawerHeight;this.animate(this.viewElement(),{height:a+"px"},{curve:coherent.easing.easeOut(1000),callback:function(){Element.setInnerHTML(this.plfMsg,this.loadingMessage);this.plfDrawer.setAttribute("aria-expanded","true");this.plfForm.setAttribute("aria-hidden","true");this.plfMsg.setAttribute("aria-hidden","false");Element.addClassName(this.viewElement(),this.loadingClassName);this.scrollIntoView.bindAndDelay(this,0);if(this.isDataLoaded){this.openDrawerWithAnimation();return}var b=JSONRPC.get(this.serviceURL);b.addMethods(this.successCallback.bind(this),this.failCallback.bind(this))}.bind(this)})},closeDrawer:function(){var a=this.plfIntro.offsetHeight+"px";Element.setInnerHTML(this.plfMsg,"");Element.addClassName(this.viewElement(),this.closingClassName);this.disableFormElements(true);this.animate(this.viewElement(),{height:a},{curve:coherent.easing.easeOut(1000),callback:function(){(function(){var b=this;Element.removeClassName(this.viewElement(),this.showingDataClassName);Element.removeClassName(this.viewElement(),this.showingMessageClassName);Element.removeClassName(this.viewElement(),this.closingClassName);this.plfDrawer.setAttribute("aria-expanded","false");this.plfForm.setAttribute("aria-hidden","true");this.plfMsg.setAttribute("aria-hidden","true");this.plfForm.reset();this.questionWidgets.forEach(function(c){c.reset()});if(this.isKeyboardUser===true){this.isKeyboardUser=false;this.plfOpenBtn.focus()}if(coherent.Browser.MobileSafari){setTimeout(function(){b.plfOpenBtn.focus()},1000)}if(Element.hasClassName(document.documentElement,"handheld")&&!coherent.Browser.MobileSafari){setTimeout(function(){b.viewElement().style.display="none";setTimeout(function(){b.viewElement().style.display="block"},0)},500)}this.isOpened=false}).bindAndDelay(this,0)}.bind(this)})},submitDrawer:function(){var c={pageName:s.pageName,uniqueUserId:apple.cookie("s_vi"),answers:[]},b=this.AJAXResponse.feedback,g=b.params;for(var d in g){c[d]=g[d]}b.questions.forEach(function(h){if(h.value!=null){c.answers.push({id:h.id,type:h.type,value:h.value})}});if(c.answers.length>0){JSONRPC.post(b.serviceURL,"",{body:apple.data.json.stringify(c)})}Element.setInnerHTML(this.plfMsg,this.confirmationMessage);var f=Element.getDimensions(this.plfMsg).height,a=((this.viewElement().offsetHeight-this.plfIntro.offsetHeight)/2)-(f/2);Element.setStyle(this.plfMsg,"bottom",a+"px");this.plfForm.setAttribute("aria-hidden","true");this.plfMsg.setAttribute("aria-hidden","false");Element.replaceClassName(this.viewElement(),this.showingDataClassName,this.showingMessageClassName);this.closeDrawer.bindAndDelay(this,3000)},fireMetricsEvent:function(a){var b=Object.applyDefaults(a,{eVar:"eVar6",slot:"",feature:"Feedback",part:(this.partNumber||""),action:"Selected"});apple.metrics.fireMicroEventNoDuplicates(b)},openDrawerWithAnimation:function(){Element.setStyle(this.plfDrawer,"height","auto");var d=Element.getDimensions(this.plfDrawer).height,b=Element.getDimensions(this.plfIntro).height,c=d+b,a=Element.getDimensions(this.viewElement()).height;if(c==a){c++}this.animate(this.viewElement(),{height:c+"px"},{curve:coherent.easing.easeOut(1000),callback:function(){Element.replaceClassName(this.viewElement(),this.loadingClassName,this.showingDataClassName);this.plfForm.setAttribute("aria-hidden","false");this.plfMsg.setAttribute("aria-hidden","true");this.disableFormElements(false);this.plfDrawer.focus();this.isOpened=true;Element.setInnerHTML(this.plfMsg,"")}.bind(this)})},scrollIntoView:function(){var b=document.body,f=document.documentElement,a=Element.getViewport(),d=Math.max(b.scrollHeight,f.scrollHeight,b.offsetHeight,f.offsetHeight,b.clientHeight,f.clientHeight)-a.height,c=this.viewElement().id,g=Element.getRect(this.viewElement()),c=[a.left,Math.min(d,g.top)];coherent.Animator.setStyles(window,{scroll:c},{duration:2000,curve:coherent.easing.cubicBezier(0.175,0.9,0.2,1,375),startStyles:{scroll:[a.left,a.top]}})},disableFormElements:function(a){Element.queryAll(this.plfForm,"input, textarea, button").forEach(function(c,b){c.disabled=a})},successCallback:function(b){var a=b&&b.feedback&&b.feedback.questions||[];if(a.length<=0){this.failCallback.bindAndDelay(this,0);return}this.AJAXResponse=b;this.createFeedbackQuestions(b&&b.feedback&&b.feedback.questions||[]);this.isDataLoaded=true;this.openDrawerWithAnimation()},failCallback:function(){var d=Element.getDimensions(this.plfDrawer).height,b=Element.getDimensions(this.plfIntro).height,c=d+b,a=Element.getDimensions(this.viewElement()).height;if(c==a){c++}this.animate(this.viewElement(),{height:c+"px"},{curve:coherent.easing.easeOut(1000),callback:function(){Element.setInnerHTML(this.plfMsg,this.errorMessage);var g=Element.getDimensions(this.plfMsg).height,f=((this.viewElement().offsetHeight-this.plfIntro.offsetHeight)/2)-(g/2);Element.setStyle(this.plfMsg,"bottom",f+"px");this.plfForm.setAttribute("aria-hidden","true");this.plfMsg.setAttribute("aria-hidden","false");Element.replaceClassName(this.viewElement(),this.loadingClassName,this.showingMessageClassName);this.closeDrawer.bindAndDelay(this,3000)}.bind(this)})},createFeedbackQuestions:function(b){var b=b||[],a=Element.query(this.viewElement(),".plf-rating-questions");plfFreetextQuestionsContainer=Element.query(this.viewElement(),".plf-freetext-questions");plfFreetextQuestionsTemplate='                 <div class="plf-freetext-question" id="ftq-${0}">                     <label id="ftq-${0}-label" class="a11ylabel" for="ftq-${0}-textarea">${1}<span class="a11y">${2}</span></label>                     <textarea id="ftq-${0}-textarea" cols="30" rows="6" ></textarea>                     <span id="ftq-${0}-count" class="count"></span>                     <p id="ftq-${0}-count-msg" class="a11y"></p>                 </div>',plfRatingQuestionsTemplate='                 <fieldset class="plf-rating-question" id="rq-${0}">                     <legend class="question" id="rq-${0}-legend">${1}</legend>                     <span class="mouseout-wrapper">                         <label id="rq-${0}-1-label" for="rq-${0}-1"><span class="a11y"><input id="rq-${0}-1" aria-labelledby="rq-${0}-legend" type="radio" value="1" name="rq-${0}-group">${2}</span></label>                         <label id="rq-${0}-2-label" for="rq-${0}-2"><span class="a11y"><input id="rq-${0}-2" aria-labelledby="rq-${0}-legend" type="radio" value="2" name="rq-${0}-group">${3}</span></label>                         <label id="rq-${0}-3-label" for="rq-${0}-3"><span class="a11y"><input id="rq-${0}-3" aria-labelledby="rq-${0}-legend" type="radio" value="3" name="rq-${0}-group">${4}</span></label>                         <label id="rq-${0}-4-label" for="rq-${0}-4"><span class="a11y"><input id="rq-${0}-4" aria-labelledby="rq-${0}-legend" type="radio" value="4" name="rq-${0}-group">${5}</span></label>                         <label id="rq-${0}-5-label" for="rq-${0}-5"><span class="a11y"><input id="rq-${0}-5" aria-labelledby="rq-${0}-legend" type="radio" value="5" name="rq-${0}-group">${6}</span></label>                     </span>                 </fieldset>';b.forEach(function(d){var c=d,f;if(c.type=="STAR_RATING"){f=new apple.RatingQuestionWidget("rq-"+c.id,c);a.innerHTML+=plfRatingQuestionsTemplate.expand({"0":c.id,"1":c.description,"2":this.ratingsLabelTemplate.replace("{0}",1).replace("{1}",5),"3":this.ratingsLabelTemplate.replace("{0}",2).replace("{1}",5),"4":this.ratingsLabelTemplate.replace("{0}",3).replace("{1}",5),"5":this.ratingsLabelTemplate.replace("{0}",4).replace("{1}",5),"6":this.ratingsLabelTemplate.replace("{0}",5).replace("{1}",5)},"")}else{if(c.type=="OPEN_ENDED"){c.lowCharsMessage=this.lowCharsMessage;c.noCharsMessage=this.noCharsMessage;f=new apple.FreeTextQuestionWidget("ftq-"+c.id,c);plfFreetextQuestionsContainer.innerHTML+=plfFreetextQuestionsTemplate.expand({"0":c.id,"1":c.description,"2":this.maxCharsAllyLabel.replace("{0}",c.maxCharLimit),"3":c.maxCharLimit},"")}}this.questionWidgets.push(f)}.bind(this))}});apple.RatingQuestionWidget=Class.create(coherent.View,{__viewClassName__:"plf-rating-question",tempStarClassName:"tempStar",starClassName:"star",labelFocusClassName:"focused",labelIDSuffix:"-label",labels:PartList("label"),radioInputs:PartList("input"),__structure__:{"input[type=radio]":coherent.ToggleButton({selectionBinding:"*.value"})},init:function(){var a=Element.query(this.viewElement(),".mouseout-wrapper");Event.observe(a,"mouseout",this.onmouseoutHandler.bindAsEventListener(this));this.labels().forEach(function(b){Event.observe(b,"mouseover",this.onmouseoverHandler.bindAsEventListener(this))}.bind(this));this.radioInputs().forEach(function(b){Event.observe(b,"focus",this.onfocusHandler.bindAsEventListener(this));Event.observe(b,"blur",this.onblurHandler.bindAsEventListener(this));Event.observe(b,"click",this.onclickHandler.bindAsEventListener(this))}.bind(this))},onfocusHandler:function(a){var b=a.target||a.srcElement;Element.addClassName($(b.id+this.labelIDSuffix),this.labelFocusClassName)},onblurHandler:function(a){var b=a.target||a.srcElement;Element.removeClassName($(b.id+this.labelIDSuffix),this.labelFocusClassName)},onclickHandler:function(a){var b=a.target||a.srcElement;this.clearStars(this.tempStarClassName);this.addClassNameToPreviousSiblings($(b.id+this.labelIDSuffix),this.starClassName)},onmouseoverHandler:function(a){var b=a.target||a.srcElement;this.addClassNameToPreviousSiblings(b,this.tempStarClassName)},onmouseoutHandler:function(a){this.clearStars(this.tempStarClassName)},addClassNameToPreviousSiblings:function(c,b){var d=this.labels();index=d.length,found=false;while(index--){var a=d[index];if(a.id===c.id){found=true}if(found){Element.addClassName(a,b)}else{Element.removeClassName(a,b)}}},clearStars:function(a){this.labels().forEach(function(b){Element.removeClassName(b,a)}.bind(this))},reset:function(){this.clearStars(this.starClassName);this.clearStars(this.tempStarClassName);this.__relativeSource.setValueForKey(null,"value")}});apple.FreeTextQuestionWidget=Class.create(coherent.View,{__viewClassName__:"plf-freetext-question",labelFocusClassName:"focus",labelHiddenClassName:"hidden",errorClassName:"err",__structure__:{textarea:coherent.TextField({valueBinding:"*.value"})},init:function(){var a=this.__relativeSource;this.maxCharLimit=a.maxCharLimit||2000;this.warnCharLimit=a.warnCharLimit||500;this.lowCharsWarnAt=a.warnThreshold||100;this.lowCharsMessage=a.lowCharsMessage;this.noCharsMessage=a.noCharsMessage;this.textarea=$(this.id+"-textarea");this.associatedLabel=$(this.id+"-label");this.plfCountTarget=$(this.id+"-count");this.plfCountMsgElement=$(this.id+"-count-msg");Event.observe(this.textarea,"focus",this.onfocusHandler.bindAsEventListener(this));Event.observe(this.textarea,"blur",this.onblurHandler.bindAsEventListener(this));Event.observe(this.textarea,"keyup",this.onkeyupHandler.bindAsEventListener(this));Event.observe(this.textarea,"keypress",this.onkeypressHandler.bindAsEventListener(this));Event.observe(this.textarea,"paste",this.onpasteHandler.bindAsEventListener(this))},onfocusHandler:function(a){var b=a.target||a.srcElement;Element.addClassName(this.associatedLabel,this.labelFocusClassName)},onblurHandler:function(a){var b=a.target||a.srcElement;if(b.value.length===0){Element.removeClassName(this.associatedLabel,this.labelFocusClassName);Element.removeClassName(this.associatedLabel,this.labelHiddenClassName)}},onpasteHandler:function(a){var c=a.target||a.srcElement,b="";Event.stop(a);if(a.clipboardData){b=a.clipboardData.getData("text/plain")}if(window.clipboardData){b=window.clipboardData.getData("Text")}c.value+=b.substring(0,this.maxCharLimit-c.value.length);return false},onkeypressHandler:function(a){var c=a.target||a.srcElement,b=c.value;if(b.length>=this.maxCharLimit){c.value=b.slice(0,this.maxCharLimit);Event.stop(a);return false}},onkeyupHandler:function(a){var c=a.target||a.srcElement,b=(this.maxCharLimit-c.value.length);if((c.value.length!=0)&&(!Element.hasClassName(this.associatedLabel,this.labelHiddenClassName))){Element.addClassName(this.associatedLabel,this.labelHiddenClassName)}if(b==this.warnCharLimit||b==this.lowCharsWarnAt||b==0){Element.setInnerHTML(this.plfCountMsgElement,this.lowCharsMessage.replace("{0}",b))}else{Element.setInnerHTML(this.plfCountMsgElement,"")}if(b<=this.warnCharLimit){Element.setInnerHTML(this.plfCountTarget,b);if(b<=this.lowCharsWarnAt){Element.addClassName(this.plfCountTarget,this.errorClassName)}else{Element.removeClassName(this.plfCountTarget,this.errorClassName)}}else{Element.removeClassName(this.plfCountTarget,this.errorClassName);Element.setInnerHTML(this.plfCountTarget,"")}},reset:function(){Element.removeClassName(this.associatedLabel,this.labelFocusClassName);Element.removeClassName(this.associatedLabel,this.labelHiddenClassName);Element.innerHTML(this.plfCountTarget,"");Element.innerHTML(this.plfCountMsgElement,"");this.__relativeSource.setValueForKey(null,"value")}});function EqualizeControllerMixinClass(){}EqualizeControllerMixinClass.prototype.equalizeSectionHeight=function(){var g=Element.query(".ipod-selection");if(g){var d=Element.query(g,"#primary .box-content");var c=Element.query(g,".rail .box-content");var h=Element.query(g,".rail .title-bar");if(d&&c&&h){c.style.minHeight="";g.style.height="auto";var f=g.offsetHeight||g.scrollHeight;g.style.height=f+"px";if(!this.primaryBoxContentStyle){this.primaryBoxContentStyle=Element.getStyles(d)}if(!this.rightRailBorderBottomWidth){this.rightRailBorderBottomWidth=Element.getStyles(c,Element.PROPERTIES[8])}if(!this.rightRailBorderTopWidth){this.rightRailBorderTopWidth=Element.getStyles(c,Element.PROPERTIES[6])}var b=h.offsetHeight||h.scrollHeight;var a=f-b-parseInt(this.rightRailBorderBottomWidth||0,10)+parseInt(this.primaryBoxContentStyle.borderTopWidth||0,10)+parseInt(this.primaryBoxContentStyle.borderBottomWidth||0,10);a=a-parseInt(this.rightRailBorderTopWidth||0);c.style.height="auto";c.style.minHeight=a+"px"}}};EqualizeControllerMixinClass.getInstance=function(){if(!EqualizeControllerMixinClass.__instance){EqualizeControllerMixinClass.__instance=new EqualizeControllerMixinClass()}return EqualizeControllerMixinClass.__instance};EqualizeControllerMixinClass.prototype.apply=function(a){a.prototype.equalizeSectionHeight=EqualizeControllerMixinClass.getInstance().equalizeSectionHeight};EqualizeControllerMixin=new EqualizeControllerMixinClass();Package("apple");apple.RetailAvailabilitySearchTrigger=Class.create(coherent.View,{exposedBindings:["availability","partNumber","storeNumber","showLink"],OMNITURE_FEATURE_NAME:"storeLocator",OMNITURE_PROPERTY_NAME:"prop37",__structure__:{".cold-start":coherent.View({visibleBinding:"partNumber&&showView&&storeNumber(not)"}),".warm-start":coherent.View({visibleBinding:"partNumber&&showView&&storeNumber"}),".retail-availability-search-availability-value":coherent.View({htmlBinding:"availability"}),".retail-availability-search-trigger":coherent.Button({visibleBinding:"showLink"}),".disclaimer":coherent.View({visibleBinding:"showView"})},init:function(){this.__partNumber=this.viewElement().getAttribute("data-part");this.__productTitle=this.viewElement().getAttribute("data-title");this.__eligibility=this.viewElement().getAttribute("data-eligibility");this.__showStoreSearchLink=this.viewElement().getAttribute("data-showstoresearchlink");if(this.__partNumber){this.setValueForKeyPath(this.__partNumber,"partNumber");this.setValueForKeyPath(this.__productTitle,"productTitle");this.setValueForKeyPath(this.__eligibility==="true","showView");this.setValueForKeyPath(this.__showStoreSearchLink==="true","showLink")}Element.addClassName(this.viewElement(),"ready");Element.queryAll(this.viewElement(),".retail-availability-search-trigger").forEach(function(a){Event.observe(a,"click",this.buttonClicked.bind(this))},this);this.addObserverForKeyPath(this,this.showHideLink,"showLink")},showHideLink:function(a){Element.queryAll(this.viewElement(),".retail-availability-search-trigger").forEach(function(b){Element.setStyle(b,"display",(a.newValue)?" inline-block":"none")})},buttonClicked:function(a){this.fireEvent(this.valueForKeyPath("storeNumber")?{action:"See more stores",events:"event29, event32"}:{action:"Check availability",events:"event29, event31"});this.viewAction="click";this.sendAction();this.viewAction=null;Event.stop(a)},fireEvent:function(a){a=a||{action:"unknown"};a.eVar=this.OMNITURE_PROPERTY_NAME;a.page=s.pageName;a.feature=this.OMNITURE_FEATURE_NAME;apple.metrics.fireMicroEvent(a)}});Package("apple");apple.RetailAvailabilitySearchOverlay=Class.create(coherent.View,{exposedBindings:["storeList","partNumber","storeNumber","productTitle"],resultsPerPage:5,currentPage:0,__hash:{},actionTypes:{cancel:1,select:2,search:3},OMNITURE_FEATURE_NAME:"storeLocator",OMNITURE_PROPERTY_NAME:"prop37",searchQueryView:coherent.TextField("#retail-availability-search-query",{valueBinding:"searchQuery",action:"performSearch",enabledBinding:"searching(not)",sendsActionOnEndEditing:false,continuallyUpdatesValue:true}),storeListView:coherent.View("#retail-availability-search-store-list",{action:"changeSelection"}),init:function(){this.addObserverForKeyPath(this,this.observeSearchingChange.bind(this),"searching");this.setValueForKeyPath(true,"showInfo");this.__initialStoreListInnerHTML="";if(this.storeListView){this.__initialStoreListInnerHTML=this.storeListView.viewElement().innerHTML}},__structure__:{"#retail-availability-search-form-spinner":coherent.View({visibleBinding:"searching"}),"#retail-availability-search-search-button":coherent.Anchor({enabledBinding:"searching(not)",action:"performSearch"}),"#retail-availability-search-product-name":coherent.View({htmlBinding:"productTitle"}),"#retail-availability-search-previous-button":coherent.Anchor({visibleBinding:"showPreviousButton",action:"showPrevious"}),"#retail-availability-search-next-button":coherent.Anchor({visibleBinding:"showNextButton",action:"showNext"}),"#retail-availability-search-photo":coherent.ImageView({srcBinding:"content.storeImageUrl"}),"#retail-availability-search-directions-button":coherent.Anchor({hrefBinding:"content.directionsUrl",enabledBinding:"content.directionsUrl",action:"directionsButtonActionHandler"}),"#retail-availability-search-reservation-button":coherent.Anchor({hrefBinding:"content.reservationUrl",enabledBinding:"content.reservationUrl",action:"reservationButtonActionHandler"}),"#retail-availability-search-cancel-button":coherent.Anchor({action:"cancel"}),"#retail-availability-search-select-store-button":coherent.Anchor({enabledBinding:"enableSelectButton",action:"saveSelection"}),"#retail-availability-search-name":coherent.View({textBinding:"content.storeDisplayName||content.address.address"}),"#retail-availability-search-locality":coherent.View({textBinding:"content.address.address2",visibleBinding:"content.address.address2"}),"#retail-availability-search-region":coherent.View({textBinding:"content.address.address3",visibleBinding:"content.address.address3"}),"#retail-availability-search-tel":coherent.View({textBinding:"content.phoneNumber",visibleBinding:"content.phoneNumber"}),"#retail-availability-search-info-placeholder":coherent.View({visibleBinding:"showInfo"}),"#retail-availability-search-error-placeholder":coherent.View({visibleBinding:"showDetails(not)&&showInfo(not)",textBinding:"errorText"}),"#retail-availability-search-profile":coherent.View({visibleBinding:"showDetails&&showInfo(not)"}),".retail-availability-search-actions":coherent.View({visibleBinding:"showDetails&&showInfo(not)"}),"#retail-availability-search-hours-info":coherent.View({htmlBinding:"content.storeHours"})},showErrorBubbleView:function(a){var c=this;function b(){var d=c.searchQueryView.viewElement();Element.addClassName(d,coherent.Style.kInvalidValueClass);c.setValueForKeyPath(true,"showErrorBubble");coherent.Bubble.display({classname:"bubble retail-availability-overlay-bubble",error:c.oldError,target:d});d.setAttribute("aria-describedby","coherent_bubble_node");c.focusLocationField()}if(this.showErrorBubble&&!(this.oldError.description.toString()===a.description.toString())){this.setValueForKeyPath(a,"oldError");this.hideErrorBubbleView();b.delay(200)}else{this.setValueForKeyPath(a,"oldError");b()}},hideErrorBubbleView:function(){Element.removeClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass);coherent.Bubble.hide({target:this.searchQueryView.viewElement()});this.setValueForKeyPath(false,"showErrorBubble");this.__validationError=false},clearAllErrors:function(){if(this.showErrorBubble||this.__validationError){if(this.zipValidation.pattern.test(this.searchQueryView.viewElement().value)){this.hideErrorBubbleView()}else{Element.addClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass)}}},focusLocationField:function(){this.searchQueryView.viewElement().focus()},validSearchQueryView:function(){var a=this.searchQuery;this.__validationError=true;if(!a){Element.addClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass);this.searchQueryView.blur();this.showErrorBubbleView(new coherent.Error({description:this.zipValidation?this.zipValidation.requiredError:"Please enter the mandatory field"}));return false}else{if(this.zipValidation.pattern&&!this.zipValidation.pattern.test(a)){this.searchQueryView.blur();this.showErrorBubbleView(new coherent.Error({description:this.zipValidation?this.zipValidation.invalidFormatError:"Zip code is not valid"}));return false}else{this.__validationError=false;return true}}},performSearch:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return(d.nodeName==="BUTTON"&&d.id==="retail-availability-search-search-button")||(d.nodeName==="INPUT"&&d.id==="retail-availability-search-query")},this.viewElement());if(b&&this.validSearchQueryView()){this.setValueForKeyPath(true,"searching");this.performAction(this.actionTypes.search)}},performAction:function(a){this.viewAction=a;this.sendAction();this.viewAction=null},reset:function(){this.storeListView.viewElement().innerHTML=this.__initialStoreListInnerHTML;this.setValueForKeyPath(null,"searchQuery");this.setValueForKeyPath(false,"showNextButton");this.setValueForKeyPath(false,"showPreviousButton");this.setValueForKeyPath(true,"showInfo")},changeSelection:function(a,d){var c=Element.locateAncestor(d.target||d.srcElement,function(g){return g.nodeName==="LABEL"&&Element.hasAttribute(g,"for")},a.viewElement());if(c){var b=c.parentNode.childNodes[0]}if(d.target.tagName==="INPUT"){var b=d.target||d.srcElement}var f=b.getAttribute("value");this.setStoreSelected(f)},saveSelection:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return d.nodeName==="BUTTON"&&d.id==="retail-availability-search-select-store-button"},this.viewElement());if(b){if(this.currentStoreNumber){this.fireEvent({action:"Retail store selected",events:"event37"});this.storeNumber=this.currentStoreNumber;this.performAction(this.actionTypes.select)}}},cancel:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return d.nodeName==="BUTTON"&&d.id==="retail-availability-search-cancel-button"},this.viewElement());if(b){this.performAction(this.actionTypes.cancel)}},showNext:function(a,b){if(this.currentPage<this.totalPageCount-1){this.fireEvent({action:"next",slot:"pageIndex"+this.currentPage});this.gotoPage(++this.currentPage)}},showPrevious:function(a,b){if(this.currentPage>0){this.fireEvent({action:"prev",slot:"pageIndex"+this.currentPage});this.gotoPage(--this.currentPage)}},gotoPage:function(a){this.setValueForKeyPath(a!==this.totalPageCount-1,"showNextButton");this.setValueForKeyPath(a!==0,"showPreviousButton");var b=this.storeListView.viewElement();if(b){b.scrollTop=a*b.offsetHeight}this.currentPage=a},directionsButtonActionHandler:function(b,c){this.fireEvent({action:"Driving Directions"});var a=b.viewElement();window.open(a.href,a.target)},reservationButtonActionHandler:function(b,c){this.fireEvent({action:"Store Workshops"});var a=b.viewElement();window.open(a.href,a.target)},fireEvent:function(a){a=a||{action:"unknown"};a.eVar=this.OMNITURE_PROPERTY_NAME;a.page=s.pageName;a.feature=this.OMNITURE_FEATURE_NAME;apple.metrics.fireMicroEvent(a)},observeStoreListChange:function(a){if(a.newValue){this.stores=coherent.KVO.adaptTree(a.newValue);this.setStoreList();if(this.stores[0]){this.setStoreSelected(this.stores[0].storeNumber)}}},showErrorMessage:function(a){this.stores=[];this.setStoreList(true);this.setValueForKeyPath(a,"errorText");this.setValueForKeyPath(false,"showDetails")},setStoreList:function(t){var m=this.storeListView.viewElement();var a=document.createDocumentFragment();var h=this.partNumber;m.innerHTML="";this.__hash={};this.currentPage=0;this.setValueForKeyPath(false,"showInfo");var v,r=this.stores.length,q=0;this.__firstStore=null;for(v=0;v<r;v++){var g=this.stores[v];if(g&&(!g.partsAvailability||!g.partsAvailability[h])){g.partsAvailability[h]={pickupDisplay:"unknown",pickupSearchQuote:this.unknownError,storeSelectionEnabled:false}}if(g&&g.partsAvailability&&g.partsAvailability[h]&&g.partsAvailability[h].pickupDisplay&&g.partsAvailability[h].pickupDisplay!=="ineligible"){g.pageIndex=Math.floor(v/this.resultsPerPage);var n=document.createElement("li");n.className="retail-availability-search-store-item";var x=document.createElement("label");x.className="retail-availability-search-store-label";x.setAttribute("for","retail-availability-search-store-selection-"+g.storeNumber);g.listElement=x;var k=document.createElement("span");k.className="store-info";var o=document.createElement("span");o.className="store-name strong block";o.title=g.storeDisplayName;o.innerHTML=g.storeDisplayName;var w=document.createElement("span");w.className="store-location";w.title=g.city+(g.city&&g.state?", ":"")+g.state;w.innerHTML=g.city+(g.city&&g.state?", ":"")+g.state;var u=document.createElement("span");u.className="store-availability";var b=document.createElement("span");b.className=g.partsAvailability[h].pickupDisplay;b.innerHTML=g.partsAvailability[h].pickupSearchQuote;u.appendChild(b);k.appendChild(o);k.appendChild(w);x.appendChild(k);x.appendChild(u);var y=document.createElement("input");y.id="retail-availability-search-store-selection-"+g.storeNumber;y.type="radio";y.className="retail-availability-search-selection a11y";y.name="retail-availability-search-selection";y.value=g.storeNumber;g.inputElement=y;n.appendChild(y);n.appendChild(x);a.appendChild(n);if(!this.__firstStore){this.__firstStore=g}g.storeNumber&&(this.__hash[g.storeNumber]=g)}else{q++}}this.totalPageCount=Math.ceil((r-q)/this.resultsPerPage);if(t){this.totalPageCount=1}var d=this.totalPageCount*this.resultsPerPage;var f=d-r+q;if(f){var c=document.createElement("li");c.className="retail-availability-search-store-item";c.innerHTML='<label class="retail-availability-search-store-label empty"><span class="store-info"></span><span class="store-availability"></span></label>';for(v=0;v<f;v++){a.appendChild(c.cloneNode(true))}}m.appendChild(a);this.gotoPage(0)},__highlightStoreSelection:function(a){for(var c in this.__hash){var b=this.__hash[c];if(b&&b.listElement){if(c===a){b.inputElement&&(b.inputElement.checked=true);Element.addClassName(b.listElement,"selected")}else{Element.removeClassName(b.listElement,"selected")}}}},setStoreSelected:function(a){if(!this.__hash[a]){if(this.__firstStore&&this.__firstStore.storeNumber){a=this.__firstStore.storeNumber}}this.setValueForKeyPath(a,"currentStoreNumber");this.__highlightStoreSelection(a);var b=this.__hash[a];if(b){if(b.city&&b.address){b.address.address3=b.city;if(b.state){b.address.address3+=", "+b.state}if(b.address.postalCode){b.address.address3+=" "+b.address.postalCode}}this.setValueForKeyPath(b,"content");if(b.partsAvailability&&b.partsAvailability[this.partNumber]){this.setValueForKeyPath(b.partsAvailability[this.partNumber].storeSelectionEnabled,"enableSelectButton")}this.setValueForKeyPath(true,"showDetails")}},observeSearchingChange:function(a){if(!a.newValue){this.focusLocationField.bindAndDelay(this,500)}}});Package("apple");apple.RetailAvailabilitySearchViewController=Class.create(coherent.ViewController,{overlay:apple.RetailAvailabilitySearchOverlay("#retail-availability-search",{storeListBinding:"stores",partNumberBinding:"partNumber",productTitleBinding:"productTitle",storeNumberBinding:"storeNumber",action:"overlayActionHandler"}),trigger:apple.RetailAvailabilitySearchTrigger(".retail-availability-search-info",{storeNumberBinding:"storeNumber",action:"triggerActionHandler"}),__overlay:coherent.Overlay("#retail-availability-search-overlay",{delegate:{}}),init:function(){this.overlay.zipValidation=this.validation.zip;this.overlay.unknownError=this.availabilityUnknownError;this.overlay.ineligibleError=this.availabilityIneligibleError;this.__partNumbers=[];this.__triggerHash={};var d=Element.queryAll(this.viewElement(),".retail-availability-search-info");var a=this.cookie&&apple.cookie(this.cookie.name);for(var c=0,b=d.length;c<b;c++){var g=d[c];var h=coherent.View.fromNode(g);var f=h.partNumber;if(this.__triggerHash[f]||!h.showView){continue}this.__triggerHash[f]=h;this.__partNumbers.push(f)}if(a){this.setValueForKeyPath(a,"storeNumber");this.getStoreAvailabilityInfo()}if(b===1){if(this.__partNumbers[0]){coherent.dataModel.setValueForKey(coherent.KVO.adaptTree({partNumber:this.__partNumbers[0]}),"retailAvailabilitySearchProduct")}coherent.dataModel.addObserverForKeyPath(this,this.observeProductChange.bind(this),"retailAvailabilitySearchProduct")}else{this.observeProductChange=function(){}}if(this.__overlay){this.__overlay.delegate.willHideOverlay=function(){this.stores=null;this.overlay.hideErrorBubbleView();this.overlay.reset()}.bind(this);this.__overlay.delegate.didShowOverlay=function(){this.overlay.focusLocationField.bindAndDelay(this.overlay,300)}.bind(this)}},overlayActionHandler:function(a,b){if(a.viewAction){if(a.viewAction===this.overlay.actionTypes.cancel){this.hideOverlay()}else{if(this.partNumber){if(a.storeNumber&&a.viewAction===this.overlay.actionTypes.select){this.saveStoreSelection(a.storeNumber);var c=this.__partNumbers[0]?this.__partNumbers:this.partNumber;this.getAvailabilityForStore(c,a.storeNumber,this.url,function(d){if(d&&d.stores&&d.stores[0]){this.processResponseForAvailabilityInfo(d.stores[0].partsAvailability)}this.hideOverlay();if(this.equalizeSectionHeight){this.equalizeSectionHeight()}}.bind(this))}else{if(a.searchQuery&&a.viewAction===this.overlay.actionTypes.search){this.getAvailabilityForLocation(this.partNumber,a.searchQuery,function(d){this.setValueForKeyPath(d.stores,"stores");this.overlay.setValueForKeyPath(false,"searching")}.bind(this))}}}else{throw"No part number found"}}}else{if(coherent.Browser.IE&&b.srcElement&&b.srcElement.id==="retail-availability-placeholder-value"){this.overlay.focusLocationField()}}},triggerActionHandler:function(a,c){if(a.viewAction!=="click"){return}var b=a.partNumber;var d=a.productTitle;if(b){this.setValueForKeyPath(b,"partNumber");this.setValueForKeyPath(d,"productTitle");if(this.storeNumber&&!this.stores){this.overlay.setValueForKeyPath(true,"searching");this.getAvailabilityForStore(b,this.storeNumber,this.searchUrl,function(f){this.setValueForKeyPath(f.stores,"stores");this.overlay.setValueForKeyPath(false,"searching");this.overlay.setValueForKeyPath(f.zip,"searchQuery")}.bind(this),this.showOverlayError.bind(this))}this.showOverlay()}},saveStoreSelection:function(a){if(a){if(this.cookie){apple.cookie(this.cookie.name,a,{domain:this.cookie.domain,path:"/",expires:this.cookie.expiry>0?this.cookie.expiry:""})}this.setValueForKeyPath(a,"storeNumber")}},showOverlay:function(){this.__overlay&&this.__overlay.display({sourceId:this.overlay.id,classname:"retail-availability-search-overlay overlay"})},hideOverlay:function(){this.__overlay.hide()},observeProductChange:function(c){var b=c.newValue||{partNumber:null,productTitle:""};var a=c.oldValue;if(a&&a.partNumber===b.partNumber){return}this.__partNumbers[0]=b.partNumber;this.trigger.setValueForKeyPath(b.partNumber,"partNumber");this.trigger.setValueForKeyPath(b.productTitle,"productTitle");this.__triggerHash={};this.__triggerHash[b.partNumber]=this.trigger;if(this.storeNumber){this.getStoreAvailabilityInfo(b.partNumber)}else{this.checkEligibilty(b.partNumber)}},getStoreAvailabilityInfo:function(){if(this.storeNumber){var a=this.__partNumbers;if(a&&a[0]){this.getAvailabilityForStore(a,this.storeNumber,this.url,function(b){if(b&&b.stores&&b.stores[0]){this.processResponseForAvailabilityInfo(b.stores[0].partsAvailability)}}.bind(this))}}},checkEligibilty:function(){var a=this.__partNumbers;if(a&&a[0]){this.getEligibilityForPartNumbers(a,function(b){if(b&&b.pickupEligibility){this.processResponseForAvailabilityInfo(b.pickupEligibility)}}.bind(this))}},processResponseForAvailabilityInfo:function(c){for(var b in this.__triggerHash){var a=c[b];if(a&&(typeof a.eligible==="undefined"||a.eligible)){this.__triggerHash[b].setValueForKeyPath(a.pickupQuote,"availability");this.__triggerHash[b].setValueForKeyPath(a.storeSearchEnabled!==false,"showLink");this.__triggerHash[b].setValueForKeyPath(a.pickupDisplay!=="ineligible","showView")}else{this.__triggerHash[b].setValueForKeyPath(false,"showView")}}},getEligibilityForPartNumbers:function(a,b){this.performQuery({partNumber:a,url:this.eligibilityUrl,success:b,timeout:this.timeout})},getAvailabilityForStore:function(c,a,b,f,d){this.performQuery({partNumber:c,storeNumber:a,url:b,success:f,error:d,timeout:this.timeout})},getAvailabilityForLocation:function(b,a,c){this.performQuery({partNumber:b,location:a,url:this.searchUrl,success:c,error:this.showOverlayError.bind(this)})},typeOf:function(a){return Object.prototype.toString.call(a).match(/\[object ([a-zA-Z0-9]+)\]/)[1].toLowerCase()},showOverlayError:function(a){this.overlay.setValueForKeyPath(false,"searching");this.overlay.showErrorMessage(a.errorMessage)},addQueryParam:function(a,b){if(a.indexOf("?")>-1){!/&$/.test(a)&&(a=a+"&")}else{a=a+"?"}a=a+b;return a},performQuery:function(d){var g={};var c=d.url;if(d.partNumber){if(this.typeOf(d.partNumber)==="array"){var f=0;var a=d.partNumber.length;for(;f<a;f++){g["parts."+f]=d.partNumber[f]}}else{g["parts.0"]=d.partNumber}if(d.location){g.zip=d.location}else{if(d.storeNumber){g.store=d.storeNumber}}if(this.queryParams){c=this.addQueryParam(c,this.queryParams)}function k(m){if(m.success===false){d.error?d.error(m):b(m)}else{d.success(m)}}function b(m,n){console.log(m,n)}var h=JSONRPC.get(c,g,d.timeout?{timeout:d.timeout}:null);h.addCallback(k,b)}}});apple.RetailAvailabilitySearchViewController.create=function(a,b){var c=Element.query(a);if(c){new coherent.View(c);new apple.RetailAvailabilitySearchViewController(c,b)}};EqualizeControllerMixin.apply(apple.RetailAvailabilitySearchViewController);Package("apple");apple.SlidingView=Class.create(coherent.View,{init:function(){Element.addClassName(this.viewElement(),"js-enabled");this.slidingList=Element.query(this.viewElement(),"ul");this.leftArrow=document.createElement("a");Element.addClassName(this.leftArrow,"navbar-arrow left");this.rightArrow=document.createElement("a");Element.addClassName(this.rightArrow,"navbar-arrow right");var a=Element.query(this.viewElement(),".panel-body");a.appendChild(this.leftArrow);a.appendChild(this.rightArrow);Event.observe(this.leftArrow,"click",this.moveRight.bind(this));Event.observe(this.rightArrow,"click",this.moveLeft.bind(this));this.isiPad=navigator.userAgent.match(/iPad/i)!=null;this.originalCoord={x:0,y:0};this.finalCoord={x:0,y:0}},moveRight:function(){},moveLeft:function(){},ontouchstart:function(a){},ontouchmove:function(a){},ontouchend:function(a){}});Package("apple");apple.LateralNav=Class.create(coherent.View,{OMNITURE_SCROLL_FEATURE_NAME:"Navigation-scroll",OMNITURE_PROPERTY_NAME:"eVar6",PAGE_NO_SESSION_KEY:"ln_curPage",ITEMS_PER_PAGE:7,MINIMUM_MOVEMENT_THRESHOLD:20,MINIMUM_VELOCITY_THRESHOLD:0.4,MOMENTUM_DURATION:400,ELASTIC_MOMENTUM_DURATION:300,LINK_ITEM_CSS_SELECTOR:".lateral-navbar ul .tile-link",TEXT_ITEM_CSS_SELECTOR:".lateral-navbar ul .promo-no-link",ARROW_CSS_SELECTOR:".lateral-navbar.taller a.navbar-arrow",THRESHOLD_HEIGHT:87,RESISTANCE_FACTOR:0.5,startTimeStamp:0,deltaX:0,STYLE:{transform:"-webkit-transform",transitionDuration:"-webkit-transition-duration",backfaceVisibility:"-webkit-backface-visibility",transitionTiming:"-webkit-transition-timing-function"},EVENT:(function(){var a={touchStart:"touchstart",touchMove:"touchmove",touchEnd:"touchend",touchCancel:"touchcancel",transitionEnd:"transitionend",click:"ontouchstart" in window?"touchend":"click"};if(coherent.Browser.Safari||coherent.Browser.Chrome){a={touchStart:"touchstart",touchMove:"touchmove",touchEnd:"touchend",touchCancel:"touchcancel",transitionEnd:"webkitTransitionEnd",click:"ontouchstart" in window?"touchend":"click"}}return a})(),list:Part("ul"),listElements:PartList("ul li"),container:Part(".panel-body"),currentElement:Part("li.current"),IS_TOUCH_DEVICE:"ontouchstart" in window,init:function(){this.generateNavigationControls();this.fixItemHeight();if(!this.shouldScroll()){this.onLoadComplete();return}var d=this.listElements().length;this.movementThreshold=this.list().offsetWidth/4;this.liWidth=this.listElements()[0].offsetWidth;this.viewWidthActual=this.container().offsetWidth;this.viewNum=Math.floor(this.viewWidthActual/this.liWidth);this.viewWidth=this.viewNum*this.liWidth;this.offsetValue=this.viewWidthActual+1-this.viewWidth;this.leftArrowWidth=this.leftArrow.offsetWidth-6;this.pages={1:{left:1,right:6,offset:0}};this.pgOn=1;this.pgNos=1;var c=Math.ceil(d/this.viewNum);for(var b=1;b<=c;b++){if(d>=(this.pgNos+1)*this.viewNum+1){this.pgNos++;this.pages[this.pgNos]={left:(this.pgNos*this.viewNum-(this.viewNum-1)),right:this.pgNos*this.viewNum,offset:0}}else{if(d>=this.pgNos*this.viewNum+1){this.pgNos++;this.pages[this.pgNos]={left:(d-(this.viewNum-1)),right:d,offset:1}}}}this.originalLeftMargin=0;this.storage=new Storage({name:"ln"});this.currentList=0;if(this.currentElement()){this.onLoadComplete();this.currentList=this.listElements().indexOf(this.currentElement())+1;var f=this.getStorageValue(this.PAGE_NO_SESSION_KEY);if(!f||f>this.pgNos||this.isCurrentItemNotOnStoredPage(f)){for(var a=1;a<=this.pgNos;a++){if((this.currentList>=this.pages[a].left)&&(this.currentList<=this.pages[a].right)){f=a}}}if(this.isItemCutOff(f,this.currentList,d)){this.setStorageValue(this.PAGE_NO_SESSION_KEY,this.pgOn)}else{this.pgOn=f}this.moveLeftInitial(d,this.listElements(),this.pgOn);if(this.rightMore){this.animateArrowRight(true);this.animateArrowLeft(false)}if(this.pgOn>1){this.animateArrowLeft(true);this.animateArrowRight(false)}}else{this.setStorageValue(this.PAGE_NO_SESSION_KEY,this.pgOn);if(!coherent.Browser.IE){this.loadAnimationTransitionEnd=this.loadAnimationTransitionEnd.bind(this);Event.observe(this.viewElement(),this.EVENT.transitionEnd,this.loadAnimationTransitionEnd);Element.addClassName(this.viewElement(),"loading")}else{this.onLoadComplete()}this.animateArrowRight(true);this.animateArrowLeft(false)}this.animateArrowLoad();if(this.IS_TOUCH_DEVICE){this.bindTouchEvents()}else{this.bindFocusEvents();Event.observe(this.list().parentNode,"scroll",this.listScrollObserver.bindAsEventListener(this))}},onLoadComplete:function(){Element.addClassName(this.viewElement(),"loaded")},loadAnimationTransitionEnd:function(){Element.removeClassName(this.viewElement(),"loading");this.onLoadComplete();Event.stopObserving(this.viewElement(),this.EVENT.transitionEnd,this.loadAnimationTransitionEnd)},getStorageValue:function(a){var b=this.storage.get(a);if(b){try{b=parseInt(b,10)}catch(c){b=null}}if(a===this.PAGE_NO_SESSION_KEY){b+=1}return b},setStorageValue:function(a,b){if(a===this.PAGE_NO_SESSION_KEY){b-=1}try{this.storage.set(a,b)}catch(c){}},isCurrentItemNotOnStoredPage:function(c){var b=[];for(var a=1;a<=this.pgNos;a++){if((this.currentList>=this.pages[a].left)&&(this.currentList<=this.pages[a].right)){b.push(a)}}if(!isNaN(c)&&isFinite(c)){c=parseInt(c,10)}if(b.indexOf(c)>=0){return false}return true},isItemCutOff:function(c,b,d){if(b%this.ITEMS_PER_PAGE===0){this.pgOn++;return true}if(!isNaN(c)&&isFinite(c)){c=parseInt(c,10)}var a=d-(this.ITEMS_PER_PAGE-1)*(c-1);return a===b},shouldScroll:function(){return this.listElements().length>=this.ITEMS_PER_PAGE},fixItemHeight:function(){var a=this.container().offsetHeight;if(a&&a>this.THRESHOLD_HEIGHT){Element.addClassName(this.viewElement(),"taller");var g=Element.query(this.listElements()[0],"a")||Element.query(this.listElements()[0],"div");this.stylesheet=this.stylesheet||new apple.stylesheet("ln_overriden_style");this.stylesheet.insertRule(this.ARROW_CSS_SELECTOR,{height:a+"px"});var d=Element.getStyles(g,["paddingTop","paddingBottom"]);var c=0;var f=0;if(d.paddingTop){c=parseInt(d.paddingTop.replace(/[^-\d\.]/g,""),10)}if(d.paddingBottom){f=parseInt(d.paddingBottom.replace(/[^-\d\.]/g,""),10)}var b=a-c-f;this.stylesheet.insertRule(this.LINK_ITEM_CSS_SELECTOR,{"min-height":b+"px"});this.stylesheet.insertRule(this.TEXT_ITEM_CSS_SELECTOR,{"min-height":b+"px"})}},generateNavigationControls:function(){this.leftArrow=document.createElement("a");Element.addClassName(this.leftArrow,"navbar-arrow left");this.rightArrow=document.createElement("a");Element.addClassName(this.rightArrow,"navbar-arrow right");this.container().appendChild(this.leftArrow);this.container().appendChild(this.rightArrow);Event.observe(this.leftArrow,this.EVENT.click,this.moveRight.bind(this));Event.observe(this.rightArrow,this.EVENT.click,this.moveLeft.bind(this))},listScrollObserver:function(a){var b=this.list().parentNode.scrollLeft;Element.setStyle(this.leftArrow,"left",b+"px");Element.setStyle(this.rightArrow,"left",b+"px");Element.setStyle(this.list(),"left",b+"px")},bindFocusEvents:function(){var a=this;this.listElements().forEach(function(b){Event.observe(a.findFocusable(b),"focus",a.observeFocus.bindAsEventListener(a))})},findFocusable:function(a){return Element.query(a,"a")||Element.query(a,"button")},observeFocus:function(a){var b=this;if(coherent.Browser.Mozilla){setTimeout(function(){c(a)},100)}else{c(a)}function c(f){var g=f.target||f.srcElement,h=b.pages[b.pgOn].right-6,d=b.listElements().indexOf(g.parentNode);if(d>=(b.viewNum*b.pgOn)&&(b.listElements()[(b.viewNum*b.pgOn)])){b.moveLeft(f,true)}else{if(d<=h-1&&(b.listElements()[h-1])){b.moveRight(f,true)}}}},fireEvent:function(a){a.eVar=this.OMNITURE_PROPERTY_NAME;a.page=s.pageName;apple.metrics.fireMicroEvent(a)},arrowTransitionEnd:function(){Element.removeClassName(this.leftArrow,"animate");Element.removeClassName(this.rightArrow,"animate");Element.removeClassName(this.leftArrow,"slow");Element.removeClassName(this.rightArrow,"slow");Element.removeClassName(this.leftArrow,"fast");Element.removeClassName(this.rightArrow,"fast")},animateArrowLeft:function(a){Element.addClassName(this.leftArrow,"animate");if(a){Element.removeClassName(this.leftArrow,"slow");Element.addClassName(this.leftArrow,"fast");Element.addClassName(this.leftArrow,"in")}else{Element.removeClassName(this.leftArrow,"fast");Element.addClassName(this.leftArrow,"slow");Element.removeClassName(this.leftArrow,"in")}},animateArrowRight:function(a){Element.addClassName(this.rightArrow,"animate");if(a){Element.removeClassName(this.rightArrow,"slow");Element.addClassName(this.rightArrow,"fast");Element.addClassName(this.rightArrow,"in")}else{Element.removeClassName(this.rightArrow,"fast");Element.addClassName(this.rightArrow,"slow");Element.removeClassName(this.rightArrow,"in")}},animateArrowLoad:function(){if(coherent.Browser.Chrome||coherent.Browser.Safari){Event.observe(this.leftArrow,this.EVENT.transitionEnd,this.arrowTransitionEnd.bind(this));Event.observe(this.rightArrow,this.EVENT.transitionEnd,this.arrowTransitionEnd.bind(this))}else{Event.observe(this.leftArrow,"transitionend",this.arrowTransitionEnd.bind(this));Event.observe(this.rightArrow,"transitionend",this.arrowTransitionEnd.bind(this))}},moveLeftInitial:function(f,g,k){var a=0;var d=this.liWidth;var h=this.offsetValue;if(k<1){k=1}else{if(k>this.pgNos){k=this.pgNos}}var c=(this.pages[k].right-this.pages[1].right)*-d+h*this.pages[k].offset;this.rightMore=k<this.pgNos;if(coherent.Browser.IE&&coherent.Browser.IE<=9){c=this.originalLeftMargin=this.originalLeftMargin+(this.pages[k].right-this.pages[1].right)*-d+h*this.pages[k].offset;coherent.Animator.setStyles(this.list(),{marginLeft:(c)},{delay:0,duration:0})}else{if(coherent.Browser.MobileSafari){this.gotoPage(this.pgOn,0);Event.stop(event)}else{for(a;a<f;a++){if(coherent.Browser.Chrome||coherent.Browser.Safari){Element.setStyle(g[a],this.STYLE.transform,"translateX("+c+"px )")}else{if(coherent.Browser.Mozilla){g[a].style.MozTransform="translateX("+c+"px)"}else{g[a].style.transform="translateX("+c+"px)"}}}}}},leftMovement:function(n,m,q,h){var o=0;var g=n;var k=this.listElements().length;var a=this.liWidth;var f=this.offsetValue;if(q<1){q=1}else{if(q>this.pgNos){q=this.pgNos}}var d=(this.pages[q].right-this.pages[1].right)*-a+f*this.pages[q].offset;this.rightMore=q<this.pgNos?true:false;if(this.rightMore){d+=this.leftArrowWidth}if(coherent.Browser.IE&&coherent.Browser.IE<=9){d=this.originalLeftMargin=this.originalLeftMargin+(this.pages[q].right-this.pages[q-1].right)*-a+f*this.pages[q].offset;if(this.rightMore){d+=this.leftArrowWidth}if(h){this.list().style.marginLeft=d+"px"}else{coherent.Animator.setStyles(this.list(),{marginLeft:(d)},{delay:0,duration:500})}}else{function c(){if(o<n){if(coherent.Browser.Chrome||coherent.Browser.Safari){Element.setStyle(m[o],"-webkit-transform","translateX("+d+"px )");if(!h){m[o].style["-webkit-transition-duration"]="0.4s"}}else{if(coherent.Browser.Mozilla&&coherent.Browser.IE!==11){m[o].style.MozTransform="translateX("+d+"px)";if(!h){m[o].style.MozTransition="0.4s"}}else{m[o].style.transform="translateX("+d+"px)";if(!h){m[o].style["transition-duration"]="0.4s"}}}o++;g--;if(h){c()}else{setTimeout(c,3*g)}}}c()}this.animateArrowLeft(true);this.animateArrowRight(false)},rightMovement:function(m,k,n,g){var f=m-1;var h=this.listElements().length;var a=this.liWidth;var d=this.offsetValue;if(n<1){n=1}else{if(n>this.pgNos){n=this.pgNos}}var c=((this.pages[n].right)-(this.pages[1].right))*-a+d*this.pages[n].offset;this.leftMore=n>1?true:false;if(this.leftMore){c+=this.leftArrowWidth}if(coherent.Browser.IE&&coherent.Browser.IE<=9){if(n===1){c=this.originalLeftMargin=0}else{c=this.originalLeftMargin=this.originalLeftMargin+(this.pages[n+1].right-this.pages[n].right)*a-d*this.pages[n+1].offset;if(this.leftMore){c+=this.leftArrowWidth}}if(g){this.list().style.marginLeft=c+"px"}else{coherent.Animator.setStyles(this.list(),{marginLeft:(c)},{delay:0,duration:500})}}else{function b(){if(f>=0){if(coherent.Browser.Chrome||coherent.Browser.Safari){Element.setStyle(k[f],"-webkit-transform","translateX("+c+"px )");if(!g){k[f].style["-webkit-transition-duration"]="0.4s"}}else{if(coherent.Browser.Mozilla&&coherent.Browser.IE!==11){k[f].style.MozTransform="translateX("+c+"px)";if(!g){k[f].style.MozTransition="0.4s"}}else{k[f].style.transform="translateX("+c+"px)";if(!g){k[f].style["transition-duration"]="0.4s"}}}f--;if(g){b()}else{setTimeout(b,3*f)}}}b()}this.animateArrowRight(true);this.animateArrowLeft(false)},moveLeft:coherent.Browser.MobileSafari?function(a){Event.stop(a);this.fireEvent({action:"right",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.gotoPage(this.pgOn+1,this.MOMENTUM_DURATION)}:function(b,a){Event.stop(b);this.fireEvent({action:"right",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.pgOn++;if(this.pgOn>this.pgNos){this.pgOn=this.pgNos}this.setStorageValue(this.PAGE_NO_SESSION_KEY,this.pgOn);this.leftMovement(this.listElements().length,this.listElements(),this.pgOn,a)},moveRight:coherent.Browser.MobileSafari?function(a){Event.stop(a);this.fireEvent({action:"left",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.gotoPage(this.pgOn-1,this.MOMENTUM_DURATION)}:function(b,a){Event.stop(b);this.fireEvent({action:"left",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.pgOn--;if(this.pgOn<1){this.pgOn=1}this.setStorageValue(this.PAGE_NO_SESSION_KEY,this.pgOn);this.rightMovement(this.listElements().length,this.listElements(),this.pgOn,a)},gotoPage:function(f,b){if(f<1){f=1}else{if(f>this.pgNos){f=this.pgNos}}this.pgOn=f;this.setStorageValue(this.PAGE_NO_SESSION_KEY,this.pgOn);var a=this.liWidth;var c=this.offsetValue;this.rightMore=f<this.pgNos;this.leftMore=f>1;var d=(this.pages[f].right-this.pages[1].right)*-a+c*this.pages[f].offset;this.momentum(d,b);this.animateArrowRight(this.rightMore);this.animateArrowLeft(this.leftMore);this.currentOffsetX=-d},translateX:("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix())?function(a){Element.setStyle(this.list(),this.STYLE.transform,"translate3d("+a+"px, 0, 0)")}:function(a){if(shouldAddResistance){offset=offset/2}Element.setStyle(this.list(),this.STYLE.transform,"translateX("+a+"px)")},getEvent:"ontouchstart" in window?function(a){return(a.targetTouches&&a.targetTouches[0]||a)}:function(a){return a},bindTouchEvents:function(){this.onTouchStart=this.onTouchStart.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);Event.observe(this.viewElement(),this.EVENT.touchStart,this.onTouchStart);Event.observe(this.viewElement(),this.EVENT.touchCancel,this.onTouchEnd);Event.observe(this.list(),this.EVENT.transitionEnd,this.momentumEnd.bind(this))},momentumEnd:function(a){Element.setStyle(this.list(),this.STYLE.transitionDuration,"0");Element.removeClassName(this.list(),"animate");this.arrowTransitionEnd()},momentum:function(c,b){var a={};a[this.STYLE.transform]="translateX("+c+"px)";a[this.STYLE.transitionDuration]=b+"ms";Element.addClassName(this.list(),"animate");Element.setStyles(this.list(),a)},isTouchActionValid:function(a){return a&&a.touches&&a.touches.length===1},onTouchStart:function(a){this.isValidMove=this.isTouchActionValid(a);var b=this.getEvent(a);Event.observe(this.viewElement(),this.EVENT.touchMove,this.onTouchMove);Event.observe(this.viewElement(),this.EVENT.touchEnd,this.onTouchEnd);this.currentOffsetX=this.currentOffsetX||0;this.startX=b.pageX;this.startTime=a.timeStamp},onTouchMove:function(a){if(!this.isValidMove){return}Event.stop(a);this.hasSwiped=true;var b=this.getEvent(a);this.finalX=b.pageX;var d=this.addResistance(this.finalX-this.startX);var c=d-this.currentOffsetX;this.translateX(c)},addResistance:function(b,a){if((this.pgOn===1&&b>0)||(this.pgOn===this.pgNos&&b<0)){return b*this.RESISTANCE_FACTOR}return b},onTouchEnd:function(c){this.isValidMove=false;var f=this.getEvent(c);var a=this.finalX-this.startX;var d=c.timeStamp-this.startTime;var b=a/d;if(this.hasSwiped){if(a>=this.movementThreshold){this.onSwipeRight(c,d)}else{if(a>=this.MINIMUM_MOVEMENT_THRESHOLD&&b>this.MINIMUM_VELOCITY_THRESHOLD){this.onSwipeRight(c,d)}else{if(a<-this.movementThreshold){this.onSwipeLeft(c,d)}else{if(a<-this.MINIMUM_MOVEMENT_THRESHOLD&&b<-this.MINIMUM_VELOCITY_THRESHOLD){this.onSwipeLeft(c,d)}else{this.gotoPage(this.pgOn,d)}}}}}else{this.gotoPage(this.pgOn,d)}Event.stopObserving(this.viewElement(),this.EVENT.touchMove,this.onTouchMove);Event.stopObserving(this.viewElement(),this.EVENT.touchEnd,this.onTouchEnd);this.hasSwiped=false},onSwipeRight:function(a,b){this.fireEvent({action:"right",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.gotoPage(this.pgOn-1,this.ELASTIC_MOMENTUM_DURATION)},onSwipeLeft:function(a,b){this.fireEvent({action:"left",feature:this.OMNITURE_SCROLL_FEATURE_NAME});this.gotoPage(this.pgOn+1,this.ELASTIC_MOMENTUM_DURATION)}});LateralNavInstances=(function(){var a=[];Event.onDomReady(function(){var c=Element.queryAll(".lateral-navbar");for(var d=0,b=c.length;d<b;d++){a.push(new apple.LateralNav(c[d]))}});return a})();Package("apple");apple.VisualLimitTextField=Class.create(coherent.TextField,{defaultOptions:{thermometerWidth:74,thermometerSpriteOffset:8,maxLength:500},init:function(){this.options=Object.applyDefaults(this.options,this.defaultOptions);this.getConfiguration();this.getThermometerElement();this.getMaxLengthAttribute();this.clearDefaultText();this.hideThermometerUntilThresholdIsReached();this.createThermometerMarkup();this.addObserverForKeyPath(this,this.observeErrorMessageChange,"errorMessage");this.setValueForKey(false,"blackWordError");this.displayServerMessages();this.updateThermometer();Event.observe(this.viewElement(),"paste",this.onpaste.bind(this))},getConfiguration:function(){this.config=window.visualLimitTextFieldConfig;this.textStrings=window.visualLimitTextFieldTextStrings},getThermometerElement:function(){var a=this.viewElement().id+"Thermometer";this.thermometer=document.getElementById(a)},getMaxLengthAttribute:function(){this.options.maxLength=this.viewElement().getAttribute("maxlength");this.viewElement().removeAttribute("maxlength")},clearDefaultText:function(){if(this.thermometer){while(this.thermometer.childNodes.length>=1){this.thermometer.removeChild(this.thermometer.firstChild)}}},hideThermometerUntilThresholdIsReached:function(){if(this.thermometer){this.thermometer.style.display="none"}},createThermometerMarkup:function(){if(this.thermometer){this.thermometer.background=document.createElement("div");this.thermometer.meter=document.createElement("div");this.thermometer.overlay=document.createElement("div");this.thermometer.background.className="textfieldThermometerBackground";this.thermometer.meter.className="textfieldThermometerMeter";this.thermometer.overlay.className="textfieldThermometerOverlay";this.thermometer.background.appendChild(this.thermometer.meter);this.thermometer.background.appendChild(this.thermometer.overlay);this.thermometer.appendChild(this.thermometer.background)}},onkeyup:function(a){this.validate();if(!this.continuallyUpdatesValue){return}if(this.updateTimer){window.clearTimeout(this.updateTimer)}this.updateTimer=this.valueChanged.bindAndDelay(this,this.keypressUpdateTimeout)},onpaste:function(a){this.validate();this.checkForBlackWords.bind(this).delay(10)},valueChanged:function(a){if(this.updateTimer){window.clearTimeout(this.updateTmer);this.updateTimer=null}if(this.markerValue){return}this.checkForBlackWords()},checkForBlackWords:function(){var a={t:this.viewElement().value};this.ajaxResponse=JSONRPC.post(this.config.messageValidatorUrl,a);this.ajaxResponse.addCallback(this.processAjaxResponse.bind(this))},processAjaxResponse:function(){if(this.ajaxResponse&&this.ajaxResponse._result&&this.ajaxResponse._result.status=="ERROR"){this.setValueForKey(this.ajaxResponse._result.error,"blackWordError")}else{this.setValueForKey(false,"blackWordError")}this.validate()},displayServerMessages:function(){var d=this.viewElement().id+"Error";var b=document.getElementById(d);if(b){var c=b.getElementsByTagName("li");var a=c[c.length-1].firstChild.nodeValue;this.setValueForKey(a,"errorMessage")}},validate:function(){var a;this.updateThermometer();this.updateValueBinding();if(this.valueIsOverMaxLength()){this.limitValueToMaxLength();this.setValueForKey(this.textStrings.maxLengthError,"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});return a}else{if(this.valueForKey("blackWordError")){this.setValueForKey(this.valueForKey("blackWordError"),"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});this.presentError(a);return a}else{if(this.valueIsAtMaxLength()){this.setValueForKey(this.textStrings.maxLengthError,"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});this.presentError(a);return true}else{this.setValueForKey(null,"errorMessage");return true}}}},updateValueBinding:function(){if(this.bindings.value){this.bindings.value.setValue(this.viewElement().value)}},valueIsOverMaxLength:function(){if(this.viewElement().value.length>this.options.maxLength){return true}return false},valueIsAtMaxLength:function(){if(this.viewElement().value.length>=this.options.maxLength){return true}return false},limitValueToMaxLength:function(){var a=this.viewElement().value.substr(0,this.options.maxLength);this.viewElement().value=a},updateThermometer:function(){this.setMeasurements();this.updateMeterPosition();this.showThermometerWhenThresholdIsReached()},setMeasurements:function(){this.currentLength=this.viewElement().value.length;this.percentFull=parseInt(this.currentLength/this.options.maxLength*100,10);this.percentFull=(this.percentFull>100)?100:this.percentFull;this.meterWidth=parseInt(this.options.thermometerWidth*this.percentFull/100,10);this.meterSpriteOffset=this.options.thermometerWidth-this.meterWidth},updateMeterPosition:function(){if(this.thermometer){var a="-"+this.meterSpriteOffset+"px -"+this.options.thermometerSpriteOffset+"px";this.thermometer.meter.style.backgroundPosition=a}},showThermometerWhenThresholdIsReached:function(){if(this.thermometer){if(this.percentFull>=this.config.thermometerThreshold){this.thermometer.style.display="block"}}},hideThermometer:function(){if(this.thermometer){this.thermometer.style.display="none"}},observeErrorMessageChange:function(b){if(b.newValue!=b.oldValue){this.hideError()}if(!b.newValue){return}var a=new coherent.Error({description:b.newValue});this.presentError(a)},presentError:function(a){coherent.Bubble.display({classname:"bubble overlay-bubble",error:a,target:this.viewElement(),dimensions:{width:350,height:35}})},reset:function(){this.viewElement().value="";this.setValueForKey(null,"errorMessage");this.setValueForKey(false,"blackWordError");this.hideError();this.updateThermometer();this.hideThermometer()},hideError:function(){coherent.Bubble.hide({target:this.viewElement()})}});Package("apple");apple.FilterArticleSelect=Class.create(coherent.SelectField,{init:function(){Event.observe(this.viewElement(),"change",this.filter.bindAsEventListener(this))},filter:function(){window.location.href=this.viewElement().value}});Package("apple");apple.CommunityViewController=Class.create(coherent.ViewController,{addStructureProperty:function(b,a){if(a&&"function"==typeof(a)&&(a=a.valueOf()).__factoryFn__){return a.call(this,b,false)}return null},readMore:function(b){var c="description";var d=" expand";var a=b.viewElement().parentNode;while(a&&a!=document.body){if(a.className==c){a.className+=d;break}a=a.parentNode}if(a){a.setAttribute("tabindex","-1");a.focus()}this.forceIEtoRedraw()},forceIEtoRedraw:function(){if(coherent.Browser.IE===7){Array.forEach(Element.queryAll("div.bottom-corners, ul.pipe-list"),function(a){a.style.display="none";a.style.display="block"})}},showReportInappropriateOverlay:function(a){this.storeReportInappropriateOptions(a);if(this.dialog){window.reportInappropriateViewController.setOptions();this.displayDialog()}else{this.dialog=new apple.Dialog();if(!this.dialog||!window.reportInappropriateUrl){return}this.displayDialog()}},displayDialog:function(){this.dialog.overlay.display({url:window.reportInappropriateUrl,classname:"overlay modal-overlay community"})},storeReportInappropriateOptions:function(a){window.reportInappropriateOptions={url:a.viewElement?a.viewElement().href:a.target.href,contentType:a.contentType}}});Package("apple");apple.QuestionSearchForm=Class.create(coherent.Form,{searchField:coherent.TextField('input[type="text"]',{valueBinding:"searchValue",action:"searchQuestions",sendsActionOnEndEditing:false}),__structure__:{".search-reset":coherent.Anchor({visibleBinding:"showReset",action:"resetSearchField"}),'button[name="search"]':coherent.Button({action:"searchQuestions"}),'button[name="post"]':coherent.Button({action:"submitQuestion"})},init:function(){this.base();this.setupSearchField();this.setupMultipleFormActions();this.toggleResetButton();this.forceIEtoRedraw();this.fixCommunitySearchIE();Event.observe(this.searchField.viewElement(),"focus",this.focusInputWrapper.bindAsEventListener(this));Event.observe(this.searchField.viewElement(),"blur",this.focusInputWrapper.bindAsEventListener(this))},fixCommunitySearchIE:function(){if(coherent.Browser.IE===7&&Element.query(".community-search")){var c=Element.getStyles(Element.query(".community-search"),["width","paddingLeft","paddingRight","borderWidth"]);var b=Element.getStyles(Element.query(".community-search .button-wrapper"),["width"]);var a=Element.getStyles(Element.query(".community-search .input-wrapper .effects"),["paddingLeft","paddingRight","borderWidth"]);var d=apple.QuestionSearchForm.stripPx;Element.query(".community-search .input-wrapper").style.width=d(c.width)-d(c.paddingLeft)-d(c.paddingRight)*2-d(c.borderWidth)*2-d(b.width)-d(a.paddingLeft)-d(a.paddingRight)-d(a.borderWidth)*2}},forceIEtoRedraw:function(){if(coherent.Browser.IE===7){Array.forEach(Element.queryAll("div.bottom-corners"),function(a){a.style.display="none";a.style.display="block"})}},setupSearchField:function(){if(this.searchField){this.searchField.nullPlaceholder=this.searchField.viewElement().getAttribute("placeholder");this.searchField.viewElement().removeAttribute("placeholder");apple.behavior.TextFieldPlaceholder(this.searchField);this.addObserverForKeyPath(this,this.toggleResetButton,"searchValue")}},setupMultipleFormActions:function(){this.actions={searchQuestions:this.viewElement().action,submitQuestion:window.questionPostAction}},searchQuestions:function(){if(!this.searchFieldIsBlank()){this.viewElement().action=this.actions.searchQuestions;this.delayedFormSubmit.bindAndDelay(this,25)}},submitQuestion:function(){if(!this.searchFieldIsBlank()){this.viewElement().action=this.actions.submitQuestion;this.delayedFormSubmit.bindAndDelay(this,25)}},delayedFormSubmit:function(){this.action=null;this.viewElement().submit()},searchFieldIsBlank:function(){if(!this.valueForKey("searchValue")){this.setValueForKey("","searchValue")}if(this.valueForKey("searchValue").replace(/^\s+$/,"").length<1){return true}return false},toggleResetButton:function(){if(this.searchField.viewElement().value.length>0){this.setValueForKey(true,"showReset")}else{this.setValueForKey(false,"showReset")}},resetSearchField:function(){this.setValueForKey("","searchValue");this.toggleResetButton()},focusInputWrapper:function(){Element.toggleClassName(this.searchField.viewElement().parentNode.parentNode,"focus");this.parentForm=this.parentForm||Element.locateAncestor(this.searchField.viewElement(),function(a){return a.tagName.toLowerCase()=="form"});if(this.parentForm){Element.toggleClassName(this.parentForm,"focus")}}});apple.QuestionSearchForm.stripPx=function(a){return parseInt(a.slice(0,-2),10)};Package("apple");apple.QuestionAnswerViewController=Class.create(apple.CommunityViewController,{contributionForm:coherent.Form("form.contribution"),questionAsked:apple.VisualLimitTextField("textarea#question-asked"),questionDescription:apple.VisualLimitTextField("textarea#question-description"),answerText:apple.VisualLimitTextField("textarea#answer-text"),__structure__:{"form.question-search":apple.QuestionSearchForm(),"form.community-search":apple.QuestionSearchForm(),"select.filter-article":apple.FilterArticleSelect(),"#follow-overlay-trigger a":coherent.Anchor({action:"showFollowOverlay"}),".question a.report-inappropriate-link":coherent.Anchor({contentType:"question",action:"showReportInappropriateOverlay"}),".answer a.report-inappropriate-link":coherent.Anchor({contentType:"answer",action:"showReportInappropriateOverlay"}),".description span.more a":coherent.Anchor({action:"readMore"})},init:function(){this.focusTextFieldsOnPageLoad();this.setupContributionForm();if(window.questionUrl){this.questionUrl.bindAndDelay(this,1500)}if(Element.query(".filter-article")&&Element.query(".filter-article .selected")){Element.query(".filter-article").selectedIndex=Element.query(".filter-article .selected").index}},showFollowOverlay:function(){var a={classname:"bubble community follow-overlay",within:document.getElementById("page"),sourceId:Element.assignId(document.getElementById("question-subscribe")),target:document.getElementById("follow-overlay-trigger")};apple.FollowOverlay.display(a)},focusTextFieldsOnPageLoad:function(){if(this.questionAsked){this.questionAsked.focus()}if(this.answerText){this.answerText.focus()}},setupContributionForm:function(){if(this.contributionForm){Event.observe(this.contributionForm.viewElement(),"submit",this.validateContributionForm.bind(this))}},validateContributionForm:function(a){if(!(this.contributionForm.validateFields())){Event.stop(a)}},questionUrl:function(){this.questionUrlRequest=JSONRPC.get(window.questionUrl)}});apple.A11yAlert=function(){var a=$("aria-alert-wrapper");if(!a){var b=document.createElement("div");b.id="aria-alert-wrapper";return new apple.A11yAlertView(document.body.appendChild(b),{text:""},{textBinding:"*.text"})}else{return coherent.View.fromNode(a)}};apple.A11yAlertView=Class.create(coherent.View,{wrapper:Part(".aria-alert-text-wrapper"),innerHTML:'<div class="a11y aria-alert-container" role="alert"><p class="aria-alert-text-wrapper" aria-live="assertive" aria-relevant="additions"></p></div>',alertPersistence:1000,observeTextChange:function(b){var a=b.newValue;if(!(""+a).length){this.clear();return}if(this._activeTimeout){window.clearTimeout(this._activeTimeout);this.clear()}this.wrapper().appendChild(document.createTextNode(""+a));this._activeTimeout=window.setTimeout(this.say.bind(this,""),this.alertPersistence)},clear:function(){var a=this.wrapper();if(a){Element.setInnerHTML(a,"")}},say:function(a){this.__relativeSource.setValueForKeyPath(a,"text")}});Package("apple.transaction");apple.transaction.TextBox=Class.create(coherent.TextField,{validate:function(){var h=this.viewElement();var m=h.value;var d;if(!h.disabled){if(this.formatter){var b=!!window.chrome;if(b&&"truncateExtraBytes" in this.formatter&&typeof(this.formatter.truncateExtraBytes)==="function"){var m=this.formatter.truncateExtraBytes(h)}var n=this.formatter.isStringValid(m);if(n!==true){d=n;this.presentError(d)}var c=m;m=this.formatter.valueForString(m);if(m!=h.value){h.value=m}}if(this.bindings.value){m=this.bindings.value.validateProposedValue(m);if(m instanceof coherent.Error){d=m;this.presentError(m)}if(m!=this.bindings.value.value()){this.bindings.value.setValue(m)}}this.clearErrorsIfNecessary(d)}var h=this.viewElement(),g=this.validationError,f=Element.assignId(h),a=f+"-error",k=Element.query("#"+a);if(g){if(!k){k=document.createElement("span");k.id=a;k.appendChild(document.createTextNode(this.validationError.description));k.className="field-error";h.parentNode.parentNode.insertBefore(k,h.parentNode)}h.setAttribute("aria-invalid","true");this.addAttributeValue(h,"aria-describedby",a)}else{h.setAttribute("aria-invalid","false");this.removeAttributeValue(h,"aria-describedby",a);if(k){k.parentNode.removeChild(k)}}return d||m},acceptsFirstResponder:function(){this.initialValue=this.viewElement().value;return this.base()},hasAttributeValue:function(c,a,b){return c.getAttribute(a)&&c.getAttribute(a).match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addAttributeValue:function(d,a,c){if(!this.hasAttributeValue(d,a,c)){var b=d.getAttribute(a);if(b&&b.length){c=b+" "+c}d.setAttribute(a,c)}},removeAttributeValue:function(d,a,c){var b=new RegExp("(\\s|^)"+c+"(\\s|$)");var f=d.getAttribute(a);if(f&&f.match(b)){d.setAttribute(a,f.replace(b," "));if(!d.getAttribute(a).length){d.removeAttribute(a)}}},observeValueChange:function(d,a,c){var b=this.hasFocus;this.initialValue=d.newValue;this.hasFocus=false;this.base(d,a,c);this.clearAllErrors();this.hasFocus=b},observeEnabledChange:function(d){if(this.resetOnDisable){var c=this.bindings.value;if(d.newValue){if(c&&this.lastEnteredValue){c.object.setValueForKeyPath(this.lastEnteredValue,c.keyPath)}}else{if(c){this.lastEnteredValue=c.value()}this.clearAllErrors();if(this.viewElement()){var b=this.viewElement(),a=Element.query($(b.parentNode),"label");b.value=null;Element.removeClassName(a,"hidden")}}}this.base(d)},resignFirstResponder:function(b){var a=this.viewElement();if(a&&a.nodeName!="INPUT"&&a.nodeName!="TEXTAREA"){return null}if(this.initialValue!=a.value){this.validate()}return this.base(b)},valueChanged:function(b){if(this.updateTimer){window.clearTimeout(this.updateTimer);this.updateTimer=null}if(this.markerValue){return}var a=this.viewElement();if(b&&b.type==="change"){if(a.value){a.value=a.value.replace(/^\s+|\s+$/g,"")}}this.validate()},willPresentError:function(b){var a=this.viewElement();if(Element.hasClassName(a,"error-below")){b.position="below"}},clearErrorsIfNecessary:function(b){if(b&&(b instanceof coherent.Error)){return}var a=this.bindings.errorMessage;if(a&&a.value()){this.bindings.errorMessage.setValue(null)}if(this.validationError){this.clearAllErrors()}},clearAllErrors:function(){var a=this.viewElement();this.base();a.setAttribute("aria-invalid","false");a.removeAttribute("aria-describedby")}});Package("apple.financeCalculator");apple.financeCalculator.LoanValueFormatter=Class.create(coherent.Formatter,{parser:null,field:null,isStringValid:function(g){var c,d,a,h=[],b=this.field&&this.field.viewElement(),f=b.getAttribute("data-separator")||null;d=(b&&parseFloat(b.getAttribute("min")))||0;a=(b&&parseFloat(b.getAttribute("max")))||null;c=(this.parser&&this.parser(g,f))||NaN;if(isNaN(c)){h.push("invalid-number")}else{if(d>c){h.push("below-min")}if(a!==null&&a<c){h.push("above-max")}}if(h.length>0){h.push("invalid");return new coherent.Error({description:h})}return true},isValidInputCharacter:function(a){return true},stringForValue:function(a){return(null===a||"undefined"===typeof(a))?"":String(a)},valueForString:function(a){return a}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorModel=Class.create({dom:{content:{query:"#finance-calculator"},errorOverlay:{query:"#finance-calculator-overlay-error",html:'<div role="dialog" id="finance-calculator-overlay-error" class="finance-calculator-overlay overlay"></div>'},overlay:{query:"#finance-calculator-overlay",html:'<div role="dialog" id="finance-calculator-overlay" class="finance-calculator-overlay overlay" aria-labelledby="finance-calculator-title"></div>'},wrapper:{html:'<div id="finance-calculator-wrapper"></div>',query:"#finance-calculator-wrapper"}},getInitialContent:function(a,b){this.requestContent(a||null,null,b)},getInstallmentsContent:function(a,b,c){this.requestContent(a,{amount:b},c)},getInterstitialContent:function(a,b){this.requestContent(a,null,b)},requestContent:function(a,c,g,f){var b={};c=c||{};b.responseContentType=f||"text/html";function d(h){if(g){g(h||false)}}XHR.get(a,c,b).addMethods(d,d)}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorView=Class.create(coherent.View,{__structure__:{".close-button":coherent.Button({action:"close"}),"#finance-calculator-form":coherent.Form({action:"submit"}),"#finance-calculator-loanvalue":apple.transaction.TextBox({valueBinding:"currentLoanValue",errorMessageBinding:"loanValueErrors",action:"submit",sendsActionOnEndEditing:false,editable:"isValueEditable"}),"#finance-calculator-error-bubble":coherent.View({visibleBinding:"loanValueErrors"}),".results":coherent.View({htmlBinding:"installmentResults"}),"button.calculate":coherent.Button({action:"submit"}),"button.apply-now":coherent.Button({action:"displayCheckoutFinancing"}),"button.apply-now-interstitial":coherent.Button({action:"displayInterstitialContent"})},applyNowButton:Part("button.apply-now"),applyNowInterstitialButton:Part("button.apply-now-interstitial"),calculateButton:Part("button.calculate"),closeButton:Part(".close-button"),errorBubble:Part("#finance-calculator-error-bubble"),errorsContainer:Part("#finance-calculator-errors"),footer:Part(".footer"),header:Part(".header"),installmentsUrlInput:Part("#finance-calculator-installments-url"),loanValueInput:Part("#finance-calculator-loanvalue"),resultsContainer:Part("#finance-calculator-results"),checkoutFinancingTabSelectors:[".checkout #payment-loan-content-tab",".checkout #payment-lease-content-tab"],defaultHeadingText:null,inputFormatter:new apple.financeCalculator.LoanValueFormatter(),spinnerContent:'<div class="overlay-waiting"></div>',spinnerTimeout:300,init:function(){this.inputFormatter.field=coherent.View.fromNode(this.loanValueInput());this.inputFormatter.parser=apple.financeCalculator.instance.parseLoanValue;this.enableIOSZoomFix()},addStructureProperty:function(b,a){if(a&&"function"==typeof(a)&&(a=a.valueOf()).__factoryFn__){return a.call(this,b,false)}return null},clearResults:function(){var a=this.resultsContainer();Element.setStyle(a,"minHeight",Element.getDimensions(a).height+"px");this.setValueForKey("","installmentResults")},close:function(a){this.disableIOSZoomFix();apple.financeCalculator.instance.close();if(a!==false&&apple.financeCalculator.instance.isCheckoutPage()===true){apple.financeCalculator.instance.trackAction("Close")}},displayCheckoutFinancing:function(){var a=this,b;b=this.checkoutFinancingTabSelectors.some(function(d){var c=Element.query(d);if(c){a.close(false);c.click();Element.scrollDocumentTopBy(Element.getRect(c).top);return true}});if(b){apple.financeCalculator.instance.trackAction("Apply Now")}},displayInterstitialContent:function(b){var c=b.viewElement(),a=(c&&c.getAttribute("data-url"))||null;if(a){apple.financeCalculator.instance.trackAction("Apply Now (Interstitial)");apple.financeCalculator.instance.showInterstitialContent(a)}},enableIOSZoomFix:function(){if(coherent.Browser.MobileSafari===true){var a=this.loanValueInput();this.disableIOSZoomFix();Event.observe(a,"touchend",function(){setTimeout(function(){apple.financeCalculator.instance.iosRenderFix();a.focus()},500)})}},disableIOSZoomFix:function(){if(coherent.Browser.MobileSafari===true){Event.stopObserving(this.loanValueInput(),"touchend")}},fetchInstallmentResults:function(g){var b=this,a=new Date().getTime(),d=apple.financeCalculator.instance.model,c=this.installmentsUrlInput().value||null,f=this.resultsContainer();this.setValueForKey(this.spinnerContent,"installmentResults");d.getInstallmentsContent(c,g,function(m){var h=new Date().getTime()-a,k=Math.max(0,b.spinnerTimeout-h);(function(){var n=apple.financeCalculator.instance.overlay,o={};this.updateHasResultsState();Element.setStyle(f,"opacity",0);b.setValueForKey(m,"installmentResults");coherent.Animator.setStyles(f,{opacity:1});this.addStructureProperty("button.apply-now",coherent.Button({action:"displayCheckoutFinancing"}));this.resize();f.firstChild.focus()}).bindAndDelay(b,k)})},getParsedLoanValue:function(){var b=this.valueForKey("currentLoanValue"),a=this.loanValueInput().getAttribute("data-separator")||null;return apple.financeCalculator.instance.parseLoanValue(b,a)},presentError:function(a){var b=this.loanValueInput();this.updateErrorMessages(a.description);this.setValueForKey(a.description,"loanValueErrors");b.setAttribute("aria-labelledby",this.errorBubble().id);b.removeAttribute("aria-describedby");b.focus()},reset:function(){var a=this.loanValueInput();a.removeAttribute("aria-labelledby");this.setValueForKey(true,"isValueEditable");this.updateHasResultsState();this.resize();if(apple.financeCalculator.instance.isCheckoutPage()===true){this.setValueForKey(false,"isValueEditable")}},resize:function(){apple.financeCalculator.instance.resizeOverlay()},setOptions:function(a){a=a||{};if("loanValue" in a){this.setValueForKey(a.loanValue,"currentLoanValue")}},submit:function(){if(this.valueForKey("isValueEditable")===false){return}this.clearResults();apple.financeCalculator.instance.trackAction("Calculate");if(this.validate()===true){this.fetchInstallmentResults(this.getParsedLoanValue())}return false},updateErrorMessages:function(f){var d,a,c=this.errorsContainer(),b=this.loanValueInput();b.removeAttribute("aria-labelledby");d=Element.queryAll(c,"li");d.forEach(function(g){Element.removeClassName(g,"active")});if(f.length>0){a="li."+f.join(", li.");d=Element.queryAll(c,a);d.forEach(function(g){Element.addClassName(g,"active")})}},validate:function(){var b,a=coherent.View.fromNode(this.loanValueInput());a.formatter=this.inputFormatter;b=!(a.validate() instanceof coherent.Error);a.formatter=null;return b},updateHasResultsState:function(){if(this.loanValueInput().value!==""){Element.addClassName(this.viewElement(),"with-results")}}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorController=Class.create(coherent.Controller,{contentView:null,isLaunching:null,model:null,overlay:null,errorOverlay:null,opts:null,constructor:function(){this.model=new apple.financeCalculator.FinanceCalculatorModel();this.createDOMContainers()},createDOMContainers:function(){var a=this.model.dom;if(!Element.query(a.wrapper.query)){document.body.appendChild(this.createElementFromHtml(a.wrapper.html))}if(!this.overlay&&!Element.query(a.overlay.query)){document.body.appendChild(this.createElementFromHtml(a.overlay.html));this.overlay=new coherent.Overlay(Element.query(a.overlay.query))}},createElementFromHtml:function(a){var b=document.createElement("div");Element.setInnerHTML(b,a);return b.firstChild},createOverlay:function(a,b){this.model.getInitialContent(a,function(d){var c,f=this.model.dom;if(d===false){this.showErrorOverlay()}else{this.destroyContentView();c=Element.query(this.model.dom.wrapper.query);Element.setInnerHTML(c,d);this.contentView=new apple.financeCalculator.FinanceCalculatorView(Element.query(f.content.query));b()}}.bind(this))},destroyContentView:function(){var a=Element.query(this.model.dom.content.query);if(a){coherent.View.teardownViewsForNodeTree(a)}},getSelectedCheckoutFinancingTab:function(){var a;if(this.isCheckoutPage()){a=Element.queryAll("#payment-form-nav .current");if(a.length===1){return a[0].getAttribute("id")}}return false},iosRotationFix:function(){var b=Element.query("#finance-calculator-title"),a=b.innerHTML;b.innerHTML+="<span/>";b.innerHTML=a},isCheckoutPage:function(){return(Element.hasClassName(document.body,"checkout"))},launch:function(b){var a;this.opts=b;if(this.isLaunching===true){return}this.isLaunching=true;if(this.isCheckoutPage()){a=this.getSelectedCheckoutFinancingTab()}this.opts.trackingPart=a||((this.opts.loanValue!==null)?"above-threshold":"");this.createOverlay(b.contentUrl,function(){this.showOverlay(b);this.isLaunching=false;if(coherent.Browser.MobileSafari===true){Element.setStyles(this.overlay.contentScreen,{position:"fixed",height:"100%","-webkit-box-reflect":"below"})}}.bind(this))},parseLoanValue:function(b,c){var f,a,d=/^([\s,.]?\d)+?$/;if(!b||b.length===0||d.test(b)===false){return NaN}c=c||".";f=b.split("");a=[];f.forEach(function(h,g){if(/\d/.test(h)===true){a.push(h)}else{if(h===c){a.push(".")}}});return parseFloat(a.join(""))},resizeOverlay:function(m){var b=this.overlay,k=this.contentView.viewElement(),g=Element.getDimensions(k),d=g.height,a=g.width,c="px",f={width:a+c,height:d+c,marginLeft:(-a/2)+c,marginTop:(-d/2)+c};Element.setStyles(b.viewElement(),f)},showErrorOverlay:function(){var d,b,a=this,c=this.model.dom;if(!this.errorOverlay){b=this.createElementFromHtml(c.errorOverlay.html);d=Element.query(c.wrapper.query);d.appendChild(b);this.errorOverlay=new coherent.Overlay(b)}this.errorOverlay.display({html:a.errorOverlay.errorInnerHTML})},showOverlay:function(b){var a;if(!this.contentView){return}this.contentView.reset();this.contentView.setOptions(b);this.overlay.display({sourceId:this.contentView.viewElement().getAttribute("id")});a=this.overlay.viewElement();if(a){document.body.appendChild(a)}if(coherent.Browser.MobileSafari===true){Event.observe(window,"orientationchange",this.iosRotationFix.bind(this))}this.trackAction("Launch")},showInterstitialContent:function(a){this.model.getInterstitialContent(a,function(b){if(b===false){this.showErrorOverlay()}else{this.destroyContentView();this.overlay.display({html:b})}}.bind(this))},trackAction:function(d,a){var b=apple.metrics||null,c={eVar:"eVar21",slot:"",feature:"Finance Calculator",action:d||null};c.part=a||this.opts.trackingPart||"";if(!b||!c.action){return}b.fireMicroEvent(c)},close:function(){if(this.overlay){this.overlay.hide()}if(coherent.Browser.MobileSafari===true){Event.stopObserving(window,"orientationchange",this.iosRotationFix.bind(this))}}});Package("apple.financeCalculator");apple.financeCalculator.bootstrap=function(){var c="a.finance-calculator-link";function a(d){var f={};d=d||"";d.split("&").map(function(g){if(g.indexOf("=")<0){return}g=g.split("=").map(decodeURIComponent);f[g[0]]=g[1]});return f}function b(h,d){var k,f,g={};if(!h.nodeName||h.nodeName.toLowerCase()!=="a"){return}Event.stop(d);k=h.getAttribute("href");if(k){f=new coherent.URL(k);f.query=a(f.query);g={contentUrl:f.url,loanValue:f.query.amount||null,page:f.query.page||null}}if(!apple.financeCalculator.instance){apple.financeCalculator.instance=new apple.financeCalculator.FinanceCalculatorController()}apple.financeCalculator.instance.launch(g)}Event.observe(document.body,"click",function(d){var f=d.target||d.srcElement;while(f!==document.body&&f.nodeName.toLowerCase()!=="a"&&f.parentNode){f=f.parentNode}if(Element.match(f,c)){b(f,d)}})};if(Event.onDomReady){Event.onDomReady(apple.financeCalculator.bootstrap)}else{Event.onLoad(apple.financeCalculator.bootstrap)}window.apple.mvt={};apple.mvt.activate=function(){if(window.optimizely&&window.optimizely.push&&window.optimizely.activateSiteCatalyst){var b=apple.metrics.clone(),a;window.optimizely.push(["activate"]);window.optimizely.activateSiteCatalyst();a=apple.metrics.getNewKeyObject(b);if(!window.optimizely.$.isEmptyObject(a)){a.linkTrackVars=window.optimizely.$.map(a,function(d,c){return c}).join(",");a.linkTrackEvents="None";apple.Tracking.track(null,"MVT Activation",a,null)}}};Package("apple.behavior");apple.behavior.Overlay=(function(){if(!(coherent&&coherent.Overlay)){return null}coherent.Overlay.prototype.requestCompleteCallback=function(){apple.mvt.activate()}})();
